function t(t,s,i=0,h=0){F.push({t,time:s,i:s+h,repeat:i})}function s(t){for(let s=F.length-1;s>=0;s--){const i=F[s];if(!i)return;i.i-=t,i.i>0||(i.t(),i.repeat-- >0?i.i=i.time:F.splice(s,1))}}function i(t,s){for(const i of["x","y"])if(t[i]!==t.h[i]){const h=t.h[i]-t[i],e=Math.sign(h)*t.speed*s/1e3;Math.abs(h)>Math.abs(e)?t[i]+=e:t[i]=t.h[i]}else t.o[i]=0,t[i]=Math.round(t[i])}let h;const e=new class{constructor(){this.l=!1,this.u=!1,this.M=!1,this.p=!1,this.m=!1,this.A=!1,this.U=!1,this.v=new Map,this.k={l:this.l,u:this.u,m:this.m,A:this.A},document.addEventListener("keydown",t=>this.C(t,!0)),document.addEventListener("keyup",t=>this.C(t,!1)),this.I=new DOMPoint}P(){this.k.l=this.l,this.k.u=this.u,this.k.m=this.m,this.k.A=this.A;const t=this.v.get("KeyA")||this.v.get("KeyQ")||this.v.get("ArrowLeft")?-1:0,s=this.v.get("KeyD")||this.v.get("ArrowRight")?1:0,i=this.v.get("KeyW")||this.v.get("KeyZ")||this.v.get("ArrowUp")?-1:0,h=this.v.get("KeyS")||this.v.get("ArrowDown")?1:0;this.I.x=t+s||0,this.I.y=i+h||0,this.l=0>this.I.y,this.u=this.I.y>0,this.M=0>this.I.x,this.p=this.I.x>0,this.U=0!==this.I.x||0!==this.I.y,this.m=!!this.v.get("Enter"),this.A=!!this.v.get("Space")}C(t,s){this.v.set(t.code,s)}},a=t=>t.getContext("2d"),o=(t,s)=>{const i=((t,s)=>{const i=document.createElement("canvas");return t&&(i.width=t),s&&(i.height=s),i})(t,s);return[i,a(i)]},n=(t,s,i,h)=>128>h?[0,0,0,0]:[51*Math.round(t/51),51*Math.round(s/51),51*Math.round(i/51),255],r=(t,s=10)=>{const i=Math.floor(1.25*s),h=Math.floor(.25*s/2),[e,a]=o(i,i);a.font=s+"px sans-serif",a.textBaseline="top",a.clearRect(0,0,i,i),a.translate(-1,0),a.fillText(t,h,h);const r=a.getImageData(0,0,i,i).data,c=a.createImageData(i,i),l=c.data;for(let t=0;r.length>t;t+=4){const[s,i,h,e]=n(r[t],r[t+1],r[t+2],r[t+3]);l[t]=s,l[t+1]=i,l[t+2]=h,l[t+3]=e}const[u,f]=o(i,i);f.putImageData(c,0,0);const d=new Image;return d.src=u.toDataURL(),d},c=(t,s)=>{const i="#FF00FF",h=[i,...s],e=h.length>4?2:h.length>2?3:6,a=6/e,o=(1<<a)-1,n=document.createElement("canvas"),r=Math.sqrt(t.length*e);n.setAttribute("width",""+r),n.setAttribute("height",""+r);const c=n.getContext("2d"),l=c.createImageData(r,r),u=l.data;let f=0;[...t].map(t=>{const s=t.charCodeAt(0);for(let t=0;e>t;t++){const e=s>>t*a&o,n=(h[e]||i).replace("#",""),r=parseInt(n.substring(0,2),16),c=parseInt(n.substring(2,4),16),l=parseInt(n.substring(4,6),16),d=e?255:0;u[f]=r,u[f+1]=c,u[f+2]=l,u[f+3]=d,f+=4}}),c.putImageData(l,0,0);const d=new Image;return d.src=n.toDataURL(),d};class l{constructor(t){this.j=t,this.D={},this.H=16;for(const[s,i]of Object.entries(t.data))this.D[s]=i.map(s=>c(s,t.palette));this.H=t.size}}const u="#75a080",f="#618e70",d="#4d7c60",M="#396a50",w="#b4ecf3",p="#4e9ca6",y="#3e8791",x="#2f6269",m="#255056",g="#1f4347",b="#13282b",A="#e0b8d3",U="#714162",v="#996a8a",k="#f2daab",C="#e6a386",I="#13282b",P="#fffef9",j={size:10,frames:4,palette:[I],data:{0:["@@@`@PJbcxpO|AQ@@","@@@`@DJbcxpO|AQ@@","@@@@h@nag|pG|AQ@@","@@@@@@z`SxxO|AQ@@"],1:["@@@`@DJbcxpO|AR@@","@@@P@HJdCy`OpC`@@","@@@@@DJbCy`OxCR@@","@@@H@DJbcxpO|AA@@"],2:["@@@@@@@`ZxyO~@B@@","@@@@@@J`_|xG~@E@@","@@@@@@@`ZxyO~PB@@","@@@@@@J`CxG~@D@@"],3:["@@@@AHJdCy`OxCb@@","@@@@@@jcC`C@@@@@","@@@@@@@@@x|oxG@@@","@@@@@@@@@@@N~yC@"],4:["@@@`@DJbcxpO|AQ@@","@@@@@BPhHN|Ka@@@","@@@D@BEqQ\\xG~`P@@","@@@P@DJbcxpO|AQ@@"],5:["@`@H@F`Wy_~GsPD@@","@`@H@B`Qy_~GwPD@@","@`@H@F`Wy_~GsPD@@","@`@H@B`Qy_~GwPD@@"],6:["@@@@@@@@@h~_~K@@@","@@@@@@@`Bx~_~E@@@","@@@@@@@`Bx}o~A@@@","@@@@@@@@@h|~C@@@"],7:["@@PA\\@GxFV~IL@A@@","@@PA\\@gxHv|AL@A@@","@@PA\\HGyRVxIL@A@@","@@h@N`CxXwxAL@A@@"],8:["@@@@@@J`SxBG{@O@@","@@@@@@j`KxLG|AO@@","@@@@@@J`CxGGz@O@@","@@@@@@J`OxDGz@O@@"]}},D={size:8,frames:4,palette:[A,b],data:{0:["PUAUUQVVTUEUUajj`@B@`@","@@@TUPUUdeEUUQUUhjJH`@","PUAUUQVVTUEUUajj`@BH@@","@@@TUPUUdeEUUQUUhjJH`@"],1:["@@@TUPUUTfEiiQUUhjJH`@","@@@UETUEeYQZZTUEjjBBH@"]}},H={palette:[y,x,m],data:"@@@@@@@DD@@@`e@@@@jB@@@hJ@@@@O@@@@}A@@@xK@@@`o@@@p~N@@T{{E@TmoWAPUUUE@WUUu@|C@C@"},T={palette:[y,x,m],data:"@PUE@@`UUB@@VUI@@xo@@poC@@kjN@@l{@@p~C@@kjN@@|o@@p{~C@@{O@@|k@@pC@@|C@@@@@@@"},E={palette:[M,u,"#b3d7ad",d],data:"@@@@@@@@@@HIIA@@@@Q[[J@@@HZ[[SA@@QR[[RJ@@QRRRRJ@@aRRRRL@@QTRRbJ@@abbTTL@@aTTbbL@@IddddI@@HaddLA@@@HIIA@@@@HIIA@@@@@II@@@@@@@@@@@"},O={palette:[x,w,p,y],data:"@@@HA@@@@@@QJ@@@@@HRRA@@@@YSZK@@@H[[[[A@@H[[[[A@@a\\[[cL@@acc\\\\L@@a\\\\ccL@@adc\\dL@@IddddI@@HaddLA@@@HIIA@@@@HIIA@@@@@II@@@@@@@@@@@"},B={palette:[f,d,M],data:"PPDDAP^feYTvVVYfweYZi]YfeiMgVvYv|Vvey`YZYvCfeiiCYZVfE\\wYZ[qWvefFle]fvPVfuY@g[dCpsCpC@"},J={palette:[m,y,x],data:"PU@@@PjVUU@YyGdjWU]PkAm^UUGt_PWUUuA}GTUUUUpjjjjC[_ZUNlk}ypvgVgCkjZ_N|}}@"},R={palette:[f,d],data:"@@@@@@D@@A@D@DA@DY@@PjEDA@@@@@A@@@@@@@@QQ@AdF@Pi"};"🔥,🍀,🌼,🐓,🌷,🌹,👻,🥚,🍎".split(",").map(t=>r(t));class G{static initialize(){G.T=new l(j),G.O=new l(D),G.B=((t=U)=>{const[s,i]=o(16,16);i.clearRect(0,0,16,16),i.fillStyle=t,i.fillRect(0,0,1,1),i.fillRect(1,0,1,1),i.fillRect(0,1,1,1),i.fillRect(14,0,1,1),i.fillRect(15,0,1,1),i.fillRect(15,1,1,1),i.fillRect(0,14,1,1),i.fillRect(0,15,1,1),i.fillRect(1,15,1,1),i.fillRect(15,14,1,1),i.fillRect(14,15,1,1),i.fillRect(15,15,1,1);const h=new Image;return h.src=s.toDataURL(),h})(),G.oak=c(E.data,E.palette),G.spruce=c(O.data,O.palette),G.house=c(J.data,J.palette),G.J=c(B.data,B.palette),G.R=c(R.data,R.palette);const t=["#fffef9",k,C];G.statue=c(H.data,H.palette),G.G=c(H.data,t),G.S=c(T.data,T.palette),G.L=c(T.data,t)}}const Q="6v7ic,6trd0,6to3o,6nvic,55eyo,2np50,2jcjo,3ugt8,34ao,7k,glc,1,opzc,3xdeu,3sapz,8rhfz,8ri26,1bzky,9j1ny,3ws2u,9dv9k,3xb1i,3xbmu,2t8g,2t8s,26ndv,ajmo,fl5ug,3x7nm,n75t,54br,59u0e,53if,rlev,4jrb,1yjk4,4eav,55q95,18zsz,mi3r,574tl,1aedd,ljn9,a1bd,4f1i,a1fs,549t,53ig,5832,1dwsh,6iw6,6ix0,cbsa,6gix,6fk4,aky7,7mbws,cvtyq,deehh,2sfi3".split(","),S={},L="]",z=t=>{if("0"===t)return{V:"0".repeat(25),N:0,W:5};const s=(parseInt(t,36).toString(2)+"").padStart(25,"0");let i=5,h=-1;for(let t=0;5>t;t++)for(let e=0;5>e;e++)"1"===s[5*e+t]&&(i=Math.min(i,t),h=Math.max(h,t));return{V:s,N:i,W:i>h?1:h-i+1}},V=(t,s,i,h,e,a=0)=>{for(let o=-e;e>=o;o++){const n=o/e,r=Math.round(h*Math.sqrt(1-n*n));if(r>0){const h=Math.round(a*Math.abs(o));t.rect(0>o?s-r+h:s-r-h,i+o,2*r,1)}}};class N{constructor(){this.F=0,this.Y=0,this.$=0,this.K=0,this.zoom=1,this.Z=0,this._=0,this.q=1,this.X=.08,this.tt=a(c1),this.st=a(c2),this.it=a(c3),this.ht=a(c4),G.initialize(),this.et(),window.addEventListener("resize",()=>this.et()),window.addEventListener("orientationchange",()=>this.et())}et(){this.F=1200,this.Y=900;const t=[this.tt,this.st,this.it,this.ht];for(const s of t)s.canvas.width=1200,s.canvas.height=900,s.imageSmoothingEnabled=!1}ot(t,s,i,h,e,a,o){t.save(),t.beginPath(),V(t,s,i,h,e),V(t,s,i,h-o,e-o),t.clip("evenodd"),t.beginPath(),t.fillStyle=a,t.fillRect(s-h,i-e,2*h,2*e),t.fill(),t.restore()}nt(t,s,i,h,e=0,a=0,n=2,r=1,c){((t,s,i,h,e=P,a=0,n=0,r=2,c=1)=>{i=Math.round(i),h=Math.round(h),s||(s=" ");const l=c*r,u=s.replace("!","@").toUpperCase().split("");let f=0;const d=[];u.forEach((t,s)=>{const i=(h=" "===t?"0":Q[t.charCodeAt(0)-35],z(h).W*r);var h;d.push({char:t,x:f,W:i}),f+=i+(u.length-1>s?l:0)});const M=5*r,w=0===a?0:1===a?Math.round(f/2):f,p=0===n?0:1===n?Math.round(M/2):M;d.forEach(({char:s,x:a,W:n})=>{if(" "===s)return;const c=((t,s,i)=>{const h=`${t.charCodeAt(0)}-${i}-${s}`;return S[h]||(S[h]=((t,s,i)=>{const h=" "===t?"0":Q[t.charCodeAt(0)-35],{V:e,N:a,W:n}=z(h),r=n*s,c=5*s,[l,u]=o(r,c),[f,d,M,w]=i.replace(/^#?([a-f\d])([a-f\d])([a-f\d])([a-f\d])$/i,(t,s,i,h,e)=>"#"+s+s+i+i+h+h+e+e).substring(1).match(/.{2}/g).map(t=>parseInt(t,16)),p=`rgba(${f}, ${d}, ${M}, ${(w||255)/255})`;return e.split("").forEach((t,i)=>{if("0"!==t){const t=i%5,h=Math.floor(i/5);if(a>t)return;const e=t-a;u.fillStyle=p,u.fillRect(e*s,h*s,s,s)}}),l})(t,s,i)),S[h]})(s,r,e);t.drawImage(c,0,0,n,M,i-w+a,h-p,n,M)})})(c||this.tt,t,s,i,h,e,a,n,r)}static drawImage(t,s,i,h,e,a,o){e&&(t.save(),t.scale(-1,1),i=-i-(a??s.width)),t.drawImage(s,i,h,a??s.width,o??s.height),e&&t.restore()}rt(t,s,i,h,e,a){N.drawImage(this.tt,t,s,i,h,e,a)}ct(t,s,i=1,h=!1){this.Z=t,this._=s,this.q=i;const e=this.F/2-32,a=this.Y/2-64;h&&(this.$=t,this.K=s,this.zoom=i),this.tt.setTransform(this.zoom,0,0,this.zoom,e-this.$*this.zoom,a-this.K*this.zoom)}lt(){this.$+=(this.Z-this.$)*this.X,.01>Math.abs(this.Z-this.$)&&(this.$=this.Z),this.K+=(this._-this.K)*this.X,.01>Math.abs(this._-this.K)&&(this.K=this._),this.zoom+=(this.q-this.zoom)*this.X,.02>Math.abs(this.q-this.zoom)&&(this.zoom=this.q)}ut(){this.tt.setTransform(1,0,0,1,0,0)}clear(){this.ut(),this.tt.clearRect(0,0,this.F,this.Y),this.tt.fillStyle=u,this.tt.fillRect(0,0,this.F,this.Y),this.st.clearRect(0,0,this.F,this.Y),this.it.clearRect(0,0,this.F,this.Y)}ft(t,s,i=7){return{x:this.F/2-32+(t-this.$)*i,y:this.Y/2-64+(s-this.K)*i}}}const W=new N;let F=[];const Y=12,$=12,K=20,Z=[[[69,100,3],[76,113,4],[89,114,5],[104,86,3],[99,59,3],[85,46,2],[86,28,2],[74,38,2],[60,39,2],[48,30,2],[46,43,2],[38,61,3],[50,73,4],[38,84,3],[46,123,3],[36,133,2],[48,141,3],[94,133,4],[113,109,5],[122,74,6],[113,56,.9]],[[45,49,.9],[71,51,.9]],[[119,54,1],[129,29,1]]],_=[{x:64,y:88,r:6},{x:75,y:88,r:6},{x:69,y:95,r:6},{x:129,y:28,r:10},{x:71,y:51,r:3}],q={dt:{x:76,y:84,name:"heart"},Mt:{x:129,y:19,name:"moon"},wt:{x:49,y:29,name:"ear"},eye:{x:71,y:50,name:"eye"},yt:{x:35,y:131,name:"foot"},xt:{x:114,y:56,name:"tail"}};class X{constructor(t,s,i,h,e,a=0,o=!1){this.gt=t,this.x=s,this.y=i,this.type=h,this.animation=e,this.speed=a,this.bt=o,this.At=0,this.Ut=0,this.vt=150,this.kt=!0,this.o={x:0,y:0},this.Ct=Math.ceil(s/Y),this.It=Math.ceil(i/$),this.At=Math.random()*this.vt,this.h={x:this.x,y:this.y}}Pt(t,s){this.Ct=t,this.It=s,this.x=t*Y,this.y=s*$,this.h={x:this.x,y:this.y}}update(t){(this.kt||this.Ut!==this.gt.D[this.animation].length-1)&&(this.At+=t,this.Ut=Math.floor(this.At/this.vt)%this.gt.D[this.animation].length)}jt(t){i(this,t),0!==this.o.x&&(this.bt=0>this.o.x)}draw(){const t=this.gt.D[this.animation];t[this.Ut]&&W.rt(t[this.Ut],this.x-(this.gt.H-Y)/2,this.y-(this.gt.H-$)/2,this.bt)}}const tt=[],st=(t,s)=>{const i=t+"",h=t=>{s(t.detail)};document.addEventListener(i,h),tt.push({Dt:i,Ht:h})},it=(t,s)=>{document.dispatchEvent(new CustomEvent(t+"",{detail:s}))},ht=(t,s,i,h)=>{const e=[];let a,o=Math.abs(i-t),n=i>t?1:-1,r=-Math.abs(h-s),c=h>s?1:-1,l=o+r;for(;e.push([t,s]),t!==i||s!==h;)a=2*l,r>a||(l+=r,t+=n),a>o||(l+=o,s+=c);return e};class et{constructor(t,s,i,h,e=Math.PI/2,a=12,o=0,n=0,r=300,c=16,l=0,u=1,f=!0){this.Tt=t,this.Et=h,this.Ot=e,this.radius=a,this.offset=o,this.Bt=n,this.speed=r,this.Jt=c,this.Rt=l,this.Gt=u,this.active=f,this.cx=s+6,this.cy=i+6;const d=((t,s,i,h)=>{const e=[];for(let a=0;5>a;a++){const o=2*Math.PI*(2*a%5)/5-Math.PI/2+i;e.push([Math.round(t+h*Math.cos(o)),Math.round(s+h*Math.sin(o))])}return e})(this.cx,this.cy,e,a);this.Qt=[];for(let t=0;5>t;t++){const[s,i]=d[t],[h,e]=d[(t+1)%5];this.Qt.push(...ht(s,i,h,e))}this.St=this.Qt.length*this.Gt*1e3/this.speed}update(t){if(!this.active)return;const s=Math.floor(this.Bt/1e3*this.speed)%this.Qt.length;if(this.offset>s&&(this.Rt++,this.Rt>=this.Gt))return this.active=!1,void this.Et();this.offset=s,this.Bt+=t}draw(){if(!this.active)return;this.Tt.fillStyle=P;const t=Math.min(this.Jt,this.offset);for(let s=0;t>s;s++){const t=(this.offset-s+this.Qt.length)%this.Qt.length,[i,h]=this.Qt[t];this.Tt.fillRect(i,h,1,1)}}isActive(){return this.active}}const at=(t,s,i,h=!1)=>{for(let e=-1;1>=e;e++)for(let a=-1;1>=a;a++)(h||0!==e||0!==a)&&i(t+a,s+e)};let ot=null;const nt=t=>{ot||(ot=new AudioContext);const s=ot.createBuffer(1,96e3,48e3),i=s.getChannelData(0);for(let s=96e3;s--;)i[s]=t(s);const h=ot.createBufferSource();h.buffer=s,h.connect(ot.destination),h.start()},rt=(t=1)=>nt(s=>{const i=2e3*t;return s>i?0:.15*(2*Math.random()-1)*Math.sin(Math.PI*s/i)}),ct=t=>nt(s=>Math.sin(s/(21-t)+5*Math.sin(s/2e3))*Math.exp(-s/4e3)*(s/96e3)*9),lt=t=>nt(s=>{const i=2*s*Math.PI/(80*Math.pow(2,-t/12))+4*Math.sin(s/1800);return(Math.sin(i)+.5*Math.sin(2*i)+.3*Math.sin(3*i)+.2*Math.sin(4*i))*Math.exp(-s/6e3)*(s/96e3)*6});class ut extends X{constructor(s,i,h,e){super(G.T,s*Y,i*$,"cat",6,80),this.map=h,this.Lt=e,this.type="cat",this.zt=!0,this.Vt=!1,this.Nt=!1,this.Wt=!1,this.Ft=!1,this.Yt=null,this.$t=0,this.Kt=0,this.map.Zt={Ct:s+1,It:i},st(7,()=>{this.Pt(q.dt.x,q.dt.y+1)}),st(6,()=>{this.zt=!1,this.Vt=!0}),st(9,()=>{this.Vt=!1}),st(12,()=>{this.Wt=!0,t(()=>{this.Wt=!1},600)}),st(19,()=>{this.animation=3,this.At=0,this.kt=!1})}_t(t){switch(super.update(t),this.animation){case 6:case 8:this.vt=600;break;case 5:this.vt=75;break;default:this.vt=150}}update(s){if(3===this.animation)return;2===this.animation?(this.$t-=s,this.$t>0||(rt(),this.$t=200)):this.$t=0;const i=this.map.grid[this.It][this.Ct].qt;if(!this.Ft&&i?(this.Ft=!0,it(10,i)):this.Ft&&!i&&(this.Ft=!1),coords.innerText=`${this.Ct},${this.It}`,!this.Lt.Xt){if(this.Wt&&!this.ts())this.animation=5;else if(this.zt)this.animation=6;else if(this.Vt)this.animation=8;else if(this.Nt)this.animation=this.Yt?7:4;else{if(super.jt(s),!this.o.y&&e.I.y){const t=this.It+e.I.y;this.map.grid[t][this.Ct].content||(this.animation=2,this.o.y=e.I.y,this.h.y+=e.I.y*$,this.It=t),this.map.Zt={Ct:this.Ct,It:this.It+e.I.y}}if(!this.o.x&&e.I.x){this.bt=e.M;const t=this.Ct+e.I.x;this.map.grid[this.It][t].content||(this.animation=2,this.o.x=e.I.x,this.h.x+=e.I.x*Y,this.Ct=t),this.map.Zt={Ct:this.Ct+e.I.x,It:this.It}}this.o.x||this.o.y?this.Kt=0:(this.animation=0,this.Kt+=s,this.Kt>2e3&&(this.animation=8)),this.Nt||this.ss(),this.Nt||!e.A||e.k.A||(this.Nt=!0,this.At=0,this.Kt=0,!this.Yt&&this.ts()?this.Yt=new et(W.tt,this.x,this.y,()=>{this.Yt=null,this.hs(),this.Nt=!1,nt(t=>t>29e3?0:.2*(t>17400?Math.pow(.9999,t-17400):1)*Math.sin(t/(30-5*Math.sin(5*Math.round(5*t/29e3)))+Math.random())*(8e3-t%6e3)/5e3)}):(t(()=>this.es(),500),t(()=>{this.Nt=!1},5*this.vt)))}this.Yt?.update(s)}}hs(){at(this.Ct,this.It,(t,s)=>{const i=this.map.grid[s][t];"spirit"===i.content?.type&&i.content.ns(5)})}ts(){let t=0;return at(this.Ct,this.It,(s,i)=>{const h=this.map.grid[i][s];"spirit"===h.content?.type&&t++}),t>=3}draw(){super.draw(),this.Yt?.draw()}ss(){const t=this.map.rs();if(t?.content)return;const s=[{Ct:this.Ct+1,It:this.It,cs:"right"},{Ct:this.Ct-1,It:this.It,cs:"left"},{Ct:this.Ct,It:this.It+1,cs:"down"},{Ct:this.Ct,It:this.It-1,cs:"up"}];let i=null,h=null,e=null,a=null;for(const t of s){const s=this.map.grid[t.It][t.Ct];if(!s.content)continue;const o=s.content.type;if("spirit"===o){i={Ct:t.Ct,It:t.It},e=t.cs;break}"statue"!==o&&"obelisk"!==o||h||(h={Ct:t.Ct,It:t.It},a=t.cs)}i?(this.map.Zt=i,"left"===e?this.bt=!0:"right"===e&&(this.bt=!1)):h&&(this.map.Zt=h,"left"===a?this.bt=!0:"right"===a&&(this.bt=!1))}es(){const t=this.map.rs();t.content&&"spirit"===t.content.type?(t.content.ns(1),nt(t=>{if(t>1e4)return 0;const s=5*Math.sin(5*Math.round(5*t/1e4));return.2*Math.pow(.998,t/10)*Math.sin(t/(40-s)+Math.random())*(8e3-t%6e3)/5e3})):t.content&&"field"===t.content.type&&(t.content=null,rt(3))}}class ft{constructor(t,s,i,h){this.ls=t,this.x=s,this.y=i,this.type=h,this.Ct=Math.ceil(s/Y),this.It=Math.ceil(i/$),this.offsetX=s-Math.round((t.width-Y)/2),this.offsetY=i-Math.round((t.height-$)/2)}draw(){W.rt(this.ls,this.offsetX,this.offsetY)}}class dt extends ft{constructor(t,s,i){super(G[i],t,s,i),this.x=t,this.y=s,this.us={top:!1,bottom:!1,left:!1,right:!1}}fs(t){this.us=t}draw(){this.us.right&&W.rt(this.ls,Math.round(this.offsetX+6),this.offsetY-6),super.draw()}}class Mt{constructor(t=47){this.ds=t}next(){return this.ds=(9301*this.ds+49297)%233280,this.ds/233280}range(t,s){return t+this.next()*(s-t)}}class wt extends ft{constructor(t,s,i=""){super(G.house,t*Y,s*$,"house"),this.name=i}}class pt extends X{constructor(t,s,i){super(G.O,t*Y,s*$,"villager",0,10),this.map=i,this.Ms=null,this.ws=0,this.ps=1e3,this.ys=!1}update(t){super.update(t),this.ws+=t,this.xs()?(this.ys||this.ps>this.ws||(this.ws=0,this.ys=!0),t>this.ws%(this.ps/5)&&it(16),this.animation=1,this.vt=50):(this.ys=!1,this.vt=150,this.ps>this.ws||(this.gs(),this.ws=0),this.jt(t))}gs(){const t=[{x:0,y:-1},{x:0,y:1},{x:1,y:0},{x:-1,y:0}];if(this.Ms&&.8>Math.random()){const t=this.Ct+this.Ms.x,s=this.It+this.Ms.y;if(this.bs(t,s))return this.Ct=t,this.It=s,this.h={x:t*Y,y:s*$},this.Ms=this.Ms,void(this.animation=0)}for(let s=0;10>s;s++){const s=t[Math.floor(4*Math.random())],i=this.Ct+s.x,h=this.It+s.y;if(this.bs(i,h))return this.Ct=i,this.It=h,this.h={x:i*Y,y:h*$},this.Ms=s,void(this.animation=0)}}bs(t,s){return null===this.map.grid[s][t].content}xs(){if(!this.Ms)return!1;for(let t=1;2>=t;t++){const s=this.Ct+this.Ms.x*t,i=this.It+this.Ms.y*t,h=this.map.grid[i]?.[s];if("cat"===h?.content?.type)return!0}return!1}}class yt extends ft{constructor(t,s){super(G.J,t*Y,s*$,"field")}}class xt{constructor(t,s,i,h,e){this.name=t,this.As=s,this.radius=i,this.Us=h,this.vs=e,this.ks=[],this.Cs=[],this.Is=[],this.As=s,this.radius=i}Ps(t,s,i){let h,e;do{const s=t.range(0,2*Math.PI),i=t.range(1,this.radius-1);h=Math.round(this.As.x+Math.cos(s)*i),e=Math.round(this.As.y+Math.sin(s)*i)}while(0>h||0>e||null!==i.get(h,e)?.content||s.some(t=>t.x===h&&t.y===e));return{x:h,y:e}}js(t,s){for(let i=0;this.Us>i;i++){const i=this.Ps(t,this.ks,s);this.ks.push(new wt(i.x+i.x%2,i.y+i.y%2))}return this.ks}Ds(t,s){const i=this.Us;for(let h=0;i>h;h++){const i=this.Ps(t,this.Cs,s);for(let t=0;2>t;t++)for(let s=0;2>s;s++)this.Cs.push(new yt(i.x+t,i.y+s))}return this.Cs}Hs(t,s){for(let i=0;this.vs>i;i++){const i=this.Ps(t,this.Cs,s);this.Is.push(new pt(i.x,i.y,s))}return this.Is}}class mt{constructor(t,s,i,h){this.icon=t,this.Ct=s,this.It=i,this.type=h,this.x=Math.round(this.Ct*Y+(Y-this.icon.width)/2),this.y=Math.round(this.It*$+($-this.icon.height)/2)}draw(){W.rt(this.icon,this.x,this.y)}}const gt=[{x:0,y:-1},{x:0,y:1},{x:1,y:0},{x:-1,y:0}],bt=(t,s)=>`${t},${s}`,At=(t,s,i)=>{const h=[];let e=i;for(;e!=s;)h.unshift(e),e=t[bt(e.Ct,e.It)];return h.unshift(s),h},Ut=[p,y,v,U],vt=(t,s,i,h,e=Ut)=>{const a=Math.ceil(12*Math.max(0,Math.min(1,t/s))),o=i,n=h-5;W.tt.fillStyle=e[0],W.tt.fillRect(o,n,a,1),W.tt.fillStyle=e[1],W.tt.fillRect(o,n+1,a,1),W.tt.fillStyle=e[2],W.tt.fillRect(o+a,n,12-a,1),W.tt.fillStyle=e[3],W.tt.fillRect(o+a,n+1,12-a,1)},kt=["☁️","🥨","🌵","🧚🏻‍♀️","🦀","👻","👹","🧿","💀"].reduce((t,s,i)=>(t[s]={icon:r(s),type:s,level:Math.ceil(i/2)},t),{});class Ct extends mt{constructor(t,s,i,h){super(kt[i].icon,t,s,"spirit"),this.vt=2e3,this.At=0,this.opacity=0,this.Ts=9,this.ws=0,this.ps=600,this.o={x:0,y:0},this.speed=20,this.Es=!1,this.Os=!1,this.state=1,this.Bs=0,this.Js=1e3,this.Rs=null,this.Gs=0,this.Qs=0,this.species=kt[i],this.map=h,this.h={x:this.x,y:this.y},this.Ss=Math.round(Math.pow(1.5,this.species.level+1)),this.Ls=this.Ss,st(20,()=>{this.state=0})}_t(t){this.Ls>0||(this.opacity-=t/this.vt),this.At+=t*Math.pow(this.species.level+.5,2),1>this.opacity&&(this.opacity+=t/this.vt),this.vt>this.At||(this.At-=this.vt)}update(t){switch(this.state){case 0:break;case 1:case 2:i(this,t);const s=this.zs();s&&(this.ws+=t,this.ps>this.ws||(this.Vs(s),this.ws=0));break;case 3:case 4:case 5:this.Ns(t)}}Ns(t){this.Bs+=t;const s=this.Bs/this.Js;if(!this.Rs)return void(this.state=1);const i=this.Rs.Ct-this.Ct,h=this.Rs.It-this.It;if(.7>s){3!==this.state&&(this.state=3);const t=s/.7;this.Gs=-i*t*3,this.Qs=-h*t*3}else if(.73>s){4!==this.state&&(this.state=4);const t=(s-.7)/.03;this.Gs=i*(Y*t-3),this.Qs=h*(Y*t-3)}else if(1>s){if(5!==this.state){this.state=5;const t=this.map.grid[this.Rs.It][this.Rs.Ct];"cat"===t.content?.type&&it(12,this.species.level)}const t=(s-.73)/.27;this.Gs=3*i*(1-t),this.Qs=3*h*(1-t)}else this.state=1,this.Bs=0,this.Rs=null,this.Gs=0,this.Qs=0}zs(){for(let t=-this.Ts;this.Ts>=t;t++)for(let s=-this.Ts;this.Ts>=s;s++){const i=this.Ct+t,h=this.It+s,e=this.map.grid[h][i];if("cat"===e.content?.type)return{Ct:i,It:h}}return null}Vs(t){const s=((t,s,i,h=100)=>{let e=h;const a=[s],o=new Set,n={};for(;0!==a.length&&e--;){const h=a.shift();if(h.Ct===i.Ct&&h.It===i.It)return At(n,s,i);gt.map(({x:s,y:i})=>t[h.It+i][h.Ct+s]).forEach(t=>{o.has(t)||(o.add(t),(null===t.content||t.x==i.Ct&&t.y==i.It)&&(n[bt(t.x,t.y)]=h,a.push({Ct:t.x,It:t.y})))})}})(this.map.grid,{Ct:this.Ct,It:this.It},t);if(s&&s.length>2){this.state=2;const t=s[1];h=t.It,(i=this).h.x=t.Ct*Y,i.h.y=h*$,this.Ct=t.Ct,this.It=t.It,this.h.x=t.Ct*Y,this.h.y=t.It*$}else 2===s?.length&&(this.state=3,this.Rs=s[1],this.Bs=0);var i,h}draw(){const t=Math.sin(this.At/this.vt*2*Math.PI);W.tt.save(),W.tt.globalAlpha=this.opacity,W.tt.fillStyle=`rgba(0,0,0,${Math.round(2+1*t)/10})`,W.tt.fillRect(this.x+3+this.Gs,this.y+9+this.Qs,this.icon.width-6,4),this.Ss>this.Ls&&vt(this.Ls,this.Ss,this.x,this.y),W.tt.save(),this.Os&&(W.tt.filter="sepia(1) saturate(2) hue-rotate(260deg) brightness(0.7)"),W.tt.translate(this.Gs,this.Qs+Math.round(2*(t-1))),super.draw(),W.tt.restore(),W.tt.restore()}ns(s=1){return this.Ls-=s,this.Os=!0,t(()=>{this.Os=!1},150),this.Ls>0||t(()=>{(()=>{const t=~(1e3*Math.random());nt(s=>Math.sin(s/(10+s/8e3-s/12e3)&t+5*Math.sin(s/2e3))*Math.exp(-s/4e3)*(s/96e3)*9)})(),this.Es=!0},1500),0>=this.Ls}}class It{constructor(t,s){this.x=t,this.y=s,this.Ws=0,this.Fs=0,this.Ys=!1,this.cx=this.x+6,this.cy=this.y+6}update(t){this.Ws+=t,this.Fs=this.Ws/It.animationDuration,1>this.Fs||(this.Ys=!0)}draw(){if(this.Ys)return;const t=3*this.Fs%1,s=c2.width/W.zoom,i=c2.height/W.zoom;W.ot(W.tt,this.cx,this.cy,s*t,i*t,P,8)}}It.animationDuration=1500;class Pt extends ft{constructor(t,s,i,h,e){super(G.statue,t*Y,s*$,"statue"),this.map=i,this.Lt=h,this.name=e,this.$s=[],this.Ks=4,this.Zs=0,this._s=1e3,this.qs=.1,this.Xs=10,this.ti=0,this.state=Pt.ii.si,this.At=0,this.hi=!1,this.ei=0,this.ai=null,this.vt=800}_t(t){this.At+=t}update(t){if(this.Zs+=t,this.state!==Pt.ii.si||K>this.ti?this.ai&&(this.ai.update(t),this.ai.Ys&&(this.state=Pt.ii.oi,this.ai=null)):(this.state=Pt.ii.ni,this.hi=!1,this.ei=0,this.ai=new It(this.x,this.y)),this.Zs>=this._s&&(this.Zs=0,Math.random()<this.qs))if(this.$s.length<this.Ks+this.Lt.ri())this.ci();else if(this.$s.length>0){const t=this.$s.filter(t=>t.Ls===t.Ss)[Math.round(Math.random()*this.$s.length-1)];t&&(t.Es=!0,this.ci())}this.$s=this.$s.filter(t=>!t.Es)}draw(){super.draw(),this.ti>0&&K>this.ti&&vt(this.ti,K,this.x,this.y,[k,C,g,b]),this.state===Pt.ii.oi&&this.li()}ui(){this.ai&&(this.ai.draw(),20>this.ai.Ws-this.ei||(this.map.fi(this.Ct,this.It,20*this.ai.Fs,!0,2,.3),this.ei=this.ai.Ws),this.hi||(this.$s.forEach((s,i)=>{t(()=>{s.ns(s.Ls)},100*i)}),this.hi=!0))}li(){W.tt.fillStyle=A;for(let t=0;5>t;t++){const s=(this.At+.5*this.vt*t)/this.vt,i=2*t*Math.PI/3,h=3,e=Math.cos(i)*h,a=Math.sin(i)*h,o=6*Math.sin(s),n=3*Math.sin(2*s),r=o*Math.cos(i)-n*Math.sin(i),c=o*Math.sin(i)+n*Math.cos(i);W.tt.fillRect(Math.round(this.x+6+e+r),Math.round(this.y+4+a+c),1,1)}}ci(){const t=[],s=Math.round(this.Lt.ri()+this.Xs);for(let i=-s;s>=i;i++)for(let h=-s;s>=h;h++){const s=this.Ct+i,e=this.It+h;null===this.map.grid[e][s].content&&t.push({x:s,y:e})}if(t.length>0){const s=t[Math.floor(Math.random()*t.length)],i=Object.values(kt).filter(t=>t.level<this.Lt.ri());if(0===i.length)return;const h=i[Math.floor(Math.random()*i.length)],e=new Ct(s.x,s.y,h.type,this.map);this.$s.push(e),this.map.set(s.x,s.y,e)}}}Pt.ii={si:0,ni:1,oi:2};class jt extends ft{constructor(t){super(G.S,828,1056,"obelisk"),this.name="barrier obelisk",this.ti=0,this.ai=null,this.map=t,this.map.set(this.Ct,this.It,this)}update(t){this.ai?.update(t)}di(){this.ai=new It(this.x,this.y)}draw(){super.draw(),this.ti>0&&vt(this.ti,K,this.x,this.y,[k,C,g,b])}ui(){this.ai?.draw()}Mi(){20>this.ti?(this.ti++,ct(2*this.ti-10)):(ct(-10),it(15)),this.ti===K&&it(20)}}class Dt{constructor(t,s,i){this.wi=t,this.pi=s,this.Lt=i,this.yi=[],this.Zt={Ct:0,It:0},this.xi=[],this.mi=new Mt,this.grid=Array.from({length:s},(s,i)=>Array.from({length:t},(t,s)=>{const h=s-70,e=i-90;let a;a=Math.sqrt(h*h+e*e)>40?.2>this.mi.next()?"spruce":"oak":.9>this.mi.next()?"spruce":"oak";const o=new dt(s*Y-2,i*$-2,a);return{x:s,y:i,content:o}})),this.yi=[new xt("Heart Peak",{x:70,y:90},12,0,0),new xt("Pine Rest",{x:99,y:100},6,2,3),new xt("Oak Branch",{x:42,y:51},4,3,4),new xt("Cat Foot",{x:48,y:140},5,4,5),new xt("Black Tail",{x:113,y:107},4,5,8),new xt("Moon Town",{x:129,y:29},8,12,25)];for(const t of Z)for(let s=0;t.length-1>s;s++)this.gi({x:t[s][0],y:t[s][1]},{x:t[s+1][0],y:t[s+1][1]},t[s][2]);for(const t of _)this.fi(t.x,t.y,t.r);for(let i=0;s>i;i++)for(let s=0;t>s;s++){const t=this.grid[i][s];t.content instanceof dt&&t.content.fs({top:this.grid[i-1]?.[s]?.content instanceof dt,bottom:this.grid[i+1]?.[s]?.content instanceof dt,left:this.grid[i]?.[s-1]?.content instanceof dt,right:this.grid[i]?.[s+1]?.content instanceof dt})}for(const t of this.yi){t.Ds(this.mi,this).forEach(t=>{this.grid[t.It][t.Ct].content=t}),t.js(this.mi,this).forEach(t=>{this.grid[t.It][t.Ct].content=t}),t.Hs(this.mi,this).forEach(t=>{this.grid[t.It][t.Ct].content=t});const{x:s,y:i}=t.As,h=t.radius;for(let e=i-h;i+h>=e;e++)for(let a=s-h;s+h>=a;a++){const o=a-s,n=e-i;o*o+n*n>h*h||(this.grid[e][a].qt=t)}this.set(61,84,new wt(61,84,"home"))}this.bi(1),this.S=new jt(this);for(const t of Object.values(q)){const{x:s,y:i,name:h}=t,e=new Pt(s,i,this,this.Lt,`cat ${h} altar`);at(s,i,(t,s)=>{this.grid[s][t].content=new yt(t,s)}),this.grid[i][s].content=e,this.xi.push(e)}st(18,()=>{this.set(64,89,new Ct(64,89,"☁️",this))})}rs(){return this.grid[this.Zt.It][this.Zt.Ct]}get(t,s){return 0>s||s>=this.pi||0>t||t>=this.wi?null:this.grid[s][t]}Ai(t,s){(this.grid[s][t].content instanceof dt||this.grid[s][t].content instanceof yt)&&(this.grid[s][t].content=null)}bi(t){const s=this.yi[0],{x:i,y:h}=s.As;for(let s=h-12;h+12>=s;s++)for(let h=i-12;i+12>=h;h++){const i=this.grid[s][h];i.content||this.mi.next()>t?i.content instanceof yt&&this.mi.next()>t&&(i.content=null):i.content=new yt(i.x,i.y)}const e=[[61,86,2],[69,88,.9],[75,89,.9],[76,84,.9]];for(let t=0;e.length-1>t;t++)this.gi({x:e[t][0],y:e[t][1]},{x:e[t+1][0],y:e[t+1][1]},e[t][2])}gi(t,s,i){const h=Math.abs(s.x-t.x),e=Math.abs(s.y-t.y),a=s.x>t.x?1:-1,o=s.y>t.y?1:-1;let n=h-e,r=t.x,c=t.y;const l=i/2;for(;;){const t=1>i?0:1.2,u=Math.ceil(this.mi.range(-t,t)),f=Math.ceil(this.mi.range(-t,t));for(let t=-l;l>=t;t++)for(let s=-l;l>=s;s++){const h=Math.ceil(r+t+u),e=Math.ceil(c+s+f);this.Ai(h,e),1>i?this.mi.next()>.5?this.Ai(h+1,e):(this.grid[e][h].content=new yt(h,e),this.grid[e][h+1].content=new yt(h,e)):this.mi.next()>.1&&(this.mi.next()>.05?this.Ai(h,e):this.grid[e][h].content=new yt(h,e))}if(r===s.x&&c===s.y)break;const d=2*n;d>-e&&(n-=e,r+=a),h>d&&(n+=h,c+=o)}}fi(t,s,i,h=!1,e=99,a=1){for(let o=0;this.pi>o;o++)for(let n=0;this.wi>n;n++){const r=n-t,c=o-s,l=Math.sqrt(r*r+c*c),u=i+this.mi.range(-i,i)/6;if(l>=u-e&&u>=l){const t=Math.min(1,(u-l)/2+.7)*a;this.mi.next()<t&&(!h||h&&this.grid[o][n].content instanceof yt)&&(this.grid[o][n].content=null)}}}set(t,s,i){this.grid[s]&&this.grid[s][t]&&(this.grid[s][t].content=i)}update(t,s){for(const i of this.grid)for(const h of i)h.content&&(h.content._t?.(t),s||(h.content.update?.(t),h.x==h.content.Ct&&h.y==h.content.It||(this.grid[h.content.It][h.content.Ct].content=h.content,h.content=null),h.content&&h?.content?.Es&&this.set(h.content.Ct,h.content.It,null)))}draw(t,s){const i=W.zoom,h=W.F/i/2+50,e=W.Y/i/2+50,a=Math.max(0,Math.floor((t-h)/Y)),o=Math.min(this.wi-1,Math.ceil((t+h)/Y)),n=Math.max(0,Math.floor((s-e)/$)),r=Math.min(this.pi-1,Math.ceil((s+e)/$));for(let t=n;r>=t;t++)for(let s=a;o>=s;s++){const i=this.grid[t][s];W.rt(G.R,i.x*Y,i.y*$)}const c=[];let l=!1;for(let i=n;r>=i;i++)for(let h=a;o>=h;h++){const e=this.grid[i][h],a=e.x*Y-t,o=e.y*$-s;a*a+o*o>5625||(e.Ui=!0),e.y===this.Zt.It&&e.x===this.Zt.Ct&&e.content&&"oak"!==e.content.type&&"spruce"!==e.content.type&&(l=!0),e?.content?.draw(),e?.content?.ui&&c.push(e?.content)}c.forEach(t=>t.ui()),l&&W.rt(G.B,this.Zt.Ct*Y-2,this.Zt.It*$-2)}}const Ht=(t,s,i)=>s+-(Math.cos(Math.PI*t)-1)/2*i,Tt={oak:u,spruce:y,house:m,field:k,statue:b,unseen:g,default:C};class Et{constructor(t){this.map=t,this.ki=0,this.updateInterval=100}update(t){this.ki+=t}draw(t){if(this.updateInterval>this.ki)return;this.ki=0;const s=W.ht,i=160,h=s.canvas.width-i-10,e=s.canvas.height-i-10;s.clearRect(h,e,i,i);for(let t=0;i>t;t++)for(let a=0;i>a;a++){const i=this.map.grid[t][a];s.fillStyle=i.Ui?Tt[i.content?.type||"default"]??Tt.default:Tt.unseen,s.fillRect(h+a,e+t,1,1)}t.Ct>=0&&i>t.Ct&&t.It>=0&&i>t.It&&(s.fillStyle=U,s.beginPath(),s.arc(h+t.Ct,e+t.It,2,0,2*Math.PI),s.fill())}}class Ot{constructor(){this.Ci=null,st(3,t=>{this.Ci=t}),st(2,()=>{this.Ci=null})}draw(){if(this.Ci){const t=160,s=20,i=c3.width-t-3*s,h=s,e=c3.height-t-s;W.it.fillStyle=U,W.it.fillRect(h+5,e+5,i,t),W.it.fillStyle=A,W.it.fillRect(h,e,i-5,t-5),this.Ci.split("\n").forEach((t,i)=>{W.nt(t,h+2*s,e+2*s+40*i,">"===t[0]?U:I,0,0,5,1,W.it)}),W.nt("press (space) to continue",h+i-s,e+t-s,U,2,2,3,1,W.it)}}}class Bt{constructor(t,s,i,h){this.map=t,this.Ii=s,this.actions=i,this.Lt=h,this.Pi=!1,this.ji=!1,this.Di=!1,this.Hi="",this.Ti=0,this.Ei=new Et(t),this.Oi=new Ot,st(9,()=>{this.ji=!0}),st(15,()=>{this.Di=!0}),st(10,t=>{this.Hi=t.name,this.Ti=3e3}),st(16,()=>{this.Pi=!0})}update(t){this.Ei.update(t),this.Ti-=t}draw(){this.ji&&this.Bi(),this.Di&&this.Ji(),this.Ri(),this.Pi&&this.Gi(),this.Qi(),this.Si(),this.ji&&this.Ei.draw(this.Ii),this.Oi.draw()}Qi(){const t=this.actions.actions;if(!t||!t[0].enabled)return;const s=Math.round((W.it.canvas.width-(120*t.length+10*(t.length-1)))/2),i=W.it.canvas.height-120-10;t.forEach(({type:t,color:h,Li:e},a)=>{const o=s+130*a;W.it.fillStyle=A,W.it.fillRect(o,i,120,120),W.nt(e,o+60,i+30,h,1,1,7,1,W.it),W.nt(t,o+60,i+95,I,1,1,3,1,W.it)})}Bi(){const t=Math.floor(this.Lt.zi),s=Math.floor(9-this.Lt.zi),i=9-t-s,h=this.Lt.zi-t,e="#".repeat(t)+(h>.3?"$":"%").repeat(i)+"&".repeat(s),a=5*(6*e.length+1);W.it.fillStyle=A,W.it.fillRect(16,16,a,35),W.nt(e,21,21,U,0,0,5,1,W.it)}Ji(){let t=c3.width-16;const s=this.Lt.Vi,i=this.Lt.Ni-this.Lt.Vi,h=6-this.Lt.Ni;W.it.fillStyle=k,W.it.fillRect(t-185+5,16,185,35);let e=L.repeat(s);t-=30*e.length,W.nt(e,t+5,21,y,0,0,5,1,W.it),e=L.repeat(i),t-=30*e.length,W.nt(e,t+5,21,x,0,0,5,1,W.it),e=L.repeat(h),t-=30*e.length,W.nt(e,t+5,21,C,0,0,5,1,W.it)}Ri(){this.Lt.Wi.filter(t=>t.time>0).forEach((t,s)=>{const{label:i,time:h}=t,e=61+70*s;let a=0;h>4800?a=-526*(1-Ht((5e3-h)/200,0,1)):200>h&&(a=-526*(1-Ht(h/200,0,1)));const o=16+a;W.it.fillStyle=U,W.it.fillRect(o,e,510,65),W.nt("GOAL",o+3+5,e+5,P,0,0,4,1,W.it),W.nt(i,o+3+5+20,35+e+5,A,0,0,3,1,W.it)})}Gi(){const t=Math.round(c3.width/2-115);W.it.fillStyle=A,W.it.fillRect(t,16,230,62),W.it.fillStyle=g,W.it.fillRect(t+5,21,220,25),W.it.fillStyle=this.Lt.Fi>.9?U:y,W.it.fillRect(t+5,21,3*Math.round(220*this.Lt.Fi/3),25),W.nt("superstition",c3.width/2,54,g,1,0,3,1,W.it)}Si(){if(this.Ti>0){const t=this.Ti,s=Ht(Math.max(0,Math.min(1,Math.min(t/150,(3e3-t)/150))),0,1);W.it.globalAlpha=s,this.Yi("^^ "+this.Hi,170),W.it.globalAlpha=1}if(this.map.Zt){const t=this.map.rs();t?.content?.name&&this.Yi(t.content.name,c3.height-170)}}Yi(t,s){W.it.fillStyle=v,W.it.fillRect(c3.width/2-175+4,s-18-4,342,43),W.it.fillStyle=C,W.it.fillRect(c3.width/2-175,s-18,350,35),W.nt(t,c3.width/2,s,U,1,1,3,1,W.it)}}const Jt=[{type:"scratch",color:U,enabled:!1,Li:"\\"},{type:"teleport",color:y,enabled:!0,Li:"["},{type:"repair",color:u,enabled:!0,Li:L},{type:"sleep",color:C,enabled:!0,Li:"z"}];class Rt{constructor(t,s){this.actions=[],this.map=t,this.Ii=s,st(9,()=>{this.actions[0].enabled=!0})}update(){const t=this.map.rs(),s=this.$i(t),i=this.Ki(t),h=this.Zi(t),a=this._i(t);if(this.actions=[a?Jt[0]:s?Jt[1]:i?Jt[2]:h?Jt[3]:Jt[0]],e.A&&!e.k.A)switch(!0){case a:break;case s:it(7);break;case i:this.qi(t);break;case h:it(11)}}qi(s){it(8);const i=s.content;K>i.ti&&(i instanceof Pt?(i.ti++,ct(i.ti),K>i.ti||t(()=>{it(13,this.map.Lt.Ni)},4e3)):i instanceof jt&&i.Mi())}Ki(t){const s=t.content,i=s?.type;return("statue"===i||"obelisk"===i)&&K>s.ti}$i(t){return t.content instanceof Pt&&this.Ii.Ct!=q.dt.x&&t.content.state===Pt.ii.oi}Zi(t){return t.content instanceof wt&&"home"===t.content.name}_i(t){return t.content instanceof Ct||t.content instanceof yt}}class Gt{constructor(){this.Xt=!1,this.zi=9,this.Ni=0,this.Vi=0,this.Fi=0,this.Wi=[],this.Xi=!1,this.th=!1,st(16,()=>{this.Fi=Math.min(1,this.Fi+.01)}),st(4,()=>{this.Xt=!0}),st(5,t=>{this.Xt=!1,t.Wi&&t.Wi.forEach(t=>{this.Wi.push({label:t,time:5e3})})}),st(12,t=>{this.zi-=(t+1)/3,this.zi=Math.round(3*this.zi)/3,this.zi=Math.round(10*this.zi)/10,nt(t=>{const s=1e4;if(t>s)return 0;const i=(s-t)/s;return((2*Math.random()-1)*Math.sin(.003*t)*.6+Math.sin(t/(15+8*Math.sin(t/500)))*Math.exp(-t/2e3)*.4)*i*i*.3}),this.zi>0||(this.zi=0,it(19))}),st(13,()=>{this.Ni++,this.Vi=this.Ni,this.sh(),it(14,this.Ni)}),st(11,()=>{this.sh()})}sh(){let s=0;for(let i=Math.floor(this.zi)+1;9>=i;i++)t(()=>{this.zi=i,nt(t=>{const s=6e3;if(t>s)return 0;var i=(s-t)/s;return.5*Math.sin(.01*t*Math.sin(.007*t+Math.sin(t/1200))+Math.sin(t/800))*i*i})},500+800*s++)}update(t){this.Wi.forEach(s=>s.time-=t)}ri(){return 4*this.Fi+this.Ni}}class Qt{constructor(t){this.ih=t,this.hh=null,this.eh=0,this.isActive=!1,this.ah=!1,this.currentState=null,this.oh="",this.nh=0,this.rh=0,this.uh=20,this.fh=2,st(1,t=>{this.dh(t)})}dh(t){this.ih[t]&&(this.hh=t,this.currentState=t,this.eh=0,this.isActive=!0,this.ah=!1,this.Mh())}update(t){if(!this.isActive||!this.hh)return;const s=e.v.get("Space"),i=s&&!this.ah;if(this.ah=s||!1,0===this.fh){this.rh+=t;const s=Math.floor(this.rh/1e3*this.uh);this.oh.length>s?s>this.nh&&(this.nh=s,this.wh()):(this.nh=this.oh.length,this.fh=1,this.wh())}i&&this.ph()}ph(){if(this.hh){if(0===this.fh)return this.nh=this.oh.length,this.fh=1,void this.wh();1===this.fh&&(this.ih[this.hh].yh.length-1>this.eh?(this.eh++,this.Mh()):this.xh())}}wh(){const t=this.oh.substring(0,this.nh);it(3,t)}Mh(){if(!this.hh)return;const t=this.ih[this.hh];t.Ys=!0,this.oh=t.yh[this.eh],this.nh=0,this.rh=0,this.fh=0,this.wh()}xh(){if(!this.hh)return;const t=this.hh;this.isActive=!1,this.hh=null,this.currentState=null,this.eh=0,it(2,t)}}const St={1:{yh:["Zzzzz...","Yawwwn...","How long was i sleeping?..."]},2:{yh:["Evil spirits?","Has the magic barrier failed\nwhile I slept??","This one seems weak.","I'll exorcise it and then\ngo check the barrier","> Use (space) to attack"],Wi:["find magic barrier obelisk"]},3:{yh:["I have no magic power left!","My magic comes from villagers\nworshiping me...","Something must be wrong with\nthe cat altar."],Wi:["repair the cat altar"]},5:{yh:["I don't have enough magic!","Something must be wrong with\nthe cat altars in the valley"]},4:{yh:["My magic has increased a little.","But the other altars...\nthey must be damaged too."],Wi:["repair all 5 temples","restore the forest magic barrier"]},7:{yh:["Villagers are very supersticious.","I should not let them see me,\nthat will empower the evil spirits."]},6:{yh:["I have restore my full magic power","Now I am able to restore the\nmagic barrier again."],Wi:["restore the forest magic barrier"]},8:{yh:["The barrier is restored.","The altars are back online.","The spirits are resting in peace.","Time for a well deserved nap..."]}};class Lt{constructor(){this.mh=new Qt({...St}),st(2,s=>{it(5,St[s]),1===s&&(it(6),it(18),W.X=.08,t(()=>{it(1,2)},3e3)),2===s&&it(9),8===s&&t(()=>it(22),3e3)}),st(1,()=>{it(4)}),st(15,()=>{it(1,St[3].Ys?5:3)}),st(14,t=>{it(1,6>t?4:6)}),st(16,()=>{St[7].Ys||it(1,7)}),st(21,()=>{it(1,8)}),t(()=>this.mh.dh(1),1e3)}update(t){this.mh.update(t)}}const zt=new class{constructor(){this.startTime=0,this.gh=!1}async start(){this.gh||(this.bh=new(window.AudioContext||window.webkitAudioContext),await this.bh.resume(),await this.bh.audioWorklet.addModule("music-worklet.js"),this.Ah=new AudioWorkletNode(this.bh,"mp"),this.Ah.connect(this.bh.destination),this.gh=!0)}Uh(){this.Ah?.port.postMessage(0)}pause(){this.Ah?.port.postMessage(1)}unpause(){this.Ah?.port.postMessage(2)}stop(){this.gh&&(this.Ah?.disconnect(),this.gh=!1)}};class Vt{constructor(){this.kh=!0,this.Ch=0,this.Ih=!0,this.Ph={x:0,y:0}}jh(){zt.stop(),W.ht.clearRect(0,0,c4.width,c4.height),(()=>{for(const{Dt:t,Ht:s}of tt)document.removeEventListener(t,s);tt.length=0})()}Dh(){this.kh&&zt.start(),st(9,()=>{zt.Uh()}),st(23,()=>{zt.pause()}),st(24,()=>{zt.unpause()}),st(19,()=>{t(()=>h.Hh(Wt),3e3)}),st(22,()=>{t(()=>h.Hh(Wt),6e3)}),st(20,()=>{zt.pause(),this.map.xi.forEach((s,i)=>{t(()=>{this.Ih=!1,this.Ph={x:s.x,y:s.y},W.ct(this.Ph.x,this.Ph.y,5,!0),t(()=>{s.ls=G.G,s.Ks=-99,s.$s.forEach(t=>t.ns(t.Ls)),lt(i)},1500)},1e3+3e3*i)}),t(()=>{this.Ih=!1;const s=this.map.S;this.Ph={x:s.x,y:s.y},W.ct(this.Ph.x,this.Ph.y,5,!0);let i=4500;t(()=>{s.ls=G.L;let i=0;t(()=>{lt(this.map.xi.length+i++)},250,4)},i),i+=1e3,t(()=>{s.di()},i),i+=2*It.animationDuration,t(()=>{zt.start()},i),t(()=>{it(21)},i)},1e3+3e3*this.map.xi.length)}),this.Lt=new Gt,this.map=new Dt(160,160,this.Lt),this.T=new ut(60,85,this.map,this.Lt),this.actions=new Rt(this.map,this.T),this.Th=new Bt(this.map,this.T,this.actions,this.Lt),this.mh=new Lt,this.map.set(this.T.Ct,this.T.It,this.T),W.ct(this.T.x,this.T.y,20,!0),W.X=.01}Eh(t){this.Ih?(W.ct(this.T.x,this.T.y,5+this.Ch+(9-this.Lt.zi)/9),this.Ph={x:this.T.x,y:this.T.y}):(W.X=.01,W.ct(this.Ph.x,this.Ph.y,7)),W.lt(),this.Lt.zi>0&&(this.Lt.Xt||this.actions.update(),this.map.update(t,this.Lt.Xt),this.Th.update(t),this.Lt.update(t)),this.mh.update(t),s(t),this.Lt.zi>0&&!this.Lt.th?(this.map.draw(this.Ph.x,this.Ph.y),this.Th.draw()):(this.Lt.zi>0&&this.Th.draw(),this.T.update(t),this.T.draw()),W.ut()}}const Nt=new Mt(0),Wt=new class{constructor(){this.Ws=0,this.Oh=!1}Eh(t){this.Ws+=t,(()=>{const t=[m,x,y,p,w],s=Math.ceil(c2.height/t.length),i=c2.width/32;for(let h=0;32>h;h++){const e=10*Math.round(16*Math.sin(1-8*Math.PI*h/32)/10);t.forEach((t,a)=>{W.tt.fillStyle=t,W.tt.fillRect(i*h,e+s*a-20,Math.ceil(c2.width/32),s)})}const h=c2.width/22,e=c2.height/2/22,a=G.oak,o=G.spruce;if(a){for(let t=0;h+32>=t;t++)for(let s=e*(1.2-Math.cos(t/h*2*Math.PI));s>0;s--){const i=5*Math.sin(12*Math.PI*(s/e));W.rt(.2+Nt.next()>s/e?a:o,22*t+i-16,c2.height-(22*s+.7*Nt.next())/2,!1,32,32)}Nt.ds=0}})();const s=W.st.canvas.width/2;W.nt("Meow Mountain",s,100,w,1,0,15),W.nt("Press Enter to start",s,230,P,1,0,4),W.nt("Press F to toggle fullscreen",s,280,m,1,0,4),this.Bh()}Bh(){e.m&&!e.k.m&&h.Hh(new Vt);const t=!!e.v.get("KeyF");t&&!this.Oh&&(document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()),this.Oh=t}};document.querySelector('link[type="image/x-icon"]').href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='85'%3E💜%3C/text%3E%3C/svg%3E";let Ft=0,Yt=!1;window.addEventListener("blur",()=>{it(23),Yt=!0}),window.addEventListener("focus",()=>{it(24),Yt=!1}),h=new class{constructor(t,...s){this.currentState=t,this.currentState.Dh?.(...s)}Hh(t,...s){this.currentState.jh?.(),this.currentState=t,this.currentState.Dh?.(...s)}getState(){return this.currentState}}(Wt,...[]),setInterval(t=>{if(Yt)return;let i=(t=performance.now())-Ft;if(Ft=t,i>1e3)return;W.clear();const a=h.getState();e.P(),a.Eh(i),s(i)},16);
//# sourceMappingURL=index-C6NmJSKe.js.map
