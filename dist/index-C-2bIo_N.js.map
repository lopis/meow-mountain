{"version":3,"file":"index-C-2bIo_N.js","sources":["../../src/core/timer.ts","../../src/utils/smooth-movement.ts","../../src/game-state-machine.ts","../../src/core/controls.ts","../../src/core/util/canvas.ts","../../src/core/emoji.ts","../../src/game/sprite-loader.ts","../../src/core/tileset.ts","../../src/core/util/color.ts","../../src/game/sprites.ts","../../src/game/game-assets.ts","../../src/core/util/image-generator.ts","../../src/core/font.ts","../../src/core/draw-engine.ts","../../src/game/constants.ts","../../src/core/game-object.ts","../../src/core/event.ts","../../src/game/entities/pentagram-attack.ts","../../src/game/grid-utils.ts","../../src/core/audio.ts","../../src/game/entities/player.ts","../../src/core/game-static-object.ts","../../src/game/entities/tree.ts","../../src/core/util/rng.ts","../../src/game/entities/house.ts","../../src/game/entities/villager.ts","../../src/game/entities/farm.ts","../../src/game/entities/village.ts","../../src/game/entities/icon.ts","../../src/game/path-findind.ts","../../src/game/entities/hp-bar.ts","../../src/game/entities/spirit.ts","../../src/game/entities/statue.ts","../../src/game/game-map.ts","../../src/core/util/util.ts","../../src/game/mini-map.ts","../../src/game/dialog-box.ts","../../src/game/hud.ts","../../src/game/entities/obelisk.ts","../../src/game/actions.ts","../../src/game/game-data.ts","../../src/core/story-engine.ts","../../src/game/game-story.ts","../../src/core/music-player.ts","../../src/game-states/game.state.ts","../../src/game-states/menu.state.ts","../../src/index.ts","../../src/core/state-machine.ts"],"sourcesContent":["type TimeEventHandler = {\n  callback: (() => void)\n  time: number\n  timeLeft: number\n  repeat: number\n}\n\nlet timeEvents: TimeEventHandler[] = [];\n\nexport function addTimeEvent (callback: () => void, time: number, repeat = 0, delay = 0) {\n  timeEvents.push({callback, time, timeLeft: time + delay, repeat});\n}\n\nexport function clearTimers() {\n  timeEvents = [];\n}\n\n/**\n * Updates the time events, checking if any should be executed.\n * @param delta The time in milliseconds since the last update.\n */\nexport function updateTimeEvents(delta: number) {\n  for (let i = timeEvents.length - 1; i >= 0; i--) {\n    const timeEvent = timeEvents[i];\n    if (!timeEvent) {\n      return;\n    }\n    timeEvent.timeLeft -= delta;\n    if (timeEvent.timeLeft <= 0) {\n      timeEvent.callback();\n\n      if (timeEvent.repeat-- <= 0) {\n        timeEvents.splice(i, 1); // Remove the executed event\n      } else {\n        timeEvent.timeLeft = timeEvent.time;\n      }\n    }\n  }\n}\n","import { CELL_WIDTH, CELL_HEIGHT } from '../game/constants';\n\nexport interface SmoothMovementState {\n  x: number;\n  y: number;\n  targetPos: { x: number; y: number };\n  moving: { x: number; y: number };\n  speed: number;\n}\n\n/**\n * Updates position smoothly towards target position using linear interpolation\n * @param state Object containing position, target, and movement state\n * @param timeElapsed Time elapsed since last update in milliseconds\n */\nexport function updatePositionSmoothly(state: SmoothMovementState, timeElapsed: number): void {\n  for (const axis of ['x', 'y'] as const) {\n    if (state[axis] !== state.targetPos[axis]) {\n      const d = state.targetPos[axis] - state[axis];\n      const step = Math.sign(d) * state.speed * timeElapsed / 1000;\n      if (Math.abs(step) >= Math.abs(d)) {\n        state[axis] = state.targetPos[axis];\n      } else {\n        state[axis] += step;\n      }\n    } else {\n      state.moving[axis] = 0;\n      state[axis] = Math.round(state[axis]);\n    }\n  }\n}\n\n/**\n * Sets target position in pixel coordinates based on grid cell coordinates\n * @param state Movement state object\n * @param col Grid column\n * @param row Grid row\n */\nexport function setTargetPosition(state: SmoothMovementState, col: number, row: number): void {\n  state.targetPos.x = col * CELL_WIDTH;\n  state.targetPos.y = row * CELL_HEIGHT;\n}\n\n/**\n * Moves towards a target grid position if the move is valid\n * @param state Movement state object\n * @param targetCol Target column\n * @param targetRow Target row\n * @param currentCol Current column (will be updated)\n * @param currentRow Current row (will be updated)\n * @param isValidMove Function to check if move is valid\n * @returns true if movement was initiated, false otherwise\n */\nexport function moveToGridPosition(\n  state: SmoothMovementState,\n  targetCol: number,\n  targetRow: number,\n  currentCol: { value: number },\n  currentRow: { value: number },\n  isValidMove: (col: number, row: number) => boolean\n): boolean {\n  if (!isValidMove(targetCol, targetRow)) {\n    return false;\n  }\n\n  // Calculate movement direction\n  const deltaCol = targetCol - currentCol.value;\n  const deltaRow = targetRow - currentRow.value;\n\n  // Update grid position\n  currentCol.value = targetCol;\n  currentRow.value = targetRow;\n\n  // Set movement direction\n  state.moving.x = Math.sign(deltaCol);\n  state.moving.y = Math.sign(deltaRow);\n\n  // Set target pixel position\n  setTargetPosition(state, targetCol, targetRow);\n\n  return true;\n}\n","import { StateMachine } from './core/state-machine';\nimport { State } from './core/state';\n\nexport let gameStateMachine: StateMachine;\n\nexport function createGameStateMachine(initialState: State, ...initialArguments: any[]) {\n  gameStateMachine = new StateMachine(initialState, ...initialArguments);\n}\n","class Controls {\n  isUp = false;\n  isDown = false;\n  isLeft = false;\n  isRight = false;\n  isConfirm = false;\n  // isEscape = false;\n  isAction1 = false;\n  isMoving = false;\n  inputDirection: DOMPoint;\n\n  keyMap: Map<string, boolean> = new Map();\n  previousState = {\n    isUp: this.isUp,\n    isDown: this.isDown,\n    isConfirm: this.isConfirm,\n    // isEscape: this.isEscape,\n    isAction1: this.isAction1,\n  };\n\n  constructor() {\n    document.addEventListener('keydown', event => this.toggleKey(event, true));\n    document.addEventListener('keyup', event => this.toggleKey(event, false));\n    this.inputDirection = new DOMPoint();\n  }\n\n  queryController() {\n    this.previousState.isUp = this.isUp;\n    this.previousState.isDown = this.isDown;\n    this.previousState.isConfirm = this.isConfirm;\n    // this.previousState.isEscape = this.isEscape;\n    this.previousState.isAction1 = this.isAction1;\n\n    const leftVal = (this.keyMap.get('KeyA') || this.keyMap.get('KeyQ') || this.keyMap.get('ArrowLeft')) ? -1 : 0;\n    const rightVal = (this.keyMap.get('KeyD') || this.keyMap.get('ArrowRight')) ? 1 : 0;\n    const upVal = this.keyMap.get('KeyW') || (this.keyMap.get('KeyZ') || this.keyMap.get('ArrowUp')) ? -1 : 0;\n    const downVal = (this.keyMap.get('KeyS') || this.keyMap.get('ArrowDown')) ? 1 : 0;\n    this.inputDirection.x = (leftVal + rightVal) || 0;\n    this.inputDirection.y = (upVal + downVal) || 0;\n\n    // const deadzone = 0.1;\n    // if (Math.hypot(this.inputDirection.x, this.inputDirection.y) < deadzone) {\n    //   this.inputDirection.x = 0;\n    //   this.inputDirection.y = 0;\n    // }\n\n    this.isUp = this.inputDirection.y < 0;\n    this.isDown = this.inputDirection.y > 0;\n    this.isLeft = this.inputDirection.x < 0;\n    this.isRight = this.inputDirection.x > 0;\n    this.isMoving = this.inputDirection.x !== 0 || this.inputDirection.y !== 0;\n    this.isConfirm = Boolean(this.keyMap.get('Enter'));\n    // this.isEscape = Boolean(this.keyMap.get('Escape'));\n    this.isAction1 = Boolean(this.keyMap.get('Space'));\n  }\n\n  private toggleKey(event: KeyboardEvent, isPressed: boolean) {\n    this.keyMap.set(event.code, isPressed);\n  }\n}\n\nexport const controls = new Controls();\n","/* eslint-disable id-denylist */\n// Canvas creation and context helpers for bundle size optimization\n\nexport const createCanvas = (w?: number, h?: number) => {\n  const c = document.createElement('canvas');\n  if (w) c.width = w;\n  if (h) c.height = h;\n  return c;\n};\n\nexport const getCtx = (canvas: HTMLCanvasElement) => canvas.getContext('2d')!;\n\nexport const createCanvasWithCtx = (w?: number, h?: number) => {\n  const canvas = createCanvas(w, h);\n  return [canvas, getCtx(canvas)] as const;\n};\n\nexport const setCanvasSize = (canvas: HTMLCanvasElement, w: number, h: number) => {\n  canvas.width = w;\n  canvas.height = h;\n};\n","import { createCanvasWithCtx } from './util/canvas';\n\n/**\n * Quantizes rgba color values to 8bit.\n */\nconst quantizeToPalette = (r: number, g: number, b: number, a: number) => {\n  // 1-bit transparency\n  if (a < 128) {\n    return [0, 0, 0, 0]; // transparent\n  }\n  const qr = Math.round(r / 51) * 51;\n  const qg = Math.round(g / 51) * 51;\n  const qb = Math.round(b / 51) * 51;\n\n  return [qr, qg, qb, 255];\n};\n\n/**\n * Converts an emoji to a pixelated image by quantizing the colors\n * to 8 bit and the transparency to 1 bit.\n */\nexport const emojiToPixelArt = (\n  emoji: string,\n  fontSize = 10,\n) => {\n  // Some emoji are a bit bigger than the font\n  const spriteScale = 0.25;\n  const spriteSize = Math.floor(fontSize * (1 + spriteScale));\n  const padding = Math.floor(fontSize * spriteScale / 2);\n\n  // Create temporary canvas\n  const [_, tmpCtx] = createCanvasWithCtx(spriteSize, spriteSize);\n\n  // Draw emoji in chosen font size\n  tmpCtx.font = `${fontSize}px sans-serif`;\n  tmpCtx.textBaseline = 'top';\n  tmpCtx.clearRect(0, 0, spriteSize, spriteSize);\n  tmpCtx.translate(-1, 0);\n  tmpCtx.fillText(emoji, padding, padding);\n\n  // Read pixels\n  const imgData = tmpCtx.getImageData(0, 0, spriteSize, spriteSize);\n  const data = imgData.data;\n\n  // Create new image data with quantized colors\n  const outImg = tmpCtx.createImageData(spriteSize, spriteSize);\n  const outData = outImg.data;\n  for (let i = 0; i < data.length; i += 4) {\n    const [r, g, b, a] = quantizeToPalette(\n      data[i],      // red\n      data[i + 1],  // green\n      data[i + 2],  // blue\n      data[i + 3],  // alpha\n    );\n    outData[i] = r;\n    outData[i + 1] = g;\n    outData[i + 2] = b;\n    outData[i + 3] = a;\n  }\n\n  // Create a new canvas to draw the quantized image\n  const [outCanvas, outCtx] = createCanvasWithCtx(spriteSize, spriteSize);\n  outCtx.putImageData(outImg, 0, 0);\n\n  // Create an image element from the canvas\n  const img = new Image();\n  img.src = outCanvas.toDataURL();\n  return img;\n};\n\n\n// const ctx = c.getContext(\"2d\");\n// ctx.imageSmoothingEnabled = false;\n\n\n// const font = 8;\n// const spriteSize = Math.floor(font * 1.25); // must match function logic\n\n// const emojis = ['🔥','🍀','🌼','🐓','🌷','🌹','👻','🥚','🍎'];\n\n// emojis.forEach((emoji, i) => {\n//   const col = i % (100 / spriteSize);       // column in grid\n//   const row = Math.floor(i / (100 / spriteSize)); // row in grid\n//   const x = col * spriteSize;\n//   const y = row * spriteSize;\n\n//   emojiToPixelArt(emoji, ctx, font, x, y);\n// });\n","export const generateImageData = (icon: string, iconPalette: string[]): HTMLImageElement => {\n  const transparent = '#FF00FF';\n  const palette = [transparent, ...iconPalette];\n  \n  const colorsPerByte = palette.length > 4 ? 2 : palette.length > 2 ? 3 : 6;\n  const bytesPerColor = 6 / colorsPerByte;\n  const bitMask = (1 << bytesPerColor) - 1;\n  const canvas = document.createElement('canvas');\n  const size = Math.sqrt(icon.length * colorsPerByte);\n  canvas.setAttribute('width', size.toString());\n  canvas.setAttribute('height', size.toString());\n  const ctx = canvas.getContext('2d')!;\n  const imgData = ctx.createImageData(size, size);\n  const data = imgData.data;\n  \n  let i = 0;\n  [...icon].map(c => {\n    const z = c.charCodeAt(0);\n\n    for (let bit = 0; bit < colorsPerByte; bit++) {\n      const paletteIndex = (z >> bit * bytesPerColor) & bitMask;\n      const hexColor = palette[paletteIndex] || transparent;\n      \n      // Convert hex to RGB\n      const hex = hexColor.replace('#', '');\n      const r = parseInt(hex.substring(0, 2), 16);\n      const g = parseInt(hex.substring(2, 4), 16);\n      const b = parseInt(hex.substring(4, 6), 16);\n      const a = paletteIndex ? 255 : 0;\n      \n      data[i] = r;\n      data[i + 1] = g;\n      data[i + 2] = b;\n      data[i + 3] = a;\n      i += 4;\n    }\n  });\n\n  \n  ctx.putImageData(imgData, 0, 0);\n  const img = new Image();\n  img.src = canvas.toDataURL();\n  return img;\n};\n","import { generateImageData } from '@/game/sprite-loader';\n\nexport class NewTileset<T extends string | number> {\n  public animations: Record<T, HTMLImageElement[]> = {} as Record<T, HTMLImageElement[]>;\n  public tileSize = 16;\n\n  constructor(\n    public spriteSheet: { size: number, palette: string[]; data: Record<T, string[]> },\n  ) {\n    // Process each animation (sit, idle, walk, run, etc.)\n    for (const [animationName, frames] of Object.entries(spriteSheet.data) as [T, string[]][]) {\n      this.animations[animationName] = frames.map((frameData: string) => \n        generateImageData(frameData, spriteSheet.palette)\n      );\n    }\n    this.tileSize = spriteSheet.size;\n  }\n}\n","export const hexToRgb = (hex: string) : number[] => {\n  // @ts-ignore\n  return hex.replace(\n    /^#?([a-f\\d])([a-f\\d])([a-f\\d])([a-f\\d])$/i,\n    (_, r, g, b, a) => '#' + r + r + g + g + b + b + a + a)\n    .substring(1)\n    .match(/.{2}/g)\n    .map(x => parseInt(x, 16)\n  );\n};\n\n\nexport type Color =\n'green0' | \n'green1' | \n'green2' | \n'green3' | \n'green4' | \n'green5' | \n'green6' | \n'blue0' | \n'blue1' | \n'blue2' | \n'blue3' | \n'blue4' | \n'blue5' | \n'blue6' | \n'purple0' | \n'purple1' | \n'purple2' | \n'purple3' | \n'purple4' | \n'purple5' | \n'yellow0' | \n'yellow1' | \n'yellow2' | \n'black' | \n'white';\n\n// export const colors: Record<Color, string> = new Proxy({}, {\n//   get: (_, prop: string) => {\n//     if (typeof window === 'undefined' || typeof document === 'undefined') return '';\n//     const value = getComputedStyle(document.documentElement).getPropertyValue(`--${prop}`);\n//     return value.trim() || '';\n//   }\n// });\n\n// function getColorsFromCSS() {\n//   const root = document.documentElement;\n//   const computedStyle = getComputedStyle(root);\n  \n//   const colorKeys = [\n//     'green0', 'green1', 'green2', 'green3',\n//     'blue0', 'blue1', 'blue2', 'blue3', 'blue4', 'blue5', 'blue6',\n//     'purple0', 'purple1', 'purple2', 'purple3', 'purple4', 'purple5',\n//     'yellow0', 'yellow1', 'yellow2',\n//     'black', 'white'\n//   ];\n  \n//   const colors = {};\n//   colorKeys.forEach((key: string) => {\n//     // @ts-expect-error\n//     colors[key] = computedStyle.getPropertyValue(`--${key}`).trim();\n//   });\n  \n//   return colors;\n// }\n\nexport const colors: Record<Color, string> = {\n  green0: '#b3d7ad',\n  green1: '#9dc4a0',\n  green2: '#89b290',\n  green3: '#75a080',\n  green4: '#618e70',\n  green5: '#4d7c60',\n  green6: '#396a50',\n  blue0: '#b4ecf3',\n  blue1: '#4e9ca6',\n  blue2: '#3e8791',\n  blue3: '#2f6269',\n  blue4: '#255056',\n  blue5: '#1f4347',\n  blue6: '#13282b',\n  purple0: '#e0b8d3',\n  purple1: '#d49bc2',\n  purple2: '#b34d92',\n  purple3: '#551641',\n  purple4: '#714162',\n  purple5: '#996a8a',\n  yellow0: '#fffef9',\n  yellow1: '#f2daab',\n  yellow2: '#e6a386',\n  black: '#13282b',\n  white: '#fffef9'\n};\n","// Auto-generated icon data\n// Generated on 2025-09-04T14:10:07.197Z\n\nimport { colors } from '@/core/util/color';\nimport { CatStates, VillagerStates } from './game-assets';\n\nexport const cat = {\n  size: 10,\n  frames: 4,\n  palette: [\n    colors.black,\n  ],\n  data: {\n    [CatStates.idle]: [\n      '@@@`@PJbcxpO|AQ@@',\n      '@@@`@DJbcxpO|AQ@@',\n      '@@@@h@nag|pG|AQ@@',\n      '@@@@@@z`SxxO|AQ@@'\n    ],\n    [CatStates.walk]: [\n      '@@@`@DJbcxpO|AR@@',\n      '@@@P@HJdCy`OpC`@@',\n      '@@@@@DJbCy`OxCR@@',\n      '@@@H@DJbcxpO|AA@@'\n    ],\n    [CatStates.run]: [\n      '@@@@@@@`ZxyO~@B@@',\n      '@@@@@@J`_|xG~@E@@',\n      '@@@@@@@`ZxyO~PB@@',\n      '@@@@@@J`CxG~@D@@'\n    ],\n    [CatStates.die]: [\n      '@@@@AHJdCy`OxCb@@',\n      '@@@@@@jcC`C@@@@@',\n      '@@@@@@@@@x|oxG@@@',\n      '@@@@@@@@@@@N~yC@'\n    ],\n    [CatStates.scratch]: [\n      '@@@`@DJbcxpO|AQ@@',\n      '@@@@@BPhHN|Ka@@@',\n      '@@@D@BEqQ\\\\xG~`P@@',\n      '@@@P@DJbcxpO|AQ@@'\n    ],\n    [CatStates.scared]: [\n      '@`@H@F`Wy_~GsPD@@',\n      '@`@H@B`Qy_~GwPD@@',\n      '@`@H@F`Wy_~GsPD@@',\n      '@`@H@B`Qy_~GwPD@@'\n    ],\n    [CatStates.sleep]: [\n      '@@@@@@@@@h~_~K@@@',\n      '@@@@@@@`Bx~_~E@@@',\n      '@@@@@@@`Bx}o~A@@@',\n      '@@@@@@@@@h|~C@@@'\n    ]\n  }\n};\n\nexport const villager = {\n  size: 8,\n  frames: 4,\n  palette: [\n    colors.purple0,\n    colors.blue6,\n  ],\n  data: {\n    [VillagerStates.walk]: [\n      'PUAUUQVVTUEUUajj`@B@`@',\n      '@@@TUPUUdeEUUQUUhjJH`@',\n      'PUAUUQVVTUEUUajj`@BH@@',\n      '@@@TUPUUdeEUUQUUhjJH`@'\n    ],\n    [VillagerStates.scared]: [\n      '@@@TUPUUTfEiiQUUhjJH`@',\n      '@@@UETUEeYQZZTUEjjBBH@',\n    ],\n  }\n};\n\nexport const statue = {\n  size: 16,\n  palette: [\n    colors.blue2,\n    colors.blue3,\n    colors.blue4,\n  ],\n  data: '@@@@@@@DD@@@`e@@@@jB@@@hJ@@@@O@@@@}A@@@xK@@@`o@@@p~N@@T{{E@TmoWAPUUUE@WUUu@|C@C@'\n};\n\nexport const obelisk = {\n  size: 16,\n  palette: [\n    colors.blue2,\n    colors.blue3,\n    colors.blue4,\n  ],\n  data: '@PUE@@`UUB@@VUI@@xo@@poC@@kjN@@l{@@p~C@@kjN@@|o@@p{~C@@{O@@|k@@pC@@|C@@@@@@@'\n};\n\nexport const oak = {\n  size: 16,\n  palette: [\n    colors.green6,\n    colors.green3,\n    colors.green0,\n    colors.green5,\n  ],\n  data: '@@@@@@@@@@HIIA@@@@Q[[J@@@HZ[[SA@@QR[[RJ@@QRRRRJ@@aRRRRL@@QTRRbJ@@abbTTL@@aTTbbL@@IddddI@@HaddLA@@@HIIA@@@@HIIA@@@@@II@@@@@@@@@@@',\n};\n\nexport const spruce = {\n  size: 16,\n  palette: [\n    colors.blue3,\n    colors.blue0,\n    colors.blue1,\n    colors.blue2,\n  ],\n  data: '@@@HA@@@@@@QJ@@@@@HRRA@@@@YSZK@@@H[[[[A@@H[[[[A@@a\\\\[[cL@@acc\\\\\\\\L@@a\\\\\\\\ccL@@adc\\\\dL@@IddddI@@HaddLA@@@HIIA@@@@HIIA@@@@@II@@@@@@@@@@@',\n};\n\nexport const grass = {\n  size: 16,\n  palette: [\n    colors.green4,\n    colors.green5,\n    colors.green6,\n  ],\n  data: 'PPDDAP^feYTvVVYfweYZi]YfeiMgVvYv|Vvey`YZYvCfeiiCYZVfE\\\\wYZ[qWvefFle]fvPVfuY@g[dCpsCpC@'\n};\n\nexport const house = {\n  size: 16,\n  palette: [\n    colors.blue4,\n    colors.blue2,\n    colors.blue3\n  ],\n  data: 'PU@@@PjVUU@YyGdjWU]PkAm^UUGt_PWUUuA}GTUUUUpjjjjC[_ZUNlk}ypvgVgCkjZ_N|}}@'\n};\n\nexport const ground = {\n  size: 12,\n  palette: [\n    colors.green4,\n    colors.green5,\n  ],\n  data: '@@@@@@D@@A@D@DA@DY@@PjEDA@@@@@A@@@@@@@@QQ@AdF@Pi',\n};\n","import { emojiToPixelArt } from '@/core/emoji';\nimport { NewTileset as NewTileset } from '@/core/tileset';\nimport { createCornerImage } from '@/core/util/image-generator';\nimport { generateImageData } from './sprite-loader';\nimport { cat, grass, ground, house, oak, obelisk, spruce, statue, villager } from './sprites';\n\nexport const enum CatStates {\n  idle,\n  walk, \n  run,\n  die,\n  scratch,\n  scared,\n  sleep\n}\nexport const enum VillagerStates {\n  walk,\n  scared,\n} ;\n\nconst emoji = '🔥,🍀,🌼,🐓,🌷,🌹,👻,🥚,🍎'.split(',');\nexport const icons = emoji.map(e => emojiToPixelArt(e));\n\nexport class GameAssets {\n  static cat: NewTileset<CatStates>;\n  static villager: NewTileset<VillagerStates>;\n  static cornerImage: HTMLImageElement;\n  static oak: HTMLImageElement;\n  static spruce: HTMLImageElement;\n  static house: HTMLImageElement;\n  static grass: HTMLImageElement;\n  static ground: HTMLImageElement;\n  static statue: HTMLImageElement;\n  static obelisk: HTMLImageElement;\n\n  public static initialize() {\n    GameAssets.cat = new NewTileset<CatStates>(cat);\n    GameAssets.villager = new NewTileset<VillagerStates>(villager);\n    GameAssets.cornerImage = createCornerImage();\n    GameAssets.oak = generateImageData(oak.data, oak.palette);\n    GameAssets.spruce = generateImageData(spruce.data, spruce.palette);\n    GameAssets.house = generateImageData(house.data, house.palette);\n    GameAssets.grass = generateImageData(grass.data, grass.palette);\n    GameAssets.ground = generateImageData(ground.data, ground.palette);\n    GameAssets.statue = generateImageData(statue.data, statue.palette);\n    GameAssets.obelisk = generateImageData(obelisk.data, obelisk.palette);\n  }\n}\n","import { colors } from './color';\nimport { createCanvasWithCtx } from './canvas';\n\n/**\n * Creates a 16x16 image with transparent background and colored corners\n * @param cornerColor The color to use for the 3x3 corner pixels\n * @returns HTMLImageElement ready to be used with drawImage\n */\nexport function createCornerImage(cornerColor: string = colors.purple4): HTMLImageElement {\n  // Create temporary canvas\n  const [canvas, ctx] = createCanvasWithCtx(16, 16);\n\n  // Clear to transparent\n  ctx.clearRect(0, 0, 16, 16);\n\n  // Set corner color\n  ctx.fillStyle = cornerColor;\n\n  // Draw 2x2 arrow corners (3 pixels each, 1 transparent)\n  \n  // Top-left corner arrow (pointing inward)\n  ctx.fillRect(0, 0, 1, 1); // top-left pixel\n  ctx.fillRect(1, 0, 1, 1); // top-right pixel  \n  ctx.fillRect(0, 1, 1, 1); // bottom-left pixel\n  // (1,1) is transparent\n  \n  // Top-right corner arrow (pointing inward)\n  ctx.fillRect(14, 0, 1, 1); // top-left pixel\n  ctx.fillRect(15, 0, 1, 1); // top-right pixel\n  ctx.fillRect(15, 1, 1, 1); // bottom-right pixel\n  // (14,1) is transparent\n  \n  // Bottom-left corner arrow (pointing inward)\n  ctx.fillRect(0, 14, 1, 1); // top-left pixel\n  ctx.fillRect(0, 15, 1, 1); // bottom-left pixel\n  ctx.fillRect(1, 15, 1, 1); // bottom-right pixel\n  // (1,14) is transparent\n  \n  // Bottom-right corner arrow (pointing inward)\n  ctx.fillRect(15, 14, 1, 1); // top-right pixel\n  ctx.fillRect(14, 15, 1, 1); // bottom-left pixel\n  ctx.fillRect(15, 15, 1, 1); // bottom-right pixel\n  // (14,14) is transparent\n\n  // Convert canvas to image\n  const img = new Image();\n  img.src = canvas.toDataURL();\n  \n  return img;\n}\n","import { hexToRgb, colors } from '@/core/util/color';\nimport { createCanvasWithCtx } from '@/core/util/canvas';\n\nexport const tinyFont = /* font-start */'6v7ic,6trd0,6to3o,6nvic,55eyo,2np50,2jcjo,3ugt8,34ao,7k,glc,1,opzc,3xdeu,3sapz,8rhfz,8ri26,1bzky,9j1ny,3ws2u,9dv9k,3xb1i,3xbmu,2t8g,2t8s,26ndv,ajmo,fl5ug,3x7nm,n75t,54br,59u0e,53if,rlev,4jrb,1yjk4,4eav,55q95,18zsz,mi3r,574tl,1aedd,ljn9,a1bd,4f1i,a1fs,549t,53ig,5832,1dwsh,6iw6,6ix0,cbsa,6gix,6fk4,aky7,7mbws,cvtyq,deehh,2sfi3'/* font-end */.split(',');\n\n// Character cache: charCode-color-size -> Canvas\nconst characterCanvases: { [key: string]: HTMLCanvasElement } = {};\n\nexport const FULL_HEART = '#';\nexport const TWO_THIRDS_HEART = '$';\nexport const ONE_THIRD_HEART = '%';\nexport const EMPTY_HEART = '&';\nexport const COLCHEIA = '*';\nexport const HOUSE = '^';\n\nexport const TELEPORT = '[';\nexport const SCRATCH = '\\\\';\nexport const MAGIC = ']';\n\nexport type DrawTextProps = {\n  text: string\n  x: number\n  y: number\n  color?: string\n  textAlign?: CanvasTextAlign\n  textBaseline?: CanvasTextBaseline\n  size?: number\n  space?: number\n}\n\nconst getCharacterData = (letter: string) => {\n  if (letter === '0') return { paddedBinary: '0'.repeat(25), leftmostCol: 0, charWidth: 5 };\n  \n  const paddedBinary = String(parseInt(letter, 36).toString(2)).padStart(25, '0');\n  let leftmostCol = 5;\n  let rightmostCol = -1;\n  \n  // Find leftmost and rightmost columns with set bits\n  for (let col = 0; col < 5; col++) {\n    for (let row = 0; row < 5; row++) {\n      const bitIndex = row * 5 + col;\n      if (paddedBinary[bitIndex] === '1') {\n        leftmostCol = Math.min(leftmostCol, col);\n        rightmostCol = Math.max(rightmostCol, col);\n      }\n    }\n  }\n  \n  const charWidth = rightmostCol >= leftmostCol ? rightmostCol - leftmostCol + 1 : 1;\n  return { paddedBinary, leftmostCol, charWidth };\n};\n\nconst getCharacterWidth = (letter: string): number => {\n  return getCharacterData(letter).charWidth;\n};\n\nconst createCharacterCanvas = (character: string, size: number, color: string): HTMLCanvasElement => {\n  const letter = character === ' ' ? '0' : tinyFont[character.charCodeAt(0) - 35];\n  const { paddedBinary, leftmostCol, charWidth } = getCharacterData(letter);\n  \n  const scaledWidth = charWidth * size;\n  const letterHeight = 5 * size;\n  \n  const [canvas, ctx] = createCanvasWithCtx(scaledWidth, letterHeight);\n  \n  const [r, g, b, a] = hexToRgb(color);\n  const fillStyle = `rgba(${r}, ${g}, ${b}, ${(a || 255) / 255})`;\n  \n  // Draw character bitmap\n  paddedBinary.split('').forEach((bit, bitIndex) => {\n    if (bit !== '0') {\n      const col = bitIndex % 5;\n      const row = Math.floor(bitIndex / 5);\n      \n      // Skip empty left columns\n      if (col < leftmostCol) return;\n      \n      const adjustedCol = col - leftmostCol;\n      \n      ctx.fillStyle = fillStyle;\n      ctx.fillRect(adjustedCol * size, row * size, size, size);\n    }\n  });\n\n  return canvas;\n};\n\nconst getCharacterCanvas = (character: string, size: number, color: string): HTMLCanvasElement => {\n  const cacheKey = `${character.charCodeAt(0)}-${color}-${size}`;\n  \n  if (!characterCanvases[cacheKey]) {\n    characterCanvases[cacheKey] = createCharacterCanvas(character, size, color);\n  }\n  \n  return characterCanvases[cacheKey];\n};\n\nexport const drawText = (\n  c: CanvasRenderingContext2D,\n  text: string,\n  x: number,\n  y: number,\n  color = colors.white,\n  textAlign = 0, // 0=left, 1=center, 2=right\n  textBaseline = 0, // 0=top, 1=middle, 2=bottom  \n  size = 2,\n  space = 1\n) => {\n  x = Math.round(x);\n  y = Math.round(y);\n  if (!text) text = ' ';\n  \n  // Calculate variable width for text\n  const spacing = space * size;\n  const characters = text.replace('!', '@').toUpperCase().split('');\n  \n  // Calculate positions and total width\n  let totalWidth = 0;\n  const charPositions: { char: string; x: number; charWidth: number }[] = [];\n  \n  characters.forEach((character, i) => {\n    const letter = character === ' ' ? '0' : tinyFont[character.charCodeAt(0) - 35];\n    const charWidth = getCharacterWidth(letter) * size;\n    \n    charPositions.push({ char: character, x: totalWidth, charWidth });\n    totalWidth += charWidth + (i < characters.length - 1 ? spacing : 0);\n  });\n  \n  const letterHeight = 5 * size;\n  const offsetX = textAlign === 0 ? 0 : textAlign === 1 ? Math.round(totalWidth / 2) : totalWidth;\n  const offsetY = textBaseline === 0 ? 0 : textBaseline === 1 ? Math.round(letterHeight / 2) : letterHeight;\n  \n  // Draw each character synchronously\n  charPositions.forEach(({ char, x: charX, charWidth }) => {\n    if (char === ' ') return; // Skip spaces\n    \n    const canvas = getCharacterCanvas(char, size, color);\n    c.drawImage(canvas, 0, 0, charWidth, letterHeight, x - offsetX + charX, y - offsetY, charWidth, letterHeight);\n  });\n};\n\n\n","import { GameAssets } from '@/game/game-assets';\nimport { drawText } from './font';\nimport { colors } from './util/color';\nimport { getCtx } from './util/canvas';\n\nconst makeCircle = (\n  ctx: CanvasRenderingContext2D,\n  centerX: number,\n  centerY: number,\n  radiusX: number,\n  radiusY: number,\n  skew = 0,\n) => {\n  // Draw ellipse using scaled circle algorithm\n  for (let y = -radiusY; y <= radiusY; y++) {\n    // Calculate the half-width at this y position using ellipse equation\n    const normalizedY = y / radiusY;\n    const halfWidth = Math.round(radiusX * Math.sqrt(1 - normalizedY * normalizedY));\n    \n    if (halfWidth > 0) {\n      const offset = Math.round(skew * Math.abs(y));\n      const currentY = centerY + y;\n      \n      if (y >= 0) {\n        ctx.rect(centerX - halfWidth - offset, currentY, halfWidth * 2, 1);\n      } else {\n        ctx.rect(centerX - halfWidth + offset, currentY, halfWidth * 2, 1);\n      }\n    }\n  }\n};\n\nclass DrawEngine {\n  ctx1: CanvasRenderingContext2D;\n  ctx2: CanvasRenderingContext2D;\n  ctx3: CanvasRenderingContext2D;\n  ctx4: CanvasRenderingContext2D;\n\n  // Canvas dimensions (cached for performance)\n  canvasWidth = 0;\n  canvasHeight = 0;\n\n  // Camera properties\n  cameraX = 0;\n  cameraY = 0;\n  zoom = 1;\n  targetCameraX = 0;\n  targetCameraY = 0;\n  targetZoom = 1;\n  cameraLerpSpeed = 0.08; // Adjust for faster/slower camera\n\n  constructor() {\n    this.ctx1 = getCtx(c1);\n    this.ctx2 = getCtx(c2);\n    this.ctx3 = getCtx(c3);\n    this.ctx4 = getCtx(c4);\n    GameAssets.initialize();\n    this.resizeCanvas();\n    window.addEventListener('resize', () => this.resizeCanvas());\n    window.addEventListener('orientationchange', () => this.resizeCanvas());\n  }\n\n  resizeCanvas() {\n    const aspectRatio = 4 / 3;\n    const gameWidth = 1200;\n    const gameHeight = Math.round(gameWidth / aspectRatio);\n    this.canvasWidth = gameWidth;\n    this.canvasHeight = gameHeight;\n    const ctxs: CanvasRenderingContext2D[] = [this.ctx1, this.ctx2, this.ctx3, this.ctx4];\n    for (const ctx of ctxs) {\n      // eslint-disable-next-line id-denylist\n      ctx.canvas.width = gameWidth;\n      // eslint-disable-next-line id-denylist\n      ctx.canvas.height = gameHeight;\n      ctx.imageSmoothingEnabled = false;\n    }\n  }\n\n  \n  // eslint-disable-next-line class-methods-use-this\n  drawCircumference(\n    ctx: CanvasRenderingContext2D,\n    centerX: number,\n    centerY: number,\n    radiusX: number,\n    radiusY: number,\n    color: string,\n    strokeWidth: number,\n  ) {\n    ctx.save();\n    ctx.beginPath();\n    makeCircle(ctx, centerX, centerY, radiusX, radiusY);\n    makeCircle(ctx, centerX, centerY, radiusX - strokeWidth, radiusY - strokeWidth);\n    ctx.clip('evenodd');\n    ctx.beginPath();\n    ctx.fillStyle = color;\n    ctx.fillRect(centerX - radiusX, centerY - radiusY, radiusX*2, radiusY*2);\n    ctx.fill();\n    ctx.restore();\n  }\n\n  drawText(\n    text: string,\n    x: number,\n    y: number,\n    color?: string,\n    textAlign = 0,\n    textBaseline = 0,\n    size = 2,\n    space = 1,\n    context?: CanvasRenderingContext2D\n  ) {\n    drawText(context || this.ctx1, text, x, y, color, textAlign, textBaseline, size, space);\n  }\n\n  static drawImage(\n    ctx: CanvasRenderingContext2D,\n    img: HTMLImageElement,\n    x: number,\n    y: number,\n    mirrored?: boolean,\n    imgWidth?: number,\n    imgWeight?: number,\n  ) {\n    if (mirrored) {\n      ctx.save();\n      ctx.scale(-1, 1);\n      x = -x - (imgWidth ?? img.width);\n    }\n    ctx.drawImage(\n      img,\n      x,\n      y,\n      imgWidth ?? img.width,\n      imgWeight ?? img.height,\n    );\n    if (mirrored) {\n      ctx.restore();\n    }\n  }\n\n  drawBackgroundImage(\n    img: HTMLImageElement,\n    x: number,\n    y: number,\n    mirrored?: boolean,\n    imgWidth?: number,\n    imgHeight?: number,\n  ) {\n    DrawEngine.drawImage(this.ctx1, img, x, y, mirrored, imgWidth, imgHeight);\n  }\n\n  /**\n   * Sets the camera position and zoom level.\n   * @param x The x-coordinate of the object where the camera should focus\n   * @param y The y-coordinate of the object where the camera should focus\n   * @param zoom The zoom level of the camera\n   */\n  setCamera(x: number, y: number, zoom: number = 1, immediate = false) {\n    this.targetCameraX = x;\n    this.targetCameraY = y;\n    this.targetZoom = zoom;\n    const cx = this.canvasWidth / 2 - 32;\n    const cy = this.canvasHeight / 2 - 64;\n    this.ctx1.setTransform(\n      this.zoom, 0, 0, this.zoom,\n      cx - this.cameraX * this.zoom,\n      cy - this.cameraY * this.zoom,\n    );\n    if (immediate) {\n      this.cameraX = x;\n      this.cameraY = y;\n      this.zoom = zoom;\n    }\n  }\n\n  updateCamera() {\n    this.cameraX += (this.targetCameraX - this.cameraX) * this.cameraLerpSpeed;\n    this.cameraY += (this.targetCameraY - this.cameraY) * this.cameraLerpSpeed;\n    this.zoom += (this.targetZoom - this.zoom) * this.cameraLerpSpeed;\n  }\n\n  resetCamera() {\n    this.ctx1.setTransform(1, 0, 0, 1, 0, 0);\n  }\n\n  clear() {\n    this.resetCamera();\n    this.ctx1.clearRect(0, 0, this.canvasWidth, this.canvasHeight);\n    this.ctx1.fillStyle = colors.green3;\n    this.ctx1.fillRect(0, 0, this.canvasWidth, this.canvasHeight);\n    this.ctx2.clearRect(0, 0, this.canvasWidth, this.canvasHeight);\n    this.ctx3.clearRect(0, 0, this.canvasWidth, this.canvasHeight);\n  }\n\n  /**\n   * Converts world coordinates to screen coordinates, accounting for camera transforms\n   * @param worldX World X coordinate\n   * @param worldY World Y coordinate\n   * @param zoom Current zoom level (defaults to 7, matching game state)\n   * @returns Screen coordinates { x, y }\n   */\n  worldToScreen(worldX: number, worldY: number, zoom: number = 7): { x: number; y: number } {\n    const cx = this.canvasWidth / 2 - 32;\n    const cy = this.canvasHeight / 2 - 64;\n\n    return {\n      x: cx + (worldX - this.cameraX) * zoom,\n      y: cy + (worldY - this.cameraY) * zoom\n    };\n  }\n}\n\nexport const drawEngine = new DrawEngine();\n","import { Circle, Path } from './types';\n\nexport const CELL_WIDTH = 12;\nexport const CELL_HEIGHT = 12;\n\nexport const MAX_LIVES = 9;\nexport const MAX_MAGIC = 6;\nexport const MAX_REPAIR = 20;\n\nexport const NOTIFICATION_DURATION = 5000;\n\nexport const paths: Path[] = [\n  // Main path\n  [\n    [69, 100, 3],\n    [76, 113, 4],\n    [89, 114, 5],\n    [104, 86, 3],\n    [99, 59, 3],\n    [85, 46, 2],\n    [86, 28, 2],\n    [74, 38, 2],\n    [60, 39, 2],\n    [48, 30, 2],\n    [46, 43, 2],\n    [38, 61, 3],\n    [50, 73, 4],\n    [38, 84, 3],\n    [46, 123, 3],\n    [36, 133, 2],\n    [48, 141, 3],\n    [94, 133, 4],\n    [113, 109, 5],\n    [122, 74, 6],\n    [113, 56, 0.9],\n  ],\n\n  // Smaller paths\n  [[45, 49, 0.9], [71, 51, 0.9]],\n\n  // Northwest village path\n  [[119, 54, 1], [129, 29, 1]],\n];\n\nexport const clearings: Circle[] = [\n  // Peak\n  { x: 64, y: 88, r: 6 },\n  { x: 75, y: 88, r: 6 },\n  { x: 69, y: 95, r: 6 },\n\n  // Northeast village\n  { x: 129, y: 28, r: 10 },\n\n  // Eye\n  { x: 71, y: 51, r: 3 },\n];\n\nexport const statues = {\n  heart: { x: 76, y: 84, name: 'heart' },\n  moon: { x: 129, y: 19, name: 'moon' },\n  ear: { x: 49, y: 29, name: 'ear' },\n  eye: { x: 71, y: 50, name: 'eye' },\n  foot: { x: 35, y: 131, name: 'foot' },\n  tail: { x: 114, y: 56, name: 'tail' },\n} as const;\n","import { CELL_WIDTH, CELL_HEIGHT } from '@/game/constants';\nimport { drawEngine } from './draw-engine';\nimport { updatePositionSmoothly, SmoothMovementState } from '../utils/smooth-movement';\n\ninterface Tileset<T extends (string | number)> {\n  animations: Record<T, HTMLImageElement[]>;\n  tileSize: number;\n}\n\nexport class GameObject<T extends (string | number)> implements SmoothMovementState {\n  animationTime = 0;\n  animationFrame = 0;\n  aD = 150; // Duration for each animation frame in milliseconds\n  animationLoop = true;\n  col: number;\n  row: number;\n  moving = { x: 0, y: 0 };\n  targetPos: { x: number; y: number };\n\n  constructor(\n    private readonly tileset: Tileset<T>,\n    public x: number,\n    public y: number,\n    public type: string,\n    public animation: T,\n    public speed: number = 0,\n    public mirrored: boolean = false,\n  ) {\n    this.col = Math.ceil(x / CELL_WIDTH);\n    this.row = Math.ceil(y / CELL_HEIGHT);\n    this.animationTime = Math.random() * this.aD;\n    this.targetPos = { x: this.x, y: this.y };\n  }\n\n  setPos(col: number, row: number) {\n    this.col = col;\n    this.row = row;\n    this.x = col * CELL_WIDTH;\n    this.y = row * CELL_HEIGHT;\n    this.targetPos = { x: this.x, y: this.y };\n  }\n\n  update(timeElapsed: number) {\n    if (!this.animationLoop && this.animationFrame === (this.tileset.animations[this.animation].length - 1)) {\n      return;\n    }\n    this.animationTime += timeElapsed;\n    this.animationFrame = Math.floor(this.animationTime / this.aD) % this.tileset.animations[this.animation].length;\n  }\n\n  updatePositionSmoothly(timeElapsed: number) {\n    updatePositionSmoothly(this, timeElapsed);\n    if (this.moving.x !== 0) {\n      this.mirrored = this.moving.x < 0;\n    }\n  }\n\n  draw() {\n    const animation = this.tileset.animations[this.animation];\n    if (animation[this.animationFrame]) {\n      drawEngine.drawBackgroundImage(\n        animation[this.animationFrame],\n        this.x - (this.tileset.tileSize - CELL_WIDTH) / 2,\n        this.y - (this.tileset.tileSize - CELL_HEIGHT) / 2,\n        this.mirrored,\n      );\n    }\n  }\n\n}\n","export const on = (event: number, listener: (detail: any) => void) => {\n  const eventName = String(event);\n  document.addEventListener(eventName, (e: Event) => {\n    listener((e as CustomEvent).detail);\n  });\n};\n\nexport const emit = (event: number, data?: any) => {\n  const eventName = String(event);\n  document.dispatchEvent(new CustomEvent(eventName, { detail: data }));\n};\n","import { colors } from '@/core/util/color';\nimport { CELL_HEIGHT, CELL_WIDTH } from '../constants';\n\nconst linePixels = (x0: number, y0: number, x1: number, y1: number): [number, number][] => {\n  const pixels: [number, number][] = [];\n  let dx = Math.abs(x1 - x0), sx = x0 < x1 ? 1 : -1;\n  let dy = -Math.abs(y1 - y0), sy = y0 < y1 ? 1 : -1;\n  let err = dx + dy, e2: number;\n\n  for (;;) {\n    pixels.push([x0, y0]);\n    if (x0 === x1 && y0 === y1) break;\n    e2 = 2 * err;\n    if (e2 >= dy) { err += dy; x0 += sx; }\n    if (e2 <= dx) { err += dx; y0 += sy; }\n  }\n  return pixels;\n};\n\nconst pentagramVertices = (cx: number, cy: number, pentagramRotation: number, radius: number): [number, number][] => {\n  const points: [number, number][] = [];\n  for (let i = 0; i < 5; i++) {\n    const angle = (2 * Math.PI * (i * 2 % 5)) / 5 - Math.PI / 2 + pentagramRotation;\n    const x = Math.round(cx + radius * Math.cos(angle));\n    const y = Math.round(cy + radius * Math.sin(angle));\n    points.push([x, y]);\n  }\n  return points;\n};\n\nconst _rotations = [Math.PI / 2, Math.PI, 3 * Math.PI / 2] as const;\n\nexport class PentagramAnimation {\n  cx: number;\n  cy: number;\n  allPixels: [number, number][];\n  totalDuration: number;\n\n  constructor(\n    public ctx: CanvasRenderingContext2D,\n    x: number,\n    y: number,\n    public animationDone: () => void,\n    private pentagramRotation: typeof _rotations[number] = Math.PI / 2,\n    private radius: number = 12,\n    private offset = 0,\n    private elapsed = 0,\n    private speed = 300,\n    private trailLength = 16,\n    private cycles = 0,\n    private maxCycles = 1,\n    private active = true,\n  ) {\n    this.cx = x + CELL_WIDTH / 2;\n    this.cy = y + CELL_HEIGHT / 2;\n\n    const points = pentagramVertices(this.cx, this.cy, pentagramRotation, radius);\n\n    this.allPixels = [];\n    for (let i = 0; i < 5; i++) {\n      const [x0, y0] = points[i];\n      const [x1, y1] = points[(i + 1) % 5];\n      this.allPixels.push(...linePixels(x0, y0, x1, y1));\n    }\n    this.totalDuration = this.allPixels.length * this.maxCycles * 1000 / this.speed;\n  }\n\n  update(timeElapsed: number): void {\n    if (!this.active) return;\n\n    const totalPixelsAdvanced = (this.elapsed / 1000) * this.speed;\n    const newOffset = Math.floor(totalPixelsAdvanced) % this.allPixels.length;\n    \n    // Check for cycle completion\n    if (newOffset < this.offset) {\n      this.cycles++;\n      if (this.cycles >= this.maxCycles) {\n        this.active = false;\n        this.animationDone();\n        return;\n      }\n    };\n    \n    this.offset = newOffset;\n    this.elapsed += timeElapsed;\n  }\n\n  draw(): void {\n    if (!this.active) return;\n\n    this.ctx.fillStyle = colors.white;\n    const effectiveTrailLength = Math.min(this.trailLength, this.offset);\n    \n    for (let i = 0; i < effectiveTrailLength; i++) {\n      const idx = (this.offset - i + this.allPixels.length) % this.allPixels.length;\n      const [x, y] = this.allPixels[idx];\n      this.ctx.fillRect(x, y, 1, 1);\n    }\n  }\n\n  isActive(): boolean {\n    return this.active;\n  }\n}\n","export const forEachSurroundingCell = (\n  centerCol: number,\n  centerRow: number,\n  callback: (col: number, row: number) => void,\n  includeCenter: boolean = false\n) => {\n  for (let deltaRow = -1; deltaRow <= 1; deltaRow++) {\n    for (let deltaCol = -1; deltaCol <= 1; deltaCol++) {\n      if (!includeCenter && deltaRow === 0 && deltaCol === 0) continue;\n      callback(centerCol + deltaCol, centerRow + deltaRow);\n    }\n  }\n};\n","\nconst t = (i: number, n: number)=>(n-i)/n;\n\n// Reuse a single AudioContext to avoid memory leaks\nlet audioCtx: AudioContext | null = null;\n\n// Sound player\nexport const playSound = (f: (i: number) => number) => {\n  if (!audioCtx) audioCtx = new AudioContext();\n  const m = audioCtx.createBuffer(1,96e3,48e3);\n  const b = m.getChannelData(0);\n  for(let i = 96e3; i--;) b[i] = f(i);\n  const s = audioCtx.createBufferSource();\n  s.buffer=m;\n  s.connect(audioCtx.destination);\n  s.start();\n};\n\n// Sound\n// export const ooof = (pitch: number) => playSound((i: number) => {\n//   var n=2e4;\n//   if (i > n) return 0;\n//   var q = t(i,n);\n//   return 0.2 * Math.tan(Math.cbrt(Math.sin(i/(145 - 5 * pitch))))*q*q;\n// });\n\n// export const doorSound = () => playSound((i: number) => {\n//   return 0.1 * Math.sin(i/50 + Math.random()*50) * (8000 - i%8000) / 5000 * Math.exp(-i/8000);\n// });\n\nexport const step = (length = 1) => playSound((i: number) => {\n  const n = 2e3 * length;\n  return i > n ? 0 : 0.15 * (Math.random() * 2 - 1) * Math.sin((Math.PI * i) / n);\n});\n\nexport const attack5 = () => playSound((i: number) => {\n  const n = 29e3;\n  if (i > n) return 0;\n  const decay = i > n * 0.6 ? Math.pow(0.9999, i - n * 0.6) : 1;\n  const phase = 5 * Math.sin(5 * Math.round(5 * i / n));\n  return decay * 0.2 * Math.sin(i/(30 - phase) + Math.random()) * (8000 - i%6000) / 5000;\n});\n\nexport const attack = () => playSound((i: number) => {\n  const n = 10e3;\n  if (i > n) return 0;\n  const phase = 5 * Math.sin(5 * Math.round(5 * i / n));\n  return Math.pow(0.998, i / 10) * 0.2 * Math.sin(i/(40 - phase) + Math.random()) * (8000 - i%6000) / 5000;\n});\n\nexport const repair = (pitch: number) => playSound((i: number) => {\n  return Math.sin(i/(21 - pitch) + Math.sin(i/2000)*5) * Math.exp(-i/4000) * (i/96000) * 9;\n});\n\nexport const hissAndSpit = () => playSound((i: number) => {\n  const n = 10e3;\n  if (i > n) return 0;\n  const q = (n - i) / n;\n  return ((Math.random() * 2 - 1) * Math.sin(i * 0.003) * 0.6 + Math.sin(i / (15 + Math.sin(i / 500) * 8)) * Math.exp(-i / 2000) * 0.4) * q * q * 0.3;\n});\n\nexport const heal = () => playSound((i: number) => {\n  const n = 6e3;\n  if (i > n) return 0;\n  var q = (n - i) / n;\n  return 0.5 * Math.sin(i*0.01*Math.sin(0.007*i+Math.sin(i/1200))+Math.sin(i/800))*q*q;\n});\n\nexport const exorcise = () => {\n  const x = ~(Math.random() * 1000);\n  return playSound((i: number) => {\n    return Math.sin(i/(10 + i/8000 - i/12000) & x + Math.sin(i/2000)*5) * Math.exp(-i/4000) * (i/96000) * 9;\n  });\n};\n","import { CatStates, GameAssets } from '@/game/game-assets';\nimport { GameObject } from '../../core/game-object';\nimport { controls } from '../../core/controls';\nimport { GameMap } from '../game-map';\nimport { CELL_HEIGHT, CELL_WIDTH, statues } from '../constants';\nimport { emit, on } from '@/core/event';\nimport { addTimeEvent } from '@/core/timer';\nimport { Spirit } from './spirit';\nimport { GameData } from '../game-data';\nimport { PentagramAnimation } from './pentagram-attack';\nimport { forEachSurroundingCell } from '../grid-utils';\nimport { drawEngine } from '@/core/draw-engine';\nimport { GameEvent } from '../event-manifest';\nimport { attack, attack5, step } from '@/core/audio';\n\nconst ANIMATION_SLOW = 600;\nconst ANIMATION_NORMAL = 150;\nconst ANIMATION_FAST = 75;\n\nconst STEP_SOUND_TIME = 200;\n\nexport class Player extends GameObject<CatStates> {\n  type = 'cat';\n  sleeping = true;\n  attacking = false;\n  scared = false;\n  inVillage = false;\n  pentagramAttack: PentagramAnimation | null = null;\n  stepSoundTimer = 0;\n\n  constructor(col: number, row: number, public map: GameMap, public gameData: GameData) {\n    super(\n      GameAssets.cat,\n      col * CELL_WIDTH,\n      row * CELL_HEIGHT,\n      'cat',\n      CatStates.sleep,\n      80,\n    );\n\n    this.aD = ANIMATION_SLOW;\n    \n    // Initialize looking direction to the right\n    this.map.playerLookingAt = { col: col + 1, row };\n\n    on(GameEvent.TELEPORT, () => {\n      this.setPos(statues.heart.x, statues.heart.y + 1);\n    });\n\n    on(GameEvent.WAKE_UP, () => {\n      this.sleeping = false;\n      this.aD = ANIMATION_NORMAL;\n    });\n\n    on(GameEvent.ATTACK_PLAYER, () => {\n      this.scared = true;\n      this.aD = ANIMATION_FAST;\n      addTimeEvent(() => {\n        this.aD = ANIMATION_NORMAL;\n        this.scared = false;\n      }, 600);\n    });\n\n    on(GameEvent.GAME_OVER, () => {\n      this.animation = CatStates.die;\n      this.animationTime = 0;\n      this.aD = ANIMATION_SLOW;\n      this.animationLoop = false;\n    });\n  }\n\n  update(timeElapsed: number) {\n    super.update(timeElapsed);\n\n    if (this.animation === CatStates.die) return;\n\n    if (this.animation == CatStates.run) {\n      this.stepSoundTimer -= timeElapsed;\n      if (this.stepSoundTimer <= 0) {\n        step();\n        this.stepSoundTimer = STEP_SOUND_TIME;\n      }\n    } else {\n      this.stepSoundTimer = 0;\n    }\n\n    const cellVillage = this.map.grid[this.row][this.col].village;\n    if (!this.inVillage && cellVillage) {\n      this.inVillage = true;\n      emit(GameEvent.ENTER_VILLAGE, cellVillage);\n    } else if (this.inVillage && !cellVillage) {\n      this.inVillage = false;\n    }\n\n    // DEBUG\n    coords.innerText = `${this.col},${this.row}`;\n\n    if (this.gameData.cutscene) {\n      return;\n    }\n    \n    if(this.scared && !this.isSurrounded()) {\n      this.animation = CatStates.scared;\n    } else if (this.sleeping) {\n      this.animation = CatStates.sleep;\n    } else if (this.attacking) {\n      this.animation = CatStates.scratch;\n    } else {\n      super.updatePositionSmoothly(timeElapsed);\n\n\n      if (!this.moving.y && controls.inputDirection.y) {\n        const newRow = this.row + controls.inputDirection.y;\n        \n        if (!this.map.grid[newRow][this.col].content) {\n          this.animation = CatStates.run;\n          this.moving.y = controls.inputDirection.y;\n          this.targetPos.y += controls.inputDirection.y * CELL_HEIGHT;\n          this.row = newRow;\n          // Update looking direction after movement to point ahead\n          this.map.playerLookingAt = { col: this.col, row: this.row + controls.inputDirection.y };\n        } else {\n          // Blocked movement - still update looking direction to attempted target\n          this.map.playerLookingAt = { col: this.col, row: this.row + controls.inputDirection.y };\n        }\n      }\n\n      if (!this.moving.x && controls.inputDirection.x) {\n        this.mirrored = controls.isLeft;\n        const newCol = this.col + controls.inputDirection.x;\n        \n        if (!this.map.grid[this.row][newCol].content) {\n          this.animation = CatStates.run;\n          this.moving.x = controls.inputDirection.x;\n          this.targetPos.x += controls.inputDirection.x * CELL_WIDTH;\n          this.col = newCol;\n          // Update looking direction after movement to point ahead  \n          this.map.playerLookingAt = { col: this.col + controls.inputDirection.x, row: this.row };\n        } else {\n          // Blocked movement - still update looking direction to attempted target\n          this.map.playerLookingAt = { col: this.col + controls.inputDirection.x, row: this.row };\n        }\n      }\n\n      if (!this.moving.x && !this.moving.y) {\n        this.animation = CatStates.idle;\n      }\n\n      // When not attacking, check if playerLookingAt is empty;\n      // If playerLookingAt is empty, look into 4 directions;\n      // If one of the directions is type spirit, set that direction as playerLookingAt;\n      // Else if one of the directions is a statue or obelisk, set that direction as playerLookingAt.\n      if (!this.attacking) {\n        this.autoSelectTarget();\n      }\n\n      if (!this.attacking && controls.isAction1 && !controls.previousState.isAction1) {\n        this.attacking = true;\n        this.animationTime = 0;\n\n        if (!this.pentagramAttack && this.isSurrounded()) {\n          console.log('pentagram start');\n          \n          this.pentagramAttack = new PentagramAnimation(\n            drawEngine.ctx1,\n            this.x,\n            this.y,\n            () => {\n              console.log('pentagram end');\n              this.pentagramAttack = null;\n              this.attackAllEnemiesAround();\n              this.attacking = false;\n              attack5();\n            },\n          );\n        } else {\n          // Check if there is an enemy right in front\n          addTimeEvent(() => this.attackEnemyInFront(), 500);\n          addTimeEvent(() => {\n            this.attacking = false;\n          }, this.aD * 5);\n        }\n      }\n    }\n    this.pentagramAttack?.update(timeElapsed);\n  }\n\n  // Deals 5 damage to all spirits\n  // in the 9 cells around the cat.\n  attackAllEnemiesAround() {\n    forEachSurroundingCell(this.col, this.row, (col, row) => {\n      const cell = this.map.grid[row][col];\n      if (cell.content?.type === 'spirit') {\n        const spirit = cell.content as Spirit;\n        spirit.takeDamage(5);\n      }\n    });\n  }\n\n  // Returns true if there are 3 or more spirits\n  // in the 9 cells around the cat.\n  isSurrounded() {\n    let spiritCount = 0;\n    forEachSurroundingCell(this.col, this.row, (col, row) => {\n      const cell = this.map.grid[row][col];\n      if (cell.content?.type === 'spirit') {\n        spiritCount++;\n      }\n    });\n    return spiritCount >= 3;\n  }\n\n  draw() {\n    super.draw();\n    this.pentagramAttack?.draw();\n  }\n\n  private autoSelectTarget() {\n    // Check if current looking position is empty\n    const currentCell = this.map.getLookingAt();\n    if (currentCell?.content) {\n      return; // Already looking at something\n    }\n\n    // Check 4 directions around player\n    const directions = [\n      { col: this.col + 1, row: this.row, facing: 'right' },\n      { col: this.col - 1, row: this.row, facing: 'left' },\n      { col: this.col, row: this.row + 1, facing: 'down' },\n      { col: this.col, row: this.row - 1, facing: 'up' },\n    ];\n\n    let spiritTarget = null;\n    let statueTarget = null;\n    let spiritFacing = null;\n    let statueFacing = null;\n\n    for (const dir of directions) {\n      const cell = this.map.grid[dir.row][dir.col];\n      if (!cell.content) continue;\n\n      const contentType = cell.content.type;\n\n      // Prioritize spirits first\n      if (contentType === 'spirit') {\n        spiritTarget = { col: dir.col, row: dir.row };\n        spiritFacing = dir.facing;\n        break; // Spirit has highest priority, stop searching\n      }\n\n      // Store statue/obelisk as backup\n      if ((contentType === 'statue' || contentType === 'obelisk') && !statueTarget) {\n        statueTarget = { col: dir.col, row: dir.row };\n        statueFacing = dir.facing;\n      }\n    }\n\n    // Set target and facing based on priority: spirit > statue/obelisk\n    if (spiritTarget) {\n      this.map.playerLookingAt = spiritTarget;\n      if (spiritFacing === 'left') this.mirrored = true;\n      else if (spiritFacing === 'right') this.mirrored = false;\n      // Optionally handle up/down facing if needed\n    } else if (statueTarget) {\n      this.map.playerLookingAt = statueTarget;\n      if (statueFacing === 'left') this.mirrored = true;\n      else if (statueFacing === 'right') this.mirrored = false;\n      // Optionally handle up/down facing if needed\n    }\n  }\n\n  private attackEnemyInFront() {\n    // Check if there's a spirit at the target position\n    const cell = this.map.getLookingAt();\n    if (cell.content && cell.content.type === 'spirit') {\n      const spirit = cell.content as Spirit;\n      spirit.takeDamage(1);\n      attack();\n    } else if (cell.content && cell.content.type === 'field') {\n      cell.content = null;\n      step(3);\n    }\n  }\n}\n","import { CELL_HEIGHT, CELL_WIDTH } from '@/game/constants';\nimport { Drawable } from '@/game/Drawable';\nimport { drawEngine } from './draw-engine';\n\nexport class GameStaticObject implements Drawable {\n  public col: number;\n  public row: number;\n  public offsetX: number;\n  public offsetY: number;\n\n  constructor(\n    public img: HTMLImageElement,\n    public x: number,\n    public y: number,\n    public type: string,\n  ) {\n    this.col = Math.ceil(x / CELL_WIDTH);\n    this.row = Math.ceil(y / CELL_HEIGHT);\n    this.offsetX = x - Math.round((img.width - CELL_WIDTH) / 2);\n    this.offsetY = y - Math.round((img.height - CELL_HEIGHT) / 2);\n  }\n\n  draw() {\n    drawEngine.drawBackgroundImage(this.img, this.offsetX, this.offsetY);\n  }\n}\n","import { GameAssets } from '@/game/game-assets';\nimport { drawEngine } from '@/core/draw-engine';\nimport { CELL_WIDTH, CELL_HEIGHT } from '@/game/constants';\nimport { GameStaticObject } from '@/core/game-static-object';\n\nexport class Tree extends GameStaticObject {\n  private neighbors: { top: boolean; bottom: boolean; left: boolean; right: boolean } = {\n    top: false,\n    bottom: false,\n    left: false,\n    right: false,\n  };\n\n  constructor(\n    public x: number,\n    public y: number,\n    treeType: 'oak' | 'spruce',\n  ) {\n    super(\n      GameAssets[treeType],\n      x,\n      y,\n      treeType,\n    );\n  }\n\n  setNeighbors(neighbors: { top: boolean; bottom: boolean; left: boolean; right: boolean }) {\n    this.neighbors = neighbors;\n  }\n\n  draw() {\n    if (this.neighbors.right) {\n      drawEngine.drawBackgroundImage(this.img, Math.round(this.offsetX + CELL_WIDTH / 2), this.offsetY - CELL_HEIGHT / 2);\n    }\n    super.draw();\n  }\n}\n","// Seeded \"random\" number generator for deterministic randomness\nexport class SeededRandom {\n  constructor(public rngSeed: number = 47) {}\n  \n  next(): number {\n    this.rngSeed = (this.rngSeed * 9301 + 49297) % 233280;\n    return this.rngSeed / 233280;\n  }\n  \n  range(min: number, max: number): number {\n    return min + this.next() * (max - min);\n  }\n}\n","import { GameAssets } from '../game-assets';\nimport { CELL_HEIGHT, CELL_WIDTH } from '../constants';\nimport { GameStaticObject } from '@/core/game-static-object';\n\nexport class House extends GameStaticObject {\n  name;\n\n  constructor(col: number, row: number, name = '') {\n    super(\n      GameAssets.house,\n      col * CELL_WIDTH,\n      row * CELL_HEIGHT,\n      'house',\n    );\n    this.name = name;\n  }\n}\n","import { GameObject } from '@/core/game-object';\nimport { GameAssets, VillagerStates } from '../game-assets';\nimport { CELL_HEIGHT, CELL_WIDTH } from '../constants';\nimport { GameMap } from '../game-map';\nimport { emit } from '@/core/event';\nimport { GameEvent } from '../event-manifest';\n\nexport class Villager extends GameObject<VillagerStates> {\n  lastDirection: { x: number; y: number } | null = null;\n  moveTimer: number = 0;\n  moveInterval: number = 1000;\n  isScared = false;\n\n  constructor(col: number, row: number, private map: GameMap) {\n    super(\n      GameAssets.villager,\n      col * CELL_WIDTH,\n      row * CELL_HEIGHT,\n      'villager',\n      VillagerStates.walk,\n      10,\n    );\n  }\n\n  update(timeElapsed: number): void {\n    super.update(timeElapsed);\n\n    this.moveTimer += timeElapsed;\n    if (this.seesCat()) {\n      if (!this.isScared && this.moveTimer >= this.moveInterval) {\n        this.moveTimer = 0;\n        this.isScared = true;\n      }\n      if (this.moveTimer % (this.moveInterval / 5) < timeElapsed) {\n        emit(GameEvent.SCARED);\n      }\n      this.animation = VillagerStates.scared;\n      this.aD = 50;\n    } else {\n      this.isScared = false;\n      this.aD = 150;\n      if (this.moveTimer >= this.moveInterval) {\n        this.takeNextStep();\n        this.moveTimer = 0;\n      }\n      this.updatePositionSmoothly(timeElapsed);\n    }\n  }\n\n  // Looks around for an empty cell to move to.\n  // Has 50% chance of moving forward in the same direction as before.\n  // Otherwise moves in a random direction, if that direction is free. \n  takeNextStep(): void {\n    const directions = [\n      { x: 0, y: -1 },\n      { x: 0, y: 1 }, \n      { x: 1, y: 0 },\n      { x: -1, y: 0 }\n    ];\n\n    // 80% chance to continue in same direction\n    if (this.lastDirection && Math.random() < 0.8) {\n      const newCol = this.col + this.lastDirection.x;\n      const newRow = this.row + this.lastDirection.y;\n      if (this.isValidMove(newCol, newRow)) {\n        this.col = newCol;\n        this.row = newRow;\n        this.targetPos = { x: newCol * CELL_WIDTH, y: newRow * CELL_HEIGHT };\n        this.lastDirection = this.lastDirection;\n        this.animation = VillagerStates.walk;\n        return;\n      }\n    }\n\n    // Try random directions without shuffling\n    for (let i = 0; i < 10; i++) {\n      const dir = directions[Math.floor(Math.random() * 4)];\n      const newCol = this.col + dir.x;\n      const newRow = this.row + dir.y;\n      if (this.isValidMove(newCol, newRow)) {\n        this.col = newCol;\n        this.row = newRow;\n        this.targetPos = { x: newCol * CELL_WIDTH, y: newRow * CELL_HEIGHT };\n        this.lastDirection = dir;\n        this.animation = VillagerStates.walk;\n        return;\n      }\n    }\n  }\n\n  private isValidMove(col: number, row: number): boolean {\n    // Check if cell is empty\n    const cell = this.map.grid[row][col];\n    return cell.content === null;\n  }\n\n  /**\n   * Checks 2 cells in front in the movement direction for a cat.\n   */\n  seesCat(): boolean {\n    if (!this.lastDirection) return false;\n\n    for (let i = 1; i <= 2; i++) {\n      const checkCol = this.col + this.lastDirection.x * i;\n      const checkRow = this.row + this.lastDirection.y * i;\n      \n      const cell = this.map.grid[checkRow]?.[checkCol];\n      if (cell?.content?.type === 'cat') {\n        return true;\n      }\n    }\n\n    return false;\n  }\n}\n","import { CELL_HEIGHT, CELL_WIDTH } from '../constants';\nimport { GameStaticObject } from '@/core/game-static-object';\nimport { GameAssets } from '../game-assets';\n\nexport class Farm extends GameStaticObject {\n  constructor(col: number, row: number) {\n    super(\n      GameAssets.grass,\n      col * CELL_WIDTH,\n      row * CELL_HEIGHT,\n      'field',\n    );\n  }\n}\n","import { SeededRandom } from '@/core/util/rng';\nimport { House } from './house';\nimport { GameMap } from '../game-map';\nimport { Villager } from './villager';\nimport { Farm } from './farm';\n\nexport class Village {\n  houses: House[] = [];\n  farms: Farm[] = [];\n  villagers: Villager[] = [];\n\n  constructor(\n    public name: string,\n    public center: { x: number; y: number },\n    public radius: number,\n    public houseCount: number,\n    public population: number,\n  ) {\n    this.center = center;\n    this.radius = radius;\n  }\n\n  private generatePosition(rng: SeededRandom, existing: { x: number; y: number }[], map: GameMap): { x: number; y: number } {\n    let col: number;\n    let row: number;\n    do {\n      const angle = rng.range(0, Math.PI * 2);\n      const distance = rng.range(1, this.radius - 1);\n      col = Math.round(this.center.x + Math.cos(angle) * distance);\n      row = Math.round(this.center.y + Math.sin(angle) * distance);\n    } while (\n      col < 0 ||\n      row < 0 ||\n      map.get(col, row)?.content !== null ||\n      existing.some(item => item.x === col && item.y === row)\n    );\n    return { x: col, y: row };\n  }\n\n  generateHouses(rng: SeededRandom, map: GameMap): House[] {\n    for (let i = 0; i < this.houseCount; i++) {\n      const pos = this.generatePosition(rng, this.houses, map);\n      const houseCol = pos.x + pos.x % 2;\n      const houseRow = pos.y + pos.y % 2;\n      this.houses.push(new House(houseCol, houseRow));\n    }\n    return this.houses;\n  }\n\n  generateFarms(rng: SeededRandom, map: GameMap): Farm[] {\n    const farmCount = this.houseCount;\n    for (let i = 0; i < farmCount; i++) {\n      const pos = this.generatePosition(rng, this.farms, map);\n      \n      // Create a 2x2 farm block\n      for (let dx = 0; dx < 2; dx++) {\n        for (let dy = 0; dy < 2; dy++) {\n          this.farms.push(new Farm(pos.x + dx, pos.y + dy));\n        }\n      }\n    }\n    return this.farms;\n  }\n\n  generateVillagers(rng: SeededRandom, map: GameMap): Villager[] {\n    for (let i = 0; i < this.population; i++) {\n      const pos = this.generatePosition(rng, this.farms, map);\n      this.villagers.push(new Villager(pos.x, pos.y, map));\n    }\n    return this.villagers;\n  }\n}\n","import { drawEngine } from '@/core/draw-engine';\nimport { CELL_HEIGHT, CELL_WIDTH } from '../constants';\n\nexport class Icon {\n  x: number;\n  y: number;\n\n  constructor(\n    public readonly icon: HTMLImageElement,\n    public col: number,\n    public row: number,\n    public type: string,\n  ) {\n    this.x = Math.round(this.col * CELL_WIDTH + (CELL_WIDTH - this.icon.width) / 2);\n    this.y = Math.round(this.row * CELL_HEIGHT + (CELL_HEIGHT - this.icon.height) / 2);\n  }\n\n  draw() {\n    drawEngine.drawBackgroundImage(this.icon, this.x, this.y);\n  }\n}\n","import { Cell } from './types';\n\nexport interface Coords {\n  col: number;\n  row: number;\n}\n\nexport interface Position {\n  x: number;\n  y: number;\n}\n\nexport interface PathNode {\n  pos: Position;\n  distance: number;\n  previous?: PathNode;\n}\n\n// Directions: north, south, east, west\nconst directions: ReadonlyArray<Readonly<{ x: number; y: number }>> = [\n  { x: 0, y: -1 }, // north\n  { x: 0, y: 1 },  // south\n  { x: 1, y: 0 },  // east\n  { x: -1, y: 0 }  // west\n] as const;\n\n/**\n * Breadth-first search to find the nearest cell that matches a condition\n * @param grid - 2D array representing the game map\n * @param start - Starting position {x, y}\n * @param matchCondition - Function that returns true if the cell satisfies the condition\n * @param maxSteps - Maximum number of steps to search\n * @returns The position of the matching cell, or null if not found\n */\nexport function findNearestMatch<T>(\n  grid: T[][],\n  start: Position,\n  matchCondition: (cell: T, x: number, y: number) => boolean,\n  maxSteps: number\n): Position | null {\n  const rowCount = grid.length;\n  const colCount = grid[0]?.length || 0;\n\n  if (colCount === 0 || rowCount === 0) return null;\n\n  // Check if starting position matches\n  if (matchCondition(grid[start.y][start.x], start.x, start.y)) {\n    return start;\n  }\n\n  const visited = new Set<string>();\n  const queue: PathNode[] = [{ pos: start, distance: 0 }];\n  visited.add(`${start.x},${start.y}`);\n\n  while (queue.length > 0) {\n    const current = queue.shift()!;\n\n    // Check all 4 directions\n    for (const dir of directions) {\n      const newX = current.pos.x + dir.x;\n      const newY = current.pos.y + dir.y;\n      const newDistance = current.distance + 1;\n\n      // Check max steps only\n      if (newDistance > maxSteps) {\n        continue;\n      }\n\n      const key = `${newX},${newY}`;\n      if (visited.has(key)) {\n        continue;\n      }\n\n      visited.add(key);\n\n      // Check if this cell matches our condition\n      if (matchCondition(grid[newY][newX], newX, newY)) {\n        return { x: newX, y: newY };\n      }\n\n      // Add to queue for further exploration\n      queue.push({\n        pos: { x: newX, y: newY },\n        distance: newDistance,\n        previous: current\n      });\n    }\n  }\n\n  return null; // No matching cell found within maxSteps\n}\n\nconst toKey = (col: number, row: number) => {\n  return `${col},${row}`;\n};\n\n// const fromKey = (key): Coords => {\n//   const [col ,row] = key.split(',').map(Number);\n//   return { col, row };\n// };\n\nconst reconstructPath = (parents: Record<string, Coords>, start: Coords, goal: Coords) => {\n  const path: Coords[] = [];\n  let current = goal;\n  while (current != start) {\n    path.unshift(current);\n    current = parents[toKey(current.col, current.row)];\n  }\n  path.unshift(start);\n  return path;\n};\n\n/**\n * Uses breadth-first-search to find the shortest path from\n * start to goal, and returns the path as an array of coords.\n * The path will take at most maxSteps steps.\n * This algo assumes that the map is fully enclosed by a boundary\n * so it is not checking whether the coordinates are valid.\n */\nexport const findShortestPath = (\n  grid: Cell[][],\n  start: Coords,\n  goal: Coords,\n  maxSteps = 100,\n) => {\n  let steps = maxSteps;\n\n  // Start from person A’s position.\n  // Keep a queue of cells to explore.\n  const queue: Coords[] = [start];\n\n  // Keep a record of which cells you’ve already visited, so you don’t loop back.\n  const visited = new Set();\n\n  // Keep a map of coords->cells that keeps track of the paths taken\n  const parents: Record<string, Coords> = {};\n\n  while (queue.length !== 0 && steps--) {\n    // Get the oldest cell from the queue\n    const current = queue.shift() as Coords;\n    if (current.col === goal.col && current.row === goal.row) {\n      return reconstructPath(parents, start, goal);\n    }\n\n    // Check the 4 immediate neighbours\n    const neighbours = directions.map(({x, y}) => grid[current.row + y][current.col + x]);\n    neighbours.forEach((neighbour) => {\n      if (!visited.has(neighbour)) {\n        visited.add(neighbour);\n        if (neighbour.content === null || (neighbour.x == goal.col && neighbour.y == goal.row)) {\n          parents[toKey(neighbour.x, neighbour.y)] = current;\n          queue.push({ col: neighbour.x, row: neighbour.y });\n        }\n      }\n    });\n  }\n};\n\n","import { drawEngine } from '@/core/draw-engine';\nimport { colors } from '@/core/util/color';\nimport { CELL_WIDTH } from '../constants';\n\nconst defaultColors: [string, string, string, string] = [colors.blue1, colors.blue2, colors.purple5, colors.purple4];\n\nexport const drawHpBar = (\n  hp: number,\n  maxHp: number,\n  x: number,\n  y: number,\n  colorHP = defaultColors,\n) => {\n  const hpRatio = Math.max(0, Math.min(1, hp / maxHp));\n  const barWidth = CELL_WIDTH;\n  const barHeight = 1;\n  const hpWidth = Math.ceil(barWidth * hpRatio);\n  const barX = x;\n  const barY = y - 5;\n\n  drawEngine.ctx1.fillStyle = colorHP[0];\n  drawEngine.ctx1.fillRect(barX, barY, hpWidth, barHeight);\n  drawEngine.ctx1.fillStyle = colorHP[1];\n  drawEngine.ctx1.fillRect(barX, barY + 1, hpWidth, barHeight);\n\n  drawEngine.ctx1.fillStyle = colorHP[2];\n  drawEngine.ctx1.fillRect(\n    barX + hpWidth,\n    barY,\n    barWidth - hpWidth,\n    barHeight,\n  );\n  drawEngine.ctx1.fillStyle = colorHP[3];\n  drawEngine.ctx1.fillRect(\n    barX + hpWidth,\n    barY +\n    1,\n    barWidth - hpWidth, barHeight,\n  );\n};\n","import { emojiToPixelArt } from '@/core/emoji';\nimport { Icon } from './icon';\nimport { drawEngine } from '@/core/draw-engine';\nimport { CELL_HEIGHT, CELL_WIDTH } from '../constants';\nimport { GameMap } from '../game-map';\nimport { updatePositionSmoothly, SmoothMovementState, setTargetPosition } from '@/utils/smooth-movement';\nimport { Coords, findShortestPath } from '../path-findind';\nimport { addTimeEvent } from '@/core/timer';\nimport { emit } from '@/core/event';\nimport { drawHpBar } from './hp-bar';\nimport { GameEvent } from '../event-manifest';\nimport { exorcise } from '@/core/audio';\n\nexport type SpiritType = '☁️' | '👻' | '👹' | '🧿' | '🦀' | '🌵' | '🥨' | '🧚🏻‍♀️' | '💀';\n\ninterface SpiritSpecies {\n  type: SpiritType,\n  icon: HTMLImageElement,\n  level: number,\n}\n\nexport const spirits = ([\n  '☁️', '🥨', '🌵', '🧚🏻‍♀️', '🦀', '👻', '👹', '🧿', '💀'\n] as const).reduce<Record<SpiritType, SpiritSpecies>>((acc, type, index) => {\n  acc[type] = { icon: emojiToPixelArt(type), type, level: Math.ceil((index) / 2) };\n  return acc;\n}, {} as Record<SpiritType, SpiritSpecies>);\n\nconst enum SpiritState {\n  IDLE,\n  MOVING,\n  WINDING,\n  ATTACKING,\n  RESTING\n}\n\nexport class Spirit extends Icon implements SmoothMovementState {\n\n  aD = 2000;\n  animationTime = 0;\n  opacity = 0;\n  species: SpiritSpecies;\n  map: GameMap;\n  searchRadius = 9;\n  moveTimer = 0;\n  moveInterval = 600;\n  targetPos: { x: number; y: number };\n  moving = { x: 0, y: 0 };\n  speed = 20;\n  maxHp: number;\n  hp: number;\n  dead = false;\n  recoil = false;\n  \n  // Simplified state system\n  state: number = SpiritState.IDLE;\n  attackTimer = 0;\n  attackDuration = 1000;\n  attackTarget: Coords | null = null;\n  attackOffsetX = 0;\n  attackOffsetY = 0;\n\n  constructor(\n    col: number,\n    row: number,\n    type: SpiritType,\n    map: GameMap,\n  ) {\n    super(spirits[type].icon, col, row, 'spirit');\n    this.species = spirits[type];\n    this.map = map;\n    this.targetPos = { x: this.x, y: this.y };\n    this.maxHp = Math.round(Math.pow(1.5, this.species.level + 1));\n    this.hp = this.maxHp;\n  }\n\n  update(timeElapsed: number) {\n    if (this.hp <= 0) return;\n\n    this.animationTime += timeElapsed * Math.pow(this.species.level + 0.5, 2);\n    if (this.opacity < 1) {\n      this.opacity += timeElapsed / this.aD;\n    }\n    if (this.animationTime >= this.aD) {\n      this.animationTime -= this.aD;\n    }\n\n    switch (this.state) {\n      case SpiritState.IDLE:\n      case SpiritState.MOVING:\n        updatePositionSmoothly(this, timeElapsed);\n        const playerCoords = this.lookAroundForPlayer();\n        if (playerCoords) {\n          this.moveTimer += timeElapsed;\n          if (this.moveTimer >= this.moveInterval) {\n            this.moveTowardsPlayer(playerCoords);\n            this.moveTimer = 0;\n          }\n        }\n        break;\n\n      case SpiritState.WINDING:\n      case SpiritState.ATTACKING:\n      case SpiritState.RESTING:\n        this.updateAttack(timeElapsed);\n        break;\n    }\n  }\n\n  private updateAttack(timeElapsed: number) {\n    this.attackTimer += timeElapsed;\n    const progress = this.attackTimer / this.attackDuration;\n    \n    if (!this.attackTarget) {\n      this.state = SpiritState.IDLE;\n      return;\n    }\n\n    const dirX = this.attackTarget.col - this.col;\n    const dirY = this.attackTarget.row - this.row;\n\n    if (progress < 0.7) {\n      // Winding up\n      if (this.state !== SpiritState.WINDING) this.state = SpiritState.WINDING;\n      const windProgress = progress / 0.7;\n      this.attackOffsetX = -dirX * windProgress * 3;\n      this.attackOffsetY = -dirY * windProgress * 3;\n    } else if (progress < 0.73) {\n      // Attacking\n      if (this.state !== SpiritState.ATTACKING) this.state = SpiritState.ATTACKING;\n      const attackProgress = (progress - 0.7) / 0.03;\n      this.attackOffsetX = dirX * (-3 + CELL_WIDTH * attackProgress);\n      this.attackOffsetY = dirY * (-3 + CELL_WIDTH * attackProgress);\n    } else if (progress < 1.0) {\n      // Resting (returning)\n      if (this.state !== SpiritState.RESTING) {\n        this.state = SpiritState.RESTING;\n        \n        // Only emit if player is still in the target cell\n        const cell = this.map.grid[this.attackTarget.row][this.attackTarget.col];\n        if (cell.content?.type === 'cat') {\n          emit(GameEvent.ATTACK_PLAYER, this.species.level);\n        }\n      }\n      const restProgress = (progress - 0.73) / 0.27;\n      this.attackOffsetX = dirX * 3 * (1 - restProgress);\n      this.attackOffsetY = dirY * 3 * (1 - restProgress);\n    } else {\n      // Attack complete\n      this.state = SpiritState.IDLE;\n      this.attackTimer = 0;\n      this.attackTarget = null;\n      this.attackOffsetX = 0;\n      this.attackOffsetY = 0;\n    }\n  }\n\n  private lookAroundForPlayer(): Coords | null {\n    // Search in a box around the spirit using the search radius\n    for (let dx = -this.searchRadius; dx <= this.searchRadius; dx++) {\n      for (let dy = -this.searchRadius; dy <= this.searchRadius; dy++) {\n        const searchCol = this.col + dx;\n        const searchRow = this.row + dy;\n\n        const cell = this.map.grid[searchRow][searchCol];\n        if (cell.content?.type === 'cat') {\n          return { col: searchCol, row: searchRow };\n        }\n      }\n    }\n    \n    return null;\n  }\n\n  private moveTowardsPlayer(playerCoords: Coords) {\n    const path = findShortestPath(\n      this.map.grid,\n      { col: this.col, row: this.row },\n      playerCoords,\n    );\n    if (path && path.length > 2) {\n      this.state = SpiritState.MOVING;\n      const nextStep = path[1];\n      setTargetPosition(this, nextStep.col, nextStep.row);\n      this.col = nextStep.col;\n      this.row = nextStep.row;\n      this.targetPos.x = nextStep.col * CELL_WIDTH;\n      this.targetPos.y = nextStep.row * CELL_HEIGHT;\n    } else if (path?.length === 2) {\n      // Start attack\n      this.state = SpiritState.WINDING;\n      this.attackTarget = path[1];\n      this.attackTimer = 0;\n    }\n  }\n\n  draw() {\n    const phase = Math.sin((this.animationTime / this.aD) * 2 * Math.PI);\n    drawEngine.ctx1.save();\n    drawEngine.ctx1.globalAlpha = this.opacity;\n\n    // Shadow\n    const shadow = Math.round(2 + 1 * phase) / 10;\n    drawEngine.ctx1.fillStyle = `rgba(0,0,0,${shadow})`;\n    drawEngine.ctx1.fillRect(\n      this.x + 3 + this.attackOffsetX,\n      this.y + CELL_HEIGHT * 3 / 4 + this.attackOffsetY,\n      this.icon.width - 6,\n      CELL_HEIGHT / 4 + 1,\n    );\n\n    if (this.hp < this.maxHp) {\n      drawHpBar(this.hp, this.maxHp, this.x, this.y);\n    }\n\n    // Icon\n    drawEngine.ctx1.save();\n    if (this.recoil) {\n      drawEngine.ctx1.filter = 'sepia(1) saturate(2) hue-rotate(260deg) brightness(0.7)';\n    }\n    drawEngine.ctx1.translate(\n      this.attackOffsetX,\n      this.attackOffsetY + Math.round(\n        (phase - 1) * 2\n      )\n    );\n    super.draw();\n    drawEngine.ctx1.restore();\n    drawEngine.ctx1.restore();\n  }\n\n  takeDamage(damage: number = 1): boolean {\n    this.hp -= damage;\n    this.recoil = true;\n    addTimeEvent(() => {\n      this.recoil = false;\n    }, 150);\n    if (this.hp <= 0) {\n      addTimeEvent(() => {\n        exorcise();\n        this.dead = true;\n      }, 1500);\n    }\n    return this.hp <= 0;\n  }\n}\n","/* eslint-disable max-classes-per-file */\nimport { GameAssets } from '../game-assets';\nimport { CELL_HEIGHT, CELL_WIDTH, MAX_REPAIR } from '../constants';\nimport { Spirit, spirits } from './spirit';\nimport { GameMap } from '../game-map';\nimport { GameData } from '../game-data';\nimport { drawHpBar } from './hp-bar';\nimport { colors } from '@/core/util/color';\nimport { drawEngine } from '@/core/draw-engine';\nimport { GameStaticObject } from '@/core/game-static-object';\n\nexport class Statue extends GameStaticObject {\n  static readonly State = {\n    BROKEN: 0,\n    ANIMATING: 1,\n    REPAIRED: 2\n  } as const;\n\n  spirits: Spirit[] = [];\n  maxSpirits = 4;\n  spawnTimer = 0;\n  spawnInterval = 1000;\n  spawnChance = 0.10;\n  spawnRadius = 10;\n  repair = 0;\n  state: number = Statue.State.BROKEN;\n  animationTime = 0;\n  repairD = 1500;\n  repairAnimationTimer = 0;\n  spiritsExorcised = false;\n  lastClearTime = 0;\n\n  /**\n   * Animation duration\n   */\n  aD = 800;\n\n  constructor(\n    col: number,\n    row: number,\n    public map: GameMap,\n    public gameData: GameData,\n    public name: string,\n  ) {\n    super(\n      GameAssets.statue,\n      col * CELL_WIDTH,\n      row * CELL_HEIGHT,\n      'statue',\n    );\n  }\n\n  updateAnimation(timeElapsed: number) {\n    this.animationTime += timeElapsed;\n  }\n\n  update(timeElapsed: number) {\n    this.spawnTimer += timeElapsed;\n\n    if (this.state === Statue.State.BROKEN && this.repair >= MAX_REPAIR) {\n      this.state = Statue.State.ANIMATING;\n      this.spiritsExorcised = false; // Reset flag when starting animation\n      this.lastClearTime = 0; // Reset clear timer\n    } else if (this.state === Statue.State.ANIMATING) {\n      this.repairAnimationTimer += timeElapsed;\n      if (this.repairAnimationTimer > this.repairD) {\n        this.state = Statue.State.REPAIRED;\n      }\n    }\n    \n    if (this.spawnTimer >= this.spawnInterval) {\n      this.spawnTimer = 0;\n\n      if (Math.random() < this.spawnChance) {\n        if (this.spirits.length < (this.maxSpirits + this.gameData.getLevel())) {\n          // Spawn new spirit\n          this.spawnSpirit();\n        } else if (this.spirits.length > 0) {\n          // Replace spirits with full HP\n          const replaceSpirit = this.spirits\n            .filter((spirit) => spirit.hp === spirit.maxHp)\n            [Math.round(Math.random() * this.spirits.length - 1)];\n          if (replaceSpirit) {\n            replaceSpirit.dead = true;\n            this.spawnSpirit();\n          }\n        }\n      }\n    }\n\n    this.spirits = this.spirits.filter(spirit => !spirit.dead);\n  }\n\n  draw() {\n    super.draw();\n    if (this.repair > 0 && this.repair < MAX_REPAIR) {\n      drawHpBar(this.repair, MAX_REPAIR, this.x, this.y, [colors.yellow1, colors.yellow2, colors.blue5, colors.blue6]);\n    }\n    if (this.state === Statue.State.REPAIRED) {\n      this.drawFaries();\n    }\n  }\n\n  postDraw() {\n    if (this.state === Statue.State.ANIMATING) {\n      this.drawAnimation();\n    }\n  }\n\n  drawFaries() {\n    const radius = 3;\n    drawEngine.ctx1.fillStyle = colors.purple0;\n    \n    for (let i = 0; i < 5; i++) {\n      const t = (this.animationTime + this.aD * 0.5 * i) / this.aD;\n      const theta = (i * 2 * Math.PI) / 3; // 0, 120°, 240°\n      // Offset distance from statue center\n      const offsetDist = 3; // adjust as needed\n      const offsetX = Math.cos(theta) * offsetDist;\n      const offsetY = Math.sin(theta) * offsetDist;\n\n      // Infinity path at t, rotated by theta\n      const x0 = radius * 2 * Math.sin(t);\n      const y0 = radius * Math.sin(2 * t);\n      const x = x0 * Math.cos(theta) - y0 * Math.sin(theta);\n      const y = x0 * Math.sin(theta) + y0 * Math.cos(theta);\n\n      // Final position: statue center + offset + rotated path\n      const px = Math.round(this.x + CELL_WIDTH / 2 + offsetX + x);\n      const py = Math.round(this.y + CELL_HEIGHT / 3 + offsetY + y);\n\n      drawEngine.ctx1.fillRect(px, py, 1, 1);\n    }\n  }\n\n  drawAnimation() {\n    const animationProgress = (3 * this.repairAnimationTimer / this.repairD) % 1;\n    \n    const maxWidth = c2.width / drawEngine.zoom;\n    const maxHeight = c2.height / drawEngine.zoom;\n    const cx = this.x + CELL_WIDTH / 2;\n    const cy = this.y + CELL_HEIGHT / 2;\n    const rx = maxWidth * animationProgress;\n    const ry = maxHeight * animationProgress;\n    drawEngine.drawCircumference(\n      drawEngine.ctx1,\n      cx,\n      cy,\n      rx,\n      ry,\n      colors.white,\n      8,\n    );\n    \n    if (this.repairAnimationTimer - this.lastClearTime >= 20) {\n      const progress = this.repairAnimationTimer / this.repairD;\n      this.map.clearCircleWithJitter(this.col, this.row, 20 * progress, true, 2, 0.3);\n      this.lastClearTime = this.repairAnimationTimer;\n    }\n    \n    // Only exorcise spirits once at the beginning of the animation\n    if (!this.spiritsExorcised) {\n      this.spirits.forEach(spirit => spirit.takeDamage(spirit.hp));\n      this.spiritsExorcised = true;\n    }\n  }\n\n  private spawnSpirit() {\n    // Find a random empty cell within a 20x20 area around the statue\n    const emptyCells: { x: number; y: number }[] = [];\n    const spawnRadius = Math.round(this.gameData.getLevel() + this.spawnRadius);\n    \n    // Collect all empty cells within the search radius\n    for (let dx = -spawnRadius; dx <= spawnRadius; dx++) {\n      for (let dy = -spawnRadius; dy <= spawnRadius; dy++) {\n        const x = this.col + dx;\n        const y = this.row + dy;\n        \n        // Check if cell is empty\n        if (this.map.grid[y][x].content === null) {\n          emptyCells.push({ x, y });\n        }\n      }\n    }\n\n    // Select a random empty cell\n    if (emptyCells.length > 0) {\n      const randomIndex = Math.floor(Math.random() * emptyCells.length);\n      const selectedPosition = emptyCells[randomIndex];\n      \n      // TODO: only spawn spirits of the appropriate level for the current game\n      const spiritTypes = Object.values(spirits)\n        .filter((spirit) => spirit.level < this.gameData.getLevel());\n      if (spiritTypes.length === 0) return;\n\n      const randomType = spiritTypes[Math.floor(Math.random() * spiritTypes.length)];\n      \n      const spirit = new Spirit(selectedPosition.x, selectedPosition.y, randomType.type, this.map);\n      this.spirits.push(spirit);\n      \n      // Place the spirit directly in the map\n      this.map.set(selectedPosition.x, selectedPosition.y, spirit);\n    }\n  }\n}\n","import { Tree } from './entities/tree';\nimport { SeededRandom } from '@/core/util/rng';\nimport { Village } from './entities/village';\nimport { CELL_HEIGHT, CELL_WIDTH, clearings, paths, statues } from './constants';\nimport { Statue } from './entities/statue';\nimport { Cell, Path } from './types';\nimport { Drawable } from './Drawable';\nimport { on } from '@/core/event';\nimport { Spirit } from './entities/spirit';\nimport { Coords } from './path-findind';\nimport { drawEngine } from '@/core/draw-engine';\nimport { GameAssets } from './game-assets';\nimport { GameData } from './game-data';\nimport { GameEvent } from './event-manifest';\nimport { Farm } from './entities/farm';\nimport { forEachSurroundingCell } from './grid-utils';\nimport { House } from './entities/house';\n\nexport class GameMap {\n  grid: Cell[][];\n  villages: Village[] = [];\n  private rng: SeededRandom;\n  playerLookingAt: Coords = { col: 0, row: 0 };\n\n  constructor(\n    public readonly colCount: number,\n    public readonly rowCount: number,\n    public gameData: GameData,\n  ) {\n    this.rng = new SeededRandom();\n\n    this.grid = Array.from({ length: rowCount }, (_a, y) =>\n      Array.from({ length: colCount }, (_b, x) => {\n        // Determine tree species based on distance from Heart Peak (70, 90)\n        const dx = x - 70;\n        const dy = y - 90;\n        const distanceFromHeartPeak = Math.sqrt(dx * dx + dy * dy);\n        \n        let treeType: 'oak' | 'spruce';\n        if (distanceFromHeartPeak <= 40) {\n          // Within 20 cell radius of Heart Peak: 90% spruce, 10% oak\n          treeType = this.rng.next() < 0.9 ? 'spruce' : 'oak';\n        } else {\n          // Rest of map: 20% spruce, 80% oak\n          treeType = this.rng.next() < 0.2 ? 'spruce' : 'oak';\n        }\n        \n        const tree = new Tree(\n          x * CELL_WIDTH - (16 - CELL_WIDTH) / 2, // Adjust x to center the image\n          y * CELL_HEIGHT - (16 - CELL_HEIGHT) / 2, // Adjust y to center the image\n          treeType\n        );\n        return { x, y, content: tree };\n      })\n    );\n\n    this.villages = [\n      new Village('Heart Peak', { x: 70, y: 90 }, 12, 0, 0),\n      new Village('Pine Rest', { x: 99, y: 100 }, 6, 2, 3),\n      new Village('Oak Branch', { x: 42, y: 51 }, 4, 3, 4),\n      new Village('Cat Foot', { x: 48, y: 140 }, 5, 4, 5),\n      new Village('Black Tail', { x: 113, y: 107 }, 4, 5, 8),\n      new Village('Moon Town', { x: 129, y: 29 }, 8, 12, 25),\n    ];\n\n\n    // Clear paths with jitter\n    for (const path of paths) {\n      for (let i = 0; i < path.length - 1; i++) {\n        const from = { x: path[i][0], y: path[i][1] };\n        const to = { x: path[i + 1][0], y: path[i + 1][1] };\n        const pathWidth = path[i][2];\n        this.clearPathWithJitter(from, to, pathWidth);\n      }\n    }\n\n    // Clear circular areas with jitter\n    for (const clearing of clearings) {\n      this.clearCircleWithJitter(clearing.x, clearing.y, clearing.r);\n    }\n\n    // Calculate neighbor information for each tree\n    for (let y = 0; y < rowCount; y++) {\n      for (let x = 0; x < colCount; x++) {\n        const cell = this.grid[y][x];\n        if (cell.content instanceof Tree) {\n          const neighbors = {\n            top: this.grid[y - 1]?.[x]?.content instanceof Tree,\n            bottom: this.grid[y + 1]?.[x]?.content instanceof Tree,\n            left: this.grid[y]?.[x - 1]?.content instanceof Tree,\n            right: this.grid[y]?.[x + 1]?.content instanceof Tree,\n          };\n          cell.content.setNeighbors(neighbors);\n        }\n      }\n    }\n\n    for (const village of this.villages) {\n      village.generateFarms(this.rng, this)\n        .forEach(farm => {\n          this.grid[farm.row][farm.col].content = farm;\n        });\n      village.generateHouses(this.rng, this)\n        .forEach(house => {\n          this.grid[house.row][house.col].content = house;\n        });\n      village.generateVillagers(this.rng, this)\n        .forEach(villager => {\n          this.grid[villager.row][villager.col].content = villager;\n        });\n\n      // Set cell.village for each cell in the village radius\n      const { x: centerX, y: centerY } = village.center;\n      const radius = village.radius;\n      for (let y = centerY - radius; y <= centerY + radius; y++) {\n      for (let x = centerX - radius; x <= centerX + radius; x++) {\n          const dx = x - centerX;\n          const dy = y - centerY;\n          if (dx * dx + dy * dy <= radius * radius) {\n            this.grid[y][x].village = village;\n          }\n        }\n      }\n\n      // Generate starting home\n      this.set(61, 84, new House(61, 84, 'home'));\n    }\n\n    this.fillCenterWithGrass(1.0);\n\n    for (const statueProps of Object.values(statues)) {\n      const { x, y, name } = statueProps;\n      const fullName = `cat ${name} altar`;\n      const statue = new Statue(x, y, this, this.gameData, fullName);\n      if (x === statues.heart.x) {\n        statue.maxSpirits = 0;\n      }\n      // Place farms in the 8 squares around the statue\n      forEachSurroundingCell(x, y, (farmCol, farmRow) => {\n        const cell = this.grid[farmRow][farmCol];\n        cell.content = new Farm(farmCol, farmRow);\n      });\n      this.grid[y][x].content = statue;\n    }\n\n    on(GameEvent.SPAWN_FIRST_SPIRIT, () => {\n      this.set(64, 89, new Spirit(64, 89, '☁️', this));\n    });\n  }\n\n  getLookingAt() {\n    return this.grid[this.playerLookingAt.row][this.playerLookingAt.col];\n  }\n\n  get(col: number, row: number) {\n    if (row < 0 || row >= this.rowCount || col < 0 || col >= this.colCount) {\n      return null;\n    }\n    return this.grid[row][col];\n  }\n\n  clearPlants(col: number, row: number) {\n    if(\n      this.grid[row][col].content instanceof Tree\n      || this.grid[row][col].content instanceof Farm\n    ) {\n      this.grid[row][col].content = null;\n    }\n  }\n\n  // Fill the center area with fields to limit player movements\n  // until they finish the onboarding.\n  // Then clear out a path from where the player starts, to the obelisk,\n  // and to the heart statue.\n  fillCenterWithGrass(converage: number) {\n    const heartsPeak = this.villages[0];\n    const radius = 12;\n    const { x: centerX, y: centerY } = heartsPeak.center;\n    for (let y = centerY - radius; y <= centerY + radius; y++) {\n      for (let x = centerX - radius; x <= centerX + radius; x++) {\n        const cell = this.grid[y][x];\n        if (!cell.content && this.rng.next() <= converage) {\n          cell.content = new Farm(cell.x, cell.y);\n        } else if (cell.content instanceof Farm && this.rng.next() > converage) {\n          cell.content = null;\n        }\n      }\n    }\n    \n    const villagePath: Path = [\n      [61, 86, 2],\n      [69, 88, 0.9],\n      [75, 89, 0.9],\n      [76, 84, 0.9],\n    ];\n    for (let i = 0; i < villagePath.length - 1; i++) {\n      const from = { x: villagePath[i][0], y: villagePath[i][1] };\n      const to = { x: villagePath[i + 1][0], y: villagePath[i + 1][1] };\n      const pathWidth = villagePath[i][2];\n      this.clearPathWithJitter(from, to, pathWidth);\n    }\n  }\n\n  clearPathWithJitter(\n    from: { x: number, y: number },\n    to: { x: number, y: number },\n    pathWidth: number,\n  ) {\n    // Bresenham's line algorithm for any angle\n    const dx = Math.abs(to.x - from.x);\n    const dy = Math.abs(to.y - from.y);\n    const sx = from.x < to.x ? 1 : -1;\n    const sy = from.y < to.y ? 1 : -1;\n    let err = dx - dy;\n\n    let x = from.x;\n    let y = from.y;\n\n    const halfWidth = pathWidth / 2;\n\n    while (true) {\n      // Add jitter to the clearing area\n      const jitterAmount = pathWidth < 1 ? 0 : 1.2; // Adjust for more/less randomness\n      const jitterX = Math.ceil(this.rng.range(-jitterAmount, jitterAmount));\n      const jitterY = Math.ceil(this.rng.range(-jitterAmount, jitterAmount));\n\n      // Clear area around the current position with jitter\n      for (let ox = -halfWidth; ox <= halfWidth; ox++) {\n        for (let oy = -halfWidth; oy <= halfWidth; oy++) {\n          const clearX = Math.ceil(x + ox + jitterX);\n          const clearY = Math.ceil(y + oy + jitterY);\n          this.clearPlants(clearX, clearY);\n          if (pathWidth < 1) {\n            if (this.rng.next() > 0.5) {\n              this.clearPlants(clearX + 1, clearY);\n            } else {\n              this.grid[clearY][clearX].content = new Farm(clearX, clearY);\n              this.grid[clearY][clearX + 1].content = new Farm(clearX, clearY);\n            }\n          } else if (this.rng.next() > 0.1) {\n            if (this.rng.next() > 0.05) {\n              // Add probability for partial clearing to create natural edges\n              this.clearPlants(clearX, clearY);\n            } else {\n              this.grid[clearY][clearX].content = new Farm(clearX, clearY);\n            }\n          }\n        }\n      }\n\n      // Check if we've reached the destination\n      if (x === to.x && y === to.y) break;\n\n      const e2 = 2 * err;\n      if (e2 > -dy) {\n        err -= dy;\n        x += sx;\n      }\n      if (e2 < dx) {\n        err += dx;\n        y += sy;\n      }\n    }\n  }\n\n  clearCircleWithJitter(\n    centerX: number,\n    centerY: number,\n    radius: number,\n    fieldsOnly = false,\n    border = 99,\n    probability = 1,\n  ) {\n    for (let y = 0; y < this.rowCount; y++) {\n      for (let x = 0; x < this.colCount; x++) {\n        const dx = x - centerX;\n        const dy = y - centerY;\n        const distance = Math.sqrt(dx * dx + dy * dy);\n\n        // Add jitter to radius for natural edge\n        const jitterRadius = this.rng.range(-radius, radius) / 6;\n        const adjustedRadius = radius + jitterRadius;\n\n        // Calculate inner radius based on borderRatio\n        const innerRadius = adjustedRadius - border;\n        \n        if (distance >= innerRadius && distance <= adjustedRadius) {\n          // Add probability for partial clearing near edges\n          const edgeDistance = adjustedRadius - distance;\n          const clearProbability = Math.min(1, edgeDistance / 2 + 0.7) * probability;\n\n          if (this.rng.next() < clearProbability) {\n            const isFarm = this.grid[y][x].content instanceof Farm;\n            if (!fieldsOnly || fieldsOnly && isFarm) {\n              this.grid[y][x].content = null;\n            }\n          }\n        }\n      }\n    }\n  }\n\n  set(col: number, row: number, content: Drawable | null) {\n    if (this.grid[row] && this.grid[row][col]) {\n      this.grid[row][col].content = content;\n    }\n  }\n\n  update(timeElapsed: number, isCutscene: boolean) {\n    for (const row of this.grid) {\n      for (const cell of row) {\n        if (cell.content) {\n          cell.content.updateAnimation?.(timeElapsed);\n          if (!isCutscene) {\n            cell.content.update?.(timeElapsed);\n            if (cell.x != cell.content.col || cell.y != cell.content.row) {\n              this.grid[cell.content.row][cell.content.col].content = cell.content;\n              cell.content = null;\n            }\n            if (cell.content && (cell?.content as Spirit)?.dead) {\n              this.set(cell.content.col, cell.content.row, null);\n            }\n          }\n        }\n      }\n    }\n  }\n\n  draw(cx: number, cy: number) {\n    const zoom = drawEngine.zoom;\n    const renderWidth = (drawEngine.canvasWidth / zoom) / 2 + 50;\n    const renderHeight = (drawEngine.canvasHeight / zoom) / 2 + 50;\n    const seenRadius = 75;\n    const seenRadiusSquared = seenRadius * seenRadius;\n\n    // Compute visible cell bounds\n    const minCol = Math.max(0, Math.floor((cx - renderWidth) / CELL_WIDTH));\n    const maxCol = Math.min(this.colCount - 1, Math.ceil((cx + renderWidth) / CELL_WIDTH));\n    const minRow = Math.max(0, Math.floor((cy - renderHeight) / CELL_HEIGHT));\n    const maxRow = Math.min(this.rowCount - 1, Math.ceil((cy + renderHeight) / CELL_HEIGHT));\n\n    // First pass: draw ground\n    for (let row = minRow; row <= maxRow; row++) {\n      for (let col = minCol; col <= maxCol; col++) {\n        const cell = this.grid[row][col];\n        const x = cell.x * CELL_WIDTH;\n        const y = cell.y * CELL_HEIGHT;\n        drawEngine.drawBackgroundImage(GameAssets.ground, x, y);\n      }\n    }\n\n    // Second pass: draw content, collect postDraw\n    const postDrawDrawables: Drawable[] = [];\n    let drawHighlight = false;\n    for (let row = minRow; row <= maxRow; row++) {\n      for (let col = minCol; col <= maxCol; col++) {\n        const cell = this.grid[row][col];\n        const x = cell.x * CELL_WIDTH;\n        const y = cell.y * CELL_HEIGHT;\n        const dx = x - cx;\n        const dy = y - cy;\n\n        // Seen radius for minimap\n        const distanceSquared = dx * dx + dy * dy;\n        if (distanceSquared <= seenRadiusSquared) {\n          cell.seen = true;\n        }\n\n        if (\n          cell.y === this.playerLookingAt.row &&\n          cell.x === this.playerLookingAt.col &&\n          cell.content &&\n          cell.content.type !== 'oak' && cell.content.type !== 'spruce'\n        ) {\n          drawHighlight = true;\n        }\n\n        cell?.content?.draw();\n        if (cell?.content?.postDraw) {\n          postDrawDrawables.push(cell?.content);\n        }\n      }\n    }\n\n    // Third pass: postDraw\n    // @ts-expect-error -- postDraw is definitely defined\n    postDrawDrawables.forEach(drawable => drawable.postDraw());\n\n    if (drawHighlight) {\n      drawEngine.drawBackgroundImage(\n        GameAssets.cornerImage,\n        this.playerLookingAt.col * CELL_WIDTH - (16 - CELL_WIDTH) / 2,\n        this.playerLookingAt.row * CELL_HEIGHT - (16 - CELL_HEIGHT) / 2\n      );\n    }\n  }\n}\n","\nexport const easeInOutSine = (x: number, min: number, max: number): number => {\n  const ease = -(Math.cos(Math.PI * x) - 1) / 2;\n  return min + ease * max;\n};\n\n/**\n * Converts a value from 0 to 1 to an exponential ease.\n * @param x value from 0 to 1\n * @returns value from 0 to 1\n */\nexport const easeInExpo = (x: number, ease = 5): number => {\n  return x === 1 ? 1 : 1 - Math.pow(2, -ease * x);\n};\n","import { colors } from '@/core/util/color';\nimport { GameMap } from './game-map';\nimport { Player } from './entities/player';\nimport { drawEngine } from '@/core/draw-engine';\n\n/* eslint-disable quote-props */\nconst pixelColors: Record<string, string> = {\n  'oak': colors.green3,\n  'spruce': colors.blue2,\n  'house': colors.blue4,\n  'field': colors.yellow1,\n  'statue': colors.blue6,\n  'unseen': colors.blue5,\n  'default': colors.yellow2,\n};\n/* eslint-enable quote-props */\n\n\nexport class MiniMap {\n  private lastUpdate = 0;\n  private updateInterval = 100; // Update once per second\n\n  constructor(private map: GameMap) { }\n\n  update(timeElapsed: number) {\n    this.lastUpdate += timeElapsed;\n  }\n\n  public draw(player: Player) {\n    if (this.lastUpdate < this.updateInterval) {\n      return;\n    }\n\n    this.lastUpdate = 0;\n    const ctx = drawEngine.ctx4;\n    const mapSize = 160;\n    const margin = 10;\n    const x = ctx.canvas.width - mapSize - margin; // Bottom right with margin\n    const y = ctx.canvas.height - mapSize - margin;\n\n    // Clear previous minimap\n    ctx.clearRect(x, y, mapSize, mapSize);\n\n    // Draw map pixels\n    for (let my = 0; my < mapSize; my++) {\n      for (let mx = 0; mx < mapSize; mx++) {\n        const cell = this.map.grid[my][mx];\n\n        if (!cell.seen) {\n          ctx.fillStyle = pixelColors.unseen;\n        } else {\n          ctx.fillStyle = pixelColors[cell.content?.type || 'default'] ?? pixelColors.default;\n        }\n\n        ctx.fillRect(x + mx, y + my, 1, 1);\n      }\n    }\n\n    if (player.col >= 0 && player.col < mapSize && player.row >= 0 && player.row < mapSize) {\n      ctx.fillStyle = colors.purple4;\n      ctx.beginPath();\n      ctx.arc(x + player.col, y + player.row, 2, 0, Math.PI * 2);\n      ctx.fill();\n    }\n  }\n}\n","import { drawEngine } from '@/core/draw-engine';\nimport { on } from '@/core/event';\nimport { StoryEngineEvent } from '@/core/story-engine';\nimport { colors } from '@/core/util/color';\n\nexport class DialogBox {\n  dialog: string | null = null;\n\n  constructor() {\n    on(StoryEngineEvent.STORY_DIALOG, (dialog) => {\n      this.dialog = dialog;\n    });\n\n    on(StoryEngineEvent.STORY_STATE_EXIT, () => {\n      this.dialog = null;\n    });\n  }\n\n  draw () {\n    if (this.dialog) {\n      const boxHeight = 160; // same as minimap\n      const margin = 20; // same as minimap\n      const boxWidth = c3.width - boxHeight - margin*3;\n      const x = margin;\n      const y = c3.height - boxHeight - margin;\n      drawEngine.ctx3.fillStyle = colors.purple4;\n      drawEngine.ctx3.fillRect(x+5, y+5, boxWidth, boxHeight);\n      drawEngine.ctx3.fillStyle = colors.purple0;\n      drawEngine.ctx3.fillRect(x, y, boxWidth-5, boxHeight-5);\n\n      this.dialog.split('\\n').forEach((dialog, i) => {\n        drawEngine.drawText(\n          dialog,\n          x + margin * 2,\n          y + margin * 2 + i * 40,\n          dialog[0] === '>' ? colors.purple4 : colors.black,\n          0, // left\n          0, // top\n          5,\n          1,\n          drawEngine.ctx3\n        );\n      });\n\n      drawEngine.drawText(\n          'press (space) to continue',\n          x + boxWidth - margin,\n          y + boxHeight - margin,\n          colors.purple4,\n          2, // right\n          2, // bottom\n          3,\n          1,\n          drawEngine.ctx3\n        );\n    }\n  }\n}\n","import { drawEngine } from '@/core/draw-engine';\nimport { colors } from '@/core/util/color';\nimport { easeInOutSine } from '@/core/util/util';\nimport { MiniMap } from './mini-map';\nimport { GameMap } from './game-map';\nimport { Player } from './entities/player';\nimport { Actions } from './actions';\nimport { GameData } from './game-data';\nimport { MAX_LIVES, MAX_MAGIC, NOTIFICATION_DURATION } from './constants';\nimport { DialogBox } from './dialog-box';\nimport { MAGIC, EMPTY_HEART, FULL_HEART, ONE_THIRD_HEART, TWO_THIRDS_HEART } from '@/core/font';\nimport { on } from '@/core/event';\nimport { GameEvent } from './event-manifest';\nimport { Village } from './entities/village';\n\nexport class HUD {\n  miniMap: MiniMap;\n  dialogBox: DialogBox;\n  renderSuperstition = false;\n  renderLives = false;\n  renderMagic = false;\n  villageName = '';\n  villageNameTimer = 0;\n\n  constructor(\n    public map: GameMap,\n    public player: Player,\n    public actions: Actions,\n    public gameData: GameData,\n  ) {\n    this.miniMap = new MiniMap(map);\n    this.dialogBox = new DialogBox();\n\n    on(GameEvent.ENABLE_SCRATCH, () => {\n      this.renderLives = true;\n    });\n\n    on(GameEvent.NOT_ENOUGH_MAGIC, () => {\n      this.renderMagic = true;\n    });\n\n    on(GameEvent.ENTER_VILLAGE, (village: Village) => {\n      this.villageName = village.name;\n      this.villageNameTimer = 3000;\n    });\n\n    on(GameEvent.SCARED, () => {\n      this.renderSuperstition = true;\n    });\n  }\n\n  update(timeElapsed: number) {\n    this.miniMap.update(timeElapsed);\n    this.villageNameTimer -= timeElapsed;\n  }\n\n  draw() {\n    this.renderLives && this.drawLives();\n    this.renderMagic && this.drawMagic();\n    this.drawGoals();\n    this.renderSuperstition && this.drawSuperstition();\n    this.drawActions();\n    this.drawInfoBox();\n    this.renderLives && this.miniMap.draw(this.player);\n    this.dialogBox.draw();\n  }\n\n  drawActions() {\n    const actions = this.actions.actions;\n    if (!actions || !actions[0].enabled) {\n      return;\n    }\n\n    const boxWidth = 120;\n    const boxHeight = 120;\n    const spacing = 10;\n    const totalWidth = actions.length * boxWidth + (actions.length - 1) * spacing;\n    const startX = Math.round((drawEngine.ctx3.canvas.width - totalWidth) / 2);\n    const y = drawEngine.ctx3.canvas.height - boxHeight - 10;\n\n    actions.forEach(({ type, color, symbol }, index) => {\n      const x = startX + index * (boxWidth + spacing);\n\n      // Draw background box\n      drawEngine.ctx3.fillStyle = colors.purple0;\n      drawEngine.ctx3.fillRect(x, y, boxWidth, boxHeight);\n\n      // Draw symbol (large font)\n      drawEngine.drawText(\n        symbol,\n        x + boxWidth / 2,\n        y + 30,\n        color,\n        1, // center\n        1, // middle\n        7,\n        1,\n        drawEngine.ctx3\n      );\n\n      // Draw action name\n      drawEngine.drawText(\n        type,\n        x + boxWidth / 2,\n        y + 95,\n        colors.black,\n        1, // center\n        1, // middle\n        3,\n        1,\n        drawEngine.ctx3\n      );\n    });\n  }\n\n  drawLives() {\n    const x = 16;\n    const y = 16;\n    const fullHearts = Math.floor(this.gameData.lives);\n    const emptyHearts = Math.floor(MAX_LIVES - this.gameData.lives);\n    const halfHearts = MAX_LIVES - fullHearts - emptyHearts;\n    const partialHearts = this.gameData.lives - fullHearts;\n    const text = FULL_HEART.repeat(fullHearts)\n      + (partialHearts > 0.3 ? TWO_THIRDS_HEART : ONE_THIRD_HEART).repeat(halfHearts)\n      + EMPTY_HEART.repeat(emptyHearts);\n    const size = 5;\n\n    const boxW = (text.length * 6 + 1) * size;\n    const boxH = 7 * size;\n    drawEngine.ctx3.fillStyle = colors.purple0;\n    drawEngine.ctx3.fillRect(x, y, boxW, boxH);\n    drawEngine.drawText(text, x + size, y + size, colors.purple4, 0, 0, size, 1, drawEngine.ctx3);\n  }\n\n  drawMagic() {\n    let x = c3.width - 16;\n    const y = 16;\n    const fullMagic = this.gameData.magic;\n    const emptyMagic = this.gameData.maxMagic - this.gameData.magic;\n    const noMagic = MAX_MAGIC - this.gameData.maxMagic;\n\n    const size = 5;\n    const charWidth = (5 + 1) * size;\n\n    const boxW = MAX_MAGIC * charWidth + size;\n    const boxH = 7 * size;\n    drawEngine.ctx3.fillStyle = colors.yellow1;\n    drawEngine.ctx3.fillRect(x - boxW + size, y, boxW, boxH);\n\n    let text = MAGIC.repeat(fullMagic);\n    x -= text.length * charWidth;\n    drawEngine.drawText(text, x + size, y + size, colors.blue2, 0, 0, size, 1, drawEngine.ctx3);\n\n    text = MAGIC.repeat(emptyMagic);\n    x -= text.length * charWidth;\n    drawEngine.drawText(text, x + size, y + size, colors.blue3, 0, 0, size, 1, drawEngine.ctx3);\n\n    text = MAGIC.repeat(noMagic);\n    x -= text.length * charWidth;\n    drawEngine.drawText(text, x + size, y + size, colors.yellow2, 0, 0, size, 1, drawEngine.ctx3);\n  }\n\n  drawGoals() {\n    const goals = this.gameData.goals;\n\n    const baseX = 16;\n    const y = 16 + 7 * 5 + 10; // lives y  + lives box height + margin\n    const boxW = 510;\n    const boxH = 5 * 7 + 30;\n    const size = 3;\n    const padding = 5;\n    const aD = 200; // 100ms slide animation\n    \n    goals.filter(goal => goal.time > 0)\n    .forEach((goal, i) => {\n      const {label, time} = goal;\n      const boxY = y + (boxH + padding) * i;\n      \n      // Calculate animation offset based on remaining time\n      let offsetX = 0;\n      const distanceX = boxW + baseX;\n      if (time > NOTIFICATION_DURATION - aD) {\n        // Sliding in from left (appearing)\n        const progress = (NOTIFICATION_DURATION - time) / aD;\n        const easedProgress = easeInOutSine(progress, 0, 1);\n        offsetX = -distanceX * (1 - easedProgress);\n      } else if (time < aD) {\n        // Sliding out to left (disappearing)\n        const progress = time / aD;\n        const easedProgress = easeInOutSine(progress, 0, 1);\n        offsetX = -distanceX * (1 - easedProgress);\n      }\n      \n      const x = baseX + offsetX;\n      \n      drawEngine.ctx3.fillStyle = colors.purple4;\n      drawEngine.ctx3.fillRect(x, boxY, boxW, boxH);\n      drawEngine.drawText(\n        'GOAL',\n        x + size + padding,\n        boxY + padding,\n        colors.white,\n        0, // left\n        0, // top\n        size + 1,\n        1,\n        drawEngine.ctx3\n      );\n      drawEngine.drawText(\n        label,\n        x + size + padding + 20,\n        35 + boxY + padding,\n        colors.purple0,\n        0, // left\n        0, // top\n        size,\n        1,\n        drawEngine.ctx3\n      );\n    });\n  }\n\n  drawSuperstition() {\n    const text = 'superstition';\n    const size = 3;\n    const charWidth = 5;\n    const padding = 5;\n    const boxW = (text.length * size + padding * 2) * charWidth;\n    const boxH = 35;\n    const x = Math.round(c3.width / 2 - boxW / 2);\n    const y = 16;\n\n    // Background\n    drawEngine.ctx3.fillStyle = colors.purple0;\n    drawEngine.ctx3.fillRect(x, y, boxW, 62);\n\n    drawEngine.ctx3.fillStyle = colors.blue5;\n    drawEngine.ctx3.fillRect(x + padding, y + padding, boxW - 2 * padding, boxH - 2 * padding);\n\n    drawEngine.ctx3.fillStyle = this.gameData.superstition > 0.9 ? colors.purple4 : colors.blue2;\n    const barSize = Math.round(this.gameData.superstition * (boxW - 2 * padding) / 3) * 3;\n    drawEngine.ctx3.fillRect(x + padding, y + padding, barSize, boxH - 2 * padding);\n\n    drawEngine.drawText(text, c3.width / 2, y + boxH + size, colors.blue5, 1, 0, size, 1, drawEngine.ctx3);\n  }\n\n  drawInfoBox() {\n    if(this.villageNameTimer > 0) {\n      const t = this.villageNameTimer;\n      const tNorm = Math.max(0, Math.min(1, Math.min(t / 150, (3000 - t) / 150)));\n      const opacity = easeInOutSine(tNorm, 0, 1);\n      drawEngine.ctx3.globalAlpha = opacity;\n      this.drawInfo(`^^ ${this.villageName}`, 170);\n      drawEngine.ctx3.globalAlpha = 1;\n    }\n\n    if (this.map.playerLookingAt) {\n      const cell = this.map.getLookingAt();\n      if (cell?.content?.name) {\n        this.drawInfo(cell.content.name, c3.height - 170);\n      }\n    }\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  drawInfo(text: string, y: number) {\n    const boxWidth = 350;\n    const boxHeight = 35;\n    drawEngine.ctx3.fillStyle = colors.purple5;\n    drawEngine.ctx3.fillRect(\n      c3.width / 2 - boxWidth / 2 + 4,\n      y - 6 * 3 - 4,\n      boxWidth - 8,\n      boxHeight + 8,\n    );\n    drawEngine.ctx3.fillStyle = colors.yellow2;\n    drawEngine.ctx3.fillRect(\n      c3.width / 2 - boxWidth / 2,\n      y - 6 * 3,\n      boxWidth,\n      boxHeight,\n    );\n    drawEngine.drawText(\n      text,\n      c3.width / 2,\n      y,\n      colors.purple4,\n      1, // center\n      1, // middle\n      3,\n      1,\n      drawEngine.ctx3\n    );\n  }\n}\n","import { GameAssets } from '../game-assets';\nimport { CELL_HEIGHT, CELL_WIDTH, MAX_MAGIC, MAX_REPAIR } from '../constants';\nimport { GameMap } from '../game-map';\nimport { drawHpBar } from './hp-bar';\nimport { colors } from '@/core/util/color';\nimport { emit } from '@/core/event';\nimport { GameEvent } from '../event-manifest';\nimport { GameStaticObject } from '@/core/game-static-object';\nimport { repair } from '@/core/audio';\n\nexport class Obelisk extends GameStaticObject {\n  map: GameMap;\n  name = 'barrier obelisk';\n  repair = 0;\n  \n  constructor(map: GameMap) {\n    const col = 69;\n    const row = 88; \n    super(\n      GameAssets.obelisk,\n      col * CELL_WIDTH,\n      row * CELL_HEIGHT,\n      'obelisk',\n    );\n    this.map = map;\n    this.map.set(this.col, this.row, this);\n  }\n\n  draw() {\n    super.draw();\n    if (this.repair > 0) {\n      drawHpBar(this.repair, MAX_REPAIR, this.x, this.y, [colors.yellow1, colors.yellow2, colors.blue5, colors.blue6]);\n    }\n  }\n\n  attemptRepair() {\n    const maxProgress = this.map.gameData.magic / MAX_MAGIC;\n    const maxRepair = MAX_REPAIR * maxProgress;\n    if (this.repair < maxRepair) {\n      this.repair ++;\n      repair(2 * this.repair - 10);\n    } else {\n      repair(-10);\n      emit(GameEvent.NOT_ENOUGH_MAGIC);\n    }\n\n    if (this.repair === MAX_REPAIR) {\n      emit(GameEvent.GAME_END);\n    }\n  }\n}\n","import { GameMap } from './game-map';\nimport { Player } from './entities/player';\nimport { MAX_REPAIR, statues } from './constants';\nimport { colors } from '@/core/util/color';\nimport { emit, on } from '@/core/event';\nimport { MAGIC, SCRATCH, TELEPORT } from '@/core/font';\nimport { controls } from '@/core/controls';\nimport { Statue } from './entities/statue';\nimport { Obelisk } from './entities/obelisk';\nimport { addTimeEvent } from '@/core/timer';\nimport { GameEvent } from './event-manifest';\nimport { repair } from '@/core/audio';\nimport { Cell } from './types';\nimport { Spirit } from './entities/spirit';\nimport { Farm } from './entities/farm';\nimport { House } from './entities/house';\n\ntype ActionType = 'teleport' | 'scratch' | 'repair' | 'sleep';\ntype Action = {\n  type: ActionType,\n  color: string,\n  enabled: boolean,\n  symbol: string,\n}\n\nconst actions: Action[] = [\n  {\n    type: 'scratch',\n    color: colors.purple4,\n    enabled: false,\n    symbol: SCRATCH,\n  },\n  {\n    type: 'teleport',\n    color: colors.blue2,\n    enabled: true,\n    symbol: TELEPORT,\n  },\n  {\n    type: 'repair',\n    color: colors.green3,\n    enabled: true,\n    symbol: MAGIC,\n  },\n  {\n    type: 'sleep',\n    color: colors.yellow2,\n    enabled: true,\n    symbol: 'z',\n  },\n];\n\nexport class Actions {\n  map: GameMap;\n  player: Player;\n  actions: Action[] = [];\n\n  constructor(map: GameMap, player: Player) {\n    this.map = map;\n    this.player = player;\n\n    on(GameEvent.ENABLE_SCRATCH, () => {\n      this.actions[0].enabled = true;\n    });\n  }\n\n  // Update available actions based on player's current position\n  update(): void {\n    const cellInFront = this.map.getLookingAt();\n\n    const canTeleport  = this.canTeleport(cellInFront);\n    const canRestore = this.canRestore(cellInFront);\n    const canSleep = this.canSleep(cellInFront);\n    const canAttack = this.canAttack(cellInFront);\n\n    this.actions = [\n      canAttack ? actions[0]\n      : canTeleport ? actions[1]\n      : canRestore ? actions[2]\n      : canSleep ? actions[3]\n      : actions[0]\n    ];\n\n    if (controls.isAction1 && !controls.previousState.isAction1) {\n      switch (true) {\n        case canAttack:\n          // Attack happens somewhere else\n          break;\n        \n        case canTeleport:\n          emit(GameEvent.TELEPORT);\n          break;\n        \n        case canRestore:\n          this.doRestore(cellInFront);\n          break;\n\n        case canSleep:\n          emit(GameEvent.SLEEP);\n\n      \n        default:\n          break;\n      }\n    }\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  doRestore(cellInFront: Cell) {\n    emit(GameEvent.RESTORE);\n    const object = cellInFront.content as Statue | Obelisk;\n    if (object.repair < MAX_REPAIR) {\n      if (object instanceof Statue) {\n        object.repair++;\n        repair(object.repair);\n        if (object.repair >= MAX_REPAIR) {\n          addTimeEvent(() => {\n            emit(GameEvent.STATUE_RESTORED, this.map.gameData.maxMagic);\n          }, 4000);\n        }\n      } else if (object instanceof Obelisk) {\n        object.attemptRepair();\n      }\n    }\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  private canRestore(cellInFront: Cell): boolean {\n    const object = cellInFront.content as Statue | Obelisk;\n    const type = object?.type;\n    return (\n      (type === 'statue' || type === 'obelisk')\n    ) && object.repair < MAX_REPAIR;\n  }\n\n  private canTeleport(cellInFront: Cell) {\n    return cellInFront.content instanceof Statue\n      && this.player.col != statues.heart.x\n      && cellInFront.content.state === Statue.State.REPAIRED;\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  private canSleep(cellInFront: Cell) {\n    return cellInFront.content instanceof House\n      && cellInFront.content.name === 'home';\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  private canAttack(cellInFront: Cell) {\n    return cellInFront.content instanceof Spirit\n      || cellInFront.content instanceof Farm;\n  }\n}\n","import { emit, on } from '@/core/event';\nimport { MAX_LIVES, NOTIFICATION_DURATION } from './constants';\nimport { SceneProps } from './game-story';\nimport { GameEvent } from './event-manifest';\nimport { addTimeEvent } from '@/core/timer';\nimport { heal, hissAndSpit } from '@/core/audio';\n\ninterface Goal {\n  label: string,\n  time: number,\n}\n\nexport class GameData {\n  cutscene = false;\n  lives = MAX_LIVES;\n  maxMagic = 0;\n  magic = 0;\n  superstition = 0;\n  goals: Goal[] = [];\n  hasClearedIntro = false;\n  win = false;\n\n  constructor() {\n    on(GameEvent.SCARED, () => {\n      this.superstition = Math.min(1, this.superstition + 0.01);\n    });\n\n    on(GameEvent.CUTSCENE_START, () => {\n      this.cutscene = true;\n    });\n\n    on(GameEvent.CUTSCENE_END, (scene: SceneProps) => {\n      this.cutscene = false;\n      if (scene.goals) {\n        scene.goals.forEach(goal => {\n          this.goals.push({\n            label: goal,\n            time: NOTIFICATION_DURATION,\n          });\n        });\n      }\n    });\n\n    on(GameEvent.ATTACK_PLAYER, (level: number) => {\n      this.lives -= (level + 1) / 3;\n      this.lives = Math.round(this.lives * 3) / 3;\n      this.lives = Math.round(this.lives * 10) / 10;\n      hissAndSpit();\n      if (this.lives <= 0) {\n        this.lives = 0;\n        emit(GameEvent.GAME_OVER);\n      }\n    });\n\n    on(GameEvent.STATUE_RESTORED, () => {\n      this.maxMagic++;\n      this.magic = this.maxMagic;\n      this.heal();\n\n      emit(GameEvent.NEXT_STATUE_DIALOG, this.maxMagic);\n    });\n\n    on(GameEvent.SLEEP, () => {\n      this.heal();\n    });\n  }\n\n  heal() {\n    let i = 0;\n    for (let lives = Math.floor(this.lives) + 1; lives <= MAX_LIVES; lives++) {\n      addTimeEvent(() => {\n        this.lives = lives;\n        heal();\n      }, 500 + 800 * (i++));\n    }\n  }\n\n  update(timeElapsed: number) {\n    this.goals.forEach(goal => goal.time -= timeElapsed);\n  }\n\n  getLevel() {\n    return this.superstition * 4 + this.maxMagic;\n  }\n}\n","import { controls } from './controls';\nimport { emit, on } from '@/core/event';\n\nexport interface DialogState {\n  dialogs: string[];\n  isDone?: boolean;\n}\n\nexport interface Script {\n  [stateKey: string]: DialogState;\n}\n\nexport const enum StoryEngineEvent {\n  // Story events\n  STORY_STATE_ENTER = 1,\n  STORY_STATE_EXIT = 2,\n  STORY_DIALOG = 3,\n};\n\nexport class Story<T extends Script> {\n  private currentStateKey: keyof T | null = null;\n  private currentDialogIndex = 0;\n  public isActive = false;\n  private previousSpacePressed = false;\n  public currentState: keyof T | null = null;\n  \n  fullText = '';\n  visibleCharacters = 0;\n  textAnimationTimer = 0;\n  charactersPerSecond = 20;\n  textAnimationState = 2; // 0=typing, 1=complete, 2=waiting\n\n  constructor(private readonly script: T) {\n    on(StoryEngineEvent.STORY_STATE_ENTER, (stateKey: keyof T) => {\n      this.enterState(stateKey);\n    });\n  }\n\n  public enterState(stateKey: keyof T) {\n    if (!this.script[stateKey]) {\n      return;\n    }\n\n    this.currentStateKey = stateKey;\n    this.currentState = stateKey;\n    this.currentDialogIndex = 0;\n    this.isActive = true;\n    this.previousSpacePressed = false;\n\n    this.showCurrentDialog();\n  }\n\n  update(timeElapsed: number) {\n    if (!this.isActive || !this.currentStateKey) {\n      return;\n    }\n\n    const spacePressed = controls.keyMap.get('Space');\n    const spaceJustPressed = spacePressed && !this.previousSpacePressed;\n    this.previousSpacePressed = spacePressed || false;\n\n    // Update typewriter animation\n    if (this.textAnimationState === 0) { // typing\n      this.textAnimationTimer += timeElapsed;\n      const targetCharacters = Math.floor((this.textAnimationTimer / 1000) * this.charactersPerSecond);\n      \n      if (targetCharacters >= this.fullText.length) {\n        // Animation complete\n        this.visibleCharacters = this.fullText.length;\n        this.textAnimationState = 1; // complete\n        this.emitCurrentVisibleText();\n      } else if (targetCharacters > this.visibleCharacters) {\n        // Show more characters\n        this.visibleCharacters = targetCharacters;\n        this.emitCurrentVisibleText();\n      }\n    }\n\n    if (spaceJustPressed) {\n      this.handleSpacePress();\n    }\n  }\n\n  private handleSpacePress() {\n    if (!this.currentStateKey) {\n      return;\n    }\n\n    if (this.textAnimationState === 0) { // typing\n      // Skip typing animation - show full text immediately\n      this.visibleCharacters = this.fullText.length;\n      this.textAnimationState = 1; // complete\n      this.emitCurrentVisibleText();\n      return;\n    }\n\n    if (this.textAnimationState === 1) { // complete\n      // Move to next dialog or exit\n      const currentState = this.script[this.currentStateKey];\n      \n      if (this.currentDialogIndex < currentState.dialogs.length - 1) {\n        // Move to next dialog\n        this.currentDialogIndex++;\n        this.showCurrentDialog();\n      } else {\n        // All dialogs complete, exit state\n        this.exitCurrentState();\n      }\n    }\n  }\n\n  private emitCurrentVisibleText() {\n    const visibleText = this.fullText.substring(0, this.visibleCharacters);\n    emit(StoryEngineEvent.STORY_DIALOG, visibleText);\n  }\n\n  private showCurrentDialog() {\n    if (!this.currentStateKey) {\n      return;\n    }\n\n    const currentState = this.script[this.currentStateKey];\n    currentState.isDone = true;\n    this.fullText = currentState.dialogs[this.currentDialogIndex];\n    \n    // Reset typewriter animation\n    this.visibleCharacters = 0;\n    this.textAnimationTimer = 0;\n    this.textAnimationState = 0; // typing\n    \n    // Start with empty text\n    this.emitCurrentVisibleText();\n  }\n\n  private exitCurrentState() {\n    if (!this.currentStateKey) {\n      return;\n    }\n\n    const stateKey = this.currentStateKey;\n    this.isActive = false;\n    this.currentStateKey = null;\n    this.currentState = null;\n    this.currentDialogIndex = 0;\n    \n    emit(StoryEngineEvent.STORY_STATE_EXIT, stateKey);\n  }\n}\n","import { drawEngine } from '@/core/draw-engine';\nimport { emit, on } from '@/core/event';\nimport { DialogState, Story, StoryEngineEvent } from '@/core/story-engine';\nimport { addTimeEvent } from '@/core/timer';\nimport { GameEvent } from './event-manifest';\nimport { MAX_MAGIC } from './constants';\n\nexport interface SceneProps extends DialogState {\n  goals?: string[],\n};\n\nconst enum Scene {\n  intro = 1,\n  spirit,\n  barrier,\n  temple,\n  noMagic,\n  magicRestored,\n  villagers,\n  end,\n}\n\nconst script = {} as Record<Scene, SceneProps>;\n\n// Use programmatic assignment to avoid preserving enum string names\nscript[Scene.intro] = {\n  dialogs: [\n    'Zzzzz...',\n    'Yawwwn...',\n    'How long was i sleeping?...',\n  ],\n};\n\nscript[Scene.spirit] = {\n  dialogs: [\n    'Evil spirits?',\n    'Has the magic barrier failed\\nwhile I slept??',\n    'This one seems weak.',\n    \"I'll exorcise it and then\\ngo check the barrier\",\n    '> Use (space) to attack',\n  ],\n  goals: ['find magic barrier obelisk'],\n};\n\nscript[Scene.barrier] = {\n  dialogs: [\n    'I have no magic power left!',\n    'My magic comes from villagers\\nworshiping me...',\n    'Something must be wrong with\\nthe cat altar.',\n  ],\n  goals: ['repair the cat altar'],\n};\n\nscript[Scene.noMagic] = {\n  dialogs: [\n    \"I don't have enough magic!\",\n    'Something must be wrong with\\nthe cat altars in the valley',\n  ],\n};\n\nscript[Scene.temple] = {\n  dialogs: [\n    'My magic has increased a little.',\n    'But the other altars...\\nthey must be damaged too.',\n  ],\n  goals: [\n    'repair all 5 temples',\n    'restore the forest magic barrier',\n  ],\n};\n\nscript[Scene.villagers] = {\n  dialogs: [\n    'Villagers are very supersticious.',\n    'I should not let them see me,\\nthat will empower the evil spirits.',\n  ],\n};\n\nscript[Scene.magicRestored] = {\n  dialogs: [\n    'I have restore my full magic power',\n    'Now I am able to restore the\\nmagic barrier again.',\n  ],\n  goals: [\n    'restore the forest magic barrier',\n  ]\n};\n\nscript[Scene.end] = {\n  dialogs: [\n    'The barrier is restored.\\nTime for a well deserved nap...',\n  ],\n};\n\nconst postIntro = () => {\n  emit(GameEvent.WAKE_UP);\n  emit(GameEvent.SPAWN_FIRST_SPIRIT);\n  drawEngine.cameraLerpSpeed = 0.08;\n};\n\nexport class GameStory {\n  story: Story<typeof script>;\n\n  constructor() {\n    this.story = new Story(script);\n\n    on(StoryEngineEvent.STORY_STATE_EXIT, (label: Scene) => {\n      emit(GameEvent.CUTSCENE_END, script[label]);\n      if (label === Scene.intro) {\n        postIntro();\n        addTimeEvent(() => {\n          emit(StoryEngineEvent.STORY_STATE_ENTER, Scene.spirit);\n        }, 3000);\n      }\n      if(label === Scene.spirit) {\n        emit(GameEvent.ENABLE_SCRATCH);\n      }\n      if (label === Scene.end) {\n        emit(GameEvent.FADE_OUT);\n      }\n    });\n\n    on(StoryEngineEvent.STORY_STATE_ENTER, () => {\n      emit(GameEvent.CUTSCENE_START);\n    });\n\n    on(GameEvent.NOT_ENOUGH_MAGIC, () => {\n      if (script[Scene.barrier].isDone) {\n        emit(StoryEngineEvent.STORY_STATE_ENTER, Scene.noMagic);\n      } else {\n        emit(StoryEngineEvent.STORY_STATE_ENTER, Scene.barrier);\n      }\n    });\n\n    on(GameEvent.NEXT_STATUE_DIALOG, (magicLevel: number) => {\n      if (magicLevel < MAX_MAGIC) {\n        emit(StoryEngineEvent.STORY_STATE_ENTER, Scene.temple);\n      } else {\n        emit(StoryEngineEvent.STORY_STATE_ENTER, Scene.magicRestored);\n      }\n    });\n\n    on(GameEvent.SCARED, () => {\n      if (!script[Scene.villagers].isDone) {\n        emit(StoryEngineEvent.STORY_STATE_ENTER, Scene.villagers);\n      }\n    });\n\n    on(GameEvent.GAME_END, () => {\n      emit(StoryEngineEvent.STORY_STATE_ENTER, Scene.end);\n    });\n\n    addTimeEvent(() => this.story.enterState(Scene.intro), 1000);\n    // setTimeout(() => {\n    //   postIntro();\n    // }, 10);\n  }\n\n  update (timeElapsed: number) {\n    this.story.update(timeElapsed);\n  }\n}\n","class MusicPlayer {\n  audioContext: AudioContext | undefined;\n  startTime = 0;\n  isPlaying = false;\n  buffer: AudioBuffer | undefined;\n  musicProcessorNode: AudioWorkletNode | undefined;\n\n  async start() {\n    if (this.isPlaying) return;\n\n    this.audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\n    await this.audioContext.resume();\n    await this.audioContext.audioWorklet.addModule('music-worklet.js');\n\n    this.musicProcessorNode = new AudioWorkletNode(this.audioContext, 'mp');\n    \n    this.musicProcessorNode.connect(this.audioContext.destination);\n    this.isPlaying = true;\n  }\n\n  startMelody() {\n    this.musicProcessorNode?.port.postMessage(0);\n  }\n\n  pause() {\n    this.musicProcessorNode?.port.postMessage(1);\n  }\n\n  unpause() {\n    this.musicProcessorNode?.port.postMessage(2);\n  }\n\n  stop() {\n    if (this.isPlaying) {\n      this.musicProcessorNode?.disconnect();\n      this.isPlaying = false;\n    }\n  }\n}\n\nexport default new MusicPlayer();\n","import { State } from '@/core/state';\nimport { drawEngine } from '@/core/draw-engine';\nimport { Player } from '@/game/entities/player';\nimport { GameMap } from '@/game/game-map';\nimport { HUD } from '@/game/hud';\nimport { Actions } from '@/game/actions';\nimport { GameData } from '@/game/game-data';\nimport { GameStory } from '@/game/game-story';\nimport { addTimeEvent, updateTimeEvents } from '@/core/timer';\nimport { Obelisk } from '@/game/entities/obelisk';\nimport musicPlayer from '@/core/music-player';\nimport { on } from '@/core/event';\nimport { GameEvent } from '@/game/event-manifest';\nimport { gameStateMachine } from '@/game-state-machine';\nimport { menuState } from './menu.state';\nimport { MAX_LIVES } from '@/game/constants';\n\nexport class GameState implements State {\n  map!: GameMap;\n  cat!: Player;\n  hud!: HUD;\n  actions!: Actions;\n  gameData!: GameData;\n  story!: GameStory;\n  playMusic = true;\n\n  onLeave() {\n    musicPlayer.stop();\n    drawEngine.ctx4.clearRect(0, 0, c4.width, c4.height);\n  }\n\n  onEnter() {\n    if (this.playMusic) {\n      musicPlayer.start();\n    }\n    \n    on(GameEvent.ENABLE_SCRATCH, () => {\n      musicPlayer.startMelody();\n    });\n    on(GameEvent.PAUSE, () => {\n      musicPlayer.pause();\n    });\n    on(GameEvent.UNPAUSE, () => {\n      musicPlayer.unpause();\n    });\n\n    on(GameEvent.GAME_OVER, () => {\n      addTimeEvent(() => gameStateMachine.setState(menuState), 3000);\n    });\n\n    on(GameEvent.FADE_OUT, () => {\n      addTimeEvent(() => gameStateMachine.setState(menuState), 3000);\n    });\n\n    this.gameData = new GameData();\n    this.map = new GameMap(160, 160, this.gameData);\n    this.cat = new Player(60, 85, this.map, this.gameData);\n    // this.cat = new Player(94, 133, this.map, this.gameData);\n    this.actions = new Actions(this.map, this.cat);\n    this.hud = new HUD(this.map, this.cat, this.actions, this.gameData);\n    this.story = new GameStory();\n    \n    this.map.set(this.cat.col, this.cat.row, this.cat);\n    new Obelisk(this.map);\n    drawEngine.setCamera(this.cat.x, this.cat.y, 20, true);\n    drawEngine.cameraLerpSpeed = 0.01;\n  }\n\n  onUpdate(timeElapsed: number) {\n    const zoom = 5 + (MAX_LIVES - this.gameData.lives) / MAX_LIVES;\n    drawEngine.setCamera(this.cat.x, this.cat.y, zoom);\n    drawEngine.updateCamera();\n\n    if (this.gameData.lives > 0) {\n      if (!this.gameData.cutscene) {\n        this.actions.update();\n      }\n      this.map.update(timeElapsed, this.gameData.cutscene);\n      this.hud.update(timeElapsed);\n      this.gameData.update(timeElapsed);\n    }\n    this.story.update(timeElapsed);\n    updateTimeEvents(timeElapsed);\n\n    if (this.gameData.lives > 0 && !this.gameData.win) {\n      this.map.draw(this.cat.x, this.cat.y);\n      this.hud.draw();\n    } else {\n      if (this.gameData.lives > 0) {\n        this.hud.draw();\n      }\n      this.cat.update(timeElapsed);\n      this.cat.draw();\n    }\n    drawEngine.resetCamera();\n  }\n}\n","import { State } from '@/core/state';\nimport { drawEngine } from '@/core/draw-engine';\nimport { controls } from '@/core/controls';\nimport { gameStateMachine } from '@/game-state-machine';\nimport { GameState } from './game.state';\nimport { colors } from '@/core/util/color';\nimport { GameAssets } from '@/game/game-assets';\nimport { SeededRandom } from '@/core/util/rng';\n\nconst toggleFullscreen = () => {\n  if (!document.fullscreenElement) {\n    document.documentElement.requestFullscreen();\n  } else {\n    document.exitFullscreen();\n  }\n};\n\nconst rng = new SeededRandom(0);\n\nconst drawBackground = () => {\n  const bgColors = [\n    colors.blue4,\n    colors.blue3,\n    colors.blue2,\n    colors.blue1,\n    colors.blue0,\n  ];\n  const sectionHeight = Math.ceil(c2.height / bgColors.length);\n  const sections = 32;\n  const sectionW = c2.width / sections;\n  const offsetFreq = 4;\n  const offsetAmplitude = 16;\n  for (let index = 0; index < sections; index++) {\n    const yOffset = Math.round(\n      offsetAmplitude * Math.sin(1 - offsetFreq * 2 * Math.PI * index / sections)\n      / 10\n    ) * 10;\n    bgColors.forEach((color, row) => {\n      drawEngine.ctx1.fillStyle = color;\n      drawEngine.ctx1.fillRect(\n        sectionW * index,\n        yOffset + sectionHeight * row - 20,\n        Math.ceil(c2.width / sections),\n        sectionHeight\n      );\n    });\n  }\n\n  const iconSize = 32;\n  const iconInterval = 22;\n  const cols = c2.width / iconInterval;\n  const rows = (c2.height / 2) / iconInterval; // fill half the screen\n  const oak: HTMLImageElement = GameAssets.oak;\n  const spruce: HTMLImageElement = GameAssets.spruce;\n\n  if (!oak) {\n    return;\n  }\n\n  for (let col = 0; col <= cols + iconSize; col++) {\n    const mountainHeight = rows * (1.2 - Math.cos((col / cols) * 2 * Math.PI));\n    for(let row = mountainHeight; row > 0; row--) {\n      const offsetX = 5 * Math.sin(12 * Math.PI * (row / rows));\n      drawEngine.drawBackgroundImage(\n        0.2 + rng.next() > (row / (rows)) ? oak : spruce,\n        col * iconInterval + offsetX - iconSize/2,\n        c2.height - (row * iconInterval + rng.next() * 0.7) / 2,\n        false,\n        iconSize,\n        iconSize,\n      );\n    }\n  }\n\n  rng.rngSeed = 0;\n};\n\nclass MenuState implements State {\n  animationTimer = 0;\n  previousFPressed = false;\n\n  onUpdate(timeElapsed: number) {\n    this.animationTimer += timeElapsed;\n\n    drawBackground();\n    const xCenter = drawEngine.ctx2.canvas.width / 2;\n    drawEngine.drawText(\n      'Meow Mountain',\n      xCenter,\n      100,\n      colors.blue0,\n      1, // center\n      0, // top\n      15\n    );\n    drawEngine.drawText(\n      'Press Enter to start',\n      xCenter,\n      230,\n      colors.white,\n      1, // center\n      0, // top\n      4\n    );\n    drawEngine.drawText(\n      'Press F to toggle fullscreen',\n      xCenter,\n      280,\n      colors.blue4,\n      1, // center\n      0, // top\n      4\n    );\n    this.updateControls();\n  }\n\n  updateControls() {\n    if (controls.isConfirm && !controls.previousState.isConfirm) {\n      gameStateMachine.setState(new GameState());\n    }\n\n    const fPressed = Boolean(controls.keyMap.get('KeyF'));\n    if (fPressed && !this.previousFPressed) {\n      toggleFullscreen();\n    }\n    this.previousFPressed = fPressed;\n  }\n};\n\nexport const menuState = new MenuState();\n","import { createGameStateMachine, gameStateMachine } from './game-state-machine';\nimport { controls } from '@/core/controls';\nimport { drawEngine } from './core/draw-engine';\nimport { updateTimeEvents } from './core/timer';\nimport { menuState } from './game-states/menu.state';\nimport { emit } from './core/event';\nimport { GameEvent } from './game/event-manifest';\n\n// @ts-ignore -- is not undefined for sure\ndocument.querySelector('link[type=\"image/x-icon\"]').href = 'data:image/svg+xml,%3Csvg xmlns=\\'http://www.w3.org/2000/svg\\' viewBox=\\'0 0 100 100\\'%3E%3Ctext y=\\'.9em\\' font-size=\\'85\\'%3E💜%3C/text%3E%3C/svg%3E';\n\nlet previousTime = 0;\n// let fpsBacklog: number[] = [];\nlet paused = false;\n\nwindow.addEventListener('blur', () => {\n  emit(GameEvent.PAUSE);\n  paused = true;\n});\nwindow.addEventListener('focus', () => {\n  emit(GameEvent.UNPAUSE);\n  paused = false;\n});\n\nfunction update(currentTime: number) {\n  if (paused) return;\n\n  currentTime = performance.now();\n  let delta = currentTime - previousTime;\n  previousTime = currentTime;\n  if (delta > 1000) {\n    return;\n  }\n    \n  // fpsBacklog.push(1000 / delta);\n  // if (fpsBacklog.length === 15) {\n  //   fps.innerHTML = `${Math.round(fpsBacklog.reduce((a, b) => a + b) / 15)} FPS`;\n  //   fpsBacklog = [];\n  // }\n\n  drawEngine.clear();\n\n  const state = gameStateMachine.getState();\n  controls.queryController();\n  state.onUpdate(delta);\n  updateTimeEvents(delta);\n};\n\n\ncreateGameStateMachine(menuState);\nsetInterval(update, 16);\n","import { State } from './state';\n\nexport class StateMachine {\n  private currentState: State;\n\n  constructor(initialState: State, ...enterArgs: any) {\n    this.currentState = initialState;\n    this.currentState.onEnter?.(...enterArgs);\n  }\n\n  setState(newState: State, ...enterArgs: any) {\n    this.currentState.onLeave?.();\n    this.currentState = newState;\n    this.currentState.onEnter?.(...enterArgs);\n  }\n\n  getState() {\n    return this.currentState;\n  }\n}\n"],"names":["addTimeEvent","callback","time","repeat","delay","timeEvents","push","timeLeft","updateTimeEvents","delta","i","length","timeEvent","splice","updatePositionSmoothly","state","timeElapsed","axis","targetPos","d","step","Math","sign","speed","abs","moving","round","gameStateMachine","controls","constructor","this","isUp","isDown","isLeft","isRight","isConfirm","isAction1","isMoving","keyMap","Map","previousState","document","addEventListener","event","toggleKey","inputDirection","DOMPoint","queryController","leftVal","get","rightVal","upVal","downVal","x","y","isPressed","set","code","getCtx","canvas","getContext","createCanvasWithCtx","w","h","c","createElement","width","height","createCanvas","quantizeToPalette","r","g","b","a","emojiToPixelArt","emoji","fontSize","spriteSize","floor","padding","_","tmpCtx","font","textBaseline","clearRect","translate","fillText","data","getImageData","outImg","createImageData","outData","outCanvas","outCtx","putImageData","img","Image","src","toDataURL","generateImageData","icon","iconPalette","transparent","palette","colorsPerByte","bytesPerColor","bitMask","size","sqrt","setAttribute","ctx","imgData","map","z","charCodeAt","bit","paletteIndex","hex","replace","parseInt","substring","NewTileset","spriteSheet","animations","tileSize","animationName","frames","Object","entries","frameData","colors","cat","villager","statue","obelisk","oak","spruce","grass","house","ground","split","e","GameAssets","initialize","cornerImage","cornerColor","fillStyle","fillRect","createCornerImage","tinyFont","characterCanvases","MAGIC","getCharacterData","letter","paddedBinary","leftmostCol","charWidth","toString","String","padStart","rightmostCol","col","row","min","max","makeCircle","centerX","centerY","radiusX","radiusY","skew","normalizedY","halfWidth","offset","rect","DrawEngine","canvasWidth","canvasHeight","cameraX","cameraY","zoom","targetCameraX","targetCameraY","targetZoom","cameraLerpSpeed","ctx1","c1","ctx2","c2","ctx3","c3","ctx4","c4","resizeCanvas","window","ctxs","imageSmoothingEnabled","drawCircumference","color","strokeWidth","save","beginPath","clip","fill","restore","drawText","text","textAlign","space","context","spacing","characters","toUpperCase","totalWidth","charPositions","forEach","character","char","letterHeight","offsetX","offsetY","charX","cacheKey","V","W","G","scaledWidth","match","bitIndex","adjustedCol","createCharacterCanvas","getCharacterCanvas","drawImage","mirrored","imgWidth","imgWeight","scale","drawBackgroundImage","imgHeight","setCamera","immediate","setTransform","updateCamera","resetCamera","clear","worldToScreen","worldX","worldY","drawEngine","CELL_WIDTH","CELL_HEIGHT","MAX_REPAIR","paths","clearings","statues","heart","name","moon","ear","eye","foot","tail","GameObject","tileset","type","animation","animationTime","animationFrame","aD","animationLoop","ceil","random","setPos","update","draw","on","listener","detail","emit","dispatchEvent","CustomEvent","linePixels","x0","y0","x1","y1","pixels","e2","dx","sx","dy","sy","err","PentagramAnimation","animationDone","pentagramRotation","PI","radius","elapsed","trailLength","cycles","maxCycles","active","cx","cy","points","angle","cos","sin","pentagramVertices","allPixels","totalDuration","newOffset","effectiveTrailLength","idx","isActive","forEachSurroundingCell","centerCol","centerRow","includeCenter","deltaRow","deltaCol","audioCtx","playSound","f","AudioContext","m","createBuffer","getChannelData","s","createBufferSource","buffer","connect","destination","start","n","repair","pitch","exp","Player","gameData","super","sleeping","attacking","scared","inVillage","pentagramAttack","stepSoundTimer","playerLookingAt","cellVillage","grid","village","coords","innerText","cutscene","isSurrounded","newRow","content","newCol","autoSelectTarget","attackAllEnemiesAround","pow","attackEnemyInFront","cell","takeDamage","spiritCount","currentCell","getLookingAt","directions","facing","spiritTarget","statueTarget","spiritFacing","statueFacing","dir","contentType","phase","GameStaticObject","Tree","treeType","neighbors","top","bottom","left","right","setNeighbors","SeededRandom","rngSeed","next","range","House","Villager","lastDirection","moveTimer","moveInterval","isScared","seesCat","takeNextStep","isValidMove","checkCol","checkRow","Farm","Village","center","houseCount","population","houses","farms","villagers","generatePosition","rng","existing","distance","some","item","generateHouses","pos","generateFarms","farmCount","generateVillagers","Icon","toKey","reconstructPath","parents","goal","path","current","unshift","defaultColors","drawHpBar","hp","maxHp","colorHP","hpWidth","barX","barY","spirits","reduce","acc","index","level","Spirit","opacity","searchRadius","dead","recoil","attackTimer","attackDuration","attackTarget","attackOffsetX","attackOffsetY","species","playerCoords","lookAroundForPlayer","moveTowardsPlayer","updateAttack","progress","dirX","dirY","windProgress","attackProgress","restProgress","searchCol","searchRow","maxSteps","steps","queue","visited","Set","shift","neighbour","has","add","findShortestPath","nextStep","globalAlpha","filter","damage","exorcise","Statue","maxSpirits","spawnTimer","spawnInterval","spawnChance","spawnRadius","State","BROKEN","repairD","repairAnimationTimer","spiritsExorcised","lastClearTime","updateAnimation","ANIMATING","REPAIRED","getLevel","spawnSpirit","replaceSpirit","spirit","drawFaries","postDraw","drawAnimation","t","theta","offsetDist","animationProgress","maxWidth","maxHeight","clearCircleWithJitter","emptyCells","selectedPosition","spiritTypes","values","randomType","GameMap","colCount","rowCount","villages","Array","from","_a","_b","tree","clearPathWithJitter","clearing","farm","fillCenterWithGrass","statueProps","farmCol","farmRow","clearPlants","converage","heartsPeak","villagePath","to","pathWidth","jitterAmount","jitterX","jitterY","ox","oy","clearX","clearY","fieldsOnly","border","probability","adjustedRadius","clearProbability","isCutscene","renderWidth","renderHeight","minCol","maxCol","minRow","maxRow","postDrawDrawables","drawHighlight","seenRadius","seen","drawable","easeInOutSine","pixelColors","field","unseen","default","MiniMap","lastUpdate","updateInterval","player","mapSize","my","mx","arc","DialogBox","dialog","boxHeight","margin","boxWidth","HUD","actions","renderSuperstition","renderLives","renderMagic","villageName","villageNameTimer","miniMap","dialogBox","drawLives","drawMagic","drawGoals","drawSuperstition","drawActions","drawInfoBox","enabled","startX","symbol","fullHearts","lives","emptyHearts","halfHearts","partialHearts","boxW","fullMagic","magic","emptyMagic","maxMagic","noMagic","MAX_MAGIC","goals","label","boxY","NOTIFICATION_DURATION","boxH","superstition","drawInfo","Obelisk","attemptRepair","Actions","cellInFront","canTeleport","canRestore","canSleep","canAttack","doRestore","object","GameData","hasClearedIntro","win","scene","q","heal","Story","script","currentStateKey","currentDialogIndex","previousSpacePressed","currentState","fullText","visibleCharacters","textAnimationTimer","charactersPerSecond","textAnimationState","stateKey","enterState","showCurrentDialog","spacePressed","spaceJustPressed","targetCharacters","emitCurrentVisibleText","handleSpacePress","dialogs","exitCurrentState","visibleText","isDone","GameStory","story","magicLevel","musicPlayer","startTime","isPlaying","audioContext","webkitAudioContext","resume","audioWorklet","addModule","musicProcessorNode","AudioWorkletNode","startMelody","port","postMessage","pause","unpause","stop","disconnect","GameState","playMusic","onLeave","onEnter","setState","menuState","hud","onUpdate","animationTimer","previousFPressed","bgColors","sectionHeight","sectionW","yOffset","offsetFreq","cols","rows","iconSize","drawBackground","xCenter","updateControls","fPressed","fullscreenElement","exitFullscreen","documentElement","requestFullscreen","querySelector","href","previousTime","paused","initialState","enterArgs","newState","getState","createGameStateMachine","setInterval","currentTime","performance","now"],"mappings":"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"}