function t(t,s,i=0,h=0){N.push({t,time:s,i:s+h,repeat:i})}function s(t){for(let s=N.length-1;s>=0;s--){const i=N[s];if(!i)return;i.i-=t,i.i>0||(i.t(),i.repeat-- >0?i.i=i.time:N.splice(s,1))}}function i(t,s){for(const i of["x","y"])if(t[i]!==t.h[i]){const h=t.h[i]-t[i],e=Math.sign(h)*t.speed*s/1e3;Math.abs(h)>Math.abs(e)?t[i]+=e:t[i]=t.h[i]}else t.o[i]=0,t[i]=Math.round(t[i])}let h;const e=new class{constructor(){this.l=!1,this.u=!1,this.M=!1,this.p=!1,this.j=!1,this.m=!1,this.B=!1,this.A=!1,this.H=new Map,this.U={l:this.l,u:this.u,j:this.j,m:this.m,B:this.B},document.addEventListener("keydown",t=>this.v(t,!0)),document.addEventListener("keyup",t=>this.v(t,!1)),this.k=new DOMPoint}P(){this.U.l=this.l,this.U.u=this.u,this.U.j=this.j,this.U.m=this.m,this.U.B=this.B;const t=navigator.getGamepads()[0],s=s=>!!t?.buttons[s].pressed,i=this.H.get("KeyA")||this.H.get("KeyQ")||this.H.get("ArrowLeft")||s(14)?-1:0,h=this.H.get("KeyD")||this.H.get("ArrowRight")||s(15)?1:0,e=this.H.get("KeyW")||this.H.get("KeyZ")||this.H.get("ArrowUp")||s(12)?-1:0,a=this.H.get("KeyS")||this.H.get("ArrowDown")||s(13)?1:0;this.k.x=i+h||0,this.k.y=e+a||0,.1>Math.hypot(this.k.x,this.k.y)&&(this.k.x=0,this.k.y=0),this.l=0>this.k.y,this.u=this.k.y>0,this.M=0>this.k.x,this.p=this.k.x>0,this.A=0!==this.k.x||0!==this.k.y,this.j=!!this.H.get("Enter")||s(9),this.m=!!this.H.get("Escape")||s(8),this.B=!!this.H.get("Space")||s(0)}v(t,s){this.H.set(t.code,s)}},a=t=>t.getContext("2d"),o=(t,s)=>{const i=((t,s)=>{const i=document.createElement("canvas");return t&&(i.width=t),s&&(i.height=s),i})(t,s);return[i,a(i)]},n=(t,s,i,h)=>128>h?[0,0,0,0]:[51*Math.round(t/51),51*Math.round(s/51),51*Math.round(i/51),255],r=(t,s=10)=>{const i=Math.floor(1.25*s),h=Math.floor(.25*s/2),[e,a]=o(i,i);a.font=s+"px sans-serif",a.textBaseline="top",a.clearRect(0,0,i,i),a.translate(-1,0),a.fillText(t,h,h);const r=a.getImageData(0,0,i,i).data,c=a.createImageData(i,i),l=c.data;for(let t=0;r.length>t;t+=4){const[s,i,h,e]=n(r[t],r[t+1],r[t+2],r[t+3]);l[t]=s,l[t+1]=i,l[t+2]=h,l[t+3]=e}const[u,f]=o(i,i);f.putImageData(c,0,0);const d=new Image;return d.src=u.toDataURL(),d},c=(t,s)=>{const i="#FF00FF",h=[i,...s],e=h.length>4?2:h.length>2?3:6,a=6/e,o=(1<<a)-1,n=document.createElement("canvas"),r=Math.sqrt(t.length*e);n.setAttribute("width",""+r),n.setAttribute("height",""+r);const c=n.getContext("2d"),l=c.createImageData(r,r),u=l.data;let f=0;[...t].map(t=>{const s=t.charCodeAt(0);for(let t=0;e>t;t++){const e=s>>t*a&o,n=(h[e]||i).replace("#",""),r=parseInt(n.substring(0,2),16),c=parseInt(n.substring(2,4),16),l=parseInt(n.substring(4,6),16),d=e?255:0;u[f]=r,u[f+1]=c,u[f+2]=l,u[f+3]=d,f+=4}}),c.putImageData(l,0,0);const d=new Image;return d.src=n.toDataURL(),d};class l{constructor(t){this.I=t,this.J={},this.D=16;for(const[s,i]of Object.entries(t.data))this.J[s]=i.map(s=>c(s,t.palette));this.D=t.size}}const u="#75a080",f="#618e70",d="#4d7c60",M="#396a50",w="#b4ecf3",p="#4e9ca6",j="#3e8791",m="#2f6269",g="#255056",y="#1f4347",B="#13282b",x="#e0b8d3",b="#714162",A="#996a8a",H="#f2daab",U="#e6a386",v="#13282b",k="#fffef9",P={size:10,frames:4,palette:[v,v],data:{0:["@@@@@@@P@@@HHBH`J`@j@hVA`jB@AD@@@@","@@@@@@@P@@`@HBH`J`@j@hVA`jB@AD@@@@","@@@@@@@@@b@@hbB`Z``U@hj@`jB@AD@@@@","@@@@@@@@@@@@Hf@`JH@j@jVA`jB@AD@@@@"],1:["@@@@@@@P@@`@HBH`J`@j@hVA`jB@DD@@@@","@@@@@@@D@@@BHB``J@Bj@`VA@dJ@@P@@@@","@@@@@@@@@@P@HBH`J@Bj@`VA@jJ@DD@@@@","@@@@@@@A@@`@HBH`J`@j@hVA`jA@A@@@@@"],2:["@@@@@@@@@@@@@@@`HJ@jAjVAhj@@D@@@@@","@@@@@@@@@@@@HB@`ZJ`U@jj@hj@@Q@@@@@","@@@@@@@@@@@@@@@`HJ@jAjVAhj@DD@@@@@","@@@@@@@@@@@@HB@`J@@Uijj@hj@@P@@@@@"],3:["@@@@@@@@A@@BHB``J@Bj@`VA@jJ@H`@@@@","@@@@@@@@@@@@HRJ`J@jU@`J@@@@@@@@@@@","@@@@@@@@@@@@@@@@@@@i`jfb@ZZ@@@@@@@","@@@@@@@@@@@@@@@@@@@@@@dBhZBjjiI@@@"],4:["@@@@@@@P@@`@HBH`J`@j@hVA`jB@AD@@@@","@@@@@@@@@@D@@H@b@BhB`ZEAjjBP@@@@@@","@@@@@@P@@@H@b@BhBH`J@jU@hj@P@D@@@@","@@@@@@@D@@`@HBH`J`@j@hVA`jB@AD@@@@"],5:["@@@P@@@B@@h@@`jHBjjJhjU@Jh@D`@@@@@","@@@P@@@B@@H@@`BHBjjJhjU@jh@DP@@@@@","@@@P@@@B@@h@@`jHBjjJhjU@Jh@DP@@@@@","@@@P@@@B@@H@@`BHBjjJhjU@jh@DP@@@@@"],6:["@@@@@@@@@@@@@@@@@@@bhjjJhZEA@@@@@@","@@@@@@@@@@@@@@@`H@@jhjVIhjR@@@@@@@","@@@@@@@@@@@@@@@`H@@jajVahjB@@@@@@@","@@@@@@@@@@@@@@@@@@@b`jjfhZE@@@@@@@"],7:["@@@@@HB@`J@@j@@VX@hHhjBB`B@@B@@@@@","@@@@@HB@`J@@jP@V@Bhh`jB@`B@@B@@@@@","@@@@@HB@`J@Aj@BVHHhH@jBB`B@@B@@@@@","@@@@@b@@hB@`J@@U@Ijh@jB@`B@@B@@@@@"],8:["@@@@@@@@@@@@HB@`JD@jH@V@Jj@@jB@@@@","@@@@@@@@@@@@HR@`JB@j`BV@`jB@jB@@@@","@@@@@@@@@@@@HB@`J@@ji@V@Hj@@jB@@@@","@@@@@@@@@@@@HB@`ZB@j`@V@Hj@@jB@@@@"]}},I={size:8,frames:4,palette:[x,B],data:{0:["PUAUUQVVTUEUUajj`@B@`@","@@@TUPUUdeEUUQUUhjJH`@","PUAUUQVVTUEUUajj`@BH@@","@@@TUPUUdeEUUQUUhjJH`@"],1:["@@@TUPUUTfEiiQUUhjJH`@","@@@UETUEeYQZZTUEjjBBH@"]}},J={palette:[j,m,g],data:"@@@@@@@DD@@@`e@@@@jB@@@hJ@@@@O@@@@}A@@@xK@@@`o@@@p~N@@T{{E@TmoWAPUUUE@WUUu@|C@C@"},D={palette:[j,m,g],data:"@PUE@@`UUB@@VUI@@xo@@poC@@kjN@@l{@@p~C@@kjN@@|o@@p{~C@@{O@@|k@@pC@@|C@@@@@@@"},C={palette:[M,u,"#b3d7ad",d],data:"@@@@@@@@@@HIIA@@@@Q[[J@@@HZ[[SA@@QR[[RJ@@QRRRRJ@@aRRRRL@@QTRRbJ@@abbTTL@@aTTbbL@@IddddI@@HaddLA@@@HIIA@@@@HIIA@@@@@II@@@@@@@@@@@"},V={palette:[m,w,p,j],data:"@@@HA@@@@@@QJ@@@@@HRRA@@@@YSZK@@@H[[[[A@@H[[[[A@@a\\[[cL@@acc\\\\L@@a\\\\ccL@@adc\\dL@@IddddI@@HaddLA@@@HIIA@@@@HIIA@@@@@II@@@@@@@@@@@"},E={palette:[f,d,M],data:"PPDDAP^feYTvVVYfweYZi]YfeiMgVvYv|Vvey`YZYvCfeiiCYZVfE\\wYZ[qWvefFle]fvPVfuY@g[dCpsCpC@"},T={palette:[g,j,m],data:"PU@@@PjVUU@YyGdjWU]PkAm^UUGt_PWUUuA}GTUUUUpjjjjC[_ZUNlk}ypvgVgCkjZ_N|}}@"},R={palette:[f,d],data:"@@@@@@D@@A@D@DA@DY@@PjEDA@@@@@A@@@@@@@@QQ@AdF@Pi"};"🔥,🍀,🌼,🐓,🌷,🌹,👻,🥚,🍎".split(",").map(t=>r(t));class S{static initialize(){S.C=new l(P),S.V=new l({...P,palette:["#551641","#b34d92"]}),S.T=new l(I),S.R=((t=b)=>{const[s,i]=o(16,16);i.clearRect(0,0,16,16),i.fillStyle=t,i.fillRect(0,0,1,1),i.fillRect(1,0,1,1),i.fillRect(0,1,1,1),i.fillRect(14,0,1,1),i.fillRect(15,0,1,1),i.fillRect(15,1,1,1),i.fillRect(0,14,1,1),i.fillRect(0,15,1,1),i.fillRect(1,15,1,1),i.fillRect(15,14,1,1),i.fillRect(14,15,1,1),i.fillRect(15,15,1,1);const h=new Image;return h.src=s.toDataURL(),h})(),S.oak=c(C.data,C.palette),S.spruce=c(V.data,V.palette),S.house=c(T.data,T.palette),S.S=c(E.data,E.palette),S.Z=c(R.data,R.palette);const t=["#fffef9",H,U];S.statue=c(J.data,J.palette),S.L=c(J.data,t),S.Y=c(D.data,D.palette),S.W=c(D.data,t)}}const Z="6v7ic,6trd0,6to3o,6nvic,55eyo,2np50,2jcjo,3ugt8,34ao,7k,glc,1,opzc,3xdeu,3sapz,8rhfz,8ri26,1bzky,9j1ny,3ws2u,9dv9k,3xb1i,3xbmu,2t8g,2t8s,26ndv,ajmo,fl5ug,3x7nm,n75t,54br,59u0e,53if,rlev,4jrb,1yjk4,4eav,55q95,18zsz,mi3r,574tl,1aedd,ljn9,a1bd,4f1i,a1fs,549t,53ig,5832,1dwsh,6iw6,6ix0,cbsa,6gix,6fk4,aky7,7mbws,cvtyq,deehh,2sfi3".split(","),z={},L="]",Y=t=>{if("0"===t)return{$:"0".repeat(25),N:0,F:5};const s=(parseInt(t,36).toString(2)+"").padStart(25,"0");let i=5,h=-1;for(let t=0;5>t;t++)for(let e=0;5>e;e++)"1"===s[5*e+t]&&(i=Math.min(i,t),h=Math.max(h,t));return{$:s,N:i,F:i>h?1:h-i+1}},Q=(t,s,i,h,e,a=0)=>{for(let o=-e;e>=o;o++){const n=o/e,r=Math.round(h*Math.sqrt(1-n*n));if(r>0){const h=Math.round(a*Math.abs(o));t.rect(0>o?s-r+h:s-r-h,i+o,2*r,1)}}};class W{constructor(){this.K=0,this.O=0,this.G=0,this.q=0,this.zoom=1,this._=0,this.X=0,this.tt=1,this.st=.08,this.it=!1,this.ht=a(c1),this.et=a(c2),this.ot=a(c3),this.nt=a(c4),S.initialize(),this.rt(),window.addEventListener("resize",()=>this.rt()),window.addEventListener("orientationchange",()=>this.rt())}rt(){this.K=1200,this.O=900;const t=[this.ht,this.et,this.ot,this.nt];for(const s of t)s.canvas.width=1200,s.canvas.height=900,s.imageSmoothingEnabled=!1}ct(t,s,i,h,e,a,o){t.save(),t.beginPath(),Q(t,s,i,h,e),Q(t,s,i,h-o,e-o),t.clip("evenodd"),t.beginPath(),t.fillStyle=a,t.fillRect(s-h,i-e,2*h,2*e),t.fill(),t.restore()}lt(t,s,i,h,e=0,a=0,n=2,r=1,c){((t,s,i,h,e=k,a=0,n=0,r=2,c=1)=>{i=Math.round(i),h=Math.round(h),s||(s=" ");const l=c*r,u=s.replace("!","@").toUpperCase().split("");let f=0;const d=[];u.forEach((t,s)=>{const i=(h=" "===t?"0":Z[t.charCodeAt(0)-35],Y(h).F*r);var h;d.push({char:t,x:f,F:i}),f+=i+(u.length-1>s?l:0)});const M=5*r,w=0===a?0:1===a?Math.round(f/2):f,p=0===n?0:1===n?Math.round(M/2):M;d.forEach(({char:s,x:a,F:n})=>{if(" "===s)return;const c=((t,s,i)=>{const h=`${t.charCodeAt(0)}-${i}-${s}`;return z[h]||(z[h]=((t,s,i)=>{const h=" "===t?"0":Z[t.charCodeAt(0)-35],{$:e,N:a,F:n}=Y(h),r=n*s,c=5*s,[l,u]=o(r,c),[f,d,M,w]=i.replace(/^#?([a-f\d])([a-f\d])([a-f\d])([a-f\d])$/i,(t,s,i,h,e)=>"#"+s+s+i+i+h+h+e+e).substring(1).match(/.{2}/g).map(t=>parseInt(t,16)),p=`rgba(${f}, ${d}, ${M}, ${(w||255)/255})`;return e.split("").forEach((t,i)=>{if("0"!==t){const t=i%5,h=Math.floor(i/5);if(a>t)return;const e=t-a;u.fillStyle=p,u.fillRect(e*s,h*s,s,s)}}),l})(t,s,i)),z[h]})(s,r,e);t.drawImage(c,0,0,n,M,i-w+a,h-p,n,M)})})(c||this.ht,t,s,i,h,e,a,n,r)}static drawImage(t,s,i,h,e,a,o){e&&(t.save(),t.scale(-1,1),i=-i-(a??s.width)),t.drawImage(s,i,h,a??s.width,o??s.height),e&&t.restore()}ut(t,s,i,h,e,a){W.drawImage(this.ht,t,s,i,h,e,a)}ft(t,s,i=1,h=!1){this._=t,this.X=s,this.tt=i;const e=this.K/2-32,a=this.O/2-64;h&&(this.G=t,this.q=s,this.zoom=i),this.ht.setTransform(this.zoom,0,0,this.zoom,e-this.G*this.zoom,a-this.q*this.zoom)}dt(){if(this.it){const t=this._-this.G,s=this.X-this.q,i=this.tt-this.zoom,h=10*this.st;.01>Math.abs(t)?this.G=this._:this.G+=Math.sign(t)*Math.min(Math.abs(t),h),.01>Math.abs(s)?this.q=this.X:this.q+=Math.sign(s)*Math.min(Math.abs(s),h),.02>Math.abs(i)?this.zoom=this.tt:this.zoom+=Math.sign(i)*Math.min(Math.abs(i),.1*h)}else this.G+=(this._-this.G)*this.st,.01>Math.abs(this._-this.G)&&(this.G=this._),this.q+=(this.X-this.q)*this.st,.01>Math.abs(this.X-this.q)&&(this.q=this.X),this.zoom+=(this.tt-this.zoom)*this.st,.02>Math.abs(this.tt-this.zoom)&&(this.zoom=this.tt)}Mt(){this.ht.setTransform(1,0,0,1,0,0)}clear(){this.Mt(),this.ht.clearRect(0,0,this.K,this.O),this.ht.fillStyle=u,this.ht.fillRect(0,0,this.K,this.O),this.et.clearRect(0,0,this.K,this.O),this.ot.clearRect(0,0,this.K,this.O)}wt(t,s,i=7){return{x:this.K/2-32+(t-this.G)*i,y:this.O/2-64+(s-this.q)*i}}}const $=new W;let N=[];const F=12,K=12,O=20,G=[[[69,100,3],[76,113,4],[89,114,5],[104,86,3],[99,59,3],[85,46,2],[86,28,2],[74,38,2],[60,39,2],[48,30,2],[46,43,2],[38,61,3],[50,73,4],[38,84,3],[46,123,3],[36,133,2],[48,141,3],[94,133,4],[113,109,5],[122,74,6],[113,56,.9]],[[45,49,.9],[71,51,.9]],[[119,54,1],[129,29,1]]],q=[{x:64,y:88,r:6},{x:75,y:88,r:6},{x:69,y:95,r:6},{x:129,y:28,r:10},{x:71,y:51,r:3}],_={jt:{x:76,y:84,name:"heart"},gt:{x:129,y:19,name:"moon"},yt:{x:49,y:29,name:"ear"},eye:{x:71,y:50,name:"eye"},Bt:{x:35,y:131,name:"foot"},xt:{x:114,y:56,name:"tail"}};class X{constructor(t,s,i,h,e,a=0,o=!1){this.bt=t,this.x=s,this.y=i,this.type=h,this.animation=e,this.speed=a,this.At=o,this.Ht=0,this.Ut=0,this.vt=150,this.kt=!0,this.o={x:0,y:0},this.Pt=Math.ceil(s/F),this.It=Math.ceil(i/K),this.Ht=Math.random()*this.vt,this.h={x:this.x,y:this.y}}Jt(t,s){this.Pt=t,this.It=s,this.x=t*F,this.y=s*K,this.h={x:this.x,y:this.y}}update(t){(this.kt||this.Ut!==this.bt.J[this.animation].length-1)&&(this.Ht+=t,this.Ut=Math.floor(this.Ht/this.vt)%this.bt.J[this.animation].length)}Dt(t){i(this,t),0!==this.o.x&&(this.At=0>this.o.x)}draw(){const t=this.bt.J[this.animation];t[this.Ut]&&$.ut(t[this.Ut],this.x-(this.bt.D-F)/2,this.y-(this.bt.D-K)/2,this.At)}}const tt=[],st=(t,s)=>{const i=t+"",h=t=>{s(t.detail)};document.addEventListener(i,h),tt.push({Ct:i,Vt:h})},it=(t,s)=>{document.dispatchEvent(new CustomEvent(t+"",{detail:s}))},ht=(t,s,i,h)=>{const e=[];let a,o=Math.abs(i-t),n=i>t?1:-1,r=-Math.abs(h-s),c=h>s?1:-1,l=o+r;for(;e.push([t,s]),t!==i||s!==h;)a=2*l,r>a||(l+=r,t+=n),a>o||(l+=o,s+=c);return e};class et{constructor(t,s,i,h,e=Math.PI/2,a=12,o=0,n=0,r=300,c=16,l=0,u=1,f=!0){this.Et=t,this.Tt=h,this.Rt=e,this.radius=a,this.offset=o,this.St=n,this.speed=r,this.Zt=c,this.zt=l,this.Lt=u,this.active=f,this.cx=s+6,this.cy=i+6;const d=((t,s,i,h)=>{const e=[];for(let a=0;5>a;a++){const o=2*Math.PI*(2*a%5)/5-Math.PI/2+i;e.push([Math.round(t+h*Math.cos(o)),Math.round(s+h*Math.sin(o))])}return e})(this.cx,this.cy,e,a);this.Yt=[];for(let t=0;5>t;t++){const[s,i]=d[t],[h,e]=d[(t+1)%5];this.Yt.push(...ht(s,i,h,e))}this.Qt=this.Yt.length*this.Lt*1e3/this.speed}update(t){if(!this.active)return;const s=Math.floor(this.St/1e3*this.speed)%this.Yt.length;if(this.offset>s&&(this.zt++,this.zt>=this.Lt))return this.active=!1,void this.Tt();this.offset=s,this.St+=t}draw(){if(!this.active)return;this.Et.fillStyle=k;const t=Math.min(this.Zt,this.offset);for(let s=0;t>s;s++){const t=(this.offset-s+this.Yt.length)%this.Yt.length,[i,h]=this.Yt[t];this.Et.fillRect(i,h,1,1)}}isActive(){return this.active}}const at=(t,s,i,h=!1)=>{for(let e=-1;1>=e;e++)for(let a=-1;1>=a;a++)(h||0!==e||0!==a)&&i(t+a,s+e)};let ot=null;const nt=t=>{ot||(ot=new AudioContext);const s=ot.createBuffer(1,96e3,48e3),i=s.getChannelData(0);for(let s=96e3;s--;)i[s]=t(s);const h=ot.createBufferSource();h.buffer=s,h.connect(ot.destination),h.start()},rt=(t=1)=>nt(s=>{const i=2e3*t;return s>i?0:.15*(2*Math.random()-1)*Math.sin(Math.PI*s/i)}),ct=t=>nt(s=>Math.sin(s/(21-t)+5*Math.sin(s/2e3))*Math.exp(-s/4e3)*(s/96e3)*9),lt=t=>nt(s=>{const i=2*s*Math.PI/(80*Math.pow(2,-t/12))+4*Math.sin(s/1800);return(Math.sin(i)+.5*Math.sin(2*i)+.3*Math.sin(3*i)+.2*Math.sin(4*i))*Math.exp(-s/6e3)*(s/96e3)*6});class ut extends X{constructor(s,i,h,e){super(S.C,s*F,i*K,"cat",6,80),this.map=h,this.Wt=e,this.type="cat",this.$t=!0,this.Nt=!1,this.Ft=!1,this.Kt=!1,this.Ot=!1,this.Gt=null,this.qt=0,this._t=0,this.map.Xt={Pt:s+1,It:i},st(7,()=>{this.Jt(_.jt.x,_.jt.y+1)}),st(6,()=>{this.$t=!1,this.Nt=!0}),st(9,()=>{this.Nt=!1}),st(12,()=>{this.Kt=!0,t(()=>{this.Kt=!1},600)}),st(19,()=>{this.animation=3,this.Ht=0,this.Ut=0,this.kt=!1,this.vt=600})}ts(t){switch(super.update(t),this.animation){case 6:case 8:this.vt=600;break;case 5:this.vt=75;break;default:this.vt=150}}update(s){if(3===this.animation)return;2===this.animation?(this.qt-=s,this.qt>0||(rt(),this.qt=200)):this.qt=0;const i=this.map.grid[this.It][this.Pt].ss;if(!this.Ot&&i?(this.Ot=!0,it(10,i)):this.Ot&&!i&&(this.Ot=!1),coords.innerText=`${this.Pt},${this.It}`,!this.Wt.hs){if(this.Kt&&!this.es())this.animation=5;else if(this.$t)this.animation=6;else if(this.Nt)this.animation=8;else if(this.Ft)this.animation=this.Gt?7:4;else{if(super.Dt(s),!this.o.y&&e.k.y){const t=this.It+e.k.y;this.map.grid[t][this.Pt].content||(this.animation=2,this.o.y=e.k.y,this.h.y+=e.k.y*K,this.It=t),this.map.Xt={Pt:this.Pt,It:this.It+e.k.y}}if(!this.o.x&&e.k.x){this.At=e.M;const t=this.Pt+e.k.x;this.map.grid[this.It][t].content||(this.animation=2,this.o.x=e.k.x,this.h.x+=e.k.x*F,this.Pt=t),this.map.Xt={Pt:this.Pt+e.k.x,It:this.It}}this.o.x||this.o.y?this._t=0:(this.animation=0,this._t+=s,this._t>2e3&&(this.animation=8)),this.Ft||this.ns(),this.Ft||!e.B||e.U.B||(this.Ft=!0,this.Ht=0,this._t=0,!this.Gt&&this.es()?this.Gt=new et($.ht,this.x,this.y,()=>{this.Gt=null,this.rs(),this.Ft=!1,nt(t=>t>29e3?0:.2*(t>17400?Math.pow(.9999,t-17400):1)*Math.sin(t/(30-5*Math.sin(5*Math.round(5*t/29e3)))+Math.random())*(8e3-t%6e3)/5e3)}):(t(()=>this.cs(),500),t(()=>{this.Ft=!1},5*this.vt)))}this.Gt?.update(s)}}rs(){at(this.Pt,this.It,(t,s)=>{const i=this.map.grid[s][t];"spirit"===i.content?.type&&i.content.ls(5)})}es(){let t=0;return at(this.Pt,this.It,(s,i)=>{const h=this.map.grid[i][s];"spirit"===h.content?.type&&t++}),t>=3}draw(){super.draw(),this.Gt?.draw()}ns(){const t=this.map.us();if(t?.content)return;const s=[{Pt:this.Pt+1,It:this.It,fs:"right"},{Pt:this.Pt-1,It:this.It,fs:"left"},{Pt:this.Pt,It:this.It+1,fs:"down"},{Pt:this.Pt,It:this.It-1,fs:"up"}];let i=null,h=null,e=null,a=null;for(const t of s){const s=this.map.grid[t.It][t.Pt];if(!s.content)continue;const o=s.content.type;if("spirit"===o){i={Pt:t.Pt,It:t.It},e=t.fs;break}"statue"!==o&&"obelisk"!==o||h||(h={Pt:t.Pt,It:t.It},a=t.fs)}i?(this.map.Xt=i,"left"===e?this.At=!0:"right"===e&&(this.At=!1)):h&&(this.map.Xt=h,"left"===a?this.At=!0:"right"===a&&(this.At=!1))}cs(){const t=this.map.us();t.content&&"spirit"===t.content.type?(t.content.ls(1),nt(t=>{if(t>1e4)return 0;const s=5*Math.sin(5*Math.round(5*t/1e4));return.2*Math.pow(.998,t/10)*Math.sin(t/(40-s)+Math.random())*(8e3-t%6e3)/5e3})):t.content&&"field"===t.content.type&&(t.content=null,rt(3))}}class ft{constructor(t,s,i,h){this.ds=t,this.x=s,this.y=i,this.type=h,this.Pt=Math.ceil(s/F),this.It=Math.ceil(i/K),this.offsetX=s-Math.round((t.width-F)/2),this.offsetY=i-Math.round((t.height-K)/2)}draw(){$.ut(this.ds,this.offsetX,this.offsetY)}}class dt extends ft{constructor(t,s,i){super(S[i],t,s,i),this.x=t,this.y=s,this.Ms={top:!1,bottom:!1,left:!1,right:!1}}ws(t){this.Ms=t}draw(){this.Ms.right&&$.ut(this.ds,Math.round(this.offsetX+6),this.offsetY-6),super.draw()}}class Mt{constructor(t=47){this.ps=t}next(){return this.ps=(9301*this.ps+49297)%233280,this.ps/233280}range(t,s){return t+this.next()*(s-t)}}class wt extends ft{constructor(t,s,i=""){super(S.house,t*F,s*K,"house"),this.name=i}}class pt extends X{constructor(t,s,i){super(S.T,t*F,s*K,"villager",0,10),this.map=i,this.js=null,this.gs=0,this.ys=1e3,this.Bs=!1}update(t){super.update(t),this.gs+=t,this.xs()?(this.Bs||this.ys>this.gs||(this.gs=0,this.Bs=!0),t>this.gs%(this.ys/5)&&it(16),this.animation=1,this.vt=50):(this.Bs=!1,this.vt=150,this.ys>this.gs||(this.bs(),this.gs=0),this.Dt(t))}bs(){const t=[{x:0,y:-1},{x:0,y:1},{x:1,y:0},{x:-1,y:0}];if(this.js&&.8>Math.random()){const t=this.Pt+this.js.x,s=this.It+this.js.y;if(this.As(t,s))return this.Pt=t,this.It=s,this.h={x:t*F,y:s*K},this.js=this.js,void(this.animation=0)}for(let s=0;10>s;s++){const s=t[Math.floor(4*Math.random())],i=this.Pt+s.x,h=this.It+s.y;if(this.As(i,h))return this.Pt=i,this.It=h,this.h={x:i*F,y:h*K},this.js=s,void(this.animation=0)}}As(t,s){return null===this.map.grid[s][t].content}xs(){if(!this.js)return!1;for(let t=1;2>=t;t++){const s=this.Pt+this.js.x*t,i=this.It+this.js.y*t,h=this.map.grid[i]?.[s];if("cat"===h?.content?.type)return!0}return!1}}class jt extends ft{constructor(t,s){super(S.S,t*F,s*K,"field")}}class mt{constructor(t,s,i,h,e){this.name=t,this.Hs=s,this.radius=i,this.Us=h,this.vs=e,this.ks=[],this.Ps=[],this.Is=[],this.Hs=s,this.radius=i}Js(t,s,i){let h,e;do{const s=t.range(0,2*Math.PI),i=t.range(1,this.radius-1);h=Math.round(this.Hs.x+Math.cos(s)*i),e=Math.round(this.Hs.y+Math.sin(s)*i)}while(0>h||0>e||null!==i.get(h,e)?.content||s.some(t=>t.x===h&&t.y===e));return{x:h,y:e}}Ds(t,s){for(let i=0;this.Us>i;i++){const i=this.Js(t,this.ks,s);this.ks.push(new wt(i.x+i.x%2,i.y+i.y%2))}return this.ks}Cs(t,s){const i=this.Us;for(let h=0;i>h;h++){const i=this.Js(t,this.Ps,s);for(let t=0;2>t;t++)for(let s=0;2>s;s++)this.Ps.push(new jt(i.x+t,i.y+s))}return this.Ps}Vs(t,s){for(let i=0;this.vs>i;i++){const i=this.Js(t,this.Ps,s);this.Is.push(new pt(i.x,i.y,s))}return this.Is}}class gt{constructor(t,s,i,h){this.icon=t,this.Pt=s,this.It=i,this.type=h,this.x=Math.round(this.Pt*F+(F-this.icon.width)/2),this.y=Math.round(this.It*K+(K-this.icon.height)/2)}draw(){$.ut(this.icon,this.x,this.y)}}const yt=[{x:0,y:-1},{x:0,y:1},{x:1,y:0},{x:-1,y:0}],Bt=(t,s)=>`${t},${s}`,xt=(t,s,i)=>{const h=[];let e=i;for(;e!=s;)h.unshift(e),e=t[Bt(e.Pt,e.It)];return h.unshift(s),h},bt=[p,j,A,b],At=(t,s,i,h,e=bt)=>{const a=Math.ceil(12*Math.max(0,Math.min(1,t/s))),o=i,n=h-5;$.ht.fillStyle=e[0],$.ht.fillRect(o,n,a,1),$.ht.fillStyle=e[1],$.ht.fillRect(o,n+1,a,1),$.ht.fillStyle=e[2],$.ht.fillRect(o+a,n,12-a,1),$.ht.fillStyle=e[3],$.ht.fillRect(o+a,n+1,12-a,1)},Ht=["☁️","🥨","🌵","🧚🏻‍♀️","🦀","👻","👹","🧿","💀"].reduce((t,s,i)=>(t[s]={icon:r(s),type:s,level:Math.ceil(i/2)},t),{});class Ut extends gt{constructor(t,s,i,h){super(Ht[i].icon,t,s,"spirit"),this.vt=2e3,this.Ht=0,this.opacity=0,this.Es=9,this.gs=0,this.ys=600,this.o={x:0,y:0},this.speed=20,this.Ts=!1,this.Rs=!1,this.state=1,this.Ss=0,this.Zs=1e3,this.zs=null,this.Ls=0,this.Ys=0,this.species=Ht[i],this.map=h,this.h={x:this.x,y:this.y},this.Qs=Math.round(Math.pow(1.5,this.species.level+1)),this.Ws=this.Qs,st(20,()=>{this.state=0})}ts(t){this.Ws>0||(this.opacity-=t/this.vt),this.Ht+=t*Math.pow(this.species.level+.5,2),1>this.opacity&&(this.opacity+=t/this.vt),this.vt>this.Ht||(this.Ht-=this.vt)}update(t){switch(this.state){case 0:break;case 1:case 2:i(this,t);const s=this.$s();s&&(this.gs+=t,this.ys>this.gs||(this.Ns(s),this.gs=0));break;case 3:case 4:case 5:this.Fs(t)}}Fs(t){this.Ss+=t;const s=this.Ss/this.Zs;if(!this.zs)return void(this.state=1);const i=this.zs.Pt-this.Pt,h=this.zs.It-this.It;if(.7>s){3!==this.state&&(this.state=3);const t=s/.7;this.Ls=-i*t*3,this.Ys=-h*t*3}else if(.73>s){4!==this.state&&(this.state=4);const t=(s-.7)/.03;this.Ls=i*(F*t-3),this.Ys=h*(F*t-3)}else if(1>s){if(5!==this.state){this.state=5;const t=this.map.grid[this.zs.It][this.zs.Pt];"cat"===t.content?.type&&it(12,this.species.level)}const t=(s-.73)/.27;this.Ls=3*i*(1-t),this.Ys=3*h*(1-t)}else this.state=1,this.Ss=0,this.zs=null,this.Ls=0,this.Ys=0}$s(){for(let t=-this.Es;this.Es>=t;t++)for(let s=-this.Es;this.Es>=s;s++){const i=this.Pt+t,h=this.It+s,e=this.map.grid[h][i];if("cat"===e.content?.type)return{Pt:i,It:h}}return null}Ns(t){const s=((t,s,i,h=100)=>{let e=h;const a=[s],o=new Set,n={};for(;0!==a.length&&e--;){const h=a.shift();if(h.Pt===i.Pt&&h.It===i.It)return xt(n,s,i);yt.map(({x:s,y:i})=>t[h.It+i][h.Pt+s]).forEach(t=>{o.has(t)||(o.add(t),(null===t.content||t.x==i.Pt&&t.y==i.It)&&(n[Bt(t.x,t.y)]=h,a.push({Pt:t.x,It:t.y})))})}})(this.map.grid,{Pt:this.Pt,It:this.It},t);if(s&&s.length>2){this.state=2;const t=s[1];h=t.It,(i=this).h.x=t.Pt*F,i.h.y=h*K,this.Pt=t.Pt,this.It=t.It,this.h.x=t.Pt*F,this.h.y=t.It*K}else 2===s?.length&&(this.state=3,this.zs=s[1],this.Ss=0);var i,h}draw(){const t=Math.sin(this.Ht/this.vt*2*Math.PI);$.ht.save(),$.ht.globalAlpha=this.opacity,$.ht.fillStyle=`rgba(0,0,0,${Math.round(2+1*t)/10})`,$.ht.fillRect(this.x+3+this.Ls,this.y+9+this.Ys,this.icon.width-6,4),this.Qs>this.Ws&&At(this.Ws,this.Qs,this.x,this.y),$.ht.save(),this.Rs&&($.ht.filter="sepia(1) saturate(2) hue-rotate(260deg) brightness(0.7)"),$.ht.translate(this.Ls,this.Ys+Math.round(2*(t-1))),super.draw(),$.ht.restore(),$.ht.restore()}ls(s=1){return this.Ws-=s,this.Rs=!0,t(()=>{this.Rs=!1},150),this.Ws>0||t(()=>{(()=>{const t=~(1e3*Math.random());nt(s=>Math.sin(s/(10+s/8e3-s/12e3)&t+5*Math.sin(s/2e3))*Math.exp(-s/4e3)*(s/96e3)*9)})(),this.Ts=!0},1500),0>=this.Ws}}class vt{constructor(t,s){this.x=t,this.y=s,this.Ks=0,this.Os=0,this.Gs=!1,this.cx=this.x+6,this.cy=this.y+6}update(t){this.Ks+=t,this.Os=this.Ks/vt.animationDuration,1>this.Os||(this.Gs=!0)}draw(){if(this.Gs)return;const t=3*this.Os%1,s=c2.width/$.zoom,i=c2.height/$.zoom;$.ct($.ht,this.cx,this.cy,s*t,i*t,k,8)}}vt.animationDuration=1500;class kt extends ft{constructor(t,s,i,h,e){super(S.statue,t*F,s*K,"statue"),this.map=i,this.Wt=h,this.name=e,this.qs=[],this._s=4,this.Xs=0,this.ti=1e3,this.si=.1,this.ii=10,this.hi=0,this.state=kt.ai.ei,this.Ht=0,this.oi=!1,this.ni=0,this.ri=null,this.vt=800}ts(t){this.Ht+=t}update(t){if(this.Xs+=t,this.state!==kt.ai.ei||O>this.hi?this.ri&&(this.ri.update(t),this.ri.Gs&&(this.state=kt.ai.ci,this.ri=null)):(this.state=kt.ai.li,this.oi=!1,this.ni=0,this.ri=new vt(this.x,this.y)),this.Xs>=this.ti&&(this.Xs=0,Math.random()<this.si))if(this.qs.length<this._s+this.Wt.ui())this.fi();else if(this.qs.length>0){const t=this.qs.filter(t=>t.Ws===t.Qs)[Math.round(Math.random()*this.qs.length-1)];t&&(t.Ts=!0,this.fi())}this.qs=this.qs.filter(t=>!t.Ts)}draw(){super.draw(),this.hi>0&&O>this.hi&&At(this.hi,O,this.x,this.y,[H,U,y,B]),this.state===kt.ai.ci&&this.di()}Mi(){this.ri&&(this.ri.draw(),20>this.ri.Ks-this.ni||(this.map.wi(this.Pt,this.It,20*this.ri.Os,!0,2,.3),this.ni=this.ri.Ks),this.oi||(this.qs.forEach((s,i)=>{t(()=>{s.ls(s.Ws)},100*i)}),this.oi=!0))}di(){$.ht.fillStyle=x;for(let t=0;5>t;t++){const s=(this.Ht+.5*this.vt*t)/this.vt,i=2*t*Math.PI/3,h=3,e=Math.cos(i)*h,a=Math.sin(i)*h,o=6*Math.sin(s),n=3*Math.sin(2*s),r=o*Math.cos(i)-n*Math.sin(i),c=o*Math.sin(i)+n*Math.cos(i);$.ht.fillRect(Math.round(this.x+6+e+r),Math.round(this.y+4+a+c),1,1)}}fi(){const t=[],s=Math.round(this.Wt.ui()+this.ii);for(let i=-s;s>=i;i++)for(let h=-s;s>=h;h++){const s=this.Pt+i,e=this.It+h;null===this.map.grid[e][s].content&&t.push({x:s,y:e})}if(t.length>0){const s=t[Math.floor(Math.random()*t.length)],i=Object.values(Ht).filter(t=>t.level<this.Wt.ui());if(0===i.length)return;const h=i[Math.floor(Math.random()*i.length)],e=new Ut(s.x,s.y,h.type,this.map);this.qs.push(e),this.map.set(s.x,s.y,e)}}}kt.ai={ei:0,li:1,ci:2};class Pt extends ft{constructor(t){super(S.Y,828,1056,"obelisk"),this.name="barrier obelisk",this.hi=0,this.ri=null,this.map=t,this.map.set(this.Pt,this.It,this)}update(t){this.ri?.update(t)}pi(){this.ri=new vt(this.x,this.y)}draw(){super.draw(),this.hi>0&&At(this.hi,O,this.x,this.y,[H,U,y,B])}Mi(){this.ri?.draw()}ji(){O*(this.map.Wt.mi/6)>this.hi?(this.hi++,ct(2*this.hi-10)):(ct(-10),it(15)),this.hi===O&&it(20)}}class It{constructor(t,s,i){this.gi=t,this.yi=s,this.Wt=i,this.Bi=[],this.Xt={Pt:0,It:0},this.xi=[],this.bi=new Mt,this.grid=Array.from({length:s},(s,i)=>Array.from({length:t},(t,s)=>{const h=s-70,e=i-90;let a;a=Math.sqrt(h*h+e*e)>40?.2>this.bi.next()?"spruce":"oak":.9>this.bi.next()?"spruce":"oak";const o=new dt(s*F-2,i*K-2,a);return{x:s,y:i,content:o}})),this.Bi=[new mt("Heart Peak",{x:70,y:90},12,0,0),new mt("Pine Rest",{x:99,y:100},6,2,3),new mt("Oak Branch",{x:42,y:51},4,3,4),new mt("Cat Foot",{x:48,y:140},5,4,5),new mt("Black Tail",{x:113,y:107},4,5,8),new mt("Moon Town",{x:129,y:29},8,12,25)];for(const t of G)for(let s=0;t.length-1>s;s++)this.Ai({x:t[s][0],y:t[s][1]},{x:t[s+1][0],y:t[s+1][1]},t[s][2]);for(const t of q)this.wi(t.x,t.y,t.r);for(let i=0;s>i;i++)for(let s=0;t>s;s++){const t=this.grid[i][s];t.content instanceof dt&&t.content.ws({top:this.grid[i-1]?.[s]?.content instanceof dt,bottom:this.grid[i+1]?.[s]?.content instanceof dt,left:this.grid[i]?.[s-1]?.content instanceof dt,right:this.grid[i]?.[s+1]?.content instanceof dt})}for(const t of this.Bi){t.Cs(this.bi,this).forEach(t=>{this.grid[t.It][t.Pt].content=t}),t.Ds(this.bi,this).forEach(t=>{this.grid[t.It][t.Pt].content=t}),t.Vs(this.bi,this).forEach(t=>{this.grid[t.It][t.Pt].content=t});const{x:s,y:i}=t.Hs,h=t.radius;for(let e=i-h;i+h>=e;e++)for(let a=s-h;s+h>=a;a++){const o=a-s,n=e-i;o*o+n*n>h*h||(this.grid[e][a].ss=t)}this.set(61,84,new wt(61,84,"home"))}this.Hi(1),this.Y=new Pt(this);for(const t of Object.values(_)){const{x:s,y:i,name:h}=t,e=new kt(s,i,this,this.Wt,`cat ${h} altar`);at(s,i,(t,s)=>{this.grid[s][t].content=new jt(t,s)}),this.grid[i][s].content=e,this.xi.push(e)}st(18,()=>{this.set(64,89,new Ut(64,89,"☁️",this))})}us(){return this.grid[this.Xt.It][this.Xt.Pt]}get(t,s){return 0>s||s>=this.yi||0>t||t>=this.gi?null:this.grid[s][t]}Ui(t,s){(this.grid[s][t].content instanceof dt||this.grid[s][t].content instanceof jt)&&(this.grid[s][t].content=null)}Hi(t){const s=this.Bi[0],{x:i,y:h}=s.Hs;for(let s=h-12;h+12>=s;s++)for(let h=i-12;i+12>=h;h++){const i=this.grid[s][h];i.content||this.bi.next()>t?i.content instanceof jt&&this.bi.next()>t&&(i.content=null):i.content=new jt(i.x,i.y)}const e=[[61,86,2],[69,88,.9],[75,89,.9],[76,84,.9]];for(let t=0;e.length-1>t;t++)this.Ai({x:e[t][0],y:e[t][1]},{x:e[t+1][0],y:e[t+1][1]},e[t][2])}Ai(t,s,i){const h=Math.abs(s.x-t.x),e=Math.abs(s.y-t.y),a=s.x>t.x?1:-1,o=s.y>t.y?1:-1;let n=h-e,r=t.x,c=t.y;const l=i/2;for(;;){const t=1>i?0:1.2,u=Math.ceil(this.bi.range(-t,t)),f=Math.ceil(this.bi.range(-t,t));for(let t=-l;l>=t;t++)for(let s=-l;l>=s;s++){const h=Math.ceil(r+t+u),e=Math.ceil(c+s+f);this.Ui(h,e),1>i?this.bi.next()>.5?this.Ui(h+1,e):(this.grid[e][h].content=new jt(h,e),this.grid[e][h+1].content=new jt(h,e)):this.bi.next()>.1&&(this.bi.next()>.05?this.Ui(h,e):this.grid[e][h].content=new jt(h,e))}if(r===s.x&&c===s.y)break;const d=2*n;d>-e&&(n-=e,r+=a),h>d&&(n+=h,c+=o)}}wi(t,s,i,h=!1,e=99,a=1){for(let o=0;this.yi>o;o++)for(let n=0;this.gi>n;n++){const r=n-t,c=o-s,l=Math.sqrt(r*r+c*c),u=i+this.bi.range(-i,i)/6;if(l>=u-e&&u>=l){const t=Math.min(1,(u-l)/2+.7)*a;this.bi.next()<t&&(!h||h&&this.grid[o][n].content instanceof jt)&&(this.grid[o][n].content=null)}}}set(t,s,i){this.grid[s]&&this.grid[s][t]&&(this.grid[s][t].content=i)}update(t,s){for(const i of this.grid)for(const h of i)h.content&&(h.content.ts?.(t),s||(h.content.update?.(t),h.x==h.content.Pt&&h.y==h.content.It||(this.grid[h.content.It][h.content.Pt].content=h.content,h.content=null),h.content&&h?.content?.Ts&&this.set(h.content.Pt,h.content.It,null)))}draw(t,s){const i=$.zoom,h=$.K/i/2+50,e=$.O/i/2+50,a=Math.max(0,Math.floor((t-h)/F)),o=Math.min(this.gi-1,Math.ceil((t+h)/F)),n=Math.max(0,Math.floor((s-e)/K)),r=Math.min(this.yi-1,Math.ceil((s+e)/K));for(let t=n;r>=t;t++)for(let s=a;o>=s;s++){const i=this.grid[t][s];$.ut(S.Z,i.x*F,i.y*K)}const c=[];let l=!1;for(let i=n;r>=i;i++)for(let h=a;o>=h;h++){const e=this.grid[i][h],a=e.x*F-t,o=e.y*K-s;a*a+o*o>5625||(e.ki=!0),e.y===this.Xt.It&&e.x===this.Xt.Pt&&e.content&&"oak"!==e.content.type&&"spruce"!==e.content.type&&(l=!0),e?.content?.draw(),e?.content?.Mi&&c.push(e?.content)}c.forEach(t=>t.Mi()),l&&$.ut(S.R,this.Xt.Pt*F-2,this.Xt.It*K-2)}}const Jt=(t,s,i)=>s+-(Math.cos(Math.PI*t)-1)/2*i,Dt={oak:u,spruce:j,house:g,field:H,statue:B,unseen:y,default:U};class Ct{constructor(t){this.map=t,this.Pi=0,this.updateInterval=100}update(t){this.Pi+=t}draw(t){if(this.updateInterval>this.Pi)return;this.Pi=0;const s=$.nt,i=160,h=s.canvas.width-i-10,e=s.canvas.height-i-10;s.clearRect(h,e,i,i);for(let t=0;i>t;t++)for(let a=0;i>a;a++){const i=this.map.grid[t][a];s.fillStyle=i.ki?Dt[i.content?.type||"default"]??Dt.default:Dt.unseen,s.fillRect(h+a,e+t,1,1)}t.Pt>=0&&i>t.Pt&&t.It>=0&&i>t.It&&(s.fillStyle=b,s.beginPath(),s.arc(h+t.Pt,e+t.It,2,0,2*Math.PI),s.fill())}}class Vt{constructor(){this.Ii=null,st(3,t=>{this.Ii=t}),st(2,()=>{this.Ii=null})}draw(){if(this.Ii){const t=160,s=20,i=c3.width-t-3*s,h=s,e=c3.height-t-s;$.ot.fillStyle=b,$.ot.fillRect(h+5,e+5,i,t),$.ot.fillStyle=x,$.ot.fillRect(h,e,i-5,t-5),this.Ii.split("\n").forEach((t,i)=>{$.lt(t,h+2*s,e+2*s+40*i,">"===t[0]?b:v,0,0,5,1,$.ot)}),$.lt("press (space) to continue",h+i-s,e+t-s,b,2,2,3,1,$.ot)}}}class Et{constructor(t,s,i,h){this.map=t,this.Ji=s,this.actions=i,this.Wt=h,this.Di=!1,this.Ci=!1,this.Vi=!1,this.Ei="",this.Ti=0,this.Ri=new Ct(t),this.Si=new Vt,st(9,()=>{this.Ci=!0}),st(15,()=>{this.Vi=!0}),st(10,t=>{this.Ei=t.name,this.Ti=3e3}),st(16,()=>{this.Di=!0})}update(t){this.Ri.update(t),this.Ti-=t}draw(){this.Ci&&this.Zi(),this.Vi&&this.zi(),this.Li(),this.Di&&this.Yi(),this.Qi(),this.Wi(),this.Ci&&this.Ri.draw(this.Ji),this.Si.draw()}Qi(){const t=this.actions.actions;if(!t||!t[0].enabled)return;const s=Math.round(($.ot.canvas.width-(120*t.length+10*(t.length-1)))/2),i=$.ot.canvas.height-120-10;t.forEach(({type:t,color:h,$i:e},a)=>{const o=s+130*a;$.ot.fillStyle=x,$.ot.fillRect(o,i,120,120),$.lt(e,o+60,i+30,h,1,1,7,1,$.ot),$.lt(t,o+60,i+95,v,1,1,3,1,$.ot)})}Zi(){const t=Math.floor(this.Wt.Ni),s=Math.floor(9-this.Wt.Ni),i=9-t-s,h=this.Wt.Ni-t,e="#".repeat(t)+(h>.3?"$":"%").repeat(i)+"&".repeat(s),a=5*(6*e.length+1);$.ot.fillStyle=x,$.ot.fillRect(16,16,a,35),$.lt(e,21,21,b,0,0,5,1,$.ot)}zi(){let t=c3.width-16;const s=this.Wt.mi,i=this.Wt.Fi-this.Wt.mi,h=6-this.Wt.Fi;$.ot.fillStyle=H,$.ot.fillRect(t-185+5,16,185,35);let e=L.repeat(s);t-=30*e.length,$.lt(e,t+5,21,j,0,0,5,1,$.ot),e=L.repeat(i),t-=30*e.length,$.lt(e,t+5,21,m,0,0,5,1,$.ot),e=L.repeat(h),t-=30*e.length,$.lt(e,t+5,21,U,0,0,5,1,$.ot)}Li(){this.Wt.Ki.filter(t=>t.time>0).forEach((t,s)=>{const{label:i,time:h}=t,e=61+70*s;let a=0;h>4800?a=-526*(1-Jt((5e3-h)/200,0,1)):200>h&&(a=-526*(1-Jt(h/200,0,1)));const o=16+a;$.ot.fillStyle=b,$.ot.fillRect(o,e,510,65),$.lt("GOAL",o+3+5,e+5,k,0,0,4,1,$.ot),$.lt(i,o+3+5+20,35+e+5,x,0,0,3,1,$.ot)})}Yi(){const t=Math.round(c3.width/2-115);$.ot.fillStyle=x,$.ot.fillRect(t,16,230,62),$.ot.fillStyle=y,$.ot.fillRect(t+5,21,220,25),$.ot.fillStyle=this.Wt.Oi>.9?b:j,$.ot.fillRect(t+5,21,3*Math.round(220*this.Wt.Oi/3),25),$.lt("superstition",c3.width/2,54,y,1,0,3,1,$.ot)}Wi(){if(this.Ti>0){const t=this.Ti,s=Jt(Math.max(0,Math.min(1,Math.min(t/150,(3e3-t)/150))),0,1);$.ot.globalAlpha=s,this.Gi("^^ "+this.Ei,170),$.ot.globalAlpha=1}if(this.map.Xt){const t=this.map.us();t?.content?.name&&this.Gi(t.content.name,c3.height-170)}}Gi(t,s){$.ot.fillStyle=A,$.ot.fillRect(c3.width/2-175+4,s-18-4,342,43),$.ot.fillStyle=U,$.ot.fillRect(c3.width/2-175,s-18,350,35),$.lt(t,c3.width/2,s,b,1,1,3,1,$.ot)}}const Tt=[{type:"scratch",color:b,enabled:!1,$i:"\\"},{type:"teleport",color:j,enabled:!0,$i:"["},{type:"repair",color:u,enabled:!0,$i:L},{type:"sleep",color:U,enabled:!0,$i:"z"}];class Rt{constructor(t,s){this.actions=[],this.map=t,this.Ji=s,st(9,()=>{this.actions[0].enabled=!0})}update(){const t=this.map.us(),s=this.qi(t),i=this._i(t),h=this.Xi(t),a=this.th(t);if(this.actions=[a?Tt[0]:s?Tt[1]:i?Tt[2]:h?Tt[3]:Tt[0]],e.B&&!e.U.B)switch(!0){case a:break;case s:it(7);break;case i:this.sh(t);break;case h:it(11)}}sh(s){it(8);const i=s.content;O>i.hi&&(i instanceof kt?(i.hi++,ct(i.hi),O>i.hi||t(()=>{it(13,this.map.Wt.Fi)},4e3)):i instanceof Pt&&i.ji())}_i(t){const s=t.content,i=s?.type;return("statue"===i||"obelisk"===i)&&O>s.hi}qi(t){return t.content instanceof kt&&this.Ji.Pt!=_.jt.x&&t.content.state===kt.ai.ci}Xi(t){return t.content instanceof wt&&"home"===t.content.name}th(t){return t.content instanceof Ut||t.content instanceof jt}}class St{constructor(){this.hs=!1,this.Ni=9,this.Fi=0,this.mi=0,this.Oi=0,this.Ki=[],this.ih=!1,this.hh=!1,st(16,()=>{this.Oi=Math.min(1,this.Oi+.01)}),st(4,()=>{this.hs=!0}),st(5,t=>{this.hs=!1,t.Ki&&t.Ki.forEach(t=>{this.Ki.push({label:t,time:5e3})})}),st(12,t=>{this.Ni-=(t+1)/3,this.Ni=Math.round(3*this.Ni)/3,this.Ni=Math.round(10*this.Ni)/10,nt(t=>{const s=1e4;if(t>s)return 0;const i=(s-t)/s;return((2*Math.random()-1)*Math.sin(.003*t)*.6+Math.sin(t/(15+8*Math.sin(t/500)))*Math.exp(-t/2e3)*.4)*i*i*.3}),this.Ni>0||(this.Ni=0,it(19))}),st(13,()=>{this.Fi++,this.mi=this.Fi,this.eh(),it(14,this.Fi)}),st(11,()=>{this.eh()})}eh(){let s=0;for(let i=Math.floor(this.Ni)+1;9>=i;i++)t(()=>{this.Ni=i,nt(t=>{const s=6e3;if(t>s)return 0;var i=(s-t)/s;return.5*Math.sin(.01*t*Math.sin(.007*t+Math.sin(t/1200))+Math.sin(t/800))*i*i})},500+800*s++)}update(t){this.Ki.forEach(s=>s.time-=t)}ui(){return 4*this.Oi+this.Fi}}class Zt{constructor(t){this.ah=t,this.oh=null,this.nh=0,this.isActive=!1,this.rh=!1,this.currentState=null,this.uh="",this.fh=0,this.dh=0,this.Mh=20,this.wh=2,st(1,t=>{this.ph(t)})}ph(t){this.ah[t]&&(this.oh=t,this.currentState=t,this.nh=0,this.isActive=!0,this.rh=!1,this.jh())}update(t){if(!this.isActive||!this.oh)return;const s=e.H.get("Space"),i=s&&!this.rh;if(this.rh=s||!1,0===this.wh){this.dh+=t;const s=Math.floor(this.dh/1e3*this.Mh);this.uh.length>s?s>this.fh&&(this.fh=s,this.mh()):(this.fh=this.uh.length,this.wh=1,this.mh())}i&&this.gh()}gh(){if(this.oh){if(0===this.wh)return this.fh=this.uh.length,this.wh=1,void this.mh();1===this.wh&&(this.ah[this.oh].yh.length-1>this.nh?(this.nh++,this.jh()):this.Bh())}}mh(){const t=this.uh.substring(0,this.fh);it(3,t)}jh(){if(!this.oh)return;const t=this.ah[this.oh];t.Gs=!0,this.uh=t.yh[this.nh],this.fh=0,this.dh=0,this.wh=0,this.mh()}Bh(){if(!this.oh)return;const t=this.oh;this.isActive=!1,this.oh=null,this.currentState=null,this.nh=0,it(2,t)}}const zt={1:{yh:["Zzzzz...","Yawwwn...","How long was I sleeping?..."]},2:{yh:["Evil spirits?","Has the magic barrier failed\nwhile I slept??","This one seems weak.","I'll exorcise it and then\ngo check the barrier","> Use (space) to attack"],Ki:["find magic barrier obelisk"]},3:{yh:["I have no magic power left!","My magic comes from villagers\nworshiping me...","Something must be wrong with\nthe cat altar."],Ki:["repair the cat altar"]},6:{yh:["I don't have enough magic!","Something must be wrong with\nthe cat altars in the valley"]},4:{yh:["My magic has increased a little.","But the other altars...\nthey must be damaged too."],Ki:["repair all 5 altars","restore the forest magic barrier"]},5:{yh:["I feel myself getting stronger.","But I must continue until\nall altars are repaired."],Ki:["repair all 5 altars","restore the forest magic barrier"]},8:{yh:["Villagers are very superstitious.","I should not let them see me,\nthat will empower the evil spirits."]},7:{yh:["I have restored my full magic power","Now I am able to restore the\nmagic barrier again."],Ki:["restore the forest magic barrier"]},9:{yh:["The barrier is restored.","The altars are back online.","The spirits are resting in peace.","Time for a well deserved nap..."]}},Lt=()=>{it(6),it(18),$.st=.08};class Yt{constructor(){this.xh=new Zt({...zt}),st(2,s=>{it(5,zt[s]),1===s&&(Lt(),t(()=>{it(1,2)},3e3)),2===s&&it(9),9===s&&t(()=>it(22),3e3)}),st(1,()=>{it(4)}),st(15,()=>{it(1,zt[3].Gs?6:3)}),st(14,t=>{it(1,6>t?zt[4].Gs?5:4:7)}),st(16,()=>{zt[8].Gs||it(1,8)}),st(21,()=>{it(1,9)}),setTimeout(()=>{Lt(),it(9)},10)}update(t){this.xh.update(t)}}const Qt=new class{constructor(){this.startTime=0,this.bh=!1}async start(){this.bh||(this.Ah=new(window.AudioContext||window.webkitAudioContext),await this.Ah.resume(),await this.Ah.audioWorklet.addModule("music-worklet.js"),this.Hh=new AudioWorkletNode(this.Ah,"mp"),this.Hh.connect(this.Ah.destination),this.bh=!0)}Uh(){this.Hh?.port.postMessage(0)}pause(){this.Hh?.port.postMessage(1)}unpause(){this.Hh?.port.postMessage(2)}stop(){this.bh&&(this.Hh?.disconnect(),this.bh=!1)}};class Wt{constructor(){this.kh=!0,this.Ph=0,this.Ih=!0,this.Jh={x:0,y:0},this.Dh=0,this.Ch=!1,this.Vh=!1}Eh(){Qt.stop(),$.nt.clearRect(0,0,c4.width,c4.height),(()=>{for(const{Ct:t,Vt:s}of tt)document.removeEventListener(t,s);tt.length=0})()}Th(){this.kh&&Qt.start(),st(9,()=>{Qt.Uh()}),st(23,()=>{Qt.pause()}),st(24,()=>{Qt.unpause()}),st(19,()=>{Qt.stop(),$.nt.clearRect(0,0,$.K,$.O),t(()=>this.Vh=!0,1e3)}),st(22,()=>{this.Ih=!1,this.Jh={x:this.Jh.x,y:this.Jh.y-200},$.it=!0,this.C.$t=!0,this.Dh=0,this.Ch=!0,t(()=>h.Rh(Nt),1e4)}),st(20,()=>{Qt.pause(),this.map.xi.forEach((s,i)=>{t(()=>{this.Ih=!1,this.Jh={x:s.x,y:s.y},$.ft(this.Jh.x,this.Jh.y,5,!0),t(()=>{s.ds=S.L,s._s=-99,s.qs.forEach(t=>t.ls(t.Ws)),lt(i)},1e3)},2e3+2e3*i)}),t(()=>{this.Ih=!1;const s=this.map.Y;this.Jh={x:s.x,y:s.y},$.ft(this.Jh.x,this.Jh.y,5,!0);let i=3e3;t(()=>{s.ds=S.W;let i=0;t(()=>{lt(this.map.xi.length+i++)},250,4)},i),i+=1e3,t(()=>{s.pi()},i),i+=2*vt.animationDuration,t(()=>{Qt.unpause()},i),t(()=>{it(21)},i)},2e3+2e3*this.map.xi.length)}),this.Wt=new St,this.map=new It(160,160,this.Wt),this.C=new ut(60,85,this.map,this.Wt),this.actions=new Rt(this.map,this.C),this.Sh=new Et(this.map,this.C,this.actions,this.Wt),this.xh=new Yt,this.map.set(this.C.Pt,this.C.It,this.C),$.ft(this.C.x,this.C.y,20,!0),$.st=.01}Zh(i){if(this.Ih?($.ft(this.C.x,this.C.y,5+this.Ph+(9-this.Wt.Ni)/9),this.Jh={x:this.C.x,y:this.C.y}):($.st=.01,$.ft(this.Jh.x,this.Jh.y,7)),$.dt(),this.Wt.Ni>0&&(this.Wt.hs||this.actions.update(),this.map.update(i,this.Wt.hs),this.Sh.update(i),this.Wt.update(i)),this.xh.update(i),s(i),this.Wt.Ni>0&&!this.Wt.hh?(this.map.draw($.G,$.q),this.Sh.draw()):(this.Wt.Ni>0&&this.Sh.draw(),this.C.ts(i),this.C.draw(),this.Vh&&($.lt("You ran out of lives",$.K/2,3*$.O/4,v,1,0,5,1,$.ot),$.lt("> Press space",$.K/2,3*$.O/4+40,d,1,0,5,1,$.ot),e.B&&e.U.B&&(this.Vh=!1,t(()=>h.Rh(Nt),1e3)))),this.Ch){this.Dh+=i;const t=Math.min(255,Math.floor(this.Dh/4e3*255)).toString(16).padStart(2,"0");$.ot.fillStyle=u+t,$.ot.fillRect(0,0,$.K,$.O)}$.Mt()}}const $t=new Mt(0),Nt=new class{constructor(){this.Ks=0,this.zh=!1}Zh(t){this.Ks+=t,(()=>{const t=[g,m,j,p,w],s=Math.ceil(c2.height/t.length),i=c2.width/32;for(let h=0;32>h;h++){const e=10*Math.round(16*Math.sin(1-8*Math.PI*h/32)/10);t.forEach((t,a)=>{$.ht.fillStyle=t,$.ht.fillRect(i*h,e+s*a-20,Math.ceil(c2.width/32),s)})}const h=c2.width/22,e=c2.height/2/22,a=S.oak,o=S.spruce;if(a){for(let t=0;h+32>=t;t++)for(let s=e*(1.2-Math.cos(t/h*2*Math.PI));s>0;s--){const i=5*Math.sin(12*Math.PI*(s/e));$.ut(.2+$t.next()>s/e?a:o,22*t+i-16,c2.height-(22*s+.7*$t.next())/2,!1,32,32)}$t.ps=0}})();const s=$.et.canvas.width/2;$.lt("Meow Mountain",s,100,w,1,0,15),$.lt("Press Enter to start",s,230,k,1,0,4),$.lt("Press F to toggle fullscreen",s,280,g,1,0,4),this.Lh()}Lh(){e.j&&!e.U.j&&h.Rh(new Wt);const t=!!e.H.get("KeyF");t&&!this.zh&&(document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()),this.zh=t}};document.querySelector('link[type="image/x-icon"]').href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='85'%3E💜%3C/text%3E%3C/svg%3E";let Ft=0,Kt=!1;window.addEventListener("blur",()=>{it(23),Kt=!0}),window.addEventListener("focus",()=>{it(24),Kt=!1}),h=new class{constructor(t,...s){this.currentState=t,this.currentState.Th?.(...s)}Rh(t,...s){this.currentState.Eh?.(),this.currentState=t,this.currentState.Th?.(...s)}getState(){return this.currentState}}(Nt,...[]),setInterval(t=>{if(Kt)return;let i=(t=performance.now())-Ft;if(Ft=t,i>1e3)return;$.clear();const a=h.getState();e.P(),a.Zh(i),s(i)},16);
//# sourceMappingURL=index-BFlj8tuc.js.map
