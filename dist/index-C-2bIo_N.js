function t(t,s,i=0,h=0){Y.push({t,time:s,i:s+h,repeat:i})}function s(t){for(let s=Y.length-1;s>=0;s--){const i=Y[s];if(!i)return;i.i-=t,i.i>0||(i.t(),i.repeat-- >0?i.i=i.time:Y.splice(s,1))}}function i(t,s){for(const i of["x","y"])if(t[i]!==t.h[i]){const h=t.h[i]-t[i],e=Math.sign(h)*t.speed*s/1e3;Math.abs(h)>Math.abs(e)?t[i]+=e:t[i]=t.h[i]}else t.o[i]=0,t[i]=Math.round(t[i])}let h;const e=new class{constructor(){this.l=!1,this.u=!1,this.M=!1,this.p=!1,this.m=!1,this.U=!1,this.A=!1,this.v=new Map,this.C={l:this.l,u:this.u,m:this.m,U:this.U},document.addEventListener("keydown",t=>this.k(t,!0)),document.addEventListener("keyup",t=>this.k(t,!1)),this.I=new DOMPoint}P(){this.C.l=this.l,this.C.u=this.u,this.C.m=this.m,this.C.U=this.U;const t=this.v.get("KeyA")||this.v.get("KeyQ")||this.v.get("ArrowLeft")?-1:0,s=this.v.get("KeyD")||this.v.get("ArrowRight")?1:0,i=this.v.get("KeyW")||this.v.get("KeyZ")||this.v.get("ArrowUp")?-1:0,h=this.v.get("KeyS")||this.v.get("ArrowDown")?1:0;this.I.x=t+s||0,this.I.y=i+h||0,this.l=0>this.I.y,this.u=this.I.y>0,this.M=0>this.I.x,this.p=this.I.x>0,this.A=0!==this.I.x||0!==this.I.y,this.m=!!this.v.get("Enter"),this.U=!!this.v.get("Space")}k(t,s){this.v.set(t.code,s)}},a=t=>t.getContext("2d"),o=(t,s)=>{const i=((t,s)=>{const i=document.createElement("canvas");return t&&(i.width=t),s&&(i.height=s),i})(t,s);return[i,a(i)]},n=(t,s,i,h)=>128>h?[0,0,0,0]:[51*Math.round(t/51),51*Math.round(s/51),51*Math.round(i/51),255],r=(t,s=10)=>{const i=Math.floor(1.25*s),h=Math.floor(.25*s/2),[e,a]=o(i,i);a.font=s+"px sans-serif",a.textBaseline="top",a.clearRect(0,0,i,i),a.translate(-1,0),a.fillText(t,h,h);const r=a.getImageData(0,0,i,i).data,c=a.createImageData(i,i),l=c.data;for(let t=0;r.length>t;t+=4){const[s,i,h,e]=n(r[t],r[t+1],r[t+2],r[t+3]);l[t]=s,l[t+1]=i,l[t+2]=h,l[t+3]=e}const[u,f]=o(i,i);f.putImageData(c,0,0);const d=new Image;return d.src=u.toDataURL(),d},c=(t,s)=>{const i="#FF00FF",h=[i,...s],e=h.length>4?2:h.length>2?3:6,a=6/e,o=(1<<a)-1,n=document.createElement("canvas"),r=Math.sqrt(t.length*e);n.setAttribute("width",""+r),n.setAttribute("height",""+r);const c=n.getContext("2d"),l=c.createImageData(r,r),u=l.data;let f=0;[...t].map(t=>{const s=t.charCodeAt(0);for(let t=0;e>t;t++){const e=s>>t*a&o,n=(h[e]||i).replace("#",""),r=parseInt(n.substring(0,2),16),c=parseInt(n.substring(2,4),16),l=parseInt(n.substring(4,6),16),d=e?255:0;u[f]=r,u[f+1]=c,u[f+2]=l,u[f+3]=d,f+=4}}),c.putImageData(l,0,0);const d=new Image;return d.src=n.toDataURL(),d};class l{constructor(t){this.j=t,this.D={},this.H=16;for(const[s,i]of Object.entries(t.data))this.D[s]=i.map(s=>c(s,t.palette));this.H=t.size}}const u="#75a080",f="#618e70",d="#4d7c60",M="#396a50",w="#b4ecf3",p="#4e9ca6",y="#3e8791",m="#2f6269",g="#255056",x="#1f4347",b="#13282b",U="#e0b8d3",A="#714162",v="#996a8a",C="#f2daab",k="#e6a386",I="#13282b",P="#fffef9",j={size:10,frames:4,palette:[I],data:{0:["@@@`@PJbcxpO|AQ@@","@@@`@DJbcxpO|AQ@@","@@@@h@nag|pG|AQ@@","@@@@@@z`SxxO|AQ@@"],1:["@@@`@DJbcxpO|AR@@","@@@P@HJdCy`OpC`@@","@@@@@DJbCy`OxCR@@","@@@H@DJbcxpO|AA@@"],2:["@@@@@@@`ZxyO~@B@@","@@@@@@J`_|xG~@E@@","@@@@@@@`ZxyO~PB@@","@@@@@@J`CxG~@D@@"],3:["@@@@AHJdCy`OxCb@@","@@@@@@jcC`C@@@@@","@@@@@@@@@x|oxG@@@","@@@@@@@@@@@N~yC@"],4:["@@@`@DJbcxpO|AQ@@","@@@@@BPhHN|Ka@@@","@@@D@BEqQ\\xG~`P@@","@@@P@DJbcxpO|AQ@@"],5:["@`@H@F`Wy_~GsPD@@","@`@H@B`Qy_~GwPD@@","@`@H@F`Wy_~GsPD@@","@`@H@B`Qy_~GwPD@@"],6:["@@@@@@@@@h~_~K@@@","@@@@@@@`Bx~_~E@@@","@@@@@@@`Bx}o~A@@@","@@@@@@@@@h|~C@@@"]}},E={size:8,frames:4,palette:[U,b],data:{0:["PUAUUQVVTUEUUajj`@B@`@","@@@TUPUUdeEUUQUUhjJH`@","PUAUUQVVTUEUUajj`@BH@@","@@@TUPUUdeEUUQUUhjJH`@"],1:["@@@TUPUUTfEiiQUUhjJH`@","@@@UETUEeYQZZTUEjjBBH@"]}},D={palette:[y,m,g],data:"@@@@@@@DD@@@`e@@@@jB@@@hJ@@@@O@@@@}A@@@xK@@@`o@@@p~N@@T{{E@TmoWAPUUUE@WUUu@|C@C@"},H={palette:[y,m,g],data:"@PUE@@`UUB@@VUI@@xo@@poC@@kjN@@l{@@p~C@@kjN@@|o@@p{~C@@{O@@|k@@pC@@|C@@@@@@@"},T={palette:[M,u,"#b3d7ad",d],data:"@@@@@@@@@@HIIA@@@@Q[[J@@@HZ[[SA@@QR[[RJ@@QRRRRJ@@aRRRRL@@QTRRbJ@@abbTTL@@aTTbbL@@IddddI@@HaddLA@@@HIIA@@@@HIIA@@@@@II@@@@@@@@@@@"},B={palette:[m,w,p,y],data:"@@@HA@@@@@@QJ@@@@@HRRA@@@@YSZK@@@H[[[[A@@H[[[[A@@a\\[[cL@@acc\\\\L@@a\\\\ccL@@adc\\dL@@IddddI@@HaddLA@@@HIIA@@@@HIIA@@@@@II@@@@@@@@@@@"},R={palette:[f,d,M],data:"PPDDAP^feYTvVVYfweYZi]YfeiMgVvYv|Vvey`YZYvCfeiiCYZVfE\\wYZ[qWvefFle]fvPVfuY@g[dCpsCpC@"},Q={palette:[g,y,m],data:"PU@@@PjVUU@YyGdjWU]PkAm^UUGt_PWUUuA}GTUUUUpjjjjC[_ZUNlk}ypvgVgCkjZ_N|}}@"},J={palette:[f,d],data:"@@@@@@D@@A@D@DA@DY@@PjEDA@@@@@A@@@@@@@@QQ@AdF@Pi"};"🔥,🍀,🌼,🐓,🌷,🌹,👻,🥚,🍎".split(",").map(t=>r(t));class S{static initialize(){S.T=new l(j),S.B=new l(E),S.R=((t=A)=>{const[s,i]=o(16,16);i.clearRect(0,0,16,16),i.fillStyle=t,i.fillRect(0,0,1,1),i.fillRect(1,0,1,1),i.fillRect(0,1,1,1),i.fillRect(14,0,1,1),i.fillRect(15,0,1,1),i.fillRect(15,1,1,1),i.fillRect(0,14,1,1),i.fillRect(0,15,1,1),i.fillRect(1,15,1,1),i.fillRect(15,14,1,1),i.fillRect(14,15,1,1),i.fillRect(15,15,1,1);const h=new Image;return h.src=s.toDataURL(),h})(),S.oak=c(T.data,T.palette),S.spruce=c(B.data,B.palette),S.house=c(Q.data,Q.palette),S.J=c(R.data,R.palette),S.S=c(J.data,J.palette),S.statue=c(D.data,D.palette),S.O=c(H.data,H.palette)}}const O="6v7ic,6trd0,6to3o,6nvic,55eyo,2np50,2jcjo,3ugt8,34ao,7k,glc,1,opzc,3xdeu,3sapz,8rhfz,8ri26,1bzky,9j1ny,3ws2u,9dv9k,3xb1i,3xbmu,2t8g,2t8s,26ndv,ajmo,fl5ug,3x7nm,n75t,54br,59u0e,53if,rlev,4jrb,1yjk4,4eav,55q95,18zsz,mi3r,574tl,1aedd,ljn9,a1bd,4f1i,a1fs,549t,53ig,5832,1dwsh,6iw6,6ix0,cbsa,6gix,6fk4,aky7,7mbws,cvtyq,deehh,2sfi3".split(","),z={},V="]",W=t=>{if("0"===t)return{V:"0".repeat(25),W:0,G:5};const s=(parseInt(t,36).toString(2)+"").padStart(25,"0");let i=5,h=-1;for(let t=0;5>t;t++)for(let e=0;5>e;e++)"1"===s[5*e+t]&&(i=Math.min(i,t),h=Math.max(h,t));return{V:s,W:i,G:i>h?1:h-i+1}},G=(t,s,i,h,e,a=0)=>{for(let o=-e;e>=o;o++){const n=o/e,r=Math.round(h*Math.sqrt(1-n*n));if(r>0){const h=Math.round(a*Math.abs(o));t.rect(0>o?s-r+h:s-r-h,i+o,2*r,1)}}};class L{constructor(){this.L=0,this.F=0,this.Y=0,this.$=0,this.zoom=1,this.N=0,this.Z=0,this.K=1,this._=.08,this.q=a(c1),this.X=a(c2),this.tt=a(c3),this.st=a(c4),S.initialize(),this.it(),window.addEventListener("resize",()=>this.it()),window.addEventListener("orientationchange",()=>this.it())}it(){this.L=1200,this.F=900;const t=[this.q,this.X,this.tt,this.st];for(const s of t)s.canvas.width=1200,s.canvas.height=900,s.imageSmoothingEnabled=!1}ht(t,s,i,h,e,a,o){t.save(),t.beginPath(),G(t,s,i,h,e),G(t,s,i,h-o,e-o),t.clip("evenodd"),t.beginPath(),t.fillStyle=a,t.fillRect(s-h,i-e,2*h,2*e),t.fill(),t.restore()}et(t,s,i,h,e=0,a=0,n=2,r=1,c){((t,s,i,h,e=P,a=0,n=0,r=2,c=1)=>{i=Math.round(i),h=Math.round(h),s||(s=" ");const l=c*r,u=s.replace("!","@").toUpperCase().split("");let f=0;const d=[];u.forEach((t,s)=>{const i=(h=" "===t?"0":O[t.charCodeAt(0)-35],W(h).G*r);var h;d.push({char:t,x:f,G:i}),f+=i+(u.length-1>s?l:0)});const M=5*r,w=0===a?0:1===a?Math.round(f/2):f,p=0===n?0:1===n?Math.round(M/2):M;d.forEach(({char:s,x:a,G:n})=>{if(" "===s)return;const c=((t,s,i)=>{const h=`${t.charCodeAt(0)}-${i}-${s}`;return z[h]||(z[h]=((t,s,i)=>{const h=" "===t?"0":O[t.charCodeAt(0)-35],{V:e,W:a,G:n}=W(h),r=n*s,c=5*s,[l,u]=o(r,c),[f,d,M,w]=i.replace(/^#?([a-f\d])([a-f\d])([a-f\d])([a-f\d])$/i,(t,s,i,h,e)=>"#"+s+s+i+i+h+h+e+e).substring(1).match(/.{2}/g).map(t=>parseInt(t,16)),p=`rgba(${f}, ${d}, ${M}, ${(w||255)/255})`;return e.split("").forEach((t,i)=>{if("0"!==t){const t=i%5,h=Math.floor(i/5);if(a>t)return;const e=t-a;u.fillStyle=p,u.fillRect(e*s,h*s,s,s)}}),l})(t,s,i)),z[h]})(s,r,e);t.drawImage(c,0,0,n,M,i-w+a,h-p,n,M)})})(c||this.q,t,s,i,h,e,a,n,r)}static drawImage(t,s,i,h,e,a,o){e&&(t.save(),t.scale(-1,1),i=-i-(a??s.width)),t.drawImage(s,i,h,a??s.width,o??s.height),e&&t.restore()}ot(t,s,i,h,e,a){L.drawImage(this.q,t,s,i,h,e,a)}nt(t,s,i=1,h=!1){this.N=t,this.Z=s,this.K=i,this.q.setTransform(this.zoom,0,0,this.zoom,this.L/2-32-this.Y*this.zoom,this.F/2-64-this.$*this.zoom),h&&(this.Y=t,this.$=s,this.zoom=i)}rt(){this.Y+=(this.N-this.Y)*this._,this.$+=(this.Z-this.$)*this._,this.zoom+=(this.K-this.zoom)*this._}ct(){this.q.setTransform(1,0,0,1,0,0)}clear(){this.ct(),this.q.clearRect(0,0,this.L,this.F),this.q.fillStyle=u,this.q.fillRect(0,0,this.L,this.F),this.X.clearRect(0,0,this.L,this.F),this.tt.clearRect(0,0,this.L,this.F)}lt(t,s,i=7){return{x:this.L/2-32+(t-this.Y)*i,y:this.F/2-64+(s-this.$)*i}}}const F=new L;let Y=[];const $=12,N=12,Z=20,K=[[[69,100,3],[76,113,4],[89,114,5],[104,86,3],[99,59,3],[85,46,2],[86,28,2],[74,38,2],[60,39,2],[48,30,2],[46,43,2],[38,61,3],[50,73,4],[38,84,3],[46,123,3],[36,133,2],[48,141,3],[94,133,4],[113,109,5],[122,74,6],[113,56,.9]],[[45,49,.9],[71,51,.9]],[[119,54,1],[129,29,1]]],_=[{x:64,y:88,r:6},{x:75,y:88,r:6},{x:69,y:95,r:6},{x:129,y:28,r:10},{x:71,y:51,r:3}],q={ut:{x:76,y:84,name:"heart"},ft:{x:129,y:19,name:"moon"},dt:{x:49,y:29,name:"ear"},eye:{x:71,y:50,name:"eye"},Mt:{x:35,y:131,name:"foot"},wt:{x:114,y:56,name:"tail"}};class X{constructor(t,s,i,h,e,a=0,o=!1){this.yt=t,this.x=s,this.y=i,this.type=h,this.animation=e,this.speed=a,this.gt=o,this.xt=0,this.bt=0,this.Ut=150,this.At=!0,this.o={x:0,y:0},this.vt=Math.ceil(s/$),this.Ct=Math.ceil(i/N),this.xt=Math.random()*this.Ut,this.h={x:this.x,y:this.y}}kt(t,s){this.vt=t,this.Ct=s,this.x=t*$,this.y=s*N,this.h={x:this.x,y:this.y}}update(t){(this.At||this.bt!==this.yt.D[this.animation].length-1)&&(this.xt+=t,this.bt=Math.floor(this.xt/this.Ut)%this.yt.D[this.animation].length)}It(t){i(this,t),0!==this.o.x&&(this.gt=0>this.o.x)}draw(){const t=this.yt.D[this.animation];t[this.bt]&&F.ot(t[this.bt],this.x-(this.yt.H-$)/2,this.y-(this.yt.H-N)/2,this.gt)}}const tt=(t,s)=>{document.addEventListener(t+"",t=>{s(t.detail)})},st=(t,s)=>{document.dispatchEvent(new CustomEvent(t+"",{detail:s}))},it=(t,s,i,h)=>{const e=[];let a,o=Math.abs(i-t),n=i>t?1:-1,r=-Math.abs(h-s),c=h>s?1:-1,l=o+r;for(;e.push([t,s]),t!==i||s!==h;)a=2*l,r>a||(l+=r,t+=n),a>o||(l+=o,s+=c);return e};class ht{constructor(t,s,i,h,e=Math.PI/2,a=12,o=0,n=0,r=300,c=16,l=0,u=1,f=!0){this.Pt=t,this.jt=h,this.Et=e,this.radius=a,this.offset=o,this.Dt=n,this.speed=r,this.Ht=c,this.Tt=l,this.Bt=u,this.active=f,this.cx=s+6,this.cy=i+6;const d=((t,s,i,h)=>{const e=[];for(let a=0;5>a;a++){const o=2*Math.PI*(2*a%5)/5-Math.PI/2+i;e.push([Math.round(t+h*Math.cos(o)),Math.round(s+h*Math.sin(o))])}return e})(this.cx,this.cy,e,a);this.Rt=[];for(let t=0;5>t;t++){const[s,i]=d[t],[h,e]=d[(t+1)%5];this.Rt.push(...it(s,i,h,e))}this.Qt=this.Rt.length*this.Bt*1e3/this.speed}update(t){if(!this.active)return;const s=Math.floor(this.Dt/1e3*this.speed)%this.Rt.length;if(this.offset>s&&(this.Tt++,this.Tt>=this.Bt))return this.active=!1,void this.jt();this.offset=s,this.Dt+=t}draw(){if(!this.active)return;this.Pt.fillStyle=P;const t=Math.min(this.Ht,this.offset);for(let s=0;t>s;s++){const t=(this.offset-s+this.Rt.length)%this.Rt.length,[i,h]=this.Rt[t];this.Pt.fillRect(i,h,1,1)}}isActive(){return this.active}}const et=(t,s,i,h=!1)=>{for(let e=-1;1>=e;e++)for(let a=-1;1>=a;a++)(h||0!==e||0!==a)&&i(t+a,s+e)};let at=null;const ot=t=>{at||(at=new AudioContext);const s=at.createBuffer(1,96e3,48e3),i=s.getChannelData(0);for(let s=96e3;s--;)i[s]=t(s);const h=at.createBufferSource();h.buffer=s,h.connect(at.destination),h.start()},nt=(t=1)=>ot(s=>{const i=2e3*t;return s>i?0:.15*(2*Math.random()-1)*Math.sin(Math.PI*s/i)}),rt=t=>ot(s=>Math.sin(s/(21-t)+5*Math.sin(s/2e3))*Math.exp(-s/4e3)*(s/96e3)*9);class ct extends X{constructor(s,i,h,e){super(S.T,s*$,i*N,"cat",6,80),this.map=h,this.Jt=e,this.type="cat",this.St=!0,this.Ot=!1,this.zt=!1,this.Vt=!1,this.Wt=null,this.Gt=0,this.Ut=600,this.map.Lt={vt:s+1,Ct:i},tt(7,()=>{this.kt(q.ut.x,q.ut.y+1)}),tt(6,()=>{this.St=!1,this.Ut=150}),tt(12,()=>{this.zt=!0,this.Ut=75,t(()=>{this.Ut=150,this.zt=!1},600)}),tt(19,()=>{this.animation=3,this.xt=0,this.Ut=600,this.At=!1})}update(s){if(super.update(s),3===this.animation)return;2==this.animation?(this.Gt-=s,this.Gt>0||(nt(),this.Gt=200)):this.Gt=0;const i=this.map.grid[this.Ct][this.vt].Ft;if(!this.Vt&&i?(this.Vt=!0,st(10,i)):this.Vt&&!i&&(this.Vt=!1),coords.innerText=`${this.vt},${this.Ct}`,!this.Jt.Yt){if(this.zt&&!this.$t())this.animation=5;else if(this.St)this.animation=6;else if(this.Ot)this.animation=4;else{if(super.It(s),!this.o.y&&e.I.y){const t=this.Ct+e.I.y;this.map.grid[t][this.vt].content||(this.animation=2,this.o.y=e.I.y,this.h.y+=e.I.y*N,this.Ct=t),this.map.Lt={vt:this.vt,Ct:this.Ct+e.I.y}}if(!this.o.x&&e.I.x){this.gt=e.M;const t=this.vt+e.I.x;this.map.grid[this.Ct][t].content||(this.animation=2,this.o.x=e.I.x,this.h.x+=e.I.x*$,this.vt=t),this.map.Lt={vt:this.vt+e.I.x,Ct:this.Ct}}this.o.x||this.o.y||(this.animation=0),this.Ot||this.Nt(),this.Ot||!e.U||e.C.U||(this.Ot=!0,this.xt=0,!this.Wt&&this.$t()?this.Wt=new ht(F.q,this.x,this.y,()=>{this.Wt=null,this.Zt(),this.Ot=!1,ot(t=>t>29e3?0:.2*(t>17400?Math.pow(.9999,t-17400):1)*Math.sin(t/(30-5*Math.sin(5*Math.round(5*t/29e3)))+Math.random())*(8e3-t%6e3)/5e3)}):(t(()=>this.Kt(),500),t(()=>{this.Ot=!1},5*this.Ut)))}this.Wt?.update(s)}}Zt(){et(this.vt,this.Ct,(t,s)=>{const i=this.map.grid[s][t];"spirit"===i.content?.type&&i.content._t(5)})}$t(){let t=0;return et(this.vt,this.Ct,(s,i)=>{const h=this.map.grid[i][s];"spirit"===h.content?.type&&t++}),t>=3}draw(){super.draw(),this.Wt?.draw()}Nt(){const t=this.map.qt();if(t?.content)return;const s=[{vt:this.vt+1,Ct:this.Ct,Xt:"right"},{vt:this.vt-1,Ct:this.Ct,Xt:"left"},{vt:this.vt,Ct:this.Ct+1,Xt:"down"},{vt:this.vt,Ct:this.Ct-1,Xt:"up"}];let i=null,h=null,e=null,a=null;for(const t of s){const s=this.map.grid[t.Ct][t.vt];if(!s.content)continue;const o=s.content.type;if("spirit"===o){i={vt:t.vt,Ct:t.Ct},e=t.Xt;break}"statue"!==o&&"obelisk"!==o||h||(h={vt:t.vt,Ct:t.Ct},a=t.Xt)}i?(this.map.Lt=i,"left"===e?this.gt=!0:"right"===e&&(this.gt=!1)):h&&(this.map.Lt=h,"left"===a?this.gt=!0:"right"===a&&(this.gt=!1))}Kt(){const t=this.map.qt();t.content&&"spirit"===t.content.type?(t.content._t(1),ot(t=>{if(t>1e4)return 0;const s=5*Math.sin(5*Math.round(5*t/1e4));return.2*Math.pow(.998,t/10)*Math.sin(t/(40-s)+Math.random())*(8e3-t%6e3)/5e3})):t.content&&"field"===t.content.type&&(t.content=null,nt(3))}}class lt{constructor(t,s,i,h){this.ts=t,this.x=s,this.y=i,this.type=h,this.vt=Math.ceil(s/$),this.Ct=Math.ceil(i/N),this.offsetX=s-Math.round((t.width-$)/2),this.offsetY=i-Math.round((t.height-N)/2)}draw(){F.ot(this.ts,this.offsetX,this.offsetY)}}class ut extends lt{constructor(t,s,i){super(S[i],t,s,i),this.x=t,this.y=s,this.ss={top:!1,bottom:!1,left:!1,right:!1}}hs(t){this.ss=t}draw(){this.ss.right&&F.ot(this.ts,Math.round(this.offsetX+6),this.offsetY-6),super.draw()}}class ft{constructor(t=47){this.es=t}next(){return this.es=(9301*this.es+49297)%233280,this.es/233280}range(t,s){return t+this.next()*(s-t)}}class dt extends lt{constructor(t,s,i=""){super(S.house,t*$,s*N,"house"),this.name=i}}class Mt extends X{constructor(t,s,i){super(S.B,t*$,s*N,"villager",0,10),this.map=i,this.ns=null,this.rs=0,this.cs=1e3,this.ls=!1}update(t){super.update(t),this.rs+=t,this.us()?(this.ls||this.cs>this.rs||(this.rs=0,this.ls=!0),t>this.rs%(this.cs/5)&&st(16),this.animation=1,this.Ut=50):(this.ls=!1,this.Ut=150,this.cs>this.rs||(this.fs(),this.rs=0),this.It(t))}fs(){const t=[{x:0,y:-1},{x:0,y:1},{x:1,y:0},{x:-1,y:0}];if(this.ns&&.8>Math.random()){const t=this.vt+this.ns.x,s=this.Ct+this.ns.y;if(this.ds(t,s))return this.vt=t,this.Ct=s,this.h={x:t*$,y:s*N},this.ns=this.ns,void(this.animation=0)}for(let s=0;10>s;s++){const s=t[Math.floor(4*Math.random())],i=this.vt+s.x,h=this.Ct+s.y;if(this.ds(i,h))return this.vt=i,this.Ct=h,this.h={x:i*$,y:h*N},this.ns=s,void(this.animation=0)}}ds(t,s){return null===this.map.grid[s][t].content}us(){if(!this.ns)return!1;for(let t=1;2>=t;t++){const s=this.vt+this.ns.x*t,i=this.Ct+this.ns.y*t,h=this.map.grid[i]?.[s];if("cat"===h?.content?.type)return!0}return!1}}class wt extends lt{constructor(t,s){super(S.J,t*$,s*N,"field")}}class pt{constructor(t,s,i,h,e){this.name=t,this.Ms=s,this.radius=i,this.ws=h,this.ps=e,this.ys=[],this.gs=[],this.xs=[],this.Ms=s,this.radius=i}bs(t,s,i){let h,e;do{const s=t.range(0,2*Math.PI),i=t.range(1,this.radius-1);h=Math.round(this.Ms.x+Math.cos(s)*i),e=Math.round(this.Ms.y+Math.sin(s)*i)}while(0>h||0>e||null!==i.get(h,e)?.content||s.some(t=>t.x===h&&t.y===e));return{x:h,y:e}}Us(t,s){for(let i=0;this.ws>i;i++){const i=this.bs(t,this.ys,s);this.ys.push(new dt(i.x+i.x%2,i.y+i.y%2))}return this.ys}As(t,s){const i=this.ws;for(let h=0;i>h;h++){const i=this.bs(t,this.gs,s);for(let t=0;2>t;t++)for(let s=0;2>s;s++)this.gs.push(new wt(i.x+t,i.y+s))}return this.gs}vs(t,s){for(let i=0;this.ps>i;i++){const i=this.bs(t,this.gs,s);this.xs.push(new Mt(i.x,i.y,s))}return this.xs}}class yt{constructor(t,s,i,h){this.icon=t,this.vt=s,this.Ct=i,this.type=h,this.x=Math.round(this.vt*$+($-this.icon.width)/2),this.y=Math.round(this.Ct*N+(N-this.icon.height)/2)}draw(){F.ot(this.icon,this.x,this.y)}}const mt=[{x:0,y:-1},{x:0,y:1},{x:1,y:0},{x:-1,y:0}],gt=(t,s)=>`${t},${s}`,xt=(t,s,i)=>{const h=[];let e=i;for(;e!=s;)h.unshift(e),e=t[gt(e.vt,e.Ct)];return h.unshift(s),h},bt=[p,y,v,A],Ut=(t,s,i,h,e=bt)=>{const a=Math.ceil(12*Math.max(0,Math.min(1,t/s))),o=i,n=h-5;F.q.fillStyle=e[0],F.q.fillRect(o,n,a,1),F.q.fillStyle=e[1],F.q.fillRect(o,n+1,a,1),F.q.fillStyle=e[2],F.q.fillRect(o+a,n,12-a,1),F.q.fillStyle=e[3],F.q.fillRect(o+a,n+1,12-a,1)},At=["☁️","🥨","🌵","🧚🏻‍♀️","🦀","👻","👹","🧿","💀"].reduce((t,s,i)=>(t[s]={icon:r(s),type:s,level:Math.ceil(i/2)},t),{});class vt extends yt{constructor(t,s,i,h){super(At[i].icon,t,s,"spirit"),this.Ut=2e3,this.xt=0,this.opacity=0,this.Cs=9,this.rs=0,this.cs=600,this.o={x:0,y:0},this.speed=20,this.ks=!1,this.Is=!1,this.state=0,this.Ps=0,this.js=1e3,this.Es=null,this.Ds=0,this.Hs=0,this.species=At[i],this.map=h,this.h={x:this.x,y:this.y},this.Ts=Math.round(Math.pow(1.5,this.species.level+1)),this.Bs=this.Ts}update(t){if(this.Bs>0)switch(this.xt+=t*Math.pow(this.species.level+.5,2),1>this.opacity&&(this.opacity+=t/this.Ut),this.Ut>this.xt||(this.xt-=this.Ut),this.state){case 0:case 1:i(this,t);const s=this.Rs();s&&(this.rs+=t,this.cs>this.rs||(this.Qs(s),this.rs=0));break;case 2:case 3:case 4:this.Js(t)}}Js(t){this.Ps+=t;const s=this.Ps/this.js;if(!this.Es)return void(this.state=0);const i=this.Es.vt-this.vt,h=this.Es.Ct-this.Ct;if(.7>s){2!==this.state&&(this.state=2);const t=s/.7;this.Ds=-i*t*3,this.Hs=-h*t*3}else if(.73>s){3!==this.state&&(this.state=3);const t=(s-.7)/.03;this.Ds=i*($*t-3),this.Hs=h*($*t-3)}else if(1>s){if(4!==this.state){this.state=4;const t=this.map.grid[this.Es.Ct][this.Es.vt];"cat"===t.content?.type&&st(12,this.species.level)}const t=(s-.73)/.27;this.Ds=3*i*(1-t),this.Hs=3*h*(1-t)}else this.state=0,this.Ps=0,this.Es=null,this.Ds=0,this.Hs=0}Rs(){for(let t=-this.Cs;this.Cs>=t;t++)for(let s=-this.Cs;this.Cs>=s;s++){const i=this.vt+t,h=this.Ct+s,e=this.map.grid[h][i];if("cat"===e.content?.type)return{vt:i,Ct:h}}return null}Qs(t){const s=((t,s,i,h=100)=>{let e=h;const a=[s],o=new Set,n={};for(;0!==a.length&&e--;){const h=a.shift();if(h.vt===i.vt&&h.Ct===i.Ct)return xt(n,s,i);mt.map(({x:s,y:i})=>t[h.Ct+i][h.vt+s]).forEach(t=>{o.has(t)||(o.add(t),(null===t.content||t.x==i.vt&&t.y==i.Ct)&&(n[gt(t.x,t.y)]=h,a.push({vt:t.x,Ct:t.y})))})}})(this.map.grid,{vt:this.vt,Ct:this.Ct},t);if(s&&s.length>2){this.state=1;const t=s[1];h=t.Ct,(i=this).h.x=t.vt*$,i.h.y=h*N,this.vt=t.vt,this.Ct=t.Ct,this.h.x=t.vt*$,this.h.y=t.Ct*N}else 2===s?.length&&(this.state=2,this.Es=s[1],this.Ps=0);var i,h}draw(){const t=Math.sin(this.xt/this.Ut*2*Math.PI);F.q.save(),F.q.globalAlpha=this.opacity,F.q.fillStyle=`rgba(0,0,0,${Math.round(2+1*t)/10})`,F.q.fillRect(this.x+3+this.Ds,this.y+9+this.Hs,this.icon.width-6,4),this.Ts>this.Bs&&Ut(this.Bs,this.Ts,this.x,this.y),F.q.save(),this.Is&&(F.q.filter="sepia(1) saturate(2) hue-rotate(260deg) brightness(0.7)"),F.q.translate(this.Ds,this.Hs+Math.round(2*(t-1))),super.draw(),F.q.restore(),F.q.restore()}_t(s=1){return this.Bs-=s,this.Is=!0,t(()=>{this.Is=!1},150),this.Bs>0||t(()=>{(()=>{const t=~(1e3*Math.random());ot(s=>Math.sin(s/(10+s/8e3-s/12e3)&t+5*Math.sin(s/2e3))*Math.exp(-s/4e3)*(s/96e3)*9)})(),this.ks=!0},1500),0>=this.Bs}}class Ct extends lt{constructor(t,s,i,h,e){super(S.statue,t*$,s*N,"statue"),this.map=i,this.Jt=h,this.name=e,this.Ss=[],this.Os=4,this.zs=0,this.Vs=1e3,this.Ws=.1,this.Gs=10,this.Ls=0,this.state=Ct.Ys.Fs,this.xt=0,this.$s=1500,this.Ns=0,this.Zs=!1,this.Ks=0,this.Ut=800}_s(t){this.xt+=t}update(t){if(this.zs+=t,this.state!==Ct.Ys.Fs||Z>this.Ls?this.state===Ct.Ys.qs&&(this.Ns+=t,this.Ns>this.$s&&(this.state=Ct.Ys.Xs)):(this.state=Ct.Ys.qs,this.Zs=!1,this.Ks=0),this.zs>=this.Vs&&(this.zs=0,Math.random()<this.Ws))if(this.Ss.length<this.Os+this.Jt.ti())this.si();else if(this.Ss.length>0){const t=this.Ss.filter(t=>t.Bs===t.Ts)[Math.round(Math.random()*this.Ss.length-1)];t&&(t.ks=!0,this.si())}this.Ss=this.Ss.filter(t=>!t.ks)}draw(){super.draw(),this.Ls>0&&Z>this.Ls&&Ut(this.Ls,Z,this.x,this.y,[C,k,x,b]),this.state===Ct.Ys.Xs&&this.ii()}hi(){this.state===Ct.Ys.qs&&this.ei()}ii(){F.q.fillStyle=U;for(let t=0;5>t;t++){const s=(this.xt+.5*this.Ut*t)/this.Ut,i=2*t*Math.PI/3,h=3,e=Math.cos(i)*h,a=Math.sin(i)*h,o=6*Math.sin(s),n=3*Math.sin(2*s),r=o*Math.cos(i)-n*Math.sin(i),c=o*Math.sin(i)+n*Math.cos(i);F.q.fillRect(Math.round(this.x+6+e+r),Math.round(this.y+4+a+c),1,1)}}ei(){const t=3*this.Ns/this.$s%1,s=c2.width/F.zoom,i=c2.height/F.zoom;F.ht(F.q,this.x+6,this.y+6,s*t,i*t,P,8),20>this.Ns-this.Ks||(this.map.ai(this.vt,this.Ct,this.Ns/this.$s*20,!0,2,.3),this.Ks=this.Ns),this.Zs||(this.Ss.forEach(t=>t._t(t.Bs)),this.Zs=!0)}si(){const t=[],s=Math.round(this.Jt.ti()+this.Gs);for(let i=-s;s>=i;i++)for(let h=-s;s>=h;h++){const s=this.vt+i,e=this.Ct+h;null===this.map.grid[e][s].content&&t.push({x:s,y:e})}if(t.length>0){const s=t[Math.floor(Math.random()*t.length)],i=Object.values(At).filter(t=>t.level<this.Jt.ti());if(0===i.length)return;const h=i[Math.floor(Math.random()*i.length)],e=new vt(s.x,s.y,h.type,this.map);this.Ss.push(e),this.map.set(s.x,s.y,e)}}}Ct.Ys={Fs:0,qs:1,Xs:2};class kt{constructor(t,s,i){this.oi=t,this.ni=s,this.Jt=i,this.ri=[],this.Lt={vt:0,Ct:0},this.ci=new ft,this.grid=Array.from({length:s},(s,i)=>Array.from({length:t},(t,s)=>{const h=s-70,e=i-90;let a;a=Math.sqrt(h*h+e*e)>40?.2>this.ci.next()?"spruce":"oak":.9>this.ci.next()?"spruce":"oak";const o=new ut(s*$-2,i*N-2,a);return{x:s,y:i,content:o}})),this.ri=[new pt("Heart Peak",{x:70,y:90},12,0,0),new pt("Pine Rest",{x:99,y:100},6,2,3),new pt("Oak Branch",{x:42,y:51},4,3,4),new pt("Cat Foot",{x:48,y:140},5,4,5),new pt("Black Tail",{x:113,y:107},4,5,8),new pt("Moon Town",{x:129,y:29},8,12,25)];for(const t of K)for(let s=0;t.length-1>s;s++)this.li({x:t[s][0],y:t[s][1]},{x:t[s+1][0],y:t[s+1][1]},t[s][2]);for(const t of _)this.ai(t.x,t.y,t.r);for(let i=0;s>i;i++)for(let s=0;t>s;s++){const t=this.grid[i][s];t.content instanceof ut&&t.content.hs({top:this.grid[i-1]?.[s]?.content instanceof ut,bottom:this.grid[i+1]?.[s]?.content instanceof ut,left:this.grid[i]?.[s-1]?.content instanceof ut,right:this.grid[i]?.[s+1]?.content instanceof ut})}for(const t of this.ri){t.As(this.ci,this).forEach(t=>{this.grid[t.Ct][t.vt].content=t}),t.Us(this.ci,this).forEach(t=>{this.grid[t.Ct][t.vt].content=t}),t.vs(this.ci,this).forEach(t=>{this.grid[t.Ct][t.vt].content=t});const{x:s,y:i}=t.Ms,h=t.radius;for(let e=i-h;i+h>=e;e++)for(let a=s-h;s+h>=a;a++){const o=a-s,n=e-i;o*o+n*n>h*h||(this.grid[e][a].Ft=t)}this.set(61,84,new dt(61,84,"home"))}this.ui(1);for(const t of Object.values(q)){const{x:s,y:i,name:h}=t,e=new Ct(s,i,this,this.Jt,`cat ${h} altar`);s===q.ut.x&&(e.Os=0),et(s,i,(t,s)=>{this.grid[s][t].content=new wt(t,s)}),this.grid[i][s].content=e}tt(18,()=>{this.set(64,89,new vt(64,89,"☁️",this))})}qt(){return this.grid[this.Lt.Ct][this.Lt.vt]}get(t,s){return 0>s||s>=this.ni||0>t||t>=this.oi?null:this.grid[s][t]}fi(t,s){(this.grid[s][t].content instanceof ut||this.grid[s][t].content instanceof wt)&&(this.grid[s][t].content=null)}ui(t){const s=this.ri[0],{x:i,y:h}=s.Ms;for(let s=h-12;h+12>=s;s++)for(let h=i-12;i+12>=h;h++){const i=this.grid[s][h];i.content||this.ci.next()>t?i.content instanceof wt&&this.ci.next()>t&&(i.content=null):i.content=new wt(i.x,i.y)}const e=[[61,86,2],[69,88,.9],[75,89,.9],[76,84,.9]];for(let t=0;e.length-1>t;t++)this.li({x:e[t][0],y:e[t][1]},{x:e[t+1][0],y:e[t+1][1]},e[t][2])}li(t,s,i){const h=Math.abs(s.x-t.x),e=Math.abs(s.y-t.y),a=s.x>t.x?1:-1,o=s.y>t.y?1:-1;let n=h-e,r=t.x,c=t.y;const l=i/2;for(;;){const t=1>i?0:1.2,u=Math.ceil(this.ci.range(-t,t)),f=Math.ceil(this.ci.range(-t,t));for(let t=-l;l>=t;t++)for(let s=-l;l>=s;s++){const h=Math.ceil(r+t+u),e=Math.ceil(c+s+f);this.fi(h,e),1>i?this.ci.next()>.5?this.fi(h+1,e):(this.grid[e][h].content=new wt(h,e),this.grid[e][h+1].content=new wt(h,e)):this.ci.next()>.1&&(this.ci.next()>.05?this.fi(h,e):this.grid[e][h].content=new wt(h,e))}if(r===s.x&&c===s.y)break;const d=2*n;d>-e&&(n-=e,r+=a),h>d&&(n+=h,c+=o)}}ai(t,s,i,h=!1,e=99,a=1){for(let o=0;this.ni>o;o++)for(let n=0;this.oi>n;n++){const r=n-t,c=o-s,l=Math.sqrt(r*r+c*c),u=i+this.ci.range(-i,i)/6;if(l>=u-e&&u>=l){const t=Math.min(1,(u-l)/2+.7)*a;this.ci.next()<t&&(!h||h&&this.grid[o][n].content instanceof wt)&&(this.grid[o][n].content=null)}}}set(t,s,i){this.grid[s]&&this.grid[s][t]&&(this.grid[s][t].content=i)}update(t,s){for(const i of this.grid)for(const h of i)h.content&&(h.content._s?.(t),s||(h.content.update?.(t),h.x==h.content.vt&&h.y==h.content.Ct||(this.grid[h.content.Ct][h.content.vt].content=h.content,h.content=null),h.content&&h?.content?.ks&&this.set(h.content.vt,h.content.Ct,null)))}draw(t,s){const i=F.zoom,h=F.L/i/2+50,e=F.F/i/2+50,a=Math.max(0,Math.floor((t-h)/$)),o=Math.min(this.oi-1,Math.ceil((t+h)/$)),n=Math.max(0,Math.floor((s-e)/N)),r=Math.min(this.ni-1,Math.ceil((s+e)/N));for(let t=n;r>=t;t++)for(let s=a;o>=s;s++){const i=this.grid[t][s];F.ot(S.S,i.x*$,i.y*N)}const c=[];let l=!1;for(let i=n;r>=i;i++)for(let h=a;o>=h;h++){const e=this.grid[i][h],a=e.x*$-t,o=e.y*N-s;a*a+o*o>5625||(e.di=!0),e.y===this.Lt.Ct&&e.x===this.Lt.vt&&e.content&&"oak"!==e.content.type&&"spruce"!==e.content.type&&(l=!0),e?.content?.draw(),e?.content?.hi&&c.push(e?.content)}c.forEach(t=>t.hi()),l&&F.ot(S.R,this.Lt.vt*$-2,this.Lt.Ct*N-2)}}const It=(t,s,i)=>s+-(Math.cos(Math.PI*t)-1)/2*i,Pt={oak:u,spruce:y,house:g,field:C,statue:b,unseen:x,default:k};class jt{constructor(t){this.map=t,this.Mi=0,this.updateInterval=100}update(t){this.Mi+=t}draw(t){if(this.updateInterval>this.Mi)return;this.Mi=0;const s=F.st,i=160,h=s.canvas.width-i-10,e=s.canvas.height-i-10;s.clearRect(h,e,i,i);for(let t=0;i>t;t++)for(let a=0;i>a;a++){const i=this.map.grid[t][a];s.fillStyle=i.di?Pt[i.content?.type||"default"]??Pt.default:Pt.unseen,s.fillRect(h+a,e+t,1,1)}t.vt>=0&&i>t.vt&&t.Ct>=0&&i>t.Ct&&(s.fillStyle=A,s.beginPath(),s.arc(h+t.vt,e+t.Ct,2,0,2*Math.PI),s.fill())}}class Et{constructor(){this.wi=null,tt(3,t=>{this.wi=t}),tt(2,()=>{this.wi=null})}draw(){if(this.wi){const t=160,s=20,i=c3.width-t-3*s,h=s,e=c3.height-t-s;F.tt.fillStyle=A,F.tt.fillRect(h+5,e+5,i,t),F.tt.fillStyle=U,F.tt.fillRect(h,e,i-5,t-5),this.wi.split("\n").forEach((t,i)=>{F.et(t,h+2*s,e+2*s+40*i,">"===t[0]?A:I,0,0,5,1,F.tt)}),F.et("press (space) to continue",h+i-s,e+t-s,A,2,2,3,1,F.tt)}}}class Dt{constructor(t,s,i,h){this.map=t,this.pi=s,this.actions=i,this.Jt=h,this.yi=!1,this.mi=!1,this.gi=!1,this.xi="",this.bi=0,this.Ui=new jt(t),this.Ai=new Et,tt(9,()=>{this.mi=!0}),tt(15,()=>{this.gi=!0}),tt(10,t=>{this.xi=t.name,this.bi=3e3}),tt(16,()=>{this.yi=!0})}update(t){this.Ui.update(t),this.bi-=t}draw(){this.mi&&this.Ci(),this.gi&&this.ki(),this.Ii(),this.yi&&this.Pi(),this.ji(),this.Ei(),this.mi&&this.Ui.draw(this.pi),this.Ai.draw()}ji(){const t=this.actions.actions;if(!t||!t[0].enabled)return;const s=Math.round((F.tt.canvas.width-(120*t.length+10*(t.length-1)))/2),i=F.tt.canvas.height-120-10;t.forEach(({type:t,color:h,Di:e},a)=>{const o=s+130*a;F.tt.fillStyle=U,F.tt.fillRect(o,i,120,120),F.et(e,o+60,i+30,h,1,1,7,1,F.tt),F.et(t,o+60,i+95,I,1,1,3,1,F.tt)})}Ci(){const t=Math.floor(this.Jt.Hi),s=Math.floor(9-this.Jt.Hi),i=9-t-s,h=this.Jt.Hi-t,e="#".repeat(t)+(h>.3?"$":"%").repeat(i)+"&".repeat(s),a=5*(6*e.length+1);F.tt.fillStyle=U,F.tt.fillRect(16,16,a,35),F.et(e,21,21,A,0,0,5,1,F.tt)}ki(){let t=c3.width-16;const s=this.Jt.Ti,i=this.Jt.Bi-this.Jt.Ti,h=6-this.Jt.Bi;F.tt.fillStyle=C,F.tt.fillRect(t-185+5,16,185,35);let e=V.repeat(s);t-=30*e.length,F.et(e,t+5,21,y,0,0,5,1,F.tt),e=V.repeat(i),t-=30*e.length,F.et(e,t+5,21,m,0,0,5,1,F.tt),e=V.repeat(h),t-=30*e.length,F.et(e,t+5,21,k,0,0,5,1,F.tt)}Ii(){this.Jt.Ri.filter(t=>t.time>0).forEach((t,s)=>{const{label:i,time:h}=t,e=61+70*s;let a=0;h>4800?a=-526*(1-It((5e3-h)/200,0,1)):200>h&&(a=-526*(1-It(h/200,0,1)));const o=16+a;F.tt.fillStyle=A,F.tt.fillRect(o,e,510,65),F.et("GOAL",o+3+5,e+5,P,0,0,4,1,F.tt),F.et(i,o+3+5+20,35+e+5,U,0,0,3,1,F.tt)})}Pi(){const t=Math.round(c3.width/2-115);F.tt.fillStyle=U,F.tt.fillRect(t,16,230,62),F.tt.fillStyle=x,F.tt.fillRect(t+5,21,220,25),F.tt.fillStyle=this.Jt.Qi>.9?A:y,F.tt.fillRect(t+5,21,3*Math.round(220*this.Jt.Qi/3),25),F.et("superstition",c3.width/2,54,x,1,0,3,1,F.tt)}Ei(){if(this.bi>0){const t=this.bi,s=It(Math.max(0,Math.min(1,Math.min(t/150,(3e3-t)/150))),0,1);F.tt.globalAlpha=s,this.Ji("^^ "+this.xi,170),F.tt.globalAlpha=1}if(this.map.Lt){const t=this.map.qt();t?.content?.name&&this.Ji(t.content.name,c3.height-170)}}Ji(t,s){F.tt.fillStyle=v,F.tt.fillRect(c3.width/2-175+4,s-18-4,342,43),F.tt.fillStyle=k,F.tt.fillRect(c3.width/2-175,s-18,350,35),F.et(t,c3.width/2,s,A,1,1,3,1,F.tt)}}class Ht extends lt{constructor(t){super(S.O,828,1056,"obelisk"),this.name="barrier obelisk",this.Ls=0,this.map=t,this.map.set(this.vt,this.Ct,this)}draw(){super.draw(),this.Ls>0&&Ut(this.Ls,Z,this.x,this.y,[C,k,x,b])}Si(){Z*(this.map.Jt.Ti/6)>this.Ls?(this.Ls++,rt(2*this.Ls-10)):(rt(-10),st(15)),this.Ls===Z&&st(20)}}const Tt=[{type:"scratch",color:A,enabled:!1,Di:"\\"},{type:"teleport",color:y,enabled:!0,Di:"["},{type:"repair",color:u,enabled:!0,Di:V},{type:"sleep",color:k,enabled:!0,Di:"z"}];class Bt{constructor(t,s){this.actions=[],this.map=t,this.pi=s,tt(9,()=>{this.actions[0].enabled=!0})}update(){const t=this.map.qt(),s=this.Oi(t),i=this.zi(t),h=this.Vi(t),a=this.Wi(t);if(this.actions=[a?Tt[0]:s?Tt[1]:i?Tt[2]:h?Tt[3]:Tt[0]],e.U&&!e.C.U)switch(!0){case a:break;case s:st(7);break;case i:this.Gi(t);break;case h:st(11)}}Gi(s){st(8);const i=s.content;Z>i.Ls&&(i instanceof Ct?(i.Ls++,rt(i.Ls),Z>i.Ls||t(()=>{st(13,this.map.Jt.Bi)},4e3)):i instanceof Ht&&i.Si())}zi(t){const s=t.content,i=s?.type;return("statue"===i||"obelisk"===i)&&Z>s.Ls}Oi(t){return t.content instanceof Ct&&this.pi.vt!=q.ut.x&&t.content.state===Ct.Ys.Xs}Vi(t){return t.content instanceof dt&&"home"===t.content.name}Wi(t){return t.content instanceof vt||t.content instanceof wt}}class Rt{constructor(){this.Yt=!1,this.Hi=9,this.Bi=0,this.Ti=0,this.Qi=0,this.Ri=[],this.Li=!1,this.Fi=!1,tt(16,()=>{this.Qi=Math.min(1,this.Qi+.01)}),tt(4,()=>{this.Yt=!0}),tt(5,t=>{this.Yt=!1,t.Ri&&t.Ri.forEach(t=>{this.Ri.push({label:t,time:5e3})})}),tt(12,t=>{this.Hi-=(t+1)/3,this.Hi=Math.round(3*this.Hi)/3,this.Hi=Math.round(10*this.Hi)/10,ot(t=>{const s=1e4;if(t>s)return 0;const i=(s-t)/s;return((2*Math.random()-1)*Math.sin(.003*t)*.6+Math.sin(t/(15+8*Math.sin(t/500)))*Math.exp(-t/2e3)*.4)*i*i*.3}),this.Hi>0||(this.Hi=0,st(19))}),tt(13,()=>{this.Bi++,this.Ti=this.Bi,this.Yi(),st(14,this.Bi)}),tt(11,()=>{this.Yi()})}Yi(){let s=0;for(let i=Math.floor(this.Hi)+1;9>=i;i++)t(()=>{this.Hi=i,ot(t=>{const s=6e3;if(t>s)return 0;var i=(s-t)/s;return.5*Math.sin(.01*t*Math.sin(.007*t+Math.sin(t/1200))+Math.sin(t/800))*i*i})},500+800*s++)}update(t){this.Ri.forEach(s=>s.time-=t)}ti(){return 4*this.Qi+this.Bi}}class Qt{constructor(t){this.$i=t,this.Ni=null,this.Zi=0,this.isActive=!1,this.Ki=!1,this.currentState=null,this._i="",this.qi=0,this.Xi=0,this.th=20,this.sh=2,tt(1,t=>{this.ih(t)})}ih(t){this.$i[t]&&(this.Ni=t,this.currentState=t,this.Zi=0,this.isActive=!0,this.Ki=!1,this.hh())}update(t){if(!this.isActive||!this.Ni)return;const s=e.v.get("Space"),i=s&&!this.Ki;if(this.Ki=s||!1,0===this.sh){this.Xi+=t;const s=Math.floor(this.Xi/1e3*this.th);this._i.length>s?s>this.qi&&(this.qi=s,this.eh()):(this.qi=this._i.length,this.sh=1,this.eh())}i&&this.ah()}ah(){if(this.Ni){if(0===this.sh)return this.qi=this._i.length,this.sh=1,void this.eh();1===this.sh&&(this.$i[this.Ni].oh.length-1>this.Zi?(this.Zi++,this.hh()):this.nh())}}eh(){const t=this._i.substring(0,this.qi);st(3,t)}hh(){if(!this.Ni)return;const t=this.$i[this.Ni];t.rh=!0,this._i=t.oh[this.Zi],this.qi=0,this.Xi=0,this.sh=0,this.eh()}nh(){if(!this.Ni)return;const t=this.Ni;this.isActive=!1,this.Ni=null,this.currentState=null,this.Zi=0,st(2,t)}}const Jt={1:{oh:["Zzzzz...","Yawwwn...","How long was i sleeping?..."]},2:{oh:["Evil spirits?","Has the magic barrier failed\nwhile I slept??","This one seems weak.","I'll exorcise it and then\ngo check the barrier","> Use (space) to attack"],Ri:["find magic barrier obelisk"]},3:{oh:["I have no magic power left!","My magic comes from villagers\nworshiping me...","Something must be wrong with\nthe cat altar."],Ri:["repair the cat altar"]},5:{oh:["I don't have enough magic!","Something must be wrong with\nthe cat altars in the valley"]},4:{oh:["My magic has increased a little.","But the other altars...\nthey must be damaged too."],Ri:["repair all 5 temples","restore the forest magic barrier"]},7:{oh:["Villagers are very supersticious.","I should not let them see me,\nthat will empower the evil spirits."]},6:{oh:["I have restore my full magic power","Now I am able to restore the\nmagic barrier again."],Ri:["restore the forest magic barrier"]},8:{oh:["The barrier is restored.\nTime for a well deserved nap..."]}};class St{constructor(){this.uh=new Qt(Jt),tt(2,s=>{st(5,Jt[s]),1===s&&(st(6),st(18),F._=.08,t(()=>{st(1,2)},3e3)),2===s&&st(9),8===s&&st(21)}),tt(1,()=>{st(4)}),tt(15,()=>{st(1,Jt[3].rh?5:3)}),tt(14,t=>{st(1,6>t?4:6)}),tt(16,()=>{Jt[7].rh||st(1,7)}),tt(20,()=>{st(1,8)}),t(()=>this.uh.ih(1),1e3)}update(t){this.uh.update(t)}}const Ot=new class{constructor(){this.startTime=0,this.fh=!1}async start(){this.fh||(this.dh=new(window.AudioContext||window.webkitAudioContext),await this.dh.resume(),await this.dh.audioWorklet.addModule("music-worklet.js"),this.Mh=new AudioWorkletNode(this.dh,"mp"),this.Mh.connect(this.dh.destination),this.fh=!0)}wh(){this.Mh?.port.postMessage(0)}pause(){this.Mh?.port.postMessage(1)}unpause(){this.Mh?.port.postMessage(2)}stop(){this.fh&&(this.Mh?.disconnect(),this.fh=!1)}};class zt{constructor(){this.ph=!0}yh(){Ot.stop(),F.st.clearRect(0,0,c4.width,c4.height)}mh(){this.ph&&Ot.start(),tt(9,()=>{Ot.wh()}),tt(22,()=>{Ot.pause()}),tt(23,()=>{Ot.unpause()}),tt(19,()=>{t(()=>h.gh(Wt),3e3)}),tt(21,()=>{t(()=>h.gh(Wt),3e3)}),this.Jt=new Rt,this.map=new kt(160,160,this.Jt),this.T=new ct(60,85,this.map,this.Jt),this.actions=new Bt(this.map,this.T),this.xh=new Dt(this.map,this.T,this.actions,this.Jt),this.uh=new St,this.map.set(this.T.vt,this.T.Ct,this.T),new Ht(this.map),F.nt(this.T.x,this.T.y,20,!0),F._=.01}bh(t){F.nt(this.T.x,this.T.y,5+(9-this.Jt.Hi)/9),F.rt(),this.Jt.Hi>0&&(this.Jt.Yt||this.actions.update(),this.map.update(t,this.Jt.Yt),this.xh.update(t),this.Jt.update(t)),this.uh.update(t),s(t),this.Jt.Hi>0&&!this.Jt.Fi?(this.map.draw(this.T.x,this.T.y),this.xh.draw()):(this.Jt.Hi>0&&this.xh.draw(),this.T.update(t),this.T.draw()),F.ct()}}const Vt=new ft(0),Wt=new class{constructor(){this.Uh=0,this.Ah=!1}bh(t){this.Uh+=t,(()=>{const t=[g,m,y,p,w],s=Math.ceil(c2.height/t.length),i=c2.width/32;for(let h=0;32>h;h++){const e=10*Math.round(16*Math.sin(1-8*Math.PI*h/32)/10);t.forEach((t,a)=>{F.q.fillStyle=t,F.q.fillRect(i*h,e+s*a-20,Math.ceil(c2.width/32),s)})}const h=c2.width/22,e=c2.height/2/22,a=S.oak,o=S.spruce;if(a){for(let t=0;h+32>=t;t++)for(let s=e*(1.2-Math.cos(t/h*2*Math.PI));s>0;s--){const i=5*Math.sin(12*Math.PI*(s/e));F.ot(.2+Vt.next()>s/e?a:o,22*t+i-16,c2.height-(22*s+.7*Vt.next())/2,!1,32,32)}Vt.es=0}})();const s=F.X.canvas.width/2;F.et("Meow Mountain",s,100,w,1,0,15),F.et("Press Enter to start",s,230,P,1,0,4),F.et("Press F to toggle fullscreen",s,280,g,1,0,4),this.Ch()}Ch(){e.m&&!e.C.m&&h.gh(new zt);const t=!!e.v.get("KeyF");t&&!this.Ah&&(document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()),this.Ah=t}};document.querySelector('link[type="image/x-icon"]').href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='85'%3E💜%3C/text%3E%3C/svg%3E";let Gt=0,Lt=!1;window.addEventListener("blur",()=>{st(22),Lt=!0}),window.addEventListener("focus",()=>{st(23),Lt=!1}),h=new class{constructor(t,...s){this.currentState=t,this.currentState.mh?.(...s)}gh(t,...s){this.currentState.yh?.(),this.currentState=t,this.currentState.mh?.(...s)}getState(){return this.currentState}}(Wt,...[]),setInterval(t=>{if(Lt)return;let i=(t=performance.now())-Gt;if(Gt=t,i>1e3)return;F.clear();const a=h.getState();e.P(),a.bh(i),s(i)},16);
//# sourceMappingURL=index-C-2bIo_N.js.map
