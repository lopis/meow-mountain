function t(t,s,i=0,h=0){N.push({t,time:s,i:s+h,repeat:i})}function s(t){for(let s=N.length-1;s>=0;s--){const i=N[s];if(!i)return;i.i-=t,i.i>0||(i.t(),i.repeat-- >0?i.i=i.time:N.splice(s,1))}}function i(t,s){for(const i of["x","y"])if(t[i]!==t.h[i]){const h=t.h[i]-t[i],e=Math.sign(h)*t.speed*s/1e3;Math.abs(h)>Math.abs(e)?t[i]+=e:t[i]=t.h[i]}else t.o[i]=0,t[i]=Math.round(t[i])}let h;const e=new class{constructor(){this.l=!1,this.u=!1,this.M=!1,this.p=!1,this.m=!1,this.U=!1,this.k=!1,this.P=new Map,this.v={l:this.l,u:this.u,m:this.m,U:this.U},document.addEventListener("keydown",t=>this.A(t,!0)),document.addEventListener("keyup",t=>this.A(t,!1)),this.C=new DOMPoint}j(){this.v.l=this.l,this.v.u=this.u,this.v.m=this.m,this.v.U=this.U;const t=navigator.getGamepads()[0],s=this.P.get("KeyA")||this.P.get("KeyQ")||this.P.get("ArrowLeft")?-1:0,i=this.P.get("KeyD")||this.P.get("ArrowRight")?1:0,h=this.P.get("KeyW")||this.P.get("KeyZ")||this.P.get("ArrowUp")?-1:0,e=this.P.get("KeyS")||this.P.get("ArrowDown")?1:0;this.C.x=s+i||t?.axes[0]||0,this.C.y=h+e||t?.axes[1]||0,this.l=0>this.C.y,this.u=this.C.y>0,this.M=0>this.C.x,this.p=this.C.x>0,this.k=0!==this.C.x||0!==this.C.y,this.m=!!this.P.get("Enter"),this.U=!!this.P.get("Space")}A(t,s){this.P.set(t.code,s)}},o=t=>t.getContext("2d"),a=(t,s)=>{const i=((t,s)=>{const i=document.createElement("canvas");return t&&(i.width=t),s&&(i.height=s),i})(t,s);return[i,o(i)]},n=(t,s,i,h)=>128>h?[0,0,0,0]:[51*Math.round(t/51),51*Math.round(s/51),51*Math.round(i/51),255],r=(t,s=10)=>{const i=Math.floor(1.25*s),h=Math.floor(.25*s/2),[e,o]=a(i,i);o.font=s+"px sans-serif",o.textBaseline="top",o.clearRect(0,0,i,i),o.translate(-1,0),o.fillText(t,h,h);const r=o.getImageData(0,0,i,i).data,c=o.createImageData(i,i),l=c.data;for(let t=0;r.length>t;t+=4){const[s,i,h,e]=n(r[t],r[t+1],r[t+2],r[t+3]);l[t]=s,l[t+1]=i,l[t+2]=h,l[t+3]=e}const[u,f]=a(i,i);f.putImageData(c,0,0);const d=new Image;return d.src=u.toDataURL(),d},c=(t,s)=>{const i=["#000000",...s],h=i.length>4?2:i.length>2?3:6,e=6/h,o=(1<<e)-1,a=document.createElement("canvas"),n=Math.sqrt(t.length*h);a.setAttribute("width",""+n),a.setAttribute("height",""+n);const r=a.getContext("2d"),c=r.createImageData(n,n),l=c.data;let u=0;[...t].map(t=>{const s=t.charCodeAt(0);for(let t=0;h>t;t++){const h=s>>t*e&o,a=(i[h]||"#000000").replace("#",""),n=parseInt(a.substring(0,2),16),r=parseInt(a.substring(2,4),16),c=parseInt(a.substring(4,6),16),f=h?255:0;l[u]=n,l[u+1]=r,l[u+2]=c,l[u+3]=f,u+=4}}),r.putImageData(c,0,0);const f=new Image;return f.src=a.toDataURL(),f};class l{constructor(t){this.B=t,this.T={},this.I=16;for(const[s,i]of Object.entries(t.data))this.T[s]=i.map(s=>c(s,t.palette));this.I=t.size}}const u="#7daf84",f="#4c8568",d="#396a50",w="#b4ecf3",M="#86bec6",p="#4e9ca6",y="#2f6269",m="#255056",x="#1f4347",g="#13282b",U="#e0b8d3",b="#714162",k="#996a8a",P="#f2daab",v="#e6a386",A="#13282b",C="#fffef9",j={size:10,frames:4,palette:[A],data:{0:["@@@`@PJbcxpO|AQ@@","@@@`@DJbcxpO|AQ@@","@@@@h@nag|pG|AQ@@","@@@@@@z`SxxO|AQ@@"],1:["@@@`@DJbcxpO|AR@@","@@@P@HJdCy`OpC`@@","@@@@@DJbCy`OxCR@@","@@@H@DJbcxpO|AA@@"],2:["@@@@@@@`ZxyO~@B@@","@@@@@@J`_|xG~@E@@","@@@@@@@`ZxyO~PB@@","@@@@@@J`CxG~@D@@"],3:["@@@@AHJdCy`OxCb@@","@@@@@@jcC`C@@@@@","@@@@@@@@@x|oxG@@@","@@@@@@@@@@@N~yC@"],4:["@@@`@DJbcxpO|AQ@@","@@@@@BPhHN|Ka@@@","@@@D@BEqQ\\xG~`P@@","@@@P@DJbcxpO|AQ@@"],5:["@`@H@F`Wy_~GsPD@@","@`@H@B`Qy_~GwPD@@","@`@H@F`Wy_~GsPD@@","@`@H@B`Qy_~GwPD@@"],6:["@@@@@@@@@h~_~K@@@","@@@@@@@`Bx~_~E@@@","@@@@@@@`Bx}o~A@@@","@@@@@@@@@h|~C@@@"]}},E={size:8,frames:4,palette:[U,g],data:{0:["PUAUUQVVTUEUUajj`@B@`@","@@@TUPUUdeEUUQUUhjJH`@","PUAUUQVVTUEUUajj`@BH@@","@@@TUPUUdeEUUQUUhjJH`@"],1:["@@@TUPUUTfEiiQUUhjJH`@","@@@UETUEeYQZZTUEjjBBH@"]}},B={palette:[p,y,m],data:"@@@@@@@DD@@@`e@@@@jB@@@hJ@@@@O@@@@}A@@@xK@@@`o@@@p~N@@T{{E@TmoWAPUUUE@WUUu@|C@C@"},T={palette:[p,y,m],data:"@PUE@@`UUB@@VUI@@xo@@poC@@kjN@@l{@@p~C@@kjN@@|o@@p{~C@@{O@@|k@@pC@@|C@@@@@@@"},I={palette:[d,u,"#b3d7ad"],data:"@@@@@@@UU@@@yF@@yoA@i~oZ@djjjAPjjjF@ijjZ@TjjZAPfiYF@eYYV@PYZV@@PUE@@@UU@@@PU@@@@@@@@"},O={palette:[y,w,p],data:"@@T@@@@dF@@@djA@@tk_@@tG@P_@P}E@]]@Twu]APw}]G@u]]W@P]_W@@PUE@@@UU@@@PU@@@@@@@@"},D={palette:[f,d,u],data:"@U@T@PyEUSqmu}uMn_wuW{w]_WK^}mwmh}m_gPwuwmB]_WWBwu}]Oxnww~c~m_]OX_{]mP}mow@Vvj\\B`bB`B@"},W={palette:[m,p,y],data:"PU@@@PjVUU@YyGdjWU]PkAm^UUGt_PWUUuA}GTUUUUpjjjjC[_ZUNlk}ypvgVgCkjZ_N|}}@"};"🔥,🍀,🌼,🐓,🌷,🌹,👻,🥚,🍎".split(",").map(t=>r(t));class S{static initialize(){S.O=new l(j),S.D=new l(E),S.W=((t=b)=>{const[s,i]=a(16,16);i.clearRect(0,0,16,16),i.fillStyle=t,i.fillRect(0,0,1,1),i.fillRect(1,0,1,1),i.fillRect(0,1,1,1),i.fillRect(14,0,1,1),i.fillRect(15,0,1,1),i.fillRect(15,1,1,1),i.fillRect(0,14,1,1),i.fillRect(0,15,1,1),i.fillRect(1,15,1,1),i.fillRect(15,14,1,1),i.fillRect(14,15,1,1),i.fillRect(15,15,1,1);const h=new Image;return h.src=s.toDataURL(),h})(),S.oak=c(I.data,I.palette),S.spruce=c(O.data,O.palette),S.house=c(W.data,W.palette),S.S=c(D.data,D.palette),S.statue=c(B.data,B.palette),S._=c(T.data,T.palette)}}const _="6v7ic,6trd0,6to3o,6nvic,55eyo,2np50,2jcjo,3ugt8,34ao,7k,glc,1,opzc,3xdeu,3sapz,8rhfz,8ri26,1bzky,9j1ny,3ws2u,9dv9k,3xb1i,3xbmu,2t8g,2t8s,26ndv,ajmo,fl5ug,3x7nm,n75t,54br,59u0e,53if,rlev,4jrb,1yjk4,4eav,55q95,18zsz,mi3r,574tl,1aedd,ljn9,a1bd,4f1i,a1fs,549t,53ig,5832,1dwsh,6iw6,6ix0,cbsa,6gix,6fk4,aky7,7mbws,cvtyq,deehh,2sfi3".split(","),z={},G="]",H=t=>{if("0"===t)return{G:"0".repeat(25),H:0,J:5};const s=(parseInt(t,36).toString(2)+"").padStart(25,"0");let i=5,h=-1;for(let t=0;5>t;t++)for(let e=0;5>e;e++)"1"===s[5*e+t]&&(i=Math.min(i,t),h=Math.max(h,t));return{G:s,H:i,J:i>h?1:h-i+1}},J=(t,s,i,h,e,o=0)=>{for(let a=-e;e>=a;a++){const n=a/e,r=Math.round(h*Math.sqrt(1-n*n));if(r>0){const h=Math.round(o*Math.abs(a));t.rect(0>a?s-r+h:s-r-h,i+a,2*r,1)}}};class Q{constructor(){this.$=0,this.N=0,this.V=0,this.F=0,this.zoom=1,this.K=0,this.Z=0,this.R=1,this.L=.08,this.Y=o(c1),this.q=o(c2),this.X=o(c3),this.tt=o(c4),S.initialize(),this.st(),window.addEventListener("resize",()=>this.st()),window.addEventListener("orientationchange",()=>this.st())}st(){this.$=1200,this.N=900;const t=[this.Y,this.q,this.X,this.tt];for(const s of t)s.canvas.width=1200,s.canvas.height=900,s.imageSmoothingEnabled=!1}it(t,s,i,h,e,o,a){t.save(),t.beginPath(),J(t,s,i,h,e),J(t,s,i,h-a,e-a),t.clip("evenodd"),t.beginPath(),t.fillStyle=o,t.fillRect(s-h,i-e,2*h,2*e),t.fill(),t.restore()}ht(t,s,i,h,e=0,o=0,n=2,r=1,c){((t,s,i,h,e=C,o=0,n=0,r=2,c=1)=>{i=Math.round(i),h=Math.round(h),s||(s=" ");const l=c*r,u=s.replace("!","@").toUpperCase().split("");let f=0;const d=[];u.forEach((t,s)=>{const i=(h=" "===t?"0":_[t.charCodeAt(0)-35],H(h).J*r);var h;d.push({char:t,x:f,J:i}),f+=i+(u.length-1>s?l:0)});const w=5*r,M=0===o?0:1===o?Math.round(f/2):f,p=0===n?0:1===n?Math.round(w/2):w;d.forEach(({char:s,x:o,J:n})=>{if(" "===s)return;const c=((t,s,i)=>{const h=`${t.charCodeAt(0)}-${i}-${s}`;return z[h]||(z[h]=((t,s,i)=>{const h=" "===t?"0":_[t.charCodeAt(0)-35],{G:e,H:o,J:n}=H(h),r=n*s,c=5*s,[l,u]=a(r,c),[f,d,w,M]=i.replace(/^#?([a-f\d])([a-f\d])([a-f\d])([a-f\d])$/i,(t,s,i,h,e)=>"#"+s+s+i+i+h+h+e+e).substring(1).match(/.{2}/g).map(t=>parseInt(t,16)),p=`rgba(${f}, ${d}, ${w}, ${(M||255)/255})`;return e.split("").forEach((t,i)=>{if("0"!==t){const t=i%5,h=Math.floor(i/5);if(o>t)return;const e=t-o;u.fillStyle=p,u.fillRect(e*s,h*s,s,s)}}),l})(t,s,i)),z[h]})(s,r,e);t.drawImage(c,0,0,n,w,i-M+o,h-p,n,w)})})(c||this.Y,t,s,i,h,e,o,n,r)}static drawImage(t,s,i,h,e,o,a){e&&(t.save(),t.scale(-1,1),i=-i-(o??s.width)),t.drawImage(s,i,h,o??s.width,a??s.height),e&&t.restore()}et(t,s,i,h,e,o){Q.drawImage(this.Y,t,s,i,h,e,o)}ot(t,s,i=1,h=!1){this.K=t,this.Z=s,this.R=i,this.Y.setTransform(this.zoom,0,0,this.zoom,this.$/2-32-this.V*this.zoom,this.N/2-64-this.F*this.zoom),h&&(this.V=t,this.F=s,this.zoom=i)}nt(){this.V+=(this.K-this.V)*this.L,this.F+=(this.Z-this.F)*this.L,this.zoom+=(this.R-this.zoom)*this.L}rt(){this.Y.setTransform(1,0,0,1,0,0)}clear(){this.rt(),this.Y.clearRect(0,0,this.$,this.N),this.Y.fillStyle=f,this.Y.fillRect(0,0,this.$,this.N),this.q.clearRect(0,0,this.$,this.N),this.X.clearRect(0,0,this.$,this.N)}ct(t,s,i=7){return{x:this.$/2-32+(t-this.V)*i,y:this.N/2-64+(s-this.F)*i}}}const $=new Q;let N=[];const V=12,F=11,K=20,Z=[[[69,100,3],[76,113,4],[89,114,5],[104,86,3],[99,59,3],[85,46,2],[86,28,2],[74,38,2],[60,39,2],[48,30,2],[46,43,2],[38,61,3],[50,73,4],[38,84,3],[46,123,3],[36,133,2],[48,141,3],[94,133,4],[113,109,5],[122,74,6],[113,56,.9]],[[45,49,.9],[71,51,.9]],[[119,54,1],[129,29,1]]],R=[{x:64,y:88,r:6},{x:75,y:88,r:6},{x:69,y:95,r:6},{x:129,y:28,r:10},{x:71,y:51,r:3}],L={lt:{x:76,y:84,name:"heart"},ut:{x:129,y:19,name:"moon"},ft:{x:49,y:29,name:"ear"},eye:{x:71,y:50,name:"eye"},dt:{x:35,y:131,name:"foot"},wt:{x:114,y:56,name:"tail"}};class Y{constructor(t,s,i,h,e,o=0,a=!1){this.Mt=t,this.x=s,this.y=i,this.type=h,this.animation=e,this.speed=o,this.yt=a,this.xt=0,this.gt=0,this.Ut=150,this.bt=!0,this.o={x:0,y:0},this.kt=Math.ceil(s/V),this.Pt=Math.ceil(i/F),this.xt=Math.random()*this.Ut,this.h={x:this.x,y:this.y}}vt(t,s){this.kt=t,this.Pt=s,this.x=t*V,this.y=s*F,this.h={x:this.x,y:this.y}}update(t){(this.bt||this.gt!==this.Mt.T[this.animation].length-1)&&(this.xt+=t,this.gt=Math.floor(this.xt/this.Ut)%this.Mt.T[this.animation].length)}At(t){i(this,t),0!==this.o.x&&(this.yt=0>this.o.x)}draw(){const t=this.Mt.T[this.animation];t[this.gt]&&$.et(t[this.gt],this.x-(this.Mt.I-V)/2,this.y-(this.Mt.I-F)/2,this.yt)}}const q=(t,s)=>{document.addEventListener(t+"",t=>{s(t.detail)})},X=(t,s)=>{document.dispatchEvent(new CustomEvent(t+"",{detail:s}))},tt=(t,s,i,h)=>{const e=[];let o,a=Math.abs(i-t),n=i>t?1:-1,r=-Math.abs(h-s),c=h>s?1:-1,l=a+r;for(;e.push([t,s]),t!==i||s!==h;)o=2*l,r>o||(l+=r,t+=n),o>a||(l+=a,s+=c);return e};class st{constructor(t,s,i,h,e=Math.PI/2,o=12,a=0,n=0,r=300,c=16,l=0,u=1,f=!0){this.Ct=t,this.jt=h,this.Et=e,this.radius=o,this.offset=a,this.Bt=n,this.speed=r,this.Tt=c,this.It=l,this.Ot=u,this.active=f,this.cx=s+6,this.cy=i+5.5;const d=((t,s,i,h)=>{const e=[];for(let o=0;5>o;o++){const a=2*Math.PI*(2*o%5)/5-Math.PI/2+i;e.push([Math.round(t+h*Math.cos(a)),Math.round(s+h*Math.sin(a))])}return e})(this.cx,this.cy,e,o);this.Dt=[];for(let t=0;5>t;t++){const[s,i]=d[t],[h,e]=d[(t+1)%5];this.Dt.push(...tt(s,i,h,e))}this.Wt=this.Dt.length*this.Ot*1e3/this.speed}update(t){if(!this.active)return;const s=Math.floor(this.Bt/1e3*this.speed)%this.Dt.length;if(this.offset>s&&(this.It++,this.It>=this.Ot))return this.active=!1,void this.jt();this.offset=s,this.Bt+=t}draw(){if(!this.active)return;this.Ct.fillStyle=C;const t=Math.min(this.Tt,this.offset);for(let s=0;t>s;s++){const t=(this.offset-s+this.Dt.length)%this.Dt.length,[i,h]=this.Dt[t];this.Ct.fillRect(i,h,1,1)}}isActive(){return this.active}}const it=(t,s,i,h=!1)=>{for(let e=-1;1>=e;e++)for(let o=-1;1>=o;o++)(h||0!==e||0!==o)&&i(t+o,s+e)};let ht=null;const et=t=>{ht||(ht=new AudioContext);const s=ht.createBuffer(1,96e3,48e3),i=s.getChannelData(0);for(let s=96e3;s--;)i[s]=t(s);const h=ht.createBufferSource();h.buffer=s,h.connect(ht.destination),h.start()},ot=(t=1)=>et(s=>{const i=2e3*t;return s>i?0:.15*(2*Math.random()-1)*Math.sin(Math.PI*s/i)}),at=t=>et(s=>Math.sin(s/(21-t)+5*Math.sin(s/2e3))*Math.exp(-s/4e3)*(s/96e3)*9);class nt extends Y{constructor(s,i,h,e){super(S.O,s*V,i*F,"cat",6,80),this.map=h,this.St=e,this.type="cat",this._t=!0,this.zt=!1,this.Gt=!1,this.Ht=!1,this.Jt=null,this.Qt=0,this.Ut=600,this.map.$t={kt:s+1,Pt:i},q(7,()=>{this.vt(L.lt.x,L.lt.y+1)}),q(6,()=>{this._t=!1,this.Ut=150}),q(12,()=>{this.Gt=!0,this.Ut=75,t(()=>{this.Ut=150,this.Gt=!1},600)}),q(19,()=>{this.animation=3,this.xt=0,this.Ut=600,this.bt=!1})}update(s){if(super.update(s),3===this.animation)return;2==this.animation?(this.Qt-=s,this.Qt>0||(ot(),this.Qt=200)):this.Qt=0;const i=this.map.grid[this.Pt][this.kt].Nt;if(!this.Ht&&i?(this.Ht=!0,X(10,i)):this.Ht&&!i&&(this.Ht=!1),coords.innerText=`${this.kt},${this.Pt}`,!this.St.Vt){if(this.Gt&&!this.Ft())this.animation=5;else if(this._t)this.animation=6;else if(this.zt)this.animation=4;else{if(super.At(s),!this.o.y&&e.C.y){const t=this.Pt+e.C.y;this.map.grid[t][this.kt].content||(this.animation=2,this.o.y=e.C.y,this.h.y+=e.C.y*F,this.Pt=t),this.map.$t={kt:this.kt,Pt:this.Pt+e.C.y}}if(!this.o.x&&e.C.x){this.yt=e.M;const t=this.kt+e.C.x;this.map.grid[this.Pt][t].content||(this.animation=2,this.o.x=e.C.x,this.h.x+=e.C.x*V,this.kt=t),this.map.$t={kt:this.kt+e.C.x,Pt:this.Pt}}this.o.x||this.o.y||(this.animation=0),this.zt||this.Kt(),this.zt||!e.U||e.v.U||(this.zt=!0,this.xt=0,!this.Jt&&this.Ft()?this.Jt=new st($.Y,this.x,this.y,()=>{this.Jt=null,this.Zt(),this.zt=!1,et(t=>t>29e3?0:.2*(t>17400?Math.pow(.9999,t-17400):1)*Math.sin(t/(30-5*Math.sin(5*Math.round(5*t/29e3)))+Math.random())*(8e3-t%6e3)/5e3)}):(t(()=>this.Rt(),500),t(()=>{this.zt=!1},5*this.Ut)))}this.Jt?.update(s)}}Zt(){it(this.kt,this.Pt,(t,s)=>{const i=this.map.grid[s][t];"spirit"===i.content?.type&&i.content.Lt(5)})}Ft(){let t=0;return it(this.kt,this.Pt,(s,i)=>{const h=this.map.grid[i][s];"spirit"===h.content?.type&&t++}),t>=3}draw(){super.draw(),this.Jt?.draw()}Kt(){const t=this.map.Yt();if(t?.content)return;const s=[{kt:this.kt+1,Pt:this.Pt},{kt:this.kt-1,Pt:this.Pt},{kt:this.kt,Pt:this.Pt+1},{kt:this.kt,Pt:this.Pt-1}];let i=null,h=null;for(const t of s){const s=this.map.grid[t.Pt][t.kt];if(!s.content)continue;const e=s.content.type;if("spirit"===e){i=t;break}"statue"!==e&&"obelisk"!==e||h||(h=t)}i?this.map.$t=i:h&&(this.map.$t=h)}Rt(){const t=this.map.Yt();t.content&&"spirit"===t.content.type?(t.content.Lt(1),et(t=>{if(t>1e4)return 0;const s=5*Math.sin(5*Math.round(5*t/1e4));return.2*Math.pow(.998,t/10)*Math.sin(t/(40-s)+Math.random())*(8e3-t%6e3)/5e3})):t.content&&"field"===t.content.type&&(t.content=null,ot(3))}}class rt{constructor(t,s,i,h){this.qt=t,this.x=s,this.y=i,this.type=h,this.kt=Math.ceil(s/V),this.Pt=Math.ceil(i/F),this.offsetX=s-Math.round((t.width-V)/2),this.offsetY=i-Math.round((t.height-F)/2)}draw(){$.et(this.qt,this.offsetX,this.offsetY)}}class ct extends rt{constructor(t,s,i){super(S[i],t,s,i),this.x=t,this.y=s,this.Xt={top:!1,bottom:!1,left:!1,right:!1}}ts(t){this.Xt=t}draw(){this.Xt.right&&$.et(this.qt,Math.round(this.offsetX+6),this.offsetY-5.5),super.draw()}}class lt{constructor(t=47){this.ss=t}next(){return this.ss=(9301*this.ss+49297)%233280,this.ss/233280}range(t,s){return t+this.next()*(s-t)}}class ut extends rt{constructor(t,s,i=""){super(S.house,t*V,s*F,"house"),this.name=i}}class ft extends Y{constructor(t,s,i){super(S.D,t*V,s*F,"villager",0,10),this.map=i,this.hs=null,this.es=0,this.ns=1e3,this.rs=!1}update(t){super.update(t),this.es+=t,this.cs()?(this.rs||this.ns>this.es||(this.es=0,this.rs=!0),t>this.es%(this.ns/5)&&X(16),this.animation=1,this.Ut=50):(this.rs=!1,this.Ut=150,this.ns>this.es||(this.ls(),this.es=0),this.At(t))}ls(){const t=[{x:0,y:-1},{x:0,y:1},{x:1,y:0},{x:-1,y:0}];if(this.hs&&.8>Math.random()){const t=this.kt+this.hs.x,s=this.Pt+this.hs.y;if(this.us(t,s))return this.kt=t,this.Pt=s,this.h={x:t*V,y:s*F},this.hs=this.hs,void(this.animation=0)}for(let s=0;10>s;s++){const s=t[Math.floor(4*Math.random())],i=this.kt+s.x,h=this.Pt+s.y;if(this.us(i,h))return this.kt=i,this.Pt=h,this.h={x:i*V,y:h*F},this.hs=s,void(this.animation=0)}}us(t,s){return null===this.map.grid[s][t].content}cs(){if(!this.hs)return!1;for(let t=1;2>=t;t++){const s=this.kt+this.hs.x*t,i=this.Pt+this.hs.y*t,h=this.map.grid[i]?.[s];if("cat"===h?.content?.type)return!0}return!1}}class dt extends rt{constructor(t,s){super(S.S,t*V,s*F,"field")}}class wt{constructor(t,s,i,h,e){this.name=t,this.fs=s,this.radius=i,this.ds=h,this.ws=e,this.Ms=[],this.ps=[],this.ys=[],this.fs=s,this.radius=i}xs(t,s,i){let h,e;do{const s=t.range(0,2*Math.PI),i=t.range(1,this.radius-1);h=Math.round(this.fs.x+Math.cos(s)*i),e=Math.round(this.fs.y+Math.sin(s)*i)}while(0>h||0>e||null!==i.get(h,e)?.content||s.some(t=>t.x===h&&t.y===e));return{x:h,y:e}}gs(t,s){for(let i=0;this.ds>i;i++){const i=this.xs(t,this.Ms,s);this.Ms.push(new ut(i.x+i.x%2,i.y+i.y%2))}return this.Ms}Us(t,s){const i=this.ds;for(let h=0;i>h;h++){const i=this.xs(t,this.ps,s);for(let t=0;2>t;t++)for(let s=0;2>s;s++)this.ps.push(new dt(i.x+t,i.y+s))}return this.ps}bs(t,s){for(let i=0;this.ws>i;i++){const i=this.xs(t,this.ps,s);this.ys.push(new ft(i.x,i.y,s))}return this.ys}}class Mt{constructor(t,s,i,h){this.icon=t,this.kt=s,this.Pt=i,this.type=h,this.x=Math.round(this.kt*V+(V-this.icon.width)/2),this.y=Math.round(this.Pt*F+(F-this.icon.height)/2)}draw(){$.et(this.icon,this.x,this.y)}}const pt=[{x:0,y:-1},{x:0,y:1},{x:1,y:0},{x:-1,y:0}],yt=(t,s)=>`${t},${s}`,mt=(t,s,i)=>{const h=[];let e=i;for(;e!=s;)h.unshift(e),e=t[yt(e.kt,e.Pt)];return h.unshift(s),h},xt=[M,p,k,b],gt=(t,s,i,h,e=xt)=>{const o=Math.ceil(12*Math.max(0,Math.min(1,t/s))),a=i,n=h-5;$.Y.fillStyle=e[0],$.Y.fillRect(a,n,o,1),$.Y.fillStyle=e[1],$.Y.fillRect(a,n+1,o,1),$.Y.fillStyle=e[2],$.Y.fillRect(a+o,n,12-o,1),$.Y.fillStyle=e[3],$.Y.fillRect(a+o,n+1,12-o,1)},Ut=["☁️","🥨","🌵","🧚🏻‍♀️","🦀","👻","👹","🧿","💀"].reduce((t,s,i)=>(t[s]={icon:r(s),type:s,level:Math.ceil(i/2)},t),{});class bt extends Mt{constructor(t,s,i,h){super(Ut[i].icon,t,s,"spirit"),this.Ut=2e3,this.xt=0,this.opacity=0,this.ks=9,this.es=0,this.ns=600,this.o={x:0,y:0},this.speed=20,this.Ps=!1,this.vs=!1,this.state=0,this.As=0,this.Cs=1e3,this.js=null,this.Es=0,this.Bs=0,this.species=Ut[i],this.map=h,this.h={x:this.x,y:this.y},this.Ts=Math.round(Math.pow(1.5,this.species.level+1)),this.Is=this.Ts}update(t){if(this.Is>0)switch(this.xt+=t*Math.pow(this.species.level+.5,2),1>this.opacity&&(this.opacity+=t/this.Ut),this.Ut>this.xt||(this.xt-=this.Ut),this.state){case 0:case 1:i(this,t);const s=this.Os();s&&(this.es+=t,this.ns>this.es||(this.Ds(s),this.es=0));break;case 2:case 3:case 4:this.Ws(t)}}Ws(t){this.As+=t;const s=this.As/this.Cs;if(!this.js)return void(this.state=0);const i=this.js.kt-this.kt,h=this.js.Pt-this.Pt;if(.7>s){2!==this.state&&(this.state=2);const t=s/.7;this.Es=-i*t*3,this.Bs=-h*t*3}else if(.73>s){3!==this.state&&(this.state=3);const t=(s-.7)/.03;this.Es=i*(V*t-3),this.Bs=h*(V*t-3)}else if(1>s){if(4!==this.state){this.state=4;const t=this.map.grid[this.js.Pt][this.js.kt];"cat"===t.content?.type&&X(12,this.species.level)}const t=(s-.73)/.27;this.Es=3*i*(1-t),this.Bs=3*h*(1-t)}else this.state=0,this.As=0,this.js=null,this.Es=0,this.Bs=0}Os(){for(let t=-this.ks;this.ks>=t;t++)for(let s=-this.ks;this.ks>=s;s++){const i=this.kt+t,h=this.Pt+s,e=this.map.grid[h][i];if("cat"===e.content?.type)return{kt:i,Pt:h}}return null}Ds(t){const s=((t,s,i,h=100)=>{let e=h;const o=[s],a=new Set,n={};for(;0!==o.length&&e--;){const h=o.shift();if(h.kt===i.kt&&h.Pt===i.Pt)return mt(n,s,i);pt.map(({x:s,y:i})=>t[h.Pt+i][h.kt+s]).forEach(t=>{a.has(t)||(a.add(t),(null===t.content||t.x==i.kt&&t.y==i.Pt)&&(n[yt(t.x,t.y)]=h,o.push({kt:t.x,Pt:t.y})))})}})(this.map.grid,{kt:this.kt,Pt:this.Pt},t);if(s&&s.length>2){this.state=1;const t=s[1];h=t.Pt,(i=this).h.x=t.kt*V,i.h.y=h*F,this.kt=t.kt,this.Pt=t.Pt,this.h.x=t.kt*V,this.h.y=t.Pt*F}else 2===s?.length&&(this.state=2,this.js=s[1],this.As=0);var i,h}draw(){const t=Math.sin(this.xt/this.Ut*2*Math.PI);$.Y.save(),$.Y.globalAlpha=this.opacity,$.Y.fillStyle=`rgba(0,0,0,${Math.round(2+1*t)/10})`,$.Y.fillRect(this.x+3+this.Es,this.y+8.25+this.Bs,this.icon.width-6,3.75),this.Ts>this.Is&&gt(this.Is,this.Ts,this.x,this.y),$.Y.save(),this.vs&&($.Y.filter="sepia(1) saturate(2) hue-rotate(260deg) brightness(0.7)"),$.Y.translate(this.Es,this.Bs+Math.round(2*(t-1))),super.draw(),$.Y.restore(),$.Y.restore()}Lt(s=1){return this.Is-=s,this.vs=!0,t(()=>{this.vs=!1},150),this.Is>0||t(()=>{(()=>{const t=~(1e3*Math.random());et(s=>Math.sin(s/(10+s/8e3-s/12e3)&t+5*Math.sin(s/2e3))*Math.exp(-s/4e3)*(s/96e3)*9)})(),this.Ps=!0},1500),0>=this.Is}}class kt extends rt{constructor(t,s,i,h,e){super(S.statue,t*V,s*F,"statue"),this.map=i,this.St=h,this.name=e,this.Ss=[],this._s=4,this.zs=0,this.Gs=1e3,this.Hs=.1,this.Js=10,this.Qs=0,this.state=kt.Ns.$s,this.xt=0,this.Vs=1500,this.Fs=0,this.Ks=!1,this.Zs=0,this.Ut=800}Rs(t){this.xt+=t}update(t){if(this.zs+=t,this.state!==kt.Ns.$s||K>this.Qs?this.state===kt.Ns.Ls&&(this.Fs+=t,this.Fs>this.Vs&&(this.state=kt.Ns.Ys)):(this.state=kt.Ns.Ls,this.Ks=!1,this.Zs=0),this.zs>=this.Gs&&(this.zs=0,Math.random()<this.Hs))if(this.Ss.length<this._s+this.St.qs())this.Xs();else if(this.Ss.length>0){const t=this.Ss.filter(t=>t.Is===t.Ts)[Math.round(Math.random()*this.Ss.length-1)];t&&(t.Ps=!0,this.Xs())}this.Ss=this.Ss.filter(t=>!t.Ps)}draw(){super.draw(),this.Qs>0&&K>this.Qs&&gt(this.Qs,K,this.x,this.y,[P,v,x,g]),this.state===kt.Ns.Ys&&this.ti()}si(){this.state===kt.Ns.Ls&&this.ii()}ti(){$.Y.fillStyle=U;for(let t=0;5>t;t++){const s=(this.xt+.5*this.Ut*t)/this.Ut,i=2*t*Math.PI/3,h=3,e=Math.cos(i)*h,o=Math.sin(i)*h,a=6*Math.sin(s),n=3*Math.sin(2*s),r=a*Math.cos(i)-n*Math.sin(i),c=a*Math.sin(i)+n*Math.cos(i);$.Y.fillRect(Math.round(this.x+6+e+r),Math.round(this.y+F/3+o+c),1,1)}}ii(){const t=3*this.Fs/this.Vs%1,s=c2.width/$.zoom,i=c2.height/$.zoom;$.it($.Y,this.x+6,this.y+5.5,s*t,i*t,C,8),20>this.Fs-this.Zs||(this.map.hi(this.kt,this.Pt,this.Fs/this.Vs*20,!0,2,.3),this.Zs=this.Fs),this.Ks||(this.Ss.forEach(t=>t.Lt(t.Is)),this.Ks=!0)}Xs(){const t=[],s=Math.round(this.St.qs()+this.Js);for(let i=-s;s>=i;i++)for(let h=-s;s>=h;h++){const s=this.kt+i,e=this.Pt+h;null===this.map.grid[e][s].content&&t.push({x:s,y:e})}if(t.length>0){const s=t[Math.floor(Math.random()*t.length)],i=Object.values(Ut).filter(t=>t.level<this.St.qs());if(0===i.length)return;const h=i[Math.floor(Math.random()*i.length)],e=new bt(s.x,s.y,h.type,this.map);this.Ss.push(e),this.map.set(s.x,s.y,e)}}}kt.Ns={$s:0,Ls:1,Ys:2};class Pt{constructor(t,s,i){this.ei=t,this.oi=s,this.St=i,this.ai=[],this.$t={kt:0,Pt:0},this.ni=new lt,this.grid=Array.from({length:s},(s,i)=>Array.from({length:t},(t,s)=>{const h=s-70,e=i-90;let o;o=Math.sqrt(h*h+e*e)>40?.2>this.ni.next()?"spruce":"oak":.9>this.ni.next()?"spruce":"oak";const a=new ct(s*V-2,i*F-2.5,o);return{x:s,y:i,content:a}})),this.ai=[new wt("Heart Peak",{x:70,y:90},12,0,0),new wt("Pine Rest",{x:99,y:100},6,2,3),new wt("Oak Branch",{x:42,y:51},4,3,4),new wt("Cat Foot",{x:48,y:140},5,4,5),new wt("Black Tail",{x:113,y:107},4,5,8),new wt("Moon Town",{x:129,y:29},8,12,25)];for(const t of Z)for(let s=0;t.length-1>s;s++)this.ri({x:t[s][0],y:t[s][1]},{x:t[s+1][0],y:t[s+1][1]},t[s][2]);for(const t of R)this.hi(t.x,t.y,t.r);for(let i=0;s>i;i++)for(let s=0;t>s;s++){const t=this.grid[i][s];t.content instanceof ct&&t.content.ts({top:this.grid[i-1]?.[s]?.content instanceof ct,bottom:this.grid[i+1]?.[s]?.content instanceof ct,left:this.grid[i]?.[s-1]?.content instanceof ct,right:this.grid[i]?.[s+1]?.content instanceof ct})}for(const t of this.ai){t.Us(this.ni,this).forEach(t=>{this.grid[t.Pt][t.kt].content=t}),t.gs(this.ni,this).forEach(t=>{this.grid[t.Pt][t.kt].content=t}),t.bs(this.ni,this).forEach(t=>{this.grid[t.Pt][t.kt].content=t});const{x:s,y:i}=t.fs,h=t.radius;for(let e=i-h;i+h>=e;e++)for(let o=s-h;s+h>=o;o++){const a=o-s,n=e-i;a*a+n*n>h*h||(this.grid[e][o].Nt=t)}this.set(61,84,new ut(61,84,"home"))}this.ci(1);for(const t of Object.values(L)){const{x:s,y:i,name:h}=t,e=new kt(s,i,this,this.St,`cat ${h} altar`);s===L.lt.x&&(e._s=0),it(s,i,(t,s)=>{this.grid[s][t].content=new dt(t,s)}),this.grid[i][s].content=e}q(18,()=>{this.set(64,89,new bt(64,89,"☁️",this))})}Yt(){return this.grid[this.$t.Pt][this.$t.kt]}get(t,s){return 0>s||s>=this.oi||0>t||t>=this.ei?null:this.grid[s][t]}li(t,s){(this.grid[s][t].content instanceof ct||this.grid[s][t].content instanceof dt)&&(this.grid[s][t].content=null)}ci(t){const s=this.ai[0],{x:i,y:h}=s.fs;for(let s=h-12;h+12>=s;s++)for(let h=i-12;i+12>=h;h++){const i=this.grid[s][h];i.content||this.ni.next()>t?i.content instanceof dt&&this.ni.next()>t&&(i.content=null):i.content=new dt(i.x,i.y)}const e=[[61,86,2],[69,88,.9],[75,89,.9],[76,84,.9]];for(let t=0;e.length-1>t;t++)this.ri({x:e[t][0],y:e[t][1]},{x:e[t+1][0],y:e[t+1][1]},e[t][2])}ri(t,s,i){const h=Math.abs(s.x-t.x),e=Math.abs(s.y-t.y),o=s.x>t.x?1:-1,a=s.y>t.y?1:-1;let n=h-e,r=t.x,c=t.y;const l=i/2;for(;;){const t=1>i?0:1.2,u=Math.ceil(this.ni.range(-t,t)),f=Math.ceil(this.ni.range(-t,t));for(let t=-l;l>=t;t++)for(let s=-l;l>=s;s++){const h=Math.ceil(r+t+u),e=Math.ceil(c+s+f);this.li(h,e),1>i?this.ni.next()>.5?this.li(h+1,e):(this.grid[e][h].content=new dt(h,e),this.grid[e][h+1].content=new dt(h,e)):this.ni.next()>.1&&(this.ni.next()>.05?this.li(h,e):this.grid[e][h].content=new dt(h,e))}if(r===s.x&&c===s.y)break;const d=2*n;d>-e&&(n-=e,r+=o),h>d&&(n+=h,c+=a)}}hi(t,s,i,h=!1,e=99,o=1){for(let a=0;this.oi>a;a++)for(let n=0;this.ei>n;n++){const r=n-t,c=a-s,l=Math.sqrt(r*r+c*c),u=i+this.ni.range(-i,i)/6;if(l>=u-e&&u>=l){const t=Math.min(1,(u-l)/2+.7)*o;this.ni.next()<t&&(!h||h&&this.grid[a][n].content instanceof dt)&&(this.grid[a][n].content=null)}}}set(t,s,i){this.grid[s]&&this.grid[s][t]&&(this.grid[s][t].content=i)}update(t,s){for(const i of this.grid)for(const h of i)h.content&&(h.content.Rs?.(t),s||(h.content.update?.(t),h.x==h.content.kt&&h.y==h.content.Pt||(this.grid[h.content.Pt][h.content.kt].content=h.content,h.content=null),h.content&&h?.content?.Ps&&this.set(h.content.kt,h.content.Pt,null)))}draw(t,s){const i=$.zoom,h=$.$/i/2+50,e=$.N/i/2+50,o=[];for(const i of this.grid)for(const a of i){const i=a.x*V,n=a.y*F,r=i-t,c=n-s;r*r+c*c>5625||(a.ui=!0),a.y===this.$t.Pt&&a.x===this.$t.kt&&a.content&&"oak"!==a.content.type&&"spruce"!==a.content.type&&$.et(S.W,i-2,n-2.5),Math.abs(r)>h||Math.abs(c)>e||(a?.content?.draw(),a?.content?.si&&o.push(a?.content))}o.forEach(t=>t.si())}}const vt=(t,s,i)=>s+-(Math.cos(Math.PI*t)-1)/2*i,At={oak:u,spruce:p,house:m,field:P,statue:g,unseen:x,default:v};class Ct{constructor(t){this.map=t,this.fi=0,this.updateInterval=100}update(t){this.fi+=t}draw(t){if(this.updateInterval>this.fi)return;this.fi=0;const s=$.tt,i=160,h=s.canvas.width-i-10,e=s.canvas.height-i-10;s.clearRect(h,e,i,i);for(let t=0;i>t;t++)for(let o=0;i>o;o++){const i=this.map.grid[t][o];s.fillStyle=i.ui?At[i.content?.type||"default"]??At.default:At.unseen,s.fillRect(h+o,e+t,1,1)}t.kt>=0&&i>t.kt&&t.Pt>=0&&i>t.Pt&&(s.fillStyle=b,s.beginPath(),s.arc(h+t.kt,e+t.Pt,2,0,2*Math.PI),s.fill())}}class jt{constructor(){this.di=null,q(3,t=>{this.di=t}),q(2,()=>{this.di=null})}draw(){if(this.di){const t=160,s=10,i=c3.width-t-3*s,h=s,e=c3.height-t-s;$.X.fillStyle=U,$.X.fillRect(h,e,i,t),this.di.split("\n").forEach((t,i)=>{$.ht(t,h+2*s,e+2*s+40*i,">"===t[0]?b:A,0,0,5,1,$.X)}),$.ht("press (space) to continue",h+i-s,e+t-s,b,2,2,5,1,$.X)}}}class Et{constructor(t,s,i,h){this.map=t,this.wi=s,this.actions=i,this.St=h,this.Mi=!1,this.pi=!1,this.yi=!1,this.mi="",this.xi=0,this.gi=new Ct(t),this.Ui=new jt,q(9,()=>{this.pi=!0}),q(15,()=>{this.yi=!0}),q(10,t=>{this.mi=t.name,this.xi=3e3}),q(16,()=>{this.Mi=!0})}update(t){this.gi.update(t),this.xi-=t}draw(){this.pi&&this.bi(),this.yi&&this.ki(),this.Pi(),this.Mi&&this.Ai(),this.Ci(),this.ji(),this.pi&&this.gi.draw(this.wi),this.Ui.draw()}Ci(){const t=this.actions.actions;if(!t||!t[0].enabled)return;const s=Math.round(($.X.canvas.width-(120*t.length+10*(t.length-1)))/2),i=$.X.canvas.height-120-10;t.forEach(({type:t,color:h,Ei:e},o)=>{const a=s+130*o;$.X.fillStyle=U,$.X.fillRect(a,i,120,120),$.ht(e,a+60,i+30,h,1,1,7,1,$.X),$.ht(t,a+60,i+95,A,1,1,3,1,$.X)})}bi(){const t=Math.floor(this.St.Bi),s=Math.floor(9-this.St.Bi),i=9-t-s,h=this.St.Bi-t,e="#".repeat(t)+(h>.3?"$":"%").repeat(i)+"&".repeat(s),o=5*(6*e.length+1);$.X.fillStyle=U,$.X.fillRect(16,16,o,35),$.ht(e,21,21,b,0,0,5,1,$.X)}ki(){let t=c3.width-16;const s=this.St.Ti,i=this.St.Ii-this.St.Ti,h=6-this.St.Ii;$.X.fillStyle=P,$.X.fillRect(t-185+5,16,185,35);let e=G.repeat(s);t-=30*e.length,$.ht(e,t+5,21,p,0,0,5,1,$.X),e=G.repeat(i),t-=30*e.length,$.ht(e,t+5,21,y,0,0,5,1,$.X),e=G.repeat(h),t-=30*e.length,$.ht(e,t+5,21,v,0,0,5,1,$.X)}Pi(){this.St.Oi.filter(t=>t.time>0).forEach((t,s)=>{const{label:i,time:h}=t,e=61+70*s;let o=0;h>4800?o=-526*(1-vt((5e3-h)/200,0,1)):200>h&&(o=-526*(1-vt(h/200,0,1)));const a=16+o;$.X.fillStyle=b,$.X.fillRect(a,e,510,65),$.ht("GOAL",a+3+5,e+5,C,0,0,4,1,$.X),$.ht(i,a+3+5+20,35+e+5,U,0,0,3,1,$.X)})}Ai(){const t=Math.round(c3.width/2-115);$.X.fillStyle=U,$.X.fillRect(t,16,230,62),$.X.fillStyle=x,$.X.fillRect(t+5,21,220,25),$.X.fillStyle=this.St.Di>.9?b:p,$.X.fillRect(t+5,21,3*Math.round(220*this.St.Di/3),25),$.ht("superstition",c3.width/2,54,x,1,0,3,1,$.X)}ji(){if(this.xi>0){const t=this.xi,s=vt(Math.max(0,Math.min(1,Math.min(t/150,(3e3-t)/150))),0,1);$.X.globalAlpha=s,this.Wi("^^ "+this.mi,170),$.X.globalAlpha=1}if(this.map.$t){const t=this.map.Yt();t?.content?.name&&this.Wi(t.content.name,c3.height-170)}}Wi(t,s){$.X.fillStyle=k,$.X.fillRect(c3.width/2-175+4,s-18-4,342,43),$.X.fillStyle=v,$.X.fillRect(c3.width/2-175,s-18,350,35),$.ht(t,c3.width/2,s,b,1,1,3,1,$.X)}}class Bt extends rt{constructor(t){super(S._,828,968,"obelisk"),this.name="barrier obelisk",this.Qs=0,this.map=t,this.map.set(this.kt,this.Pt,this)}draw(){super.draw(),this.Qs>0&&gt(this.Qs,K,this.x,this.y,[P,v,x,g])}Si(){K*(this.map.St.Ti/6)>this.Qs?(this.Qs++,at(2*this.Qs-10)):(at(-10),X(15)),this.Qs===K&&X(20)}}const Tt=[{type:"scratch",color:b,enabled:!1,Ei:"\\"},{type:"teleport",color:p,enabled:!0,Ei:"["},{type:"repair",color:u,enabled:!0,Ei:G},{type:"sleep",color:v,enabled:!0,Ei:"z"}];class It{constructor(t,s){this.actions=[],this.map=t,this.wi=s,q(9,()=>{this.actions[0].enabled=!0})}update(){const t=this.map.Yt(),s=this._i(t),i=this.zi(t),h=this.Gi(t),o=this.Hi(t);if(this.actions=[o?Tt[0]:s?Tt[1]:i?Tt[2]:h?Tt[3]:Tt[0]],e.U&&!e.v.U)switch(!0){case o:break;case s:X(7);break;case i:this.Ji(t);break;case h:X(11)}}Ji(s){X(8);const i=s.content;K>i.Qs&&(i instanceof kt?(i.Qs++,at(i.Qs),K>i.Qs||t(()=>{X(13,this.map.St.Ii)},4e3)):i instanceof Bt&&i.Si())}zi(t){const s=t.content,i=s?.type;return("statue"===i||"obelisk"===i)&&K>s.Qs}_i(t){return t.content instanceof kt&&this.wi.kt!=L.lt.x&&t.content.state===kt.Ns.Ys}Gi(t){return t.content instanceof ut&&"home"===t.content.name}Hi(t){return t.content instanceof bt||t.content instanceof dt}}class Ot{constructor(){this.Vt=!1,this.Bi=9,this.Ii=0,this.Ti=0,this.Di=0,this.Oi=[],this.Qi=!1,this.$i=!1,q(16,()=>{this.Di=Math.min(1,this.Di+.01)}),q(4,()=>{this.Vt=!0}),q(5,t=>{this.Vt=!1,t.Oi&&t.Oi.forEach(t=>{this.Oi.push({label:t,time:5e3})})}),q(12,t=>{this.Bi-=(t+1)/3,this.Bi=Math.round(3*this.Bi)/3,this.Bi=Math.round(10*this.Bi)/10,et(t=>{const s=1e4;if(t>s)return 0;const i=(s-t)/s;return((2*Math.random()-1)*Math.sin(.003*t)*.6+Math.sin(t/(15+8*Math.sin(t/500)))*Math.exp(-t/2e3)*.4)*i*i*.3}),this.Bi>0||(this.Bi=0,X(19))}),q(13,()=>{this.Ii++,this.Ti=this.Ii,this.Ni(),X(14,this.Ii)}),q(11,()=>{this.Ni()})}Ni(){let s=0;for(let i=Math.floor(this.Bi)+1;9>=i;i++)t(()=>{this.Bi=i,et(t=>{const s=6e3;if(t>s)return 0;var i=(s-t)/s;return.5*Math.sin(.01*t*Math.sin(.007*t+Math.sin(t/1200))+Math.sin(t/800))*i*i})},500+800*s++)}update(t){this.Oi.forEach(s=>s.time-=t)}qs(){return 4*this.Di+this.Ii}}class Dt{constructor(t){this.Vi=t,this.Fi=null,this.Ki=0,this.isActive=!1,this.Zi=!1,this.currentState=null,this.Ri="",this.Li=0,this.Yi=0,this.qi=20,this.Xi=2,q(1,t=>{this.th(t)})}th(t){this.Vi[t]&&(this.Fi=t,this.currentState=t,this.Ki=0,this.isActive=!0,this.Zi=!1,this.sh())}update(t){if(!this.isActive||!this.Fi)return;const s=e.P.get("Space"),i=s&&!this.Zi;if(this.Zi=s||!1,0===this.Xi){this.Yi+=t;const s=Math.floor(this.Yi/1e3*this.qi);this.Ri.length>s?s>this.Li&&(this.Li=s,this.ih()):(this.Li=this.Ri.length,this.Xi=1,this.ih())}i&&this.hh()}hh(){if(this.Fi){if(0===this.Xi)return this.Li=this.Ri.length,this.Xi=1,void this.ih();1===this.Xi&&(this.Vi[this.Fi].eh.length-1>this.Ki?(this.Ki++,this.sh()):this.oh())}}ih(){const t=this.Ri.substring(0,this.Li);X(3,t)}sh(){if(!this.Fi)return;const t=this.Vi[this.Fi];t.ah=!0,this.Ri=t.eh[this.Ki],this.Li=0,this.Yi=0,this.Xi=0,this.ih()}oh(){if(!this.Fi)return;const t=this.Fi;this.isActive=!1,this.Fi=null,this.currentState=null,this.Ki=0,X(2,t)}}const Wt={1:{eh:["Zzzzz...","Yawwwn...","How long was i sleeping?..."]},2:{eh:["Evil spirits?","Has the magic barrier failed\nwhile I slept??","This one seems weak.","I'll exorcise it and then\ngo check the barrier","> Use (space) to attack"],Oi:["find magic barrier obelisk"]},3:{eh:["I have no magic power left!","My magic comes from villagers\nworshiping me...","Something must be wrong with\nthe cat altar."],Oi:["repair the cat altar"]},5:{eh:["I don't have enough magic!","Something must be wrong with\nthe cat altars in the valley"]},4:{eh:["My magic has increased a little.","But the other altars...\nthey must be damaged too."],Oi:["repair all 5 temples","restore the forest magic barrier"]},7:{eh:["Villagers are very supersticious.","I should not let them see me,\nthat will empower the evil spirits."]},6:{eh:["I have restore my full magic power","Now I am able to restore the\nmagic barrier again."],Oi:["restore the forest magic barrier"]},8:{eh:["The barrier is restored.\nTime for a well deserved nap..."]}};class St{constructor(){this.nh=new Dt(Wt),q(2,s=>{X(5,Wt[s]),1===s&&(X(6),X(18),$.L=.08,t(()=>{X(1,2)},3e3)),2===s&&X(9),8===s&&X(21)}),q(1,()=>{X(4)}),q(15,()=>{X(1,Wt[3].ah?5:3)}),q(14,t=>{X(1,6>t?4:6)}),q(16,()=>{Wt[7].ah||X(1,7)}),q(20,()=>{X(1,8)}),t(()=>this.nh.th(1),1e3)}update(t){this.nh.update(t)}}const _t=new class{constructor(){this.startTime=0,this.rh=!1}async start(){this.rh||(this.uh=new(window.AudioContext||window.webkitAudioContext),await this.uh.resume(),await this.uh.audioWorklet.addModule("music-worklet.js"),this.fh=new AudioWorkletNode(this.uh,"mp"),this.fh.connect(this.uh.destination),this.rh=!0)}dh(){this.fh?.port.postMessage(0)}pause(){this.fh?.port.postMessage(1)}unpause(){this.fh?.port.postMessage(2)}stop(){this.rh&&(this.fh?.disconnect(),this.rh=!1)}};class zt{constructor(){this.wh=!0}Mh(){_t.stop(),$.tt.clearRect(0,0,c4.width,c4.height)}ph(){this.wh&&_t.start(),q(9,()=>{_t.dh()}),q(22,()=>{_t.pause()}),q(23,()=>{_t.unpause()}),q(19,()=>{t(()=>h.yh(Ht),3e3)}),q(21,()=>{t(()=>h.yh(Ht),3e3)}),this.St=new Ot,this.map=new Pt(160,160,this.St),this.O=new nt(60,85,this.map,this.St),this.actions=new It(this.map,this.O),this.mh=new Et(this.map,this.O,this.actions,this.St),this.nh=new St,this.map.set(this.O.kt,this.O.Pt,this.O),new Bt(this.map),$.ot(this.O.x,this.O.y,20,!0),$.L=.01}xh(t){$.ot(this.O.x,this.O.y,5+(9-this.St.Bi)/9),$.nt(),this.St.Bi>0&&(this.St.Vt||this.actions.update(),this.map.update(t,this.St.Vt),this.mh.update(t),this.St.update(t)),this.nh.update(t),s(t),this.St.Bi>0&&!this.St.$i?(this.map.draw(this.O.x,this.O.y),this.mh.draw()):(this.St.Bi>0&&this.mh.draw(),this.O.update(t),this.O.draw()),$.rt()}}const Gt=new lt(0),Ht=new class{constructor(){this.gh=0,this.Uh=!1}xh(t){this.gh+=t,(()=>{const t=[m,y,p,M,w],s=Math.ceil(c2.height/t.length),i=c2.width/32;for(let h=0;32>h;h++){const e=10*Math.round(16*Math.sin(1-8*Math.PI*h/32)/10);t.forEach((t,o)=>{$.Y.fillStyle=t,$.Y.fillRect(i*h,e+s*o-20,Math.ceil(c2.width/32),s)})}const h=c2.width/22,e=c2.height/2/22,o=S.oak,a=S.spruce;if(o){for(let t=0;h+32>=t;t++)for(let s=e*(1.2-Math.cos(t/h*2*Math.PI));s>0;s--){const i=5*Math.sin(12*Math.PI*(s/e));$.et(.2+Gt.next()>s/e?o:a,22*t+i-16,c2.height-(22*s+.7*Gt.next())/2,!1,32,32)}Gt.ss=0}})();const s=$.q.canvas.width/2;$.ht("Meow Mountain",s,100,w,1,0,15),$.ht("Press Enter to start",s,230,C,1,0,4),$.ht("Press F to toggle fullscreen",s,280,m,1,0,4),this.bh()}bh(){e.m&&!e.v.m&&h.yh(new zt);const t=!!e.P.get("KeyF");t&&!this.Uh&&(document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()),this.Uh=t}};document.querySelector('link[type="image/x-icon"]').href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='85'%3E💜%3C/text%3E%3C/svg%3E";let Jt=0,Qt=!1;window.addEventListener("blur",()=>{X(22),Qt=!0}),window.addEventListener("focus",()=>{X(23),Qt=!1}),h=new class{constructor(t,...s){this.currentState=t,this.currentState.ph?.(...s)}yh(t,...s){this.currentState.Mh?.(),this.currentState=t,this.currentState.ph?.(...s)}getState(){return this.currentState}}(Ht,...[]),setInterval(t=>{if(Qt)return;let i=(t=performance.now())-Jt;if(Jt=t,i>1e3)return;$.clear();const o=h.getState();e.j(),o.xh(i),s(i)},16);
//# sourceMappingURL=index-DGTw03J7.js.map
