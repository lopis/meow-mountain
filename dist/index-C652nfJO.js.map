{"version":3,"file":"index-C652nfJO.js","sources":["../../src/core/timer.ts","../../src/utils/smooth-movement.ts","../../src/game-state-machine.ts","../../src/core/controls.ts","../../src/core/util/canvas.ts","../../src/core/emoji.ts","../../src/game/sprite-loader.ts","../../src/core/tileset.ts","../../src/core/util/color.ts","../../src/game/sprites.ts","../../src/game/game-assets.ts","../../src/core/util/image-generator.ts","../../src/core/font.ts","../../src/core/draw-engine.ts","../../src/game/constants.ts","../../src/core/game-object.ts","../../src/core/event.ts","../../src/game/entities/pentagram-attack.ts","../../src/game/grid-utils.ts","../../src/core/audio.ts","../../src/game/entities/player.ts","../../src/core/game-static-object.ts","../../src/game/entities/tree.ts","../../src/core/util/rng.ts","../../src/game/entities/house.ts","../../src/game/entities/villager.ts","../../src/game/entities/farm.ts","../../src/game/entities/village.ts","../../src/game/entities/icon.ts","../../src/game/path-findind.ts","../../src/game/entities/hp-bar.ts","../../src/game/entities/spirit.ts","../../src/game/entities/statue.ts","../../src/game/game-map.ts","../../src/core/util/util.ts","../../src/game/mini-map.ts","../../src/game/dialog-box.ts","../../src/game/hud.ts","../../src/game/entities/obelisk.ts","../../src/game/actions.ts","../../src/game/game-data.ts","../../src/core/story-engine.ts","../../src/game/game-story.ts","../../src/core/music-player.ts","../../src/game-states/game.state.ts","../../src/game-states/menu.state.ts","../../src/index.ts","../../src/core/state-machine.ts"],"sourcesContent":["type TimeEventHandler = {\n  callback: (() => void)\n  time: number\n  timeLeft: number\n  repeat: number\n}\n\nlet timeEvents: TimeEventHandler[] = [];\n\nexport function addTimeEvent (callback: () => void, time: number, repeat = 0, delay = 0) {\n  timeEvents.push({callback, time, timeLeft: time + delay, repeat});\n}\n\nexport function clearTimers() {\n  timeEvents = [];\n}\n\n/**\n * Updates the time events, checking if any should be executed.\n * @param delta The time in milliseconds since the last update.\n */\nexport function updateTimeEvents(delta: number) {\n  for (let i = timeEvents.length - 1; i >= 0; i--) {\n    const timeEvent = timeEvents[i];\n    if (!timeEvent) {\n      return;\n    }\n    timeEvent.timeLeft -= delta;\n    if (timeEvent.timeLeft <= 0) {\n      timeEvent.callback();\n\n      if (timeEvent.repeat-- <= 0) {\n        timeEvents.splice(i, 1); // Remove the executed event\n      } else {\n        timeEvent.timeLeft = timeEvent.time;\n      }\n    }\n  }\n}\n","import { CELL_WIDTH, CELL_HEIGHT } from '../game/constants';\n\nexport interface SmoothMovementState {\n  x: number;\n  y: number;\n  targetPos: { x: number; y: number };\n  moving: { x: number; y: number };\n  speed: number;\n}\n\n/**\n * Updates position smoothly towards target position using linear interpolation\n * @param state Object containing position, target, and movement state\n * @param timeElapsed Time elapsed since last update in milliseconds\n */\nexport function updatePositionSmoothly(state: SmoothMovementState, timeElapsed: number): void {\n  for (const axis of ['x', 'y'] as const) {\n    if (state[axis] !== state.targetPos[axis]) {\n      const d = state.targetPos[axis] - state[axis];\n      const step = Math.sign(d) * state.speed * timeElapsed / 1000;\n      if (Math.abs(step) >= Math.abs(d)) {\n        state[axis] = state.targetPos[axis];\n      } else {\n        state[axis] += step;\n      }\n    } else {\n      state.moving[axis] = 0;\n      state[axis] = Math.round(state[axis]);\n    }\n  }\n}\n\n/**\n * Sets target position in pixel coordinates based on grid cell coordinates\n * @param state Movement state object\n * @param col Grid column\n * @param row Grid row\n */\nexport function setTargetPosition(state: SmoothMovementState, col: number, row: number): void {\n  state.targetPos.x = col * CELL_WIDTH;\n  state.targetPos.y = row * CELL_HEIGHT;\n}\n\n/**\n * Moves towards a target grid position if the move is valid\n * @param state Movement state object\n * @param targetCol Target column\n * @param targetRow Target row\n * @param currentCol Current column (will be updated)\n * @param currentRow Current row (will be updated)\n * @param isValidMove Function to check if move is valid\n * @returns true if movement was initiated, false otherwise\n */\nexport function moveToGridPosition(\n  state: SmoothMovementState,\n  targetCol: number,\n  targetRow: number,\n  currentCol: { value: number },\n  currentRow: { value: number },\n  isValidMove: (col: number, row: number) => boolean\n): boolean {\n  if (!isValidMove(targetCol, targetRow)) {\n    return false;\n  }\n\n  // Calculate movement direction\n  const deltaCol = targetCol - currentCol.value;\n  const deltaRow = targetRow - currentRow.value;\n\n  // Update grid position\n  currentCol.value = targetCol;\n  currentRow.value = targetRow;\n\n  // Set movement direction\n  state.moving.x = Math.sign(deltaCol);\n  state.moving.y = Math.sign(deltaRow);\n\n  // Set target pixel position\n  setTargetPosition(state, targetCol, targetRow);\n\n  return true;\n}\n","import { StateMachine } from './core/state-machine';\nimport { State } from './core/state';\n\nexport let gameStateMachine: StateMachine;\n\nexport function createGameStateMachine(initialState: State, ...initialArguments: any[]) {\n  gameStateMachine = new StateMachine(initialState, ...initialArguments);\n}\n","class Controls {\n  isUp = false;\n  isDown = false;\n  isLeft = false;\n  isRight = false;\n  isConfirm = false;\n  // isEscape = false;\n  isAction1 = false;\n  isMoving = false;\n  inputDirection: DOMPoint;\n\n  keyMap: Map<string, boolean> = new Map();\n  previousState = {\n    isUp: this.isUp,\n    isDown: this.isDown,\n    isConfirm: this.isConfirm,\n    // isEscape: this.isEscape,\n    isAction1: this.isAction1,\n  };\n\n  constructor() {\n    document.addEventListener('keydown', event => this.toggleKey(event, true));\n    document.addEventListener('keyup', event => this.toggleKey(event, false));\n    this.inputDirection = new DOMPoint();\n  }\n\n  queryController() {\n    this.previousState.isUp = this.isUp;\n    this.previousState.isDown = this.isDown;\n    this.previousState.isConfirm = this.isConfirm;\n    // this.previousState.isEscape = this.isEscape;\n    this.previousState.isAction1 = this.isAction1;\n    const gamepad = navigator.getGamepads()[0];\n\n    const leftVal = (this.keyMap.get('KeyA') || this.keyMap.get('KeyQ') || this.keyMap.get('ArrowLeft')) ? -1 : 0;\n    const rightVal = (this.keyMap.get('KeyD') || this.keyMap.get('ArrowRight')) ? 1 : 0;\n    const upVal = this.keyMap.get('KeyW') || (this.keyMap.get('KeyZ') || this.keyMap.get('ArrowUp')) ? -1 : 0;\n    const downVal = (this.keyMap.get('KeyS') || this.keyMap.get('ArrowDown')) ? 1 : 0;\n    this.inputDirection.x = (leftVal + rightVal) || gamepad?.axes[0] || 0;\n    this.inputDirection.y = (upVal + downVal) || gamepad?.axes[1] || 0;\n\n    // const deadzone = 0.1;\n    // if (Math.hypot(this.inputDirection.x, this.inputDirection.y) < deadzone) {\n    //   this.inputDirection.x = 0;\n    //   this.inputDirection.y = 0;\n    // }\n\n    this.isUp = this.inputDirection.y < 0;\n    this.isDown = this.inputDirection.y > 0;\n    this.isLeft = this.inputDirection.x < 0;\n    this.isRight = this.inputDirection.x > 0;\n    this.isMoving = this.inputDirection.x !== 0 || this.inputDirection.y !== 0;\n    this.isConfirm = Boolean(this.keyMap.get('Enter'));\n    // this.isEscape = Boolean(this.keyMap.get('Escape'));\n    this.isAction1 = Boolean(this.keyMap.get('Space'));\n  }\n\n  private toggleKey(event: KeyboardEvent, isPressed: boolean) {\n    this.keyMap.set(event.code, isPressed);\n  }\n}\n\nexport const controls = new Controls();\n","/* eslint-disable id-denylist */\n// Canvas creation and context helpers for bundle size optimization\n\nexport const createCanvas = (w?: number, h?: number) => {\n  const c = document.createElement('canvas');\n  if (w) c.width = w;\n  if (h) c.height = h;\n  return c;\n};\n\nexport const getCtx = (canvas: HTMLCanvasElement) => canvas.getContext('2d')!;\n\nexport const createCanvasWithCtx = (w?: number, h?: number) => {\n  const canvas = createCanvas(w, h);\n  return [canvas, getCtx(canvas)] as const;\n};\n\nexport const setCanvasSize = (canvas: HTMLCanvasElement, w: number, h: number) => {\n  canvas.width = w;\n  canvas.height = h;\n};\n","import { createCanvasWithCtx } from './util/canvas';\n\n/**\n * Quantizes rgba color values to 8bit.\n */\nconst quantizeToPalette = (r: number, g: number, b: number, a: number) => {\n  // 1-bit transparency\n  if (a < 128) {\n    return [0, 0, 0, 0]; // transparent\n  }\n  const qr = Math.round(r / 51) * 51;\n  const qg = Math.round(g / 51) * 51;\n  const qb = Math.round(b / 51) * 51;\n\n  return [qr, qg, qb, 255];\n};\n\n/**\n * Converts an emoji to a pixelated image by quantizing the colors\n * to 8 bit and the transparency to 1 bit.\n */\nexport const emojiToPixelArt = (\n  emoji: string,\n  fontSize = 10,\n) => {\n  // Some emoji are a bit bigger than the font\n  const spriteScale = 0.25;\n  const spriteSize = Math.floor(fontSize * (1 + spriteScale));\n  const padding = Math.floor(fontSize * spriteScale / 2);\n\n  // Create temporary canvas\n  const [_, tmpCtx] = createCanvasWithCtx(spriteSize, spriteSize);\n\n  // Draw emoji in chosen font size\n  tmpCtx.font = `${fontSize}px sans-serif`;\n  tmpCtx.textBaseline = 'top';\n  tmpCtx.clearRect(0, 0, spriteSize, spriteSize);\n  tmpCtx.translate(-1, 0);\n  tmpCtx.fillText(emoji, padding, padding);\n\n  // Read pixels\n  const imgData = tmpCtx.getImageData(0, 0, spriteSize, spriteSize);\n  const data = imgData.data;\n\n  // Create new image data with quantized colors\n  const outImg = tmpCtx.createImageData(spriteSize, spriteSize);\n  const outData = outImg.data;\n  for (let i = 0; i < data.length; i += 4) {\n    const [r, g, b, a] = quantizeToPalette(\n      data[i],      // red\n      data[i + 1],  // green\n      data[i + 2],  // blue\n      data[i + 3],  // alpha\n    );\n    outData[i] = r;\n    outData[i + 1] = g;\n    outData[i + 2] = b;\n    outData[i + 3] = a;\n  }\n\n  // Create a new canvas to draw the quantized image\n  const [outCanvas, outCtx] = createCanvasWithCtx(spriteSize, spriteSize);\n  outCtx.putImageData(outImg, 0, 0);\n\n  // Create an image element from the canvas\n  const img = new Image();\n  img.src = outCanvas.toDataURL();\n  return img;\n};\n\n\n// const ctx = c.getContext(\"2d\");\n// ctx.imageSmoothingEnabled = false;\n\n\n// const font = 8;\n// const spriteSize = Math.floor(font * 1.25); // must match function logic\n\n// const emojis = ['🔥','🍀','🌼','🐓','🌷','🌹','👻','🥚','🍎'];\n\n// emojis.forEach((emoji, i) => {\n//   const col = i % (100 / spriteSize);       // column in grid\n//   const row = Math.floor(i / (100 / spriteSize)); // row in grid\n//   const x = col * spriteSize;\n//   const y = row * spriteSize;\n\n//   emojiToPixelArt(emoji, ctx, font, x, y);\n// });\n","export const generateImageData = (icon: string, iconPalette: string[]): HTMLImageElement => {\n  const transparent = '#FF00FF';\n  const palette = [transparent, ...iconPalette];\n  \n  const colorsPerByte = palette.length > 4 ? 2 : palette.length > 2 ? 3 : 6;\n  const bytesPerColor = 6 / colorsPerByte;\n  const bitMask = (1 << bytesPerColor) - 1;\n  const canvas = document.createElement('canvas');\n  const size = Math.sqrt(icon.length * colorsPerByte);\n  canvas.setAttribute('width', size.toString());\n  canvas.setAttribute('height', size.toString());\n  const ctx = canvas.getContext('2d')!;\n  const imgData = ctx.createImageData(size, size);\n  const data = imgData.data;\n  \n  let i = 0;\n  [...icon].map(c => {\n    const z = c.charCodeAt(0);\n\n    for (let bit = 0; bit < colorsPerByte; bit++) {\n      const paletteIndex = (z >> bit * bytesPerColor) & bitMask;\n      const hexColor = palette[paletteIndex] || transparent;\n      \n      // Convert hex to RGB\n      const hex = hexColor.replace('#', '');\n      const r = parseInt(hex.substring(0, 2), 16);\n      const g = parseInt(hex.substring(2, 4), 16);\n      const b = parseInt(hex.substring(4, 6), 16);\n      const a = paletteIndex ? 255 : 0;\n      \n      data[i] = r;\n      data[i + 1] = g;\n      data[i + 2] = b;\n      data[i + 3] = a;\n      i += 4;\n    }\n  });\n\n  \n  ctx.putImageData(imgData, 0, 0);\n  const img = new Image();\n  img.src = canvas.toDataURL();\n  return img;\n};\n","import { generateImageData } from '@/game/sprite-loader';\n\nexport class NewTileset<T extends string | number> {\n  public animations: Record<T, HTMLImageElement[]> = {} as Record<T, HTMLImageElement[]>;\n  public tileSize = 16;\n\n  constructor(\n    public spriteSheet: { size: number, palette: string[]; data: Record<T, string[]> },\n  ) {\n    // Process each animation (sit, idle, walk, run, etc.)\n    for (const [animationName, frames] of Object.entries(spriteSheet.data) as [T, string[]][]) {\n      this.animations[animationName] = frames.map((frameData: string) => \n        generateImageData(frameData, spriteSheet.palette)\n      );\n    }\n    this.tileSize = spriteSheet.size;\n  }\n}\n","export const hexToRgb = (hex: string) : number[] => {\n  // @ts-ignore\n  return hex.replace(\n    /^#?([a-f\\d])([a-f\\d])([a-f\\d])([a-f\\d])$/i,\n    (_, r, g, b, a) => '#' + r + r + g + g + b + b + a + a)\n    .substring(1)\n    .match(/.{2}/g)\n    .map(x => parseInt(x, 16)\n  );\n};\n\n\nexport type Color =\n'green0' | \n'green1' | \n'green2' | \n'green3' | \n'green4' | \n'green5' | \n'green6' | \n'blue0' | \n'blue1' | \n'blue2' | \n'blue3' | \n'blue4' | \n'blue5' | \n'blue6' | \n'purple0' | \n'purple1' | \n'purple2' | \n'purple3' | \n'purple4' | \n'purple5' | \n'yellow0' | \n'yellow1' | \n'yellow2' | \n'black' | \n'white';\n\n// export const colors: Record<Color, string> = new Proxy({}, {\n//   get: (_, prop: string) => {\n//     if (typeof window === 'undefined' || typeof document === 'undefined') return '';\n//     const value = getComputedStyle(document.documentElement).getPropertyValue(`--${prop}`);\n//     return value.trim() || '';\n//   }\n// });\n\n// function getColorsFromCSS() {\n//   const root = document.documentElement;\n//   const computedStyle = getComputedStyle(root);\n  \n//   const colorKeys = [\n//     'green0', 'green1', 'green2', 'green3',\n//     'blue0', 'blue1', 'blue2', 'blue3', 'blue4', 'blue5', 'blue6',\n//     'purple0', 'purple1', 'purple2', 'purple3', 'purple4', 'purple5',\n//     'yellow0', 'yellow1', 'yellow2',\n//     'black', 'white'\n//   ];\n  \n//   const colors = {};\n//   colorKeys.forEach((key: string) => {\n//     // @ts-expect-error\n//     colors[key] = computedStyle.getPropertyValue(`--${key}`).trim();\n//   });\n  \n//   return colors;\n// }\n\nexport const colors: Record<Color, string> = {\n  green0: '#b3d7ad',\n  green1: '#9dc4a0',\n  green2: '#89b290',\n  green3: '#75a080',\n  green4: '#618e70',\n  green5: '#4d7c60',\n  green6: '#396a50',\n  blue0: '#b4ecf3',\n  blue1: '#4e9ca6',\n  blue2: '#3e8791',\n  blue3: '#2f6269',\n  blue4: '#255056',\n  blue5: '#1f4347',\n  blue6: '#13282b',\n  purple0: '#e0b8d3',\n  purple1: '#d49bc2',\n  purple2: '#b34d92',\n  purple3: '#551641',\n  purple4: '#714162',\n  purple5: '#996a8a',\n  yellow0: '#fffef9',\n  yellow1: '#f2daab',\n  yellow2: '#e6a386',\n  black: '#13282b',\n  white: '#fffef9'\n};\n","// Auto-generated icon data\n// Generated on 2025-09-04T14:10:07.197Z\n\nimport { colors } from '@/core/util/color';\nimport { CatStates, VillagerStates } from './game-assets';\n\nexport const cat = {\n  size: 10,\n  frames: 4,\n  palette: [\n    colors.black,\n  ],\n  data: {\n    [CatStates.idle]: [\n      '@@@`@PJbcxpO|AQ@@',\n      '@@@`@DJbcxpO|AQ@@',\n      '@@@@h@nag|pG|AQ@@',\n      '@@@@@@z`SxxO|AQ@@'\n    ],\n    [CatStates.walk]: [\n      '@@@`@DJbcxpO|AR@@',\n      '@@@P@HJdCy`OpC`@@',\n      '@@@@@DJbCy`OxCR@@',\n      '@@@H@DJbcxpO|AA@@'\n    ],\n    [CatStates.run]: [\n      '@@@@@@@`ZxyO~@B@@',\n      '@@@@@@J`_|xG~@E@@',\n      '@@@@@@@`ZxyO~PB@@',\n      '@@@@@@J`CxG~@D@@'\n    ],\n    [CatStates.die]: [\n      '@@@@AHJdCy`OxCb@@',\n      '@@@@@@jcC`C@@@@@',\n      '@@@@@@@@@x|oxG@@@',\n      '@@@@@@@@@@@N~yC@'\n    ],\n    [CatStates.scratch]: [\n      '@@@`@DJbcxpO|AQ@@',\n      '@@@@@BPhHN|Ka@@@',\n      '@@@D@BEqQ\\\\xG~`P@@',\n      '@@@P@DJbcxpO|AQ@@'\n    ],\n    [CatStates.scared]: [\n      '@`@H@F`Wy_~GsPD@@',\n      '@`@H@B`Qy_~GwPD@@',\n      '@`@H@F`Wy_~GsPD@@',\n      '@`@H@B`Qy_~GwPD@@'\n    ],\n    [CatStates.sleep]: [\n      '@@@@@@@@@h~_~K@@@',\n      '@@@@@@@`Bx~_~E@@@',\n      '@@@@@@@`Bx}o~A@@@',\n      '@@@@@@@@@h|~C@@@'\n    ]\n  }\n};\n\nexport const villager = {\n  size: 8,\n  frames: 4,\n  palette: [\n    colors.purple0,\n    colors.blue6,\n  ],\n  data: {\n    [VillagerStates.walk]: [\n      'PUAUUQVVTUEUUajj`@B@`@',\n      '@@@TUPUUdeEUUQUUhjJH`@',\n      'PUAUUQVVTUEUUajj`@BH@@',\n      '@@@TUPUUdeEUUQUUhjJH`@'\n    ],\n    [VillagerStates.scared]: [\n      '@@@TUPUUTfEiiQUUhjJH`@',\n      '@@@UETUEeYQZZTUEjjBBH@',\n    ],\n  }\n};\n\nexport const statue = {\n  size: 16,\n  palette: [\n    colors.blue2,\n    colors.blue3,\n    colors.blue4,\n  ],\n  data: '@@@@@@@DD@@@`e@@@@jB@@@hJ@@@@O@@@@}A@@@xK@@@`o@@@p~N@@T{{E@TmoWAPUUUE@WUUu@|C@C@'\n};\n\nexport const obelisk = {\n  size: 16,\n  palette: [\n    colors.blue2,\n    colors.blue3,\n    colors.blue4,\n  ],\n  data: '@PUE@@`UUB@@VUI@@xo@@poC@@kjN@@l{@@p~C@@kjN@@|o@@p{~C@@{O@@|k@@pC@@|C@@@@@@@'\n};\n\nexport const oak = {\n  size: 16,\n  palette: [\n    colors.green6,\n    colors.green3,\n    colors.green0,\n    colors.green5,\n  ],\n  data: '@@@@@@@@@@HIIA@@@@Q[[J@@@HZ[[SA@@QR[[RJ@@QRRRRJ@@aRRRRL@@QTRRbJ@@abbTTL@@aTTbbL@@IddddI@@HaddLA@@@HIIA@@@@HIIA@@@@@II@@@@@@@@@@@',\n};\n\nexport const spruce = {\n  size: 16,\n  palette: [\n    colors.blue3,\n    colors.blue0,\n    colors.blue1,\n    colors.blue2,\n  ],\n  data: '@@@HA@@@@@@QJ@@@@@HRRA@@@@YSZK@@@H[[[[A@@H[[[[A@@a\\\\[[cL@@acc\\\\\\\\L@@a\\\\\\\\ccL@@adc\\\\dL@@IddddI@@HaddLA@@@HIIA@@@@HIIA@@@@@II@@@@@@@@@@@',\n};\n\nexport const grass = {\n  size: 16,\n  palette: [\n    colors.green4,\n    colors.green5,\n    colors.green6,\n  ],\n  data: 'PPDDAP^feYTvVVYfweYZi]YfeiMgVvYv|Vvey`YZYvCfeiiCYZVfE\\\\wYZ[qWvefFle]fvPVfuY@g[dCpsCpC@'\n};\n\nexport const house = {\n  size: 16,\n  palette: [\n    colors.blue4,\n    colors.blue2,\n    colors.blue3\n  ],\n  data: 'PU@@@PjVUU@YyGdjWU]PkAm^UUGt_PWUUuA}GTUUUUpjjjjC[_ZUNlk}ypvgVgCkjZ_N|}}@'\n};\n\nexport const ground = {\n  size: 12,\n  palette: [\n    colors.green4,\n    colors.green5,\n  ],\n  data: '@@@@@@D@@A@D@DA@DY@@PjEDA@@@@@A@@@@@@@@QQ@AdF@Pi',\n};\n","import { emojiToPixelArt } from '@/core/emoji';\nimport { NewTileset as NewTileset } from '@/core/tileset';\nimport { createCornerImage } from '@/core/util/image-generator';\nimport { generateImageData } from './sprite-loader';\nimport { cat, grass, ground, house, oak, obelisk, spruce, statue, villager } from './sprites';\n\nexport const enum CatStates {\n  idle,\n  walk, \n  run,\n  die,\n  scratch,\n  scared,\n  sleep\n}\nexport const enum VillagerStates {\n  walk,\n  scared,\n} ;\n\nconst emoji = '🔥,🍀,🌼,🐓,🌷,🌹,👻,🥚,🍎'.split(',');\nexport const icons = emoji.map(e => emojiToPixelArt(e));\n\nexport class GameAssets {\n  static cat: NewTileset<CatStates>;\n  static villager: NewTileset<VillagerStates>;\n  static cornerImage: HTMLImageElement;\n  static oak: HTMLImageElement;\n  static spruce: HTMLImageElement;\n  static house: HTMLImageElement;\n  static grass: HTMLImageElement;\n  static ground: HTMLImageElement;\n  static statue: HTMLImageElement;\n  static obelisk: HTMLImageElement;\n\n  public static initialize() {\n    GameAssets.cat = new NewTileset<CatStates>(cat);\n    GameAssets.villager = new NewTileset<VillagerStates>(villager);\n    GameAssets.cornerImage = createCornerImage();\n    GameAssets.oak = generateImageData(oak.data, oak.palette);\n    GameAssets.spruce = generateImageData(spruce.data, spruce.palette);\n    GameAssets.house = generateImageData(house.data, house.palette);\n    GameAssets.grass = generateImageData(grass.data, grass.palette);\n    GameAssets.ground = generateImageData(ground.data, ground.palette);\n    GameAssets.statue = generateImageData(statue.data, statue.palette);\n    GameAssets.obelisk = generateImageData(obelisk.data, obelisk.palette);\n  }\n}\n","import { colors } from './color';\nimport { createCanvasWithCtx } from './canvas';\n\n/**\n * Creates a 16x16 image with transparent background and colored corners\n * @param cornerColor The color to use for the 3x3 corner pixels\n * @returns HTMLImageElement ready to be used with drawImage\n */\nexport function createCornerImage(cornerColor: string = colors.purple4): HTMLImageElement {\n  // Create temporary canvas\n  const [canvas, ctx] = createCanvasWithCtx(16, 16);\n\n  // Clear to transparent\n  ctx.clearRect(0, 0, 16, 16);\n\n  // Set corner color\n  ctx.fillStyle = cornerColor;\n\n  // Draw 2x2 arrow corners (3 pixels each, 1 transparent)\n  \n  // Top-left corner arrow (pointing inward)\n  ctx.fillRect(0, 0, 1, 1); // top-left pixel\n  ctx.fillRect(1, 0, 1, 1); // top-right pixel  \n  ctx.fillRect(0, 1, 1, 1); // bottom-left pixel\n  // (1,1) is transparent\n  \n  // Top-right corner arrow (pointing inward)\n  ctx.fillRect(14, 0, 1, 1); // top-left pixel\n  ctx.fillRect(15, 0, 1, 1); // top-right pixel\n  ctx.fillRect(15, 1, 1, 1); // bottom-right pixel\n  // (14,1) is transparent\n  \n  // Bottom-left corner arrow (pointing inward)\n  ctx.fillRect(0, 14, 1, 1); // top-left pixel\n  ctx.fillRect(0, 15, 1, 1); // bottom-left pixel\n  ctx.fillRect(1, 15, 1, 1); // bottom-right pixel\n  // (1,14) is transparent\n  \n  // Bottom-right corner arrow (pointing inward)\n  ctx.fillRect(15, 14, 1, 1); // top-right pixel\n  ctx.fillRect(14, 15, 1, 1); // bottom-left pixel\n  ctx.fillRect(15, 15, 1, 1); // bottom-right pixel\n  // (14,14) is transparent\n\n  // Convert canvas to image\n  const img = new Image();\n  img.src = canvas.toDataURL();\n  \n  return img;\n}\n","import { hexToRgb, colors } from '@/core/util/color';\nimport { createCanvasWithCtx } from '@/core/util/canvas';\n\nexport const tinyFont = /* font-start */'6v7ic,6trd0,6to3o,6nvic,55eyo,2np50,2jcjo,3ugt8,34ao,7k,glc,1,opzc,3xdeu,3sapz,8rhfz,8ri26,1bzky,9j1ny,3ws2u,9dv9k,3xb1i,3xbmu,2t8g,2t8s,26ndv,ajmo,fl5ug,3x7nm,n75t,54br,59u0e,53if,rlev,4jrb,1yjk4,4eav,55q95,18zsz,mi3r,574tl,1aedd,ljn9,a1bd,4f1i,a1fs,549t,53ig,5832,1dwsh,6iw6,6ix0,cbsa,6gix,6fk4,aky7,7mbws,cvtyq,deehh,2sfi3'/* font-end */.split(',');\n\n// Character cache: charCode-color-size -> Canvas\nconst characterCanvases: { [key: string]: HTMLCanvasElement } = {};\n\nexport const FULL_HEART = '#';\nexport const TWO_THIRDS_HEART = '$';\nexport const ONE_THIRD_HEART = '%';\nexport const EMPTY_HEART = '&';\nexport const COLCHEIA = '*';\nexport const HOUSE = '^';\n\nexport const TELEPORT = '[';\nexport const SCRATCH = '\\\\';\nexport const MAGIC = ']';\n\nexport type DrawTextProps = {\n  text: string\n  x: number\n  y: number\n  color?: string\n  textAlign?: CanvasTextAlign\n  textBaseline?: CanvasTextBaseline\n  size?: number\n  space?: number\n}\n\nconst getCharacterData = (letter: string) => {\n  if (letter === '0') return { paddedBinary: '0'.repeat(25), leftmostCol: 0, charWidth: 5 };\n  \n  const paddedBinary = String(parseInt(letter, 36).toString(2)).padStart(25, '0');\n  let leftmostCol = 5;\n  let rightmostCol = -1;\n  \n  // Find leftmost and rightmost columns with set bits\n  for (let col = 0; col < 5; col++) {\n    for (let row = 0; row < 5; row++) {\n      const bitIndex = row * 5 + col;\n      if (paddedBinary[bitIndex] === '1') {\n        leftmostCol = Math.min(leftmostCol, col);\n        rightmostCol = Math.max(rightmostCol, col);\n      }\n    }\n  }\n  \n  const charWidth = rightmostCol >= leftmostCol ? rightmostCol - leftmostCol + 1 : 1;\n  return { paddedBinary, leftmostCol, charWidth };\n};\n\nconst getCharacterWidth = (letter: string): number => {\n  return getCharacterData(letter).charWidth;\n};\n\nconst createCharacterCanvas = (character: string, size: number, color: string): HTMLCanvasElement => {\n  const letter = character === ' ' ? '0' : tinyFont[character.charCodeAt(0) - 35];\n  const { paddedBinary, leftmostCol, charWidth } = getCharacterData(letter);\n  \n  const scaledWidth = charWidth * size;\n  const letterHeight = 5 * size;\n  \n  const [canvas, ctx] = createCanvasWithCtx(scaledWidth, letterHeight);\n  \n  const [r, g, b, a] = hexToRgb(color);\n  const fillStyle = `rgba(${r}, ${g}, ${b}, ${(a || 255) / 255})`;\n  \n  // Draw character bitmap\n  paddedBinary.split('').forEach((bit, bitIndex) => {\n    if (bit !== '0') {\n      const col = bitIndex % 5;\n      const row = Math.floor(bitIndex / 5);\n      \n      // Skip empty left columns\n      if (col < leftmostCol) return;\n      \n      const adjustedCol = col - leftmostCol;\n      \n      ctx.fillStyle = fillStyle;\n      ctx.fillRect(adjustedCol * size, row * size, size, size);\n    }\n  });\n\n  return canvas;\n};\n\nconst getCharacterCanvas = (character: string, size: number, color: string): HTMLCanvasElement => {\n  const cacheKey = `${character.charCodeAt(0)}-${color}-${size}`;\n  \n  if (!characterCanvases[cacheKey]) {\n    characterCanvases[cacheKey] = createCharacterCanvas(character, size, color);\n  }\n  \n  return characterCanvases[cacheKey];\n};\n\nexport const drawText = (\n  c: CanvasRenderingContext2D,\n  text: string,\n  x: number,\n  y: number,\n  color = colors.white,\n  textAlign = 0, // 0=left, 1=center, 2=right\n  textBaseline = 0, // 0=top, 1=middle, 2=bottom  \n  size = 2,\n  space = 1\n) => {\n  x = Math.round(x);\n  y = Math.round(y);\n  if (!text) text = ' ';\n  \n  // Calculate variable width for text\n  const spacing = space * size;\n  const characters = text.replace('!', '@').toUpperCase().split('');\n  \n  // Calculate positions and total width\n  let totalWidth = 0;\n  const charPositions: { char: string; x: number; charWidth: number }[] = [];\n  \n  characters.forEach((character, i) => {\n    const letter = character === ' ' ? '0' : tinyFont[character.charCodeAt(0) - 35];\n    const charWidth = getCharacterWidth(letter) * size;\n    \n    charPositions.push({ char: character, x: totalWidth, charWidth });\n    totalWidth += charWidth + (i < characters.length - 1 ? spacing : 0);\n  });\n  \n  const letterHeight = 5 * size;\n  const offsetX = textAlign === 0 ? 0 : textAlign === 1 ? Math.round(totalWidth / 2) : totalWidth;\n  const offsetY = textBaseline === 0 ? 0 : textBaseline === 1 ? Math.round(letterHeight / 2) : letterHeight;\n  \n  // Draw each character synchronously\n  charPositions.forEach(({ char, x: charX, charWidth }) => {\n    if (char === ' ') return; // Skip spaces\n    \n    const canvas = getCharacterCanvas(char, size, color);\n    c.drawImage(canvas, 0, 0, charWidth, letterHeight, x - offsetX + charX, y - offsetY, charWidth, letterHeight);\n  });\n};\n\n\n","import { GameAssets } from '@/game/game-assets';\nimport { drawText } from './font';\nimport { colors } from './util/color';\nimport { getCtx } from './util/canvas';\n\nconst makeCircle = (\n  ctx: CanvasRenderingContext2D,\n  centerX: number,\n  centerY: number,\n  radiusX: number,\n  radiusY: number,\n  skew = 0,\n) => {\n  // Draw ellipse using scaled circle algorithm\n  for (let y = -radiusY; y <= radiusY; y++) {\n    // Calculate the half-width at this y position using ellipse equation\n    const normalizedY = y / radiusY;\n    const halfWidth = Math.round(radiusX * Math.sqrt(1 - normalizedY * normalizedY));\n    \n    if (halfWidth > 0) {\n      const offset = Math.round(skew * Math.abs(y));\n      const currentY = centerY + y;\n      \n      if (y >= 0) {\n        ctx.rect(centerX - halfWidth - offset, currentY, halfWidth * 2, 1);\n      } else {\n        ctx.rect(centerX - halfWidth + offset, currentY, halfWidth * 2, 1);\n      }\n    }\n  }\n};\n\nclass DrawEngine {\n  ctx1: CanvasRenderingContext2D;\n  ctx2: CanvasRenderingContext2D;\n  ctx3: CanvasRenderingContext2D;\n  ctx4: CanvasRenderingContext2D;\n\n  // Canvas dimensions (cached for performance)\n  canvasWidth = 0;\n  canvasHeight = 0;\n\n  // Camera properties\n  cameraX = 0;\n  cameraY = 0;\n  zoom = 1;\n  targetCameraX = 0;\n  targetCameraY = 0;\n  targetZoom = 1;\n  cameraLerpSpeed = 0.08; // Adjust for faster/slower camera\n\n  constructor() {\n    this.ctx1 = getCtx(c1);\n    this.ctx2 = getCtx(c2);\n    this.ctx3 = getCtx(c3);\n    this.ctx4 = getCtx(c4);\n    GameAssets.initialize();\n    this.resizeCanvas();\n    window.addEventListener('resize', () => this.resizeCanvas());\n    window.addEventListener('orientationchange', () => this.resizeCanvas());\n  }\n\n  resizeCanvas() {\n    const aspectRatio = 4 / 3;\n    const gameWidth = 1200;\n    const gameHeight = Math.round(gameWidth / aspectRatio);\n    this.canvasWidth = gameWidth;\n    this.canvasHeight = gameHeight;\n    const ctxs: CanvasRenderingContext2D[] = [this.ctx1, this.ctx2, this.ctx3, this.ctx4];\n    for (const ctx of ctxs) {\n      // eslint-disable-next-line id-denylist\n      ctx.canvas.width = gameWidth;\n      // eslint-disable-next-line id-denylist\n      ctx.canvas.height = gameHeight;\n      ctx.imageSmoothingEnabled = false;\n    }\n  }\n\n  \n  // eslint-disable-next-line class-methods-use-this\n  drawCircumference(\n    ctx: CanvasRenderingContext2D,\n    centerX: number,\n    centerY: number,\n    radiusX: number,\n    radiusY: number,\n    color: string,\n    strokeWidth: number,\n  ) {\n    ctx.save();\n    ctx.beginPath();\n    makeCircle(ctx, centerX, centerY, radiusX, radiusY);\n    makeCircle(ctx, centerX, centerY, radiusX - strokeWidth, radiusY - strokeWidth);\n    ctx.clip('evenodd');\n    ctx.beginPath();\n    ctx.fillStyle = color;\n    ctx.fillRect(centerX - radiusX, centerY - radiusY, radiusX*2, radiusY*2);\n    ctx.fill();\n    ctx.restore();\n  }\n\n  drawText(\n    text: string,\n    x: number,\n    y: number,\n    color?: string,\n    textAlign = 0,\n    textBaseline = 0,\n    size = 2,\n    space = 1,\n    context?: CanvasRenderingContext2D\n  ) {\n    drawText(context || this.ctx1, text, x, y, color, textAlign, textBaseline, size, space);\n  }\n\n  static drawImage(\n    ctx: CanvasRenderingContext2D,\n    img: HTMLImageElement,\n    x: number,\n    y: number,\n    mirrored?: boolean,\n    imgWidth?: number,\n    imgWeight?: number,\n  ) {\n    if (mirrored) {\n      ctx.save();\n      ctx.scale(-1, 1);\n      x = -x - (imgWidth ?? img.width);\n    }\n    ctx.drawImage(\n      img,\n      x,\n      y,\n      imgWidth ?? img.width,\n      imgWeight ?? img.height,\n    );\n    if (mirrored) {\n      ctx.restore();\n    }\n  }\n\n  drawBackgroundImage(\n    img: HTMLImageElement,\n    x: number,\n    y: number,\n    mirrored?: boolean,\n    imgWidth?: number,\n    imgHeight?: number,\n  ) {\n    DrawEngine.drawImage(this.ctx1, img, x, y, mirrored, imgWidth, imgHeight);\n  }\n\n  /**\n   * Sets the camera position and zoom level.\n   * @param x The x-coordinate of the object where the camera should focus\n   * @param y The y-coordinate of the object where the camera should focus\n   * @param zoom The zoom level of the camera\n   */\n  setCamera(x: number, y: number, zoom: number = 1, immediate = false) {\n    this.targetCameraX = x;\n    this.targetCameraY = y;\n    this.targetZoom = zoom;\n    const cx = this.canvasWidth / 2 - 32;\n    const cy = this.canvasHeight / 2 - 64;\n    this.ctx1.setTransform(\n      this.zoom, 0, 0, this.zoom,\n      cx - this.cameraX * this.zoom,\n      cy - this.cameraY * this.zoom,\n    );\n    if (immediate) {\n      this.cameraX = x;\n      this.cameraY = y;\n      this.zoom = zoom;\n    }\n  }\n\n  updateCamera() {\n    this.cameraX += (this.targetCameraX - this.cameraX) * this.cameraLerpSpeed;\n    this.cameraY += (this.targetCameraY - this.cameraY) * this.cameraLerpSpeed;\n    this.zoom += (this.targetZoom - this.zoom) * this.cameraLerpSpeed;\n  }\n\n  resetCamera() {\n    this.ctx1.setTransform(1, 0, 0, 1, 0, 0);\n  }\n\n  clear() {\n    this.resetCamera();\n    this.ctx1.clearRect(0, 0, this.canvasWidth, this.canvasHeight);\n    this.ctx1.fillStyle = colors.green3;\n    this.ctx1.fillRect(0, 0, this.canvasWidth, this.canvasHeight);\n    this.ctx2.clearRect(0, 0, this.canvasWidth, this.canvasHeight);\n    this.ctx3.clearRect(0, 0, this.canvasWidth, this.canvasHeight);\n  }\n\n  /**\n   * Converts world coordinates to screen coordinates, accounting for camera transforms\n   * @param worldX World X coordinate\n   * @param worldY World Y coordinate\n   * @param zoom Current zoom level (defaults to 7, matching game state)\n   * @returns Screen coordinates { x, y }\n   */\n  worldToScreen(worldX: number, worldY: number, zoom: number = 7): { x: number; y: number } {\n    const cx = this.canvasWidth / 2 - 32;\n    const cy = this.canvasHeight / 2 - 64;\n\n    return {\n      x: cx + (worldX - this.cameraX) * zoom,\n      y: cy + (worldY - this.cameraY) * zoom\n    };\n  }\n}\n\nexport const drawEngine = new DrawEngine();\n","import { Circle, Path } from './types';\n\nexport const CELL_WIDTH = 12;\nexport const CELL_HEIGHT = 12;\n\nexport const MAX_LIVES = 9;\nexport const MAX_MAGIC = 6;\nexport const MAX_REPAIR = 20;\n\nexport const NOTIFICATION_DURATION = 5000;\n\nexport const paths: Path[] = [\n  // Main path\n  [\n    [69, 100, 3],\n    [76, 113, 4],\n    [89, 114, 5],\n    [104, 86, 3],\n    [99, 59, 3],\n    [85, 46, 2],\n    [86, 28, 2],\n    [74, 38, 2],\n    [60, 39, 2],\n    [48, 30, 2],\n    [46, 43, 2],\n    [38, 61, 3],\n    [50, 73, 4],\n    [38, 84, 3],\n    [46, 123, 3],\n    [36, 133, 2],\n    [48, 141, 3],\n    [94, 133, 4],\n    [113, 109, 5],\n    [122, 74, 6],\n    [113, 56, 0.9],\n  ],\n\n  // Smaller paths\n  [[45, 49, 0.9], [71, 51, 0.9]],\n\n  // Northwest village path\n  [[119, 54, 1], [129, 29, 1]],\n];\n\nexport const clearings: Circle[] = [\n  // Peak\n  { x: 64, y: 88, r: 6 },\n  { x: 75, y: 88, r: 6 },\n  { x: 69, y: 95, r: 6 },\n\n  // Northeast village\n  { x: 129, y: 28, r: 10 },\n\n  // Eye\n  { x: 71, y: 51, r: 3 },\n];\n\nexport const statues = {\n  heart: { x: 76, y: 84, name: 'heart' },\n  moon: { x: 129, y: 19, name: 'moon' },\n  ear: { x: 49, y: 29, name: 'ear' },\n  eye: { x: 71, y: 50, name: 'eye' },\n  foot: { x: 35, y: 131, name: 'foot' },\n  tail: { x: 114, y: 56, name: 'tail' },\n} as const;\n","import { CELL_WIDTH, CELL_HEIGHT } from '@/game/constants';\nimport { drawEngine } from './draw-engine';\nimport { updatePositionSmoothly, SmoothMovementState } from '../utils/smooth-movement';\n\ninterface Tileset<T extends (string | number)> {\n  animations: Record<T, HTMLImageElement[]>;\n  tileSize: number;\n}\n\nexport class GameObject<T extends (string | number)> implements SmoothMovementState {\n  animationTime = 0;\n  animationFrame = 0;\n  aD = 150; // Duration for each animation frame in milliseconds\n  animationLoop = true;\n  col: number;\n  row: number;\n  moving = { x: 0, y: 0 };\n  targetPos: { x: number; y: number };\n\n  constructor(\n    private readonly tileset: Tileset<T>,\n    public x: number,\n    public y: number,\n    public type: string,\n    public animation: T,\n    public speed: number = 0,\n    public mirrored: boolean = false,\n  ) {\n    this.col = Math.ceil(x / CELL_WIDTH);\n    this.row = Math.ceil(y / CELL_HEIGHT);\n    this.animationTime = Math.random() * this.aD;\n    this.targetPos = { x: this.x, y: this.y };\n  }\n\n  setPos(col: number, row: number) {\n    this.col = col;\n    this.row = row;\n    this.x = col * CELL_WIDTH;\n    this.y = row * CELL_HEIGHT;\n    this.targetPos = { x: this.x, y: this.y };\n  }\n\n  update(timeElapsed: number) {\n    if (!this.animationLoop && this.animationFrame === (this.tileset.animations[this.animation].length - 1)) {\n      return;\n    }\n    this.animationTime += timeElapsed;\n    this.animationFrame = Math.floor(this.animationTime / this.aD) % this.tileset.animations[this.animation].length;\n  }\n\n  updatePositionSmoothly(timeElapsed: number) {\n    updatePositionSmoothly(this, timeElapsed);\n    if (this.moving.x !== 0) {\n      this.mirrored = this.moving.x < 0;\n    }\n  }\n\n  draw() {\n    const animation = this.tileset.animations[this.animation];\n    if (animation[this.animationFrame]) {\n      drawEngine.drawBackgroundImage(\n        animation[this.animationFrame],\n        this.x - (this.tileset.tileSize - CELL_WIDTH) / 2,\n        this.y - (this.tileset.tileSize - CELL_HEIGHT) / 2,\n        this.mirrored,\n      );\n    }\n  }\n\n}\n","export const on = (event: number, listener: (detail: any) => void) => {\n  const eventName = String(event);\n  document.addEventListener(eventName, (e: Event) => {\n    listener((e as CustomEvent).detail);\n  });\n};\n\nexport const emit = (event: number, data?: any) => {\n  const eventName = String(event);\n  document.dispatchEvent(new CustomEvent(eventName, { detail: data }));\n};\n","import { colors } from '@/core/util/color';\nimport { CELL_HEIGHT, CELL_WIDTH } from '../constants';\n\nconst linePixels = (x0: number, y0: number, x1: number, y1: number): [number, number][] => {\n  const pixels: [number, number][] = [];\n  let dx = Math.abs(x1 - x0), sx = x0 < x1 ? 1 : -1;\n  let dy = -Math.abs(y1 - y0), sy = y0 < y1 ? 1 : -1;\n  let err = dx + dy, e2: number;\n\n  for (;;) {\n    pixels.push([x0, y0]);\n    if (x0 === x1 && y0 === y1) break;\n    e2 = 2 * err;\n    if (e2 >= dy) { err += dy; x0 += sx; }\n    if (e2 <= dx) { err += dx; y0 += sy; }\n  }\n  return pixels;\n};\n\nconst pentagramVertices = (cx: number, cy: number, pentagramRotation: number, radius: number): [number, number][] => {\n  const points: [number, number][] = [];\n  for (let i = 0; i < 5; i++) {\n    const angle = (2 * Math.PI * (i * 2 % 5)) / 5 - Math.PI / 2 + pentagramRotation;\n    const x = Math.round(cx + radius * Math.cos(angle));\n    const y = Math.round(cy + radius * Math.sin(angle));\n    points.push([x, y]);\n  }\n  return points;\n};\n\nconst _rotations = [Math.PI / 2, Math.PI, 3 * Math.PI / 2] as const;\n\nexport class PentagramAnimation {\n  cx: number;\n  cy: number;\n  allPixels: [number, number][];\n  totalDuration: number;\n\n  constructor(\n    public ctx: CanvasRenderingContext2D,\n    x: number,\n    y: number,\n    public animationDone: () => void,\n    private pentagramRotation: typeof _rotations[number] = Math.PI / 2,\n    private radius: number = 12,\n    private offset = 0,\n    private elapsed = 0,\n    private speed = 300,\n    private trailLength = 16,\n    private cycles = 0,\n    private maxCycles = 1,\n    private active = true,\n  ) {\n    this.cx = x + CELL_WIDTH / 2;\n    this.cy = y + CELL_HEIGHT / 2;\n\n    const points = pentagramVertices(this.cx, this.cy, pentagramRotation, radius);\n\n    this.allPixels = [];\n    for (let i = 0; i < 5; i++) {\n      const [x0, y0] = points[i];\n      const [x1, y1] = points[(i + 1) % 5];\n      this.allPixels.push(...linePixels(x0, y0, x1, y1));\n    }\n    this.totalDuration = this.allPixels.length * this.maxCycles * 1000 / this.speed;\n  }\n\n  update(timeElapsed: number): void {\n    if (!this.active) return;\n\n    const totalPixelsAdvanced = (this.elapsed / 1000) * this.speed;\n    const newOffset = Math.floor(totalPixelsAdvanced) % this.allPixels.length;\n    \n    // Check for cycle completion\n    if (newOffset < this.offset) {\n      this.cycles++;\n      if (this.cycles >= this.maxCycles) {\n        this.active = false;\n        this.animationDone();\n        return;\n      }\n    };\n    \n    this.offset = newOffset;\n    this.elapsed += timeElapsed;\n  }\n\n  draw(): void {\n    if (!this.active) return;\n\n    this.ctx.fillStyle = colors.white;\n    const effectiveTrailLength = Math.min(this.trailLength, this.offset);\n    \n    for (let i = 0; i < effectiveTrailLength; i++) {\n      const idx = (this.offset - i + this.allPixels.length) % this.allPixels.length;\n      const [x, y] = this.allPixels[idx];\n      this.ctx.fillRect(x, y, 1, 1);\n    }\n  }\n\n  isActive(): boolean {\n    return this.active;\n  }\n}\n","export const forEachSurroundingCell = (\n  centerCol: number,\n  centerRow: number,\n  callback: (col: number, row: number) => void,\n  includeCenter: boolean = false\n) => {\n  for (let deltaRow = -1; deltaRow <= 1; deltaRow++) {\n    for (let deltaCol = -1; deltaCol <= 1; deltaCol++) {\n      if (!includeCenter && deltaRow === 0 && deltaCol === 0) continue;\n      callback(centerCol + deltaCol, centerRow + deltaRow);\n    }\n  }\n};\n","\nconst t = (i: number, n: number)=>(n-i)/n;\n\n// Reuse a single AudioContext to avoid memory leaks\nlet audioCtx: AudioContext | null = null;\n\n// Sound player\nexport const playSound = (f: (i: number) => number) => {\n  if (!audioCtx) audioCtx = new AudioContext();\n  const m = audioCtx.createBuffer(1,96e3,48e3);\n  const b = m.getChannelData(0);\n  for(let i = 96e3; i--;) b[i] = f(i);\n  const s = audioCtx.createBufferSource();\n  s.buffer=m;\n  s.connect(audioCtx.destination);\n  s.start();\n};\n\n// Sound\n// export const ooof = (pitch: number) => playSound((i: number) => {\n//   var n=2e4;\n//   if (i > n) return 0;\n//   var q = t(i,n);\n//   return 0.2 * Math.tan(Math.cbrt(Math.sin(i/(145 - 5 * pitch))))*q*q;\n// });\n\n// export const doorSound = () => playSound((i: number) => {\n//   return 0.1 * Math.sin(i/50 + Math.random()*50) * (8000 - i%8000) / 5000 * Math.exp(-i/8000);\n// });\n\nexport const step = (length = 1) => playSound((i: number) => {\n  const n = 2e3 * length;\n  return i > n ? 0 : 0.15 * (Math.random() * 2 - 1) * Math.sin((Math.PI * i) / n);\n});\n\nexport const attack5 = () => playSound((i: number) => {\n  const n = 29e3;\n  if (i > n) return 0;\n  const decay = i > n * 0.6 ? Math.pow(0.9999, i - n * 0.6) : 1;\n  const phase = 5 * Math.sin(5 * Math.round(5 * i / n));\n  return decay * 0.2 * Math.sin(i/(30 - phase) + Math.random()) * (8000 - i%6000) / 5000;\n});\n\nexport const attack = () => playSound((i: number) => {\n  const n = 10e3;\n  if (i > n) return 0;\n  const phase = 5 * Math.sin(5 * Math.round(5 * i / n));\n  return Math.pow(0.998, i / 10) * 0.2 * Math.sin(i/(40 - phase) + Math.random()) * (8000 - i%6000) / 5000;\n});\n\nexport const repair = (pitch: number) => playSound((i: number) => {\n  return Math.sin(i/(21 - pitch) + Math.sin(i/2000)*5) * Math.exp(-i/4000) * (i/96000) * 9;\n});\n\nexport const hissAndSpit = () => playSound((i: number) => {\n  const n = 10e3;\n  if (i > n) return 0;\n  const q = (n - i) / n;\n  return ((Math.random() * 2 - 1) * Math.sin(i * 0.003) * 0.6 + Math.sin(i / (15 + Math.sin(i / 500) * 8)) * Math.exp(-i / 2000) * 0.4) * q * q * 0.3;\n});\n\nexport const heal = () => playSound((i: number) => {\n  const n = 6e3;\n  if (i > n) return 0;\n  var q = (n - i) / n;\n  return 0.5 * Math.sin(i*0.01*Math.sin(0.007*i+Math.sin(i/1200))+Math.sin(i/800))*q*q;\n});\n\nexport const exorcise = () => {\n  const x = ~(Math.random() * 1000);\n  return playSound((i: number) => {\n    return Math.sin(i/(10 + i/8000 - i/12000) & x + Math.sin(i/2000)*5) * Math.exp(-i/4000) * (i/96000) * 9;\n  });\n};\n","import { CatStates, GameAssets } from '@/game/game-assets';\nimport { GameObject } from '../../core/game-object';\nimport { controls } from '../../core/controls';\nimport { GameMap } from '../game-map';\nimport { CELL_HEIGHT, CELL_WIDTH, statues } from '../constants';\nimport { emit, on } from '@/core/event';\nimport { addTimeEvent } from '@/core/timer';\nimport { Spirit } from './spirit';\nimport { GameData } from '../game-data';\nimport { PentagramAnimation } from './pentagram-attack';\nimport { forEachSurroundingCell } from '../grid-utils';\nimport { drawEngine } from '@/core/draw-engine';\nimport { GameEvent } from '../event-manifest';\nimport { attack, attack5, step } from '@/core/audio';\n\nconst ANIMATION_SLOW = 600;\nconst ANIMATION_NORMAL = 150;\nconst ANIMATION_FAST = 75;\n\nconst STEP_SOUND_TIME = 200;\n\nexport class Player extends GameObject<CatStates> {\n  type = 'cat';\n  sleeping = true;\n  attacking = false;\n  scared = false;\n  inVillage = false;\n  pentagramAttack: PentagramAnimation | null = null;\n  stepSoundTimer = 0;\n\n  constructor(col: number, row: number, public map: GameMap, public gameData: GameData) {\n    super(\n      GameAssets.cat,\n      col * CELL_WIDTH,\n      row * CELL_HEIGHT,\n      'cat',\n      CatStates.sleep,\n      80,\n    );\n\n    this.aD = ANIMATION_SLOW;\n    \n    // Initialize looking direction to the right\n    this.map.playerLookingAt = { col: col + 1, row };\n\n    on(GameEvent.TELEPORT, () => {\n      this.setPos(statues.heart.x, statues.heart.y + 1);\n    });\n\n    on(GameEvent.WAKE_UP, () => {\n      this.sleeping = false;\n      this.aD = ANIMATION_NORMAL;\n    });\n\n    on(GameEvent.ATTACK_PLAYER, () => {\n      this.scared = true;\n      this.aD = ANIMATION_FAST;\n      addTimeEvent(() => {\n        this.aD = ANIMATION_NORMAL;\n        this.scared = false;\n      }, 600);\n    });\n\n    on(GameEvent.GAME_OVER, () => {\n      this.animation = CatStates.die;\n      this.animationTime = 0;\n      this.aD = ANIMATION_SLOW;\n      this.animationLoop = false;\n    });\n  }\n\n  update(timeElapsed: number) {\n    super.update(timeElapsed);\n\n    if (this.animation === CatStates.die) return;\n\n    if (this.animation == CatStates.run) {\n      this.stepSoundTimer -= timeElapsed;\n      if (this.stepSoundTimer <= 0) {\n        step();\n        this.stepSoundTimer = STEP_SOUND_TIME;\n      }\n    } else {\n      this.stepSoundTimer = 0;\n    }\n\n    const cellVillage = this.map.grid[this.row][this.col].village;\n    if (!this.inVillage && cellVillage) {\n      this.inVillage = true;\n      emit(GameEvent.ENTER_VILLAGE, cellVillage);\n    } else if (this.inVillage && !cellVillage) {\n      this.inVillage = false;\n    }\n\n    // DEBUG\n    coords.innerText = `${this.col},${this.row}`;\n\n    if (this.gameData.cutscene) {\n      return;\n    }\n    \n    if(this.scared && !this.isSurrounded()) {\n      this.animation = CatStates.scared;\n    } else if (this.sleeping) {\n      this.animation = CatStates.sleep;\n    } else if (this.attacking) {\n      this.animation = CatStates.scratch;\n    } else {\n      super.updatePositionSmoothly(timeElapsed);\n\n\n      if (!this.moving.y && controls.inputDirection.y) {\n        const newRow = this.row + controls.inputDirection.y;\n        \n        if (!this.map.grid[newRow][this.col].content) {\n          this.animation = CatStates.run;\n          this.moving.y = controls.inputDirection.y;\n          this.targetPos.y += controls.inputDirection.y * CELL_HEIGHT;\n          this.row = newRow;\n          // Update looking direction after movement to point ahead\n          this.map.playerLookingAt = { col: this.col, row: this.row + controls.inputDirection.y };\n        } else {\n          // Blocked movement - still update looking direction to attempted target\n          this.map.playerLookingAt = { col: this.col, row: this.row + controls.inputDirection.y };\n        }\n      }\n\n      if (!this.moving.x && controls.inputDirection.x) {\n        this.mirrored = controls.isLeft;\n        const newCol = this.col + controls.inputDirection.x;\n        \n        if (!this.map.grid[this.row][newCol].content) {\n          this.animation = CatStates.run;\n          this.moving.x = controls.inputDirection.x;\n          this.targetPos.x += controls.inputDirection.x * CELL_WIDTH;\n          this.col = newCol;\n          // Update looking direction after movement to point ahead  \n          this.map.playerLookingAt = { col: this.col + controls.inputDirection.x, row: this.row };\n        } else {\n          // Blocked movement - still update looking direction to attempted target\n          this.map.playerLookingAt = { col: this.col + controls.inputDirection.x, row: this.row };\n        }\n      }\n\n      if (!this.moving.x && !this.moving.y) {\n        this.animation = CatStates.idle;\n      }\n\n      // When not attacking, check if playerLookingAt is empty;\n      // If playerLookingAt is empty, look into 4 directions;\n      // If one of the directions is type spirit, set that direction as playerLookingAt;\n      // Else if one of the directions is a statue or obelisk, set that direction as playerLookingAt.\n      if (!this.attacking) {\n        this.autoSelectTarget();\n      }\n\n      if (!this.attacking && controls.isAction1 && !controls.previousState.isAction1) {\n        this.attacking = true;\n        this.animationTime = 0;\n\n        if (!this.pentagramAttack && this.isSurrounded()) {\n          console.log('pentagram start');\n          \n          this.pentagramAttack = new PentagramAnimation(\n            drawEngine.ctx1,\n            this.x,\n            this.y,\n            () => {\n              console.log('pentagram end');\n              this.pentagramAttack = null;\n              this.attackAllEnemiesAround();\n              this.attacking = false;\n              attack5();\n            },\n          );\n        } else {\n          // Check if there is an enemy right in front\n          addTimeEvent(() => this.attackEnemyInFront(), 500);\n          addTimeEvent(() => {\n            this.attacking = false;\n          }, this.aD * 5);\n        }\n      }\n    }\n    this.pentagramAttack?.update(timeElapsed);\n  }\n\n  // Deals 5 damage to all spirits\n  // in the 9 cells around the cat.\n  attackAllEnemiesAround() {\n    forEachSurroundingCell(this.col, this.row, (col, row) => {\n      const cell = this.map.grid[row][col];\n      if (cell.content?.type === 'spirit') {\n        const spirit = cell.content as Spirit;\n        spirit.takeDamage(5);\n      }\n    });\n  }\n\n  // Returns true if there are 3 or more spirits\n  // in the 9 cells around the cat.\n  isSurrounded() {\n    let spiritCount = 0;\n    forEachSurroundingCell(this.col, this.row, (col, row) => {\n      const cell = this.map.grid[row][col];\n      if (cell.content?.type === 'spirit') {\n        spiritCount++;\n      }\n    });\n    return spiritCount >= 3;\n  }\n\n  draw() {\n    super.draw();\n    this.pentagramAttack?.draw();\n  }\n\n  private autoSelectTarget() {\n    // Check if current looking position is empty\n    const currentCell = this.map.getLookingAt();\n    if (currentCell?.content) {\n      return; // Already looking at something\n    }\n\n    // Check 4 directions around player\n    const directions = [\n      { col: this.col + 1, row: this.row, facing: 'right' },\n      { col: this.col - 1, row: this.row, facing: 'left' },\n      { col: this.col, row: this.row + 1, facing: 'down' },\n      { col: this.col, row: this.row - 1, facing: 'up' },\n    ];\n\n    let spiritTarget = null;\n    let statueTarget = null;\n    let spiritFacing = null;\n    let statueFacing = null;\n\n    for (const dir of directions) {\n      const cell = this.map.grid[dir.row][dir.col];\n      if (!cell.content) continue;\n\n      const contentType = cell.content.type;\n\n      // Prioritize spirits first\n      if (contentType === 'spirit') {\n        spiritTarget = { col: dir.col, row: dir.row };\n        spiritFacing = dir.facing;\n        break; // Spirit has highest priority, stop searching\n      }\n\n      // Store statue/obelisk as backup\n      if ((contentType === 'statue' || contentType === 'obelisk') && !statueTarget) {\n        statueTarget = { col: dir.col, row: dir.row };\n        statueFacing = dir.facing;\n      }\n    }\n\n    // Set target and facing based on priority: spirit > statue/obelisk\n    if (spiritTarget) {\n      this.map.playerLookingAt = spiritTarget;\n      if (spiritFacing === 'left') this.mirrored = true;\n      else if (spiritFacing === 'right') this.mirrored = false;\n      // Optionally handle up/down facing if needed\n    } else if (statueTarget) {\n      this.map.playerLookingAt = statueTarget;\n      if (statueFacing === 'left') this.mirrored = true;\n      else if (statueFacing === 'right') this.mirrored = false;\n      // Optionally handle up/down facing if needed\n    }\n  }\n\n  private attackEnemyInFront() {\n    // Check if there's a spirit at the target position\n    const cell = this.map.getLookingAt();\n    if (cell.content && cell.content.type === 'spirit') {\n      const spirit = cell.content as Spirit;\n      spirit.takeDamage(1);\n      attack();\n    } else if (cell.content && cell.content.type === 'field') {\n      cell.content = null;\n      step(3);\n    }\n  }\n}\n","import { CELL_HEIGHT, CELL_WIDTH } from '@/game/constants';\nimport { Drawable } from '@/game/Drawable';\nimport { drawEngine } from './draw-engine';\n\nexport class GameStaticObject implements Drawable {\n  public col: number;\n  public row: number;\n  public offsetX: number;\n  public offsetY: number;\n\n  constructor(\n    public img: HTMLImageElement,\n    public x: number,\n    public y: number,\n    public type: string,\n  ) {\n    this.col = Math.ceil(x / CELL_WIDTH);\n    this.row = Math.ceil(y / CELL_HEIGHT);\n    this.offsetX = x - Math.round((img.width - CELL_WIDTH) / 2);\n    this.offsetY = y - Math.round((img.height - CELL_HEIGHT) / 2);\n  }\n\n  draw() {\n    drawEngine.drawBackgroundImage(this.img, this.offsetX, this.offsetY);\n  }\n}\n","import { GameAssets } from '@/game/game-assets';\nimport { drawEngine } from '@/core/draw-engine';\nimport { CELL_WIDTH, CELL_HEIGHT } from '@/game/constants';\nimport { GameStaticObject } from '@/core/game-static-object';\n\nexport class Tree extends GameStaticObject {\n  private neighbors: { top: boolean; bottom: boolean; left: boolean; right: boolean } = {\n    top: false,\n    bottom: false,\n    left: false,\n    right: false,\n  };\n\n  constructor(\n    public x: number,\n    public y: number,\n    treeType: 'oak' | 'spruce',\n  ) {\n    super(\n      GameAssets[treeType],\n      x,\n      y,\n      treeType,\n    );\n  }\n\n  setNeighbors(neighbors: { top: boolean; bottom: boolean; left: boolean; right: boolean }) {\n    this.neighbors = neighbors;\n  }\n\n  draw() {\n    if (this.neighbors.right) {\n      drawEngine.drawBackgroundImage(this.img, Math.round(this.offsetX + CELL_WIDTH / 2), this.offsetY - CELL_HEIGHT / 2);\n    }\n    super.draw();\n  }\n}\n","// Seeded \"random\" number generator for deterministic randomness\nexport class SeededRandom {\n  constructor(public rngSeed: number = 47) {}\n  \n  next(): number {\n    this.rngSeed = (this.rngSeed * 9301 + 49297) % 233280;\n    return this.rngSeed / 233280;\n  }\n  \n  range(min: number, max: number): number {\n    return min + this.next() * (max - min);\n  }\n}\n","import { GameAssets } from '../game-assets';\nimport { CELL_HEIGHT, CELL_WIDTH } from '../constants';\nimport { GameStaticObject } from '@/core/game-static-object';\n\nexport class House extends GameStaticObject {\n  name;\n\n  constructor(col: number, row: number, name = '') {\n    super(\n      GameAssets.house,\n      col * CELL_WIDTH,\n      row * CELL_HEIGHT,\n      'house',\n    );\n    this.name = name;\n  }\n}\n","import { GameObject } from '@/core/game-object';\nimport { GameAssets, VillagerStates } from '../game-assets';\nimport { CELL_HEIGHT, CELL_WIDTH } from '../constants';\nimport { GameMap } from '../game-map';\nimport { emit } from '@/core/event';\nimport { GameEvent } from '../event-manifest';\n\nexport class Villager extends GameObject<VillagerStates> {\n  lastDirection: { x: number; y: number } | null = null;\n  moveTimer: number = 0;\n  moveInterval: number = 1000;\n  isScared = false;\n\n  constructor(col: number, row: number, private map: GameMap) {\n    super(\n      GameAssets.villager,\n      col * CELL_WIDTH,\n      row * CELL_HEIGHT,\n      'villager',\n      VillagerStates.walk,\n      10,\n    );\n  }\n\n  update(timeElapsed: number): void {\n    super.update(timeElapsed);\n\n    this.moveTimer += timeElapsed;\n    if (this.seesCat()) {\n      if (!this.isScared && this.moveTimer >= this.moveInterval) {\n        this.moveTimer = 0;\n        this.isScared = true;\n      }\n      if (this.moveTimer % (this.moveInterval / 5) < timeElapsed) {\n        emit(GameEvent.SCARED);\n      }\n      this.animation = VillagerStates.scared;\n      this.aD = 50;\n    } else {\n      this.isScared = false;\n      this.aD = 150;\n      if (this.moveTimer >= this.moveInterval) {\n        this.takeNextStep();\n        this.moveTimer = 0;\n      }\n      this.updatePositionSmoothly(timeElapsed);\n    }\n  }\n\n  // Looks around for an empty cell to move to.\n  // Has 50% chance of moving forward in the same direction as before.\n  // Otherwise moves in a random direction, if that direction is free. \n  takeNextStep(): void {\n    const directions = [\n      { x: 0, y: -1 },\n      { x: 0, y: 1 }, \n      { x: 1, y: 0 },\n      { x: -1, y: 0 }\n    ];\n\n    // 80% chance to continue in same direction\n    if (this.lastDirection && Math.random() < 0.8) {\n      const newCol = this.col + this.lastDirection.x;\n      const newRow = this.row + this.lastDirection.y;\n      if (this.isValidMove(newCol, newRow)) {\n        this.col = newCol;\n        this.row = newRow;\n        this.targetPos = { x: newCol * CELL_WIDTH, y: newRow * CELL_HEIGHT };\n        this.lastDirection = this.lastDirection;\n        this.animation = VillagerStates.walk;\n        return;\n      }\n    }\n\n    // Try random directions without shuffling\n    for (let i = 0; i < 10; i++) {\n      const dir = directions[Math.floor(Math.random() * 4)];\n      const newCol = this.col + dir.x;\n      const newRow = this.row + dir.y;\n      if (this.isValidMove(newCol, newRow)) {\n        this.col = newCol;\n        this.row = newRow;\n        this.targetPos = { x: newCol * CELL_WIDTH, y: newRow * CELL_HEIGHT };\n        this.lastDirection = dir;\n        this.animation = VillagerStates.walk;\n        return;\n      }\n    }\n  }\n\n  private isValidMove(col: number, row: number): boolean {\n    // Check if cell is empty\n    const cell = this.map.grid[row][col];\n    return cell.content === null;\n  }\n\n  /**\n   * Checks 2 cells in front in the movement direction for a cat.\n   */\n  seesCat(): boolean {\n    if (!this.lastDirection) return false;\n\n    for (let i = 1; i <= 2; i++) {\n      const checkCol = this.col + this.lastDirection.x * i;\n      const checkRow = this.row + this.lastDirection.y * i;\n      \n      const cell = this.map.grid[checkRow]?.[checkCol];\n      if (cell?.content?.type === 'cat') {\n        return true;\n      }\n    }\n\n    return false;\n  }\n}\n","import { CELL_HEIGHT, CELL_WIDTH } from '../constants';\nimport { GameStaticObject } from '@/core/game-static-object';\nimport { GameAssets } from '../game-assets';\n\nexport class Farm extends GameStaticObject {\n  constructor(col: number, row: number) {\n    super(\n      GameAssets.grass,\n      col * CELL_WIDTH,\n      row * CELL_HEIGHT,\n      'field',\n    );\n  }\n}\n","import { SeededRandom } from '@/core/util/rng';\nimport { House } from './house';\nimport { GameMap } from '../game-map';\nimport { Villager } from './villager';\nimport { Farm } from './farm';\n\nexport class Village {\n  houses: House[] = [];\n  farms: Farm[] = [];\n  villagers: Villager[] = [];\n\n  constructor(\n    public name: string,\n    public center: { x: number; y: number },\n    public radius: number,\n    public houseCount: number,\n    public population: number,\n  ) {\n    this.center = center;\n    this.radius = radius;\n  }\n\n  private generatePosition(rng: SeededRandom, existing: { x: number; y: number }[], map: GameMap): { x: number; y: number } {\n    let col: number;\n    let row: number;\n    do {\n      const angle = rng.range(0, Math.PI * 2);\n      const distance = rng.range(1, this.radius - 1);\n      col = Math.round(this.center.x + Math.cos(angle) * distance);\n      row = Math.round(this.center.y + Math.sin(angle) * distance);\n    } while (\n      col < 0 ||\n      row < 0 ||\n      map.get(col, row)?.content !== null ||\n      existing.some(item => item.x === col && item.y === row)\n    );\n    return { x: col, y: row };\n  }\n\n  generateHouses(rng: SeededRandom, map: GameMap): House[] {\n    for (let i = 0; i < this.houseCount; i++) {\n      const pos = this.generatePosition(rng, this.houses, map);\n      const houseCol = pos.x + pos.x % 2;\n      const houseRow = pos.y + pos.y % 2;\n      this.houses.push(new House(houseCol, houseRow));\n    }\n    return this.houses;\n  }\n\n  generateFarms(rng: SeededRandom, map: GameMap): Farm[] {\n    const farmCount = this.houseCount;\n    for (let i = 0; i < farmCount; i++) {\n      const pos = this.generatePosition(rng, this.farms, map);\n      \n      // Create a 2x2 farm block\n      for (let dx = 0; dx < 2; dx++) {\n        for (let dy = 0; dy < 2; dy++) {\n          this.farms.push(new Farm(pos.x + dx, pos.y + dy));\n        }\n      }\n    }\n    return this.farms;\n  }\n\n  generateVillagers(rng: SeededRandom, map: GameMap): Villager[] {\n    for (let i = 0; i < this.population; i++) {\n      const pos = this.generatePosition(rng, this.farms, map);\n      this.villagers.push(new Villager(pos.x, pos.y, map));\n    }\n    return this.villagers;\n  }\n}\n","import { drawEngine } from '@/core/draw-engine';\nimport { CELL_HEIGHT, CELL_WIDTH } from '../constants';\n\nexport class Icon {\n  x: number;\n  y: number;\n\n  constructor(\n    public readonly icon: HTMLImageElement,\n    public col: number,\n    public row: number,\n    public type: string,\n  ) {\n    this.x = Math.round(this.col * CELL_WIDTH + (CELL_WIDTH - this.icon.width) / 2);\n    this.y = Math.round(this.row * CELL_HEIGHT + (CELL_HEIGHT - this.icon.height) / 2);\n  }\n\n  draw() {\n    drawEngine.drawBackgroundImage(this.icon, this.x, this.y);\n  }\n}\n","import { Cell } from './types';\n\nexport interface Coords {\n  col: number;\n  row: number;\n}\n\nexport interface Position {\n  x: number;\n  y: number;\n}\n\nexport interface PathNode {\n  pos: Position;\n  distance: number;\n  previous?: PathNode;\n}\n\n// Directions: north, south, east, west\nconst directions: ReadonlyArray<Readonly<{ x: number; y: number }>> = [\n  { x: 0, y: -1 }, // north\n  { x: 0, y: 1 },  // south\n  { x: 1, y: 0 },  // east\n  { x: -1, y: 0 }  // west\n] as const;\n\n/**\n * Breadth-first search to find the nearest cell that matches a condition\n * @param grid - 2D array representing the game map\n * @param start - Starting position {x, y}\n * @param matchCondition - Function that returns true if the cell satisfies the condition\n * @param maxSteps - Maximum number of steps to search\n * @returns The position of the matching cell, or null if not found\n */\nexport function findNearestMatch<T>(\n  grid: T[][],\n  start: Position,\n  matchCondition: (cell: T, x: number, y: number) => boolean,\n  maxSteps: number\n): Position | null {\n  const rowCount = grid.length;\n  const colCount = grid[0]?.length || 0;\n\n  if (colCount === 0 || rowCount === 0) return null;\n\n  // Check if starting position matches\n  if (matchCondition(grid[start.y][start.x], start.x, start.y)) {\n    return start;\n  }\n\n  const visited = new Set<string>();\n  const queue: PathNode[] = [{ pos: start, distance: 0 }];\n  visited.add(`${start.x},${start.y}`);\n\n  while (queue.length > 0) {\n    const current = queue.shift()!;\n\n    // Check all 4 directions\n    for (const dir of directions) {\n      const newX = current.pos.x + dir.x;\n      const newY = current.pos.y + dir.y;\n      const newDistance = current.distance + 1;\n\n      // Check max steps only\n      if (newDistance > maxSteps) {\n        continue;\n      }\n\n      const key = `${newX},${newY}`;\n      if (visited.has(key)) {\n        continue;\n      }\n\n      visited.add(key);\n\n      // Check if this cell matches our condition\n      if (matchCondition(grid[newY][newX], newX, newY)) {\n        return { x: newX, y: newY };\n      }\n\n      // Add to queue for further exploration\n      queue.push({\n        pos: { x: newX, y: newY },\n        distance: newDistance,\n        previous: current\n      });\n    }\n  }\n\n  return null; // No matching cell found within maxSteps\n}\n\nconst toKey = (col: number, row: number) => {\n  return `${col},${row}`;\n};\n\n// const fromKey = (key): Coords => {\n//   const [col ,row] = key.split(',').map(Number);\n//   return { col, row };\n// };\n\nconst reconstructPath = (parents: Record<string, Coords>, start: Coords, goal: Coords) => {\n  const path: Coords[] = [];\n  let current = goal;\n  while (current != start) {\n    path.unshift(current);\n    current = parents[toKey(current.col, current.row)];\n  }\n  path.unshift(start);\n  return path;\n};\n\n/**\n * Uses breadth-first-search to find the shortest path from\n * start to goal, and returns the path as an array of coords.\n * The path will take at most maxSteps steps.\n * This algo assumes that the map is fully enclosed by a boundary\n * so it is not checking whether the coordinates are valid.\n */\nexport const findShortestPath = (\n  grid: Cell[][],\n  start: Coords,\n  goal: Coords,\n  maxSteps = 100,\n) => {\n  let steps = maxSteps;\n\n  // Start from person A’s position.\n  // Keep a queue of cells to explore.\n  const queue: Coords[] = [start];\n\n  // Keep a record of which cells you’ve already visited, so you don’t loop back.\n  const visited = new Set();\n\n  // Keep a map of coords->cells that keeps track of the paths taken\n  const parents: Record<string, Coords> = {};\n\n  while (queue.length !== 0 && steps--) {\n    // Get the oldest cell from the queue\n    const current = queue.shift() as Coords;\n    if (current.col === goal.col && current.row === goal.row) {\n      return reconstructPath(parents, start, goal);\n    }\n\n    // Check the 4 immediate neighbours\n    const neighbours = directions.map(({x, y}) => grid[current.row + y][current.col + x]);\n    neighbours.forEach((neighbour) => {\n      if (!visited.has(neighbour)) {\n        visited.add(neighbour);\n        if (neighbour.content === null || (neighbour.x == goal.col && neighbour.y == goal.row)) {\n          parents[toKey(neighbour.x, neighbour.y)] = current;\n          queue.push({ col: neighbour.x, row: neighbour.y });\n        }\n      }\n    });\n  }\n};\n\n","import { drawEngine } from '@/core/draw-engine';\nimport { colors } from '@/core/util/color';\nimport { CELL_WIDTH } from '../constants';\n\nconst defaultColors: [string, string, string, string] = [colors.blue1, colors.blue2, colors.purple5, colors.purple4];\n\nexport const drawHpBar = (\n  hp: number,\n  maxHp: number,\n  x: number,\n  y: number,\n  colorHP = defaultColors,\n) => {\n  const hpRatio = Math.max(0, Math.min(1, hp / maxHp));\n  const barWidth = CELL_WIDTH;\n  const barHeight = 1;\n  const hpWidth = Math.ceil(barWidth * hpRatio);\n  const barX = x;\n  const barY = y - 5;\n\n  drawEngine.ctx1.fillStyle = colorHP[0];\n  drawEngine.ctx1.fillRect(barX, barY, hpWidth, barHeight);\n  drawEngine.ctx1.fillStyle = colorHP[1];\n  drawEngine.ctx1.fillRect(barX, barY + 1, hpWidth, barHeight);\n\n  drawEngine.ctx1.fillStyle = colorHP[2];\n  drawEngine.ctx1.fillRect(\n    barX + hpWidth,\n    barY,\n    barWidth - hpWidth,\n    barHeight,\n  );\n  drawEngine.ctx1.fillStyle = colorHP[3];\n  drawEngine.ctx1.fillRect(\n    barX + hpWidth,\n    barY +\n    1,\n    barWidth - hpWidth, barHeight,\n  );\n};\n","import { emojiToPixelArt } from '@/core/emoji';\nimport { Icon } from './icon';\nimport { drawEngine } from '@/core/draw-engine';\nimport { CELL_HEIGHT, CELL_WIDTH } from '../constants';\nimport { GameMap } from '../game-map';\nimport { updatePositionSmoothly, SmoothMovementState, setTargetPosition } from '@/utils/smooth-movement';\nimport { Coords, findShortestPath } from '../path-findind';\nimport { addTimeEvent } from '@/core/timer';\nimport { emit } from '@/core/event';\nimport { drawHpBar } from './hp-bar';\nimport { GameEvent } from '../event-manifest';\nimport { exorcise } from '@/core/audio';\n\nexport type SpiritType = '☁️' | '👻' | '👹' | '🧿' | '🦀' | '🌵' | '🥨' | '🧚🏻‍♀️' | '💀';\n\ninterface SpiritSpecies {\n  type: SpiritType,\n  icon: HTMLImageElement,\n  level: number,\n}\n\nexport const spirits = ([\n  '☁️', '🥨', '🌵', '🧚🏻‍♀️', '🦀', '👻', '👹', '🧿', '💀'\n] as const).reduce<Record<SpiritType, SpiritSpecies>>((acc, type, index) => {\n  acc[type] = { icon: emojiToPixelArt(type), type, level: Math.ceil((index) / 2) };\n  return acc;\n}, {} as Record<SpiritType, SpiritSpecies>);\n\nconst enum SpiritState {\n  IDLE,\n  MOVING,\n  WINDING,\n  ATTACKING,\n  RESTING\n}\n\nexport class Spirit extends Icon implements SmoothMovementState {\n\n  aD = 2000;\n  animationTime = 0;\n  opacity = 0;\n  species: SpiritSpecies;\n  map: GameMap;\n  searchRadius = 9;\n  moveTimer = 0;\n  moveInterval = 600;\n  targetPos: { x: number; y: number };\n  moving = { x: 0, y: 0 };\n  speed = 20;\n  maxHp: number;\n  hp: number;\n  dead = false;\n  recoil = false;\n  \n  // Simplified state system\n  state: number = SpiritState.IDLE;\n  attackTimer = 0;\n  attackDuration = 1000;\n  attackTarget: Coords | null = null;\n  attackOffsetX = 0;\n  attackOffsetY = 0;\n\n  constructor(\n    col: number,\n    row: number,\n    type: SpiritType,\n    map: GameMap,\n  ) {\n    super(spirits[type].icon, col, row, 'spirit');\n    this.species = spirits[type];\n    this.map = map;\n    this.targetPos = { x: this.x, y: this.y };\n    this.maxHp = Math.round(Math.pow(1.5, this.species.level + 1));\n    this.hp = this.maxHp;\n  }\n\n  update(timeElapsed: number) {\n    if (this.hp <= 0) return;\n\n    this.animationTime += timeElapsed * Math.pow(this.species.level + 0.5, 2);\n    if (this.opacity < 1) {\n      this.opacity += timeElapsed / this.aD;\n    }\n    if (this.animationTime >= this.aD) {\n      this.animationTime -= this.aD;\n    }\n\n    switch (this.state) {\n      case SpiritState.IDLE:\n      case SpiritState.MOVING:\n        updatePositionSmoothly(this, timeElapsed);\n        const playerCoords = this.lookAroundForPlayer();\n        if (playerCoords) {\n          this.moveTimer += timeElapsed;\n          if (this.moveTimer >= this.moveInterval) {\n            this.moveTowardsPlayer(playerCoords);\n            this.moveTimer = 0;\n          }\n        }\n        break;\n\n      case SpiritState.WINDING:\n      case SpiritState.ATTACKING:\n      case SpiritState.RESTING:\n        this.updateAttack(timeElapsed);\n        break;\n    }\n  }\n\n  private updateAttack(timeElapsed: number) {\n    this.attackTimer += timeElapsed;\n    const progress = this.attackTimer / this.attackDuration;\n    \n    if (!this.attackTarget) {\n      this.state = SpiritState.IDLE;\n      return;\n    }\n\n    const dirX = this.attackTarget.col - this.col;\n    const dirY = this.attackTarget.row - this.row;\n\n    if (progress < 0.7) {\n      // Winding up\n      if (this.state !== SpiritState.WINDING) this.state = SpiritState.WINDING;\n      const windProgress = progress / 0.7;\n      this.attackOffsetX = -dirX * windProgress * 3;\n      this.attackOffsetY = -dirY * windProgress * 3;\n    } else if (progress < 0.73) {\n      // Attacking\n      if (this.state !== SpiritState.ATTACKING) this.state = SpiritState.ATTACKING;\n      const attackProgress = (progress - 0.7) / 0.03;\n      this.attackOffsetX = dirX * (-3 + CELL_WIDTH * attackProgress);\n      this.attackOffsetY = dirY * (-3 + CELL_WIDTH * attackProgress);\n    } else if (progress < 1.0) {\n      // Resting (returning)\n      if (this.state !== SpiritState.RESTING) {\n        this.state = SpiritState.RESTING;\n        \n        // Only emit if player is still in the target cell\n        const cell = this.map.grid[this.attackTarget.row][this.attackTarget.col];\n        if (cell.content?.type === 'cat') {\n          emit(GameEvent.ATTACK_PLAYER, this.species.level);\n        }\n      }\n      const restProgress = (progress - 0.73) / 0.27;\n      this.attackOffsetX = dirX * 3 * (1 - restProgress);\n      this.attackOffsetY = dirY * 3 * (1 - restProgress);\n    } else {\n      // Attack complete\n      this.state = SpiritState.IDLE;\n      this.attackTimer = 0;\n      this.attackTarget = null;\n      this.attackOffsetX = 0;\n      this.attackOffsetY = 0;\n    }\n  }\n\n  private lookAroundForPlayer(): Coords | null {\n    // Search in a box around the spirit using the search radius\n    for (let dx = -this.searchRadius; dx <= this.searchRadius; dx++) {\n      for (let dy = -this.searchRadius; dy <= this.searchRadius; dy++) {\n        const searchCol = this.col + dx;\n        const searchRow = this.row + dy;\n\n        const cell = this.map.grid[searchRow][searchCol];\n        if (cell.content?.type === 'cat') {\n          return { col: searchCol, row: searchRow };\n        }\n      }\n    }\n    \n    return null;\n  }\n\n  private moveTowardsPlayer(playerCoords: Coords) {\n    const path = findShortestPath(\n      this.map.grid,\n      { col: this.col, row: this.row },\n      playerCoords,\n    );\n    if (path && path.length > 2) {\n      this.state = SpiritState.MOVING;\n      const nextStep = path[1];\n      setTargetPosition(this, nextStep.col, nextStep.row);\n      this.col = nextStep.col;\n      this.row = nextStep.row;\n      this.targetPos.x = nextStep.col * CELL_WIDTH;\n      this.targetPos.y = nextStep.row * CELL_HEIGHT;\n    } else if (path?.length === 2) {\n      // Start attack\n      this.state = SpiritState.WINDING;\n      this.attackTarget = path[1];\n      this.attackTimer = 0;\n    }\n  }\n\n  draw() {\n    const phase = Math.sin((this.animationTime / this.aD) * 2 * Math.PI);\n    drawEngine.ctx1.save();\n    drawEngine.ctx1.globalAlpha = this.opacity;\n\n    // Shadow\n    const shadow = Math.round(2 + 1 * phase) / 10;\n    drawEngine.ctx1.fillStyle = `rgba(0,0,0,${shadow})`;\n    drawEngine.ctx1.fillRect(\n      this.x + 3 + this.attackOffsetX,\n      this.y + CELL_HEIGHT * 3 / 4 + this.attackOffsetY,\n      this.icon.width - 6,\n      CELL_HEIGHT / 4 + 1,\n    );\n\n    if (this.hp < this.maxHp) {\n      drawHpBar(this.hp, this.maxHp, this.x, this.y);\n    }\n\n    // Icon\n    drawEngine.ctx1.save();\n    if (this.recoil) {\n      drawEngine.ctx1.filter = 'sepia(1) saturate(2) hue-rotate(260deg) brightness(0.7)';\n    }\n    drawEngine.ctx1.translate(\n      this.attackOffsetX,\n      this.attackOffsetY + Math.round(\n        (phase - 1) * 2\n      )\n    );\n    super.draw();\n    drawEngine.ctx1.restore();\n    drawEngine.ctx1.restore();\n  }\n\n  takeDamage(damage: number = 1): boolean {\n    this.hp -= damage;\n    this.recoil = true;\n    addTimeEvent(() => {\n      this.recoil = false;\n    }, 150);\n    if (this.hp <= 0) {\n      addTimeEvent(() => {\n        exorcise();\n        this.dead = true;\n      }, 1500);\n    }\n    return this.hp <= 0;\n  }\n}\n","/* eslint-disable max-classes-per-file */\nimport { GameAssets } from '../game-assets';\nimport { CELL_HEIGHT, CELL_WIDTH, MAX_REPAIR } from '../constants';\nimport { Spirit, spirits } from './spirit';\nimport { GameMap } from '../game-map';\nimport { GameData } from '../game-data';\nimport { drawHpBar } from './hp-bar';\nimport { colors } from '@/core/util/color';\nimport { drawEngine } from '@/core/draw-engine';\nimport { GameStaticObject } from '@/core/game-static-object';\n\nexport class Statue extends GameStaticObject {\n  static readonly State = {\n    BROKEN: 0,\n    ANIMATING: 1,\n    REPAIRED: 2\n  } as const;\n\n  spirits: Spirit[] = [];\n  maxSpirits = 4;\n  spawnTimer = 0;\n  spawnInterval = 1000;\n  spawnChance = 0.10;\n  spawnRadius = 10;\n  repair = 0;\n  state: number = Statue.State.BROKEN;\n  animationTime = 0;\n  repairD = 1500;\n  repairAnimationTimer = 0;\n  spiritsExorcised = false;\n  lastClearTime = 0;\n\n  /**\n   * Animation duration\n   */\n  aD = 800;\n\n  constructor(\n    col: number,\n    row: number,\n    public map: GameMap,\n    public gameData: GameData,\n    public name: string,\n  ) {\n    super(\n      GameAssets.statue,\n      col * CELL_WIDTH,\n      row * CELL_HEIGHT,\n      'statue',\n    );\n  }\n\n  updateAnimation(timeElapsed: number) {\n    this.animationTime += timeElapsed;\n  }\n\n  update(timeElapsed: number) {\n    this.spawnTimer += timeElapsed;\n\n    if (this.state === Statue.State.BROKEN && this.repair >= MAX_REPAIR) {\n      this.state = Statue.State.ANIMATING;\n      this.spiritsExorcised = false; // Reset flag when starting animation\n      this.lastClearTime = 0; // Reset clear timer\n    } else if (this.state === Statue.State.ANIMATING) {\n      this.repairAnimationTimer += timeElapsed;\n      if (this.repairAnimationTimer > this.repairD) {\n        this.state = Statue.State.REPAIRED;\n      }\n    }\n    \n    if (this.spawnTimer >= this.spawnInterval) {\n      this.spawnTimer = 0;\n\n      if (Math.random() < this.spawnChance) {\n        if (this.spirits.length < (this.maxSpirits + this.gameData.getLevel())) {\n          // Spawn new spirit\n          this.spawnSpirit();\n        } else if (this.spirits.length > 0) {\n          // Replace spirits with full HP\n          const replaceSpirit = this.spirits\n            .filter((spirit) => spirit.hp === spirit.maxHp)\n            [Math.round(Math.random() * this.spirits.length - 1)];\n          if (replaceSpirit) {\n            replaceSpirit.dead = true;\n            this.spawnSpirit();\n          }\n        }\n      }\n    }\n\n    this.spirits = this.spirits.filter(spirit => !spirit.dead);\n  }\n\n  draw() {\n    super.draw();\n    if (this.repair > 0 && this.repair < MAX_REPAIR) {\n      drawHpBar(this.repair, MAX_REPAIR, this.x, this.y, [colors.yellow1, colors.yellow2, colors.blue5, colors.blue6]);\n    }\n    if (this.state === Statue.State.REPAIRED) {\n      this.drawFaries();\n    }\n  }\n\n  postDraw() {\n    if (this.state === Statue.State.ANIMATING) {\n      this.drawAnimation();\n    }\n  }\n\n  drawFaries() {\n    const radius = 3;\n    drawEngine.ctx1.fillStyle = colors.purple0;\n    \n    for (let i = 0; i < 5; i++) {\n      const t = (this.animationTime + this.aD * 0.5 * i) / this.aD;\n      const theta = (i * 2 * Math.PI) / 3; // 0, 120°, 240°\n      // Offset distance from statue center\n      const offsetDist = 3; // adjust as needed\n      const offsetX = Math.cos(theta) * offsetDist;\n      const offsetY = Math.sin(theta) * offsetDist;\n\n      // Infinity path at t, rotated by theta\n      const x0 = radius * 2 * Math.sin(t);\n      const y0 = radius * Math.sin(2 * t);\n      const x = x0 * Math.cos(theta) - y0 * Math.sin(theta);\n      const y = x0 * Math.sin(theta) + y0 * Math.cos(theta);\n\n      // Final position: statue center + offset + rotated path\n      const px = Math.round(this.x + CELL_WIDTH / 2 + offsetX + x);\n      const py = Math.round(this.y + CELL_HEIGHT / 3 + offsetY + y);\n\n      drawEngine.ctx1.fillRect(px, py, 1, 1);\n    }\n  }\n\n  drawAnimation() {\n    const animationProgress = (3 * this.repairAnimationTimer / this.repairD) % 1;\n    \n    const maxWidth = c2.width / drawEngine.zoom;\n    const maxHeight = c2.height / drawEngine.zoom;\n    const cx = this.x + CELL_WIDTH / 2;\n    const cy = this.y + CELL_HEIGHT / 2;\n    const rx = maxWidth * animationProgress;\n    const ry = maxHeight * animationProgress;\n    drawEngine.drawCircumference(\n      drawEngine.ctx1,\n      cx,\n      cy,\n      rx,\n      ry,\n      colors.white,\n      8,\n    );\n    \n    if (this.repairAnimationTimer - this.lastClearTime >= 20) {\n      const progress = this.repairAnimationTimer / this.repairD;\n      this.map.clearCircleWithJitter(this.col, this.row, 20 * progress, true, 2, 0.3);\n      this.lastClearTime = this.repairAnimationTimer;\n    }\n    \n    // Only exorcise spirits once at the beginning of the animation\n    if (!this.spiritsExorcised) {\n      this.spirits.forEach(spirit => spirit.takeDamage(spirit.hp));\n      this.spiritsExorcised = true;\n    }\n  }\n\n  private spawnSpirit() {\n    // Find a random empty cell within a 20x20 area around the statue\n    const emptyCells: { x: number; y: number }[] = [];\n    const spawnRadius = Math.round(this.gameData.getLevel() + this.spawnRadius);\n    \n    // Collect all empty cells within the search radius\n    for (let dx = -spawnRadius; dx <= spawnRadius; dx++) {\n      for (let dy = -spawnRadius; dy <= spawnRadius; dy++) {\n        const x = this.col + dx;\n        const y = this.row + dy;\n        \n        // Check if cell is empty\n        if (this.map.grid[y][x].content === null) {\n          emptyCells.push({ x, y });\n        }\n      }\n    }\n\n    // Select a random empty cell\n    if (emptyCells.length > 0) {\n      const randomIndex = Math.floor(Math.random() * emptyCells.length);\n      const selectedPosition = emptyCells[randomIndex];\n      \n      // TODO: only spawn spirits of the appropriate level for the current game\n      const spiritTypes = Object.values(spirits)\n        .filter((spirit) => spirit.level < this.gameData.getLevel());\n      if (spiritTypes.length === 0) return;\n\n      const randomType = spiritTypes[Math.floor(Math.random() * spiritTypes.length)];\n      \n      const spirit = new Spirit(selectedPosition.x, selectedPosition.y, randomType.type, this.map);\n      this.spirits.push(spirit);\n      \n      // Place the spirit directly in the map\n      this.map.set(selectedPosition.x, selectedPosition.y, spirit);\n    }\n  }\n}\n","import { Tree } from './entities/tree';\nimport { SeededRandom } from '@/core/util/rng';\nimport { Village } from './entities/village';\nimport { CELL_HEIGHT, CELL_WIDTH, clearings, paths, statues } from './constants';\nimport { Statue } from './entities/statue';\nimport { Cell, Path } from './types';\nimport { Drawable } from './Drawable';\nimport { on } from '@/core/event';\nimport { Spirit } from './entities/spirit';\nimport { Coords } from './path-findind';\nimport { drawEngine } from '@/core/draw-engine';\nimport { GameAssets } from './game-assets';\nimport { GameData } from './game-data';\nimport { GameEvent } from './event-manifest';\nimport { Farm } from './entities/farm';\nimport { forEachSurroundingCell } from './grid-utils';\nimport { House } from './entities/house';\n\nexport class GameMap {\n  grid: Cell[][];\n  villages: Village[] = [];\n  private rng: SeededRandom;\n  playerLookingAt: Coords = { col: 0, row: 0 };\n\n  constructor(\n    public readonly colCount: number,\n    public readonly rowCount: number,\n    public gameData: GameData,\n  ) {\n    this.rng = new SeededRandom();\n\n    this.grid = Array.from({ length: rowCount }, (_a, y) =>\n      Array.from({ length: colCount }, (_b, x) => {\n        // Determine tree species based on distance from Heart Peak (70, 90)\n        const dx = x - 70;\n        const dy = y - 90;\n        const distanceFromHeartPeak = Math.sqrt(dx * dx + dy * dy);\n        \n        let treeType: 'oak' | 'spruce';\n        if (distanceFromHeartPeak <= 40) {\n          // Within 20 cell radius of Heart Peak: 90% spruce, 10% oak\n          treeType = this.rng.next() < 0.9 ? 'spruce' : 'oak';\n        } else {\n          // Rest of map: 20% spruce, 80% oak\n          treeType = this.rng.next() < 0.2 ? 'spruce' : 'oak';\n        }\n        \n        const tree = new Tree(\n          x * CELL_WIDTH - (16 - CELL_WIDTH) / 2, // Adjust x to center the image\n          y * CELL_HEIGHT - (16 - CELL_HEIGHT) / 2, // Adjust y to center the image\n          treeType\n        );\n        return { x, y, content: tree };\n      })\n    );\n\n    this.villages = [\n      new Village('Heart Peak', { x: 70, y: 90 }, 12, 0, 0),\n      new Village('Pine Rest', { x: 99, y: 100 }, 6, 2, 3),\n      new Village('Oak Branch', { x: 42, y: 51 }, 4, 3, 4),\n      new Village('Cat Foot', { x: 48, y: 140 }, 5, 4, 5),\n      new Village('Black Tail', { x: 113, y: 107 }, 4, 5, 8),\n      new Village('Moon Town', { x: 129, y: 29 }, 8, 12, 25),\n    ];\n\n\n    // Clear paths with jitter\n    for (const path of paths) {\n      for (let i = 0; i < path.length - 1; i++) {\n        const from = { x: path[i][0], y: path[i][1] };\n        const to = { x: path[i + 1][0], y: path[i + 1][1] };\n        const pathWidth = path[i][2];\n        this.clearPathWithJitter(from, to, pathWidth);\n      }\n    }\n\n    // Clear circular areas with jitter\n    for (const clearing of clearings) {\n      this.clearCircleWithJitter(clearing.x, clearing.y, clearing.r);\n    }\n\n    // Calculate neighbor information for each tree\n    for (let y = 0; y < rowCount; y++) {\n      for (let x = 0; x < colCount; x++) {\n        const cell = this.grid[y][x];\n        if (cell.content instanceof Tree) {\n          const neighbors = {\n            top: this.grid[y - 1]?.[x]?.content instanceof Tree,\n            bottom: this.grid[y + 1]?.[x]?.content instanceof Tree,\n            left: this.grid[y]?.[x - 1]?.content instanceof Tree,\n            right: this.grid[y]?.[x + 1]?.content instanceof Tree,\n          };\n          cell.content.setNeighbors(neighbors);\n        }\n      }\n    }\n\n    for (const village of this.villages) {\n      village.generateFarms(this.rng, this)\n        .forEach(farm => {\n          this.grid[farm.row][farm.col].content = farm;\n        });\n      village.generateHouses(this.rng, this)\n        .forEach(house => {\n          this.grid[house.row][house.col].content = house;\n        });\n      village.generateVillagers(this.rng, this)\n        .forEach(villager => {\n          this.grid[villager.row][villager.col].content = villager;\n        });\n\n      // Set cell.village for each cell in the village radius\n      const { x: centerX, y: centerY } = village.center;\n      const radius = village.radius;\n      for (let y = centerY - radius; y <= centerY + radius; y++) {\n      for (let x = centerX - radius; x <= centerX + radius; x++) {\n          const dx = x - centerX;\n          const dy = y - centerY;\n          if (dx * dx + dy * dy <= radius * radius) {\n            this.grid[y][x].village = village;\n          }\n        }\n      }\n\n      // Generate starting home\n      this.set(61, 84, new House(61, 84, 'home'));\n    }\n\n    this.fillCenterWithGrass(1.0);\n\n    for (const statueProps of Object.values(statues)) {\n      const { x, y, name } = statueProps;\n      const fullName = `cat ${name} altar`;\n      const statue = new Statue(x, y, this, this.gameData, fullName);\n      if (x === statues.heart.x) {\n        statue.maxSpirits = 0;\n      }\n      // Place farms in the 8 squares around the statue\n      forEachSurroundingCell(x, y, (farmCol, farmRow) => {\n        const cell = this.grid[farmRow][farmCol];\n        cell.content = new Farm(farmCol, farmRow);\n      });\n      this.grid[y][x].content = statue;\n    }\n\n    on(GameEvent.SPAWN_FIRST_SPIRIT, () => {\n      this.set(64, 89, new Spirit(64, 89, '☁️', this));\n    });\n  }\n\n  getLookingAt() {\n    return this.grid[this.playerLookingAt.row][this.playerLookingAt.col];\n  }\n\n  get(col: number, row: number) {\n    if (row < 0 || row >= this.rowCount || col < 0 || col >= this.colCount) {\n      return null;\n    }\n    return this.grid[row][col];\n  }\n\n  clearPlants(col: number, row: number) {\n    if(\n      this.grid[row][col].content instanceof Tree\n      || this.grid[row][col].content instanceof Farm\n    ) {\n      this.grid[row][col].content = null;\n    }\n  }\n\n  // Fill the center area with fields to limit player movements\n  // until they finish the onboarding.\n  // Then clear out a path from where the player starts, to the obelisk,\n  // and to the heart statue.\n  fillCenterWithGrass(converage: number) {\n    const heartsPeak = this.villages[0];\n    const radius = 12;\n    const { x: centerX, y: centerY } = heartsPeak.center;\n    for (let y = centerY - radius; y <= centerY + radius; y++) {\n      for (let x = centerX - radius; x <= centerX + radius; x++) {\n        const cell = this.grid[y][x];\n        if (!cell.content && this.rng.next() <= converage) {\n          cell.content = new Farm(cell.x, cell.y);\n        } else if (cell.content instanceof Farm && this.rng.next() > converage) {\n          cell.content = null;\n        }\n      }\n    }\n    \n    const villagePath: Path = [\n      [61, 86, 2],\n      [69, 88, 0.9],\n      [75, 89, 0.9],\n      [76, 84, 0.9],\n    ];\n    for (let i = 0; i < villagePath.length - 1; i++) {\n      const from = { x: villagePath[i][0], y: villagePath[i][1] };\n      const to = { x: villagePath[i + 1][0], y: villagePath[i + 1][1] };\n      const pathWidth = villagePath[i][2];\n      this.clearPathWithJitter(from, to, pathWidth);\n    }\n  }\n\n  clearPathWithJitter(\n    from: { x: number, y: number },\n    to: { x: number, y: number },\n    pathWidth: number,\n  ) {\n    // Bresenham's line algorithm for any angle\n    const dx = Math.abs(to.x - from.x);\n    const dy = Math.abs(to.y - from.y);\n    const sx = from.x < to.x ? 1 : -1;\n    const sy = from.y < to.y ? 1 : -1;\n    let err = dx - dy;\n\n    let x = from.x;\n    let y = from.y;\n\n    const halfWidth = pathWidth / 2;\n\n    while (true) {\n      // Add jitter to the clearing area\n      const jitterAmount = pathWidth < 1 ? 0 : 1.2; // Adjust for more/less randomness\n      const jitterX = Math.ceil(this.rng.range(-jitterAmount, jitterAmount));\n      const jitterY = Math.ceil(this.rng.range(-jitterAmount, jitterAmount));\n\n      // Clear area around the current position with jitter\n      for (let ox = -halfWidth; ox <= halfWidth; ox++) {\n        for (let oy = -halfWidth; oy <= halfWidth; oy++) {\n          const clearX = Math.ceil(x + ox + jitterX);\n          const clearY = Math.ceil(y + oy + jitterY);\n          this.clearPlants(clearX, clearY);\n          if (pathWidth < 1) {\n            if (this.rng.next() > 0.5) {\n              this.clearPlants(clearX + 1, clearY);\n            } else {\n              this.grid[clearY][clearX].content = new Farm(clearX, clearY);\n              this.grid[clearY][clearX + 1].content = new Farm(clearX, clearY);\n            }\n          } else if (this.rng.next() > 0.1) {\n            if (this.rng.next() > 0.05) {\n              // Add probability for partial clearing to create natural edges\n              this.clearPlants(clearX, clearY);\n            } else {\n              this.grid[clearY][clearX].content = new Farm(clearX, clearY);\n            }\n          }\n        }\n      }\n\n      // Check if we've reached the destination\n      if (x === to.x && y === to.y) break;\n\n      const e2 = 2 * err;\n      if (e2 > -dy) {\n        err -= dy;\n        x += sx;\n      }\n      if (e2 < dx) {\n        err += dx;\n        y += sy;\n      }\n    }\n  }\n\n  clearCircleWithJitter(\n    centerX: number,\n    centerY: number,\n    radius: number,\n    fieldsOnly = false,\n    border = 99,\n    probability = 1,\n  ) {\n    for (let y = 0; y < this.rowCount; y++) {\n      for (let x = 0; x < this.colCount; x++) {\n        const dx = x - centerX;\n        const dy = y - centerY;\n        const distance = Math.sqrt(dx * dx + dy * dy);\n\n        // Add jitter to radius for natural edge\n        const jitterRadius = this.rng.range(-radius, radius) / 6;\n        const adjustedRadius = radius + jitterRadius;\n\n        // Calculate inner radius based on borderRatio\n        const innerRadius = adjustedRadius - border;\n        \n        if (distance >= innerRadius && distance <= adjustedRadius) {\n          // Add probability for partial clearing near edges\n          const edgeDistance = adjustedRadius - distance;\n          const clearProbability = Math.min(1, edgeDistance / 2 + 0.7) * probability;\n\n          if (this.rng.next() < clearProbability) {\n            const isFarm = this.grid[y][x].content instanceof Farm;\n            if (!fieldsOnly || fieldsOnly && isFarm) {\n              this.grid[y][x].content = null;\n            }\n          }\n        }\n      }\n    }\n  }\n\n  set(col: number, row: number, content: Drawable | null) {\n    if (this.grid[row] && this.grid[row][col]) {\n      this.grid[row][col].content = content;\n    }\n  }\n\n  update(timeElapsed: number, isCutscene: boolean) {\n    for (const row of this.grid) {\n      for (const cell of row) {\n        if (cell.content) {\n          cell.content.updateAnimation?.(timeElapsed);\n          if (!isCutscene) {\n            cell.content.update?.(timeElapsed);\n            if (cell.x != cell.content.col || cell.y != cell.content.row) {\n              this.grid[cell.content.row][cell.content.col].content = cell.content;\n              cell.content = null;\n            }\n            if (cell.content && (cell?.content as Spirit)?.dead) {\n              this.set(cell.content.col, cell.content.row, null);\n            }\n          }\n        }\n      }\n    }\n  }\n\n  draw(cx: number, cy: number) {\n    const zoom = drawEngine.zoom;\n    const renderWidth = (drawEngine.canvasWidth / zoom) / 2 + 50;\n    const renderHeight = (drawEngine.canvasHeight / zoom) / 2 + 50;\n    const seenRadius = 75;\n    const seenRadiusSquared = seenRadius * seenRadius;\n\n    // Compute visible cell bounds\n    const minCol = Math.max(0, Math.floor((cx - renderWidth) / CELL_WIDTH));\n    const maxCol = Math.min(this.colCount - 1, Math.ceil((cx + renderWidth) / CELL_WIDTH));\n    const minRow = Math.max(0, Math.floor((cy - renderHeight) / CELL_HEIGHT));\n    const maxRow = Math.min(this.rowCount - 1, Math.ceil((cy + renderHeight) / CELL_HEIGHT));\n\n    // First pass: draw ground\n    for (let row = minRow; row <= maxRow; row++) {\n      for (let col = minCol; col <= maxCol; col++) {\n        const cell = this.grid[row][col];\n        const x = cell.x * CELL_WIDTH;\n        const y = cell.y * CELL_HEIGHT;\n        drawEngine.drawBackgroundImage(GameAssets.ground, x, y);\n      }\n    }\n\n    // Second pass: draw content, collect postDraw\n    const postDrawDrawables: Drawable[] = [];\n    let drawHighlight = false;\n    for (let row = minRow; row <= maxRow; row++) {\n      for (let col = minCol; col <= maxCol; col++) {\n        const cell = this.grid[row][col];\n        const x = cell.x * CELL_WIDTH;\n        const y = cell.y * CELL_HEIGHT;\n        const dx = x - cx;\n        const dy = y - cy;\n\n        // Seen radius for minimap\n        const distanceSquared = dx * dx + dy * dy;\n        if (distanceSquared <= seenRadiusSquared) {\n          cell.seen = true;\n        }\n\n        if (\n          cell.y === this.playerLookingAt.row &&\n          cell.x === this.playerLookingAt.col &&\n          cell.content &&\n          cell.content.type !== 'oak' && cell.content.type !== 'spruce'\n        ) {\n          drawHighlight = true;\n        }\n\n        cell?.content?.draw();\n        if (cell?.content?.postDraw) {\n          postDrawDrawables.push(cell?.content);\n        }\n      }\n    }\n\n    // Third pass: postDraw\n    // @ts-expect-error -- postDraw is definitely defined\n    postDrawDrawables.forEach(drawable => drawable.postDraw());\n\n    if (drawHighlight) {\n      drawEngine.drawBackgroundImage(\n        GameAssets.cornerImage,\n        this.playerLookingAt.col * CELL_WIDTH - (16 - CELL_WIDTH) / 2,\n        this.playerLookingAt.row * CELL_HEIGHT - (16 - CELL_HEIGHT) / 2\n      );\n    }\n  }\n}\n","\nexport const easeInOutSine = (x: number, min: number, max: number): number => {\n  const ease = -(Math.cos(Math.PI * x) - 1) / 2;\n  return min + ease * max;\n};\n\n/**\n * Converts a value from 0 to 1 to an exponential ease.\n * @param x value from 0 to 1\n * @returns value from 0 to 1\n */\nexport const easeInExpo = (x: number, ease = 5): number => {\n  return x === 1 ? 1 : 1 - Math.pow(2, -ease * x);\n};\n","import { colors } from '@/core/util/color';\nimport { GameMap } from './game-map';\nimport { Player } from './entities/player';\nimport { drawEngine } from '@/core/draw-engine';\n\n/* eslint-disable quote-props */\nconst pixelColors: Record<string, string> = {\n  'oak': colors.green3,\n  'spruce': colors.blue2,\n  'house': colors.blue4,\n  'field': colors.yellow1,\n  'statue': colors.blue6,\n  'unseen': colors.blue5,\n  'default': colors.yellow2,\n};\n/* eslint-enable quote-props */\n\n\nexport class MiniMap {\n  private lastUpdate = 0;\n  private updateInterval = 100; // Update once per second\n\n  constructor(private map: GameMap) { }\n\n  update(timeElapsed: number) {\n    this.lastUpdate += timeElapsed;\n  }\n\n  public draw(player: Player) {\n    if (this.lastUpdate < this.updateInterval) {\n      return;\n    }\n\n    this.lastUpdate = 0;\n    const ctx = drawEngine.ctx4;\n    const mapSize = 160;\n    const margin = 10;\n    const x = ctx.canvas.width - mapSize - margin; // Bottom right with margin\n    const y = ctx.canvas.height - mapSize - margin;\n\n    // Clear previous minimap\n    ctx.clearRect(x, y, mapSize, mapSize);\n\n    // Draw map pixels\n    for (let my = 0; my < mapSize; my++) {\n      for (let mx = 0; mx < mapSize; mx++) {\n        const cell = this.map.grid[my][mx];\n\n        if (!cell.seen) {\n          ctx.fillStyle = pixelColors.unseen;\n        } else {\n          ctx.fillStyle = pixelColors[cell.content?.type || 'default'] ?? pixelColors.default;\n        }\n\n        ctx.fillRect(x + mx, y + my, 1, 1);\n      }\n    }\n\n    if (player.col >= 0 && player.col < mapSize && player.row >= 0 && player.row < mapSize) {\n      ctx.fillStyle = colors.purple4;\n      ctx.beginPath();\n      ctx.arc(x + player.col, y + player.row, 2, 0, Math.PI * 2);\n      ctx.fill();\n    }\n  }\n}\n","import { drawEngine } from '@/core/draw-engine';\nimport { on } from '@/core/event';\nimport { StoryEngineEvent } from '@/core/story-engine';\nimport { colors } from '@/core/util/color';\n\nexport class DialogBox {\n  dialog: string | null = null;\n\n  constructor() {\n    on(StoryEngineEvent.STORY_DIALOG, (dialog) => {\n      this.dialog = dialog;\n    });\n\n    on(StoryEngineEvent.STORY_STATE_EXIT, () => {\n      this.dialog = null;\n    });\n  }\n\n  draw () {\n    if (this.dialog) {\n      const boxHeight = 160; // same as minimap\n      const margin = 20; // same as minimap\n      const boxWidth = c3.width - boxHeight - margin*3;\n      const x = margin;\n      const y = c3.height - boxHeight - margin;\n      drawEngine.ctx3.fillStyle = colors.purple4;\n      drawEngine.ctx3.fillRect(x+5, y+5, boxWidth, boxHeight);\n      drawEngine.ctx3.fillStyle = colors.purple0;\n      drawEngine.ctx3.fillRect(x, y, boxWidth-5, boxHeight-5);\n\n      this.dialog.split('\\n').forEach((dialog, i) => {\n        drawEngine.drawText(\n          dialog,\n          x + margin * 2,\n          y + margin * 2 + i * 40,\n          dialog[0] === '>' ? colors.purple4 : colors.black,\n          0, // left\n          0, // top\n          5,\n          1,\n          drawEngine.ctx3\n        );\n      });\n\n      drawEngine.drawText(\n          'press (space) to continue',\n          x + boxWidth - margin,\n          y + boxHeight - margin,\n          colors.purple4,\n          2, // right\n          2, // bottom\n          3,\n          1,\n          drawEngine.ctx3\n        );\n    }\n  }\n}\n","import { drawEngine } from '@/core/draw-engine';\nimport { colors } from '@/core/util/color';\nimport { easeInOutSine } from '@/core/util/util';\nimport { MiniMap } from './mini-map';\nimport { GameMap } from './game-map';\nimport { Player } from './entities/player';\nimport { Actions } from './actions';\nimport { GameData } from './game-data';\nimport { MAX_LIVES, MAX_MAGIC, NOTIFICATION_DURATION } from './constants';\nimport { DialogBox } from './dialog-box';\nimport { MAGIC, EMPTY_HEART, FULL_HEART, ONE_THIRD_HEART, TWO_THIRDS_HEART } from '@/core/font';\nimport { on } from '@/core/event';\nimport { GameEvent } from './event-manifest';\nimport { Village } from './entities/village';\n\nexport class HUD {\n  miniMap: MiniMap;\n  dialogBox: DialogBox;\n  renderSuperstition = false;\n  renderLives = false;\n  renderMagic = false;\n  villageName = '';\n  villageNameTimer = 0;\n\n  constructor(\n    public map: GameMap,\n    public player: Player,\n    public actions: Actions,\n    public gameData: GameData,\n  ) {\n    this.miniMap = new MiniMap(map);\n    this.dialogBox = new DialogBox();\n\n    on(GameEvent.ENABLE_SCRATCH, () => {\n      this.renderLives = true;\n    });\n\n    on(GameEvent.NOT_ENOUGH_MAGIC, () => {\n      this.renderMagic = true;\n    });\n\n    on(GameEvent.ENTER_VILLAGE, (village: Village) => {\n      this.villageName = village.name;\n      this.villageNameTimer = 3000;\n    });\n\n    on(GameEvent.SCARED, () => {\n      this.renderSuperstition = true;\n    });\n  }\n\n  update(timeElapsed: number) {\n    this.miniMap.update(timeElapsed);\n    this.villageNameTimer -= timeElapsed;\n  }\n\n  draw() {\n    this.renderLives && this.drawLives();\n    this.renderMagic && this.drawMagic();\n    this.drawGoals();\n    this.renderSuperstition && this.drawSuperstition();\n    this.drawActions();\n    this.drawInfoBox();\n    this.renderLives && this.miniMap.draw(this.player);\n    this.dialogBox.draw();\n  }\n\n  drawActions() {\n    const actions = this.actions.actions;\n    if (!actions || !actions[0].enabled) {\n      return;\n    }\n\n    const boxWidth = 120;\n    const boxHeight = 120;\n    const spacing = 10;\n    const totalWidth = actions.length * boxWidth + (actions.length - 1) * spacing;\n    const startX = Math.round((drawEngine.ctx3.canvas.width - totalWidth) / 2);\n    const y = drawEngine.ctx3.canvas.height - boxHeight - 10;\n\n    actions.forEach(({ type, color, symbol }, index) => {\n      const x = startX + index * (boxWidth + spacing);\n\n      // Draw background box\n      drawEngine.ctx3.fillStyle = colors.purple0;\n      drawEngine.ctx3.fillRect(x, y, boxWidth, boxHeight);\n\n      // Draw symbol (large font)\n      drawEngine.drawText(\n        symbol,\n        x + boxWidth / 2,\n        y + 30,\n        color,\n        1, // center\n        1, // middle\n        7,\n        1,\n        drawEngine.ctx3\n      );\n\n      // Draw action name\n      drawEngine.drawText(\n        type,\n        x + boxWidth / 2,\n        y + 95,\n        colors.black,\n        1, // center\n        1, // middle\n        3,\n        1,\n        drawEngine.ctx3\n      );\n    });\n  }\n\n  drawLives() {\n    const x = 16;\n    const y = 16;\n    const fullHearts = Math.floor(this.gameData.lives);\n    const emptyHearts = Math.floor(MAX_LIVES - this.gameData.lives);\n    const halfHearts = MAX_LIVES - fullHearts - emptyHearts;\n    const partialHearts = this.gameData.lives - fullHearts;\n    const text = FULL_HEART.repeat(fullHearts)\n      + (partialHearts > 0.3 ? TWO_THIRDS_HEART : ONE_THIRD_HEART).repeat(halfHearts)\n      + EMPTY_HEART.repeat(emptyHearts);\n    const size = 5;\n\n    const boxW = (text.length * 6 + 1) * size;\n    const boxH = 7 * size;\n    drawEngine.ctx3.fillStyle = colors.purple0;\n    drawEngine.ctx3.fillRect(x, y, boxW, boxH);\n    drawEngine.drawText(text, x + size, y + size, colors.purple4, 0, 0, size, 1, drawEngine.ctx3);\n  }\n\n  drawMagic() {\n    let x = c3.width - 16;\n    const y = 16;\n    const fullMagic = this.gameData.magic;\n    const emptyMagic = this.gameData.maxMagic - this.gameData.magic;\n    const noMagic = MAX_MAGIC - this.gameData.maxMagic;\n\n    const size = 5;\n    const charWidth = (5 + 1) * size;\n\n    const boxW = MAX_MAGIC * charWidth + size;\n    const boxH = 7 * size;\n    drawEngine.ctx3.fillStyle = colors.yellow1;\n    drawEngine.ctx3.fillRect(x - boxW + size, y, boxW, boxH);\n\n    let text = MAGIC.repeat(fullMagic);\n    x -= text.length * charWidth;\n    drawEngine.drawText(text, x + size, y + size, colors.blue2, 0, 0, size, 1, drawEngine.ctx3);\n\n    text = MAGIC.repeat(emptyMagic);\n    x -= text.length * charWidth;\n    drawEngine.drawText(text, x + size, y + size, colors.blue3, 0, 0, size, 1, drawEngine.ctx3);\n\n    text = MAGIC.repeat(noMagic);\n    x -= text.length * charWidth;\n    drawEngine.drawText(text, x + size, y + size, colors.yellow2, 0, 0, size, 1, drawEngine.ctx3);\n  }\n\n  drawGoals() {\n    const goals = this.gameData.goals;\n\n    const baseX = 16;\n    const y = 16 + 7 * 5 + 10; // lives y  + lives box height + margin\n    const boxW = 510;\n    const boxH = 5 * 7 + 30;\n    const size = 3;\n    const padding = 5;\n    const aD = 200; // 100ms slide animation\n    \n    goals.filter(goal => goal.time > 0)\n    .forEach((goal, i) => {\n      const {label, time} = goal;\n      const boxY = y + (boxH + padding) * i;\n      \n      // Calculate animation offset based on remaining time\n      let offsetX = 0;\n      const distanceX = boxW + baseX;\n      if (time > NOTIFICATION_DURATION - aD) {\n        // Sliding in from left (appearing)\n        const progress = (NOTIFICATION_DURATION - time) / aD;\n        const easedProgress = easeInOutSine(progress, 0, 1);\n        offsetX = -distanceX * (1 - easedProgress);\n      } else if (time < aD) {\n        // Sliding out to left (disappearing)\n        const progress = time / aD;\n        const easedProgress = easeInOutSine(progress, 0, 1);\n        offsetX = -distanceX * (1 - easedProgress);\n      }\n      \n      const x = baseX + offsetX;\n      \n      drawEngine.ctx3.fillStyle = colors.purple4;\n      drawEngine.ctx3.fillRect(x, boxY, boxW, boxH);\n      drawEngine.drawText(\n        'GOAL',\n        x + size + padding,\n        boxY + padding,\n        colors.white,\n        0, // left\n        0, // top\n        size + 1,\n        1,\n        drawEngine.ctx3\n      );\n      drawEngine.drawText(\n        label,\n        x + size + padding + 20,\n        35 + boxY + padding,\n        colors.purple0,\n        0, // left\n        0, // top\n        size,\n        1,\n        drawEngine.ctx3\n      );\n    });\n  }\n\n  drawSuperstition() {\n    const text = 'superstition';\n    const size = 3;\n    const charWidth = 5;\n    const padding = 5;\n    const boxW = (text.length * size + padding * 2) * charWidth;\n    const boxH = 35;\n    const x = Math.round(c3.width / 2 - boxW / 2);\n    const y = 16;\n\n    // Background\n    drawEngine.ctx3.fillStyle = colors.purple0;\n    drawEngine.ctx3.fillRect(x, y, boxW, 62);\n\n    drawEngine.ctx3.fillStyle = colors.blue5;\n    drawEngine.ctx3.fillRect(x + padding, y + padding, boxW - 2 * padding, boxH - 2 * padding);\n\n    drawEngine.ctx3.fillStyle = this.gameData.superstition > 0.9 ? colors.purple4 : colors.blue2;\n    const barSize = Math.round(this.gameData.superstition * (boxW - 2 * padding) / 3) * 3;\n    drawEngine.ctx3.fillRect(x + padding, y + padding, barSize, boxH - 2 * padding);\n\n    drawEngine.drawText(text, c3.width / 2, y + boxH + size, colors.blue5, 1, 0, size, 1, drawEngine.ctx3);\n  }\n\n  drawInfoBox() {\n    if(this.villageNameTimer > 0) {\n      const t = this.villageNameTimer;\n      const tNorm = Math.max(0, Math.min(1, Math.min(t / 150, (3000 - t) / 150)));\n      const opacity = easeInOutSine(tNorm, 0, 1);\n      drawEngine.ctx3.globalAlpha = opacity;\n      this.drawInfo(`^^ ${this.villageName}`, 170);\n      drawEngine.ctx3.globalAlpha = 1;\n    }\n\n    if (this.map.playerLookingAt) {\n      const cell = this.map.getLookingAt();\n      if (cell?.content?.name) {\n        this.drawInfo(cell.content.name, c3.height - 170);\n      }\n    }\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  drawInfo(text: string, y: number) {\n    const boxWidth = 350;\n    const boxHeight = 35;\n    drawEngine.ctx3.fillStyle = colors.purple5;\n    drawEngine.ctx3.fillRect(\n      c3.width / 2 - boxWidth / 2 + 4,\n      y - 6 * 3 - 4,\n      boxWidth - 8,\n      boxHeight + 8,\n    );\n    drawEngine.ctx3.fillStyle = colors.yellow2;\n    drawEngine.ctx3.fillRect(\n      c3.width / 2 - boxWidth / 2,\n      y - 6 * 3,\n      boxWidth,\n      boxHeight,\n    );\n    drawEngine.drawText(\n      text,\n      c3.width / 2,\n      y,\n      colors.purple4,\n      1, // center\n      1, // middle\n      3,\n      1,\n      drawEngine.ctx3\n    );\n  }\n}\n","import { GameAssets } from '../game-assets';\nimport { CELL_HEIGHT, CELL_WIDTH, MAX_MAGIC, MAX_REPAIR } from '../constants';\nimport { GameMap } from '../game-map';\nimport { drawHpBar } from './hp-bar';\nimport { colors } from '@/core/util/color';\nimport { emit } from '@/core/event';\nimport { GameEvent } from '../event-manifest';\nimport { GameStaticObject } from '@/core/game-static-object';\nimport { repair } from '@/core/audio';\n\nexport class Obelisk extends GameStaticObject {\n  map: GameMap;\n  name = 'barrier obelisk';\n  repair = 0;\n  \n  constructor(map: GameMap) {\n    const col = 69;\n    const row = 88; \n    super(\n      GameAssets.obelisk,\n      col * CELL_WIDTH,\n      row * CELL_HEIGHT,\n      'obelisk',\n    );\n    this.map = map;\n    this.map.set(this.col, this.row, this);\n  }\n\n  draw() {\n    super.draw();\n    if (this.repair > 0) {\n      drawHpBar(this.repair, MAX_REPAIR, this.x, this.y, [colors.yellow1, colors.yellow2, colors.blue5, colors.blue6]);\n    }\n  }\n\n  attemptRepair() {\n    const maxProgress = this.map.gameData.magic / MAX_MAGIC;\n    const maxRepair = MAX_REPAIR * maxProgress;\n    if (this.repair < maxRepair) {\n      this.repair ++;\n      repair(2 * this.repair - 10);\n    } else {\n      repair(-10);\n      emit(GameEvent.NOT_ENOUGH_MAGIC);\n    }\n\n    if (this.repair === MAX_REPAIR) {\n      emit(GameEvent.GAME_END);\n    }\n  }\n}\n","import { GameMap } from './game-map';\nimport { Player } from './entities/player';\nimport { MAX_REPAIR, statues } from './constants';\nimport { colors } from '@/core/util/color';\nimport { emit, on } from '@/core/event';\nimport { MAGIC, SCRATCH, TELEPORT } from '@/core/font';\nimport { controls } from '@/core/controls';\nimport { Statue } from './entities/statue';\nimport { Obelisk } from './entities/obelisk';\nimport { addTimeEvent } from '@/core/timer';\nimport { GameEvent } from './event-manifest';\nimport { repair } from '@/core/audio';\nimport { Cell } from './types';\nimport { Spirit } from './entities/spirit';\nimport { Farm } from './entities/farm';\nimport { House } from './entities/house';\n\ntype ActionType = 'teleport' | 'scratch' | 'repair' | 'sleep';\ntype Action = {\n  type: ActionType,\n  color: string,\n  enabled: boolean,\n  symbol: string,\n}\n\nconst actions: Action[] = [\n  {\n    type: 'scratch',\n    color: colors.purple4,\n    enabled: false,\n    symbol: SCRATCH,\n  },\n  {\n    type: 'teleport',\n    color: colors.blue2,\n    enabled: true,\n    symbol: TELEPORT,\n  },\n  {\n    type: 'repair',\n    color: colors.green3,\n    enabled: true,\n    symbol: MAGIC,\n  },\n  {\n    type: 'sleep',\n    color: colors.yellow2,\n    enabled: true,\n    symbol: 'z',\n  },\n];\n\nexport class Actions {\n  map: GameMap;\n  player: Player;\n  actions: Action[] = [];\n\n  constructor(map: GameMap, player: Player) {\n    this.map = map;\n    this.player = player;\n\n    on(GameEvent.ENABLE_SCRATCH, () => {\n      this.actions[0].enabled = true;\n    });\n  }\n\n  // Update available actions based on player's current position\n  update(): void {\n    const cellInFront = this.map.getLookingAt();\n\n    const canTeleport  = this.canTeleport(cellInFront);\n    const canRestore = this.canRestore(cellInFront);\n    const canSleep = this.canSleep(cellInFront);\n    const canAttack = this.canAttack(cellInFront);\n\n    this.actions = [\n      canAttack ? actions[0]\n      : canTeleport ? actions[1]\n      : canRestore ? actions[2]\n      : canSleep ? actions[3]\n      : actions[0]\n    ];\n\n    if (controls.isAction1 && !controls.previousState.isAction1) {\n      switch (true) {\n        case canAttack:\n          // Attack happens somewhere else\n          break;\n        \n        case canTeleport:\n          emit(GameEvent.TELEPORT);\n          break;\n        \n        case canRestore:\n          this.doRestore(cellInFront);\n          break;\n\n        case canSleep:\n          emit(GameEvent.SLEEP);\n\n      \n        default:\n          break;\n      }\n    }\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  doRestore(cellInFront: Cell) {\n    emit(GameEvent.RESTORE);\n    const object = cellInFront.content as Statue | Obelisk;\n    if (object.repair < MAX_REPAIR) {\n      if (object instanceof Statue) {\n        object.repair++;\n        repair(object.repair);\n        if (object.repair >= MAX_REPAIR) {\n          addTimeEvent(() => {\n            emit(GameEvent.STATUE_RESTORED, this.map.gameData.maxMagic);\n          }, 4000);\n        }\n      } else if (object instanceof Obelisk) {\n        object.attemptRepair();\n      }\n    }\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  private canRestore(cellInFront: Cell): boolean {\n    const object = cellInFront.content as Statue | Obelisk;\n    const type = object?.type;\n    return (\n      (type === 'statue' || type === 'obelisk')\n    ) && object.repair < MAX_REPAIR;\n  }\n\n  private canTeleport(cellInFront: Cell) {\n    return cellInFront.content instanceof Statue\n      && this.player.col != statues.heart.x\n      && cellInFront.content.state === Statue.State.REPAIRED;\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  private canSleep(cellInFront: Cell) {\n    return cellInFront.content instanceof House\n      && cellInFront.content.name === 'home';\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  private canAttack(cellInFront: Cell) {\n    return cellInFront.content instanceof Spirit\n      || cellInFront.content instanceof Farm;\n  }\n}\n","import { emit, on } from '@/core/event';\nimport { MAX_LIVES, NOTIFICATION_DURATION } from './constants';\nimport { SceneProps } from './game-story';\nimport { GameEvent } from './event-manifest';\nimport { addTimeEvent } from '@/core/timer';\nimport { heal, hissAndSpit } from '@/core/audio';\n\ninterface Goal {\n  label: string,\n  time: number,\n}\n\nexport class GameData {\n  cutscene = false;\n  lives = MAX_LIVES;\n  maxMagic = 0;\n  magic = 0;\n  superstition = 0;\n  goals: Goal[] = [];\n  hasClearedIntro = false;\n  win = false;\n\n  constructor() {\n    on(GameEvent.SCARED, () => {\n      this.superstition = Math.min(1, this.superstition + 0.01);\n    });\n\n    on(GameEvent.CUTSCENE_START, () => {\n      this.cutscene = true;\n    });\n\n    on(GameEvent.CUTSCENE_END, (scene: SceneProps) => {\n      this.cutscene = false;\n      if (scene.goals) {\n        scene.goals.forEach(goal => {\n          this.goals.push({\n            label: goal,\n            time: NOTIFICATION_DURATION,\n          });\n        });\n      }\n    });\n\n    on(GameEvent.ATTACK_PLAYER, (level: number) => {\n      this.lives -= (level + 1) / 3;\n      this.lives = Math.round(this.lives * 3) / 3;\n      this.lives = Math.round(this.lives * 10) / 10;\n      hissAndSpit();\n      if (this.lives <= 0) {\n        this.lives = 0;\n        emit(GameEvent.GAME_OVER);\n      }\n    });\n\n    on(GameEvent.STATUE_RESTORED, () => {\n      this.maxMagic++;\n      this.magic = this.maxMagic;\n      this.heal();\n\n      emit(GameEvent.NEXT_STATUE_DIALOG, this.maxMagic);\n    });\n\n    on(GameEvent.SLEEP, () => {\n      this.heal();\n    });\n  }\n\n  heal() {\n    let i = 0;\n    for (let lives = Math.floor(this.lives) + 1; lives <= MAX_LIVES; lives++) {\n      addTimeEvent(() => {\n        this.lives = lives;\n        heal();\n      }, 500 + 800 * (i++));\n    }\n  }\n\n  update(timeElapsed: number) {\n    this.goals.forEach(goal => goal.time -= timeElapsed);\n  }\n\n  getLevel() {\n    return this.superstition * 4 + this.maxMagic;\n  }\n}\n","import { controls } from './controls';\nimport { emit, on } from '@/core/event';\n\nexport interface DialogState {\n  dialogs: string[];\n  isDone?: boolean;\n}\n\nexport interface Script {\n  [stateKey: string]: DialogState;\n}\n\nexport const enum StoryEngineEvent {\n  // Story events\n  STORY_STATE_ENTER = 1,\n  STORY_STATE_EXIT = 2,\n  STORY_DIALOG = 3,\n};\n\nexport class Story<T extends Script> {\n  private currentStateKey: keyof T | null = null;\n  private currentDialogIndex = 0;\n  public isActive = false;\n  private previousSpacePressed = false;\n  public currentState: keyof T | null = null;\n  \n  fullText = '';\n  visibleCharacters = 0;\n  textAnimationTimer = 0;\n  charactersPerSecond = 20;\n  textAnimationState = 2; // 0=typing, 1=complete, 2=waiting\n\n  constructor(private readonly script: T) {\n    on(StoryEngineEvent.STORY_STATE_ENTER, (stateKey: keyof T) => {\n      this.enterState(stateKey);\n    });\n  }\n\n  public enterState(stateKey: keyof T) {\n    if (!this.script[stateKey]) {\n      return;\n    }\n\n    this.currentStateKey = stateKey;\n    this.currentState = stateKey;\n    this.currentDialogIndex = 0;\n    this.isActive = true;\n    this.previousSpacePressed = false;\n\n    this.showCurrentDialog();\n  }\n\n  update(timeElapsed: number) {\n    if (!this.isActive || !this.currentStateKey) {\n      return;\n    }\n\n    const spacePressed = controls.keyMap.get('Space');\n    const spaceJustPressed = spacePressed && !this.previousSpacePressed;\n    this.previousSpacePressed = spacePressed || false;\n\n    // Update typewriter animation\n    if (this.textAnimationState === 0) { // typing\n      this.textAnimationTimer += timeElapsed;\n      const targetCharacters = Math.floor((this.textAnimationTimer / 1000) * this.charactersPerSecond);\n      \n      if (targetCharacters >= this.fullText.length) {\n        // Animation complete\n        this.visibleCharacters = this.fullText.length;\n        this.textAnimationState = 1; // complete\n        this.emitCurrentVisibleText();\n      } else if (targetCharacters > this.visibleCharacters) {\n        // Show more characters\n        this.visibleCharacters = targetCharacters;\n        this.emitCurrentVisibleText();\n      }\n    }\n\n    if (spaceJustPressed) {\n      this.handleSpacePress();\n    }\n  }\n\n  private handleSpacePress() {\n    if (!this.currentStateKey) {\n      return;\n    }\n\n    if (this.textAnimationState === 0) { // typing\n      // Skip typing animation - show full text immediately\n      this.visibleCharacters = this.fullText.length;\n      this.textAnimationState = 1; // complete\n      this.emitCurrentVisibleText();\n      return;\n    }\n\n    if (this.textAnimationState === 1) { // complete\n      // Move to next dialog or exit\n      const currentState = this.script[this.currentStateKey];\n      \n      if (this.currentDialogIndex < currentState.dialogs.length - 1) {\n        // Move to next dialog\n        this.currentDialogIndex++;\n        this.showCurrentDialog();\n      } else {\n        // All dialogs complete, exit state\n        this.exitCurrentState();\n      }\n    }\n  }\n\n  private emitCurrentVisibleText() {\n    const visibleText = this.fullText.substring(0, this.visibleCharacters);\n    emit(StoryEngineEvent.STORY_DIALOG, visibleText);\n  }\n\n  private showCurrentDialog() {\n    if (!this.currentStateKey) {\n      return;\n    }\n\n    const currentState = this.script[this.currentStateKey];\n    currentState.isDone = true;\n    this.fullText = currentState.dialogs[this.currentDialogIndex];\n    \n    // Reset typewriter animation\n    this.visibleCharacters = 0;\n    this.textAnimationTimer = 0;\n    this.textAnimationState = 0; // typing\n    \n    // Start with empty text\n    this.emitCurrentVisibleText();\n  }\n\n  private exitCurrentState() {\n    if (!this.currentStateKey) {\n      return;\n    }\n\n    const stateKey = this.currentStateKey;\n    this.isActive = false;\n    this.currentStateKey = null;\n    this.currentState = null;\n    this.currentDialogIndex = 0;\n    \n    emit(StoryEngineEvent.STORY_STATE_EXIT, stateKey);\n  }\n}\n","import { drawEngine } from '@/core/draw-engine';\nimport { emit, on } from '@/core/event';\nimport { DialogState, Story, StoryEngineEvent } from '@/core/story-engine';\nimport { addTimeEvent } from '@/core/timer';\nimport { GameEvent } from './event-manifest';\nimport { MAX_MAGIC } from './constants';\n\nexport interface SceneProps extends DialogState {\n  goals?: string[],\n};\n\nconst enum Scene {\n  intro = 1,\n  spirit,\n  barrier,\n  temple,\n  noMagic,\n  magicRestored,\n  villagers,\n  end,\n}\n\nconst script = {} as Record<Scene, SceneProps>;\n\n// Use programmatic assignment to avoid preserving enum string names\nscript[Scene.intro] = {\n  dialogs: [\n    'Zzzzz...',\n    'Yawwwn...',\n    'How long was i sleeping?...',\n  ],\n};\n\nscript[Scene.spirit] = {\n  dialogs: [\n    'Evil spirits?',\n    'Has the magic barrier failed\\nwhile I slept??',\n    'This one seems weak.',\n    \"I'll exorcise it and then\\ngo check the barrier\",\n    '> Use (space) to attack',\n  ],\n  goals: ['find magic barrier obelisk'],\n};\n\nscript[Scene.barrier] = {\n  dialogs: [\n    'I have no magic power left!',\n    'My magic comes from villagers\\nworshiping me...',\n    'Something must be wrong with\\nthe cat altar.',\n  ],\n  goals: ['repair the cat altar'],\n};\n\nscript[Scene.noMagic] = {\n  dialogs: [\n    \"I don't have enough magic!\",\n    'Something must be wrong with\\nthe cat altars in the valley',\n  ],\n};\n\nscript[Scene.temple] = {\n  dialogs: [\n    'My magic has increased a little.',\n    'But the other altars...\\nthey must be damaged too.',\n  ],\n  goals: [\n    'repair all 5 temples',\n    'restore the forest magic barrier',\n  ],\n};\n\nscript[Scene.villagers] = {\n  dialogs: [\n    'Villagers are very supersticious.',\n    'I should not let them see me,\\nthat will empower the evil spirits.',\n  ],\n};\n\nscript[Scene.magicRestored] = {\n  dialogs: [\n    'I have restore my full magic power',\n    'Now I am able to restore the\\nmagic barrier again.',\n  ],\n  goals: [\n    'restore the forest magic barrier',\n  ]\n};\n\nscript[Scene.end] = {\n  dialogs: [\n    'The barrier is restored.\\nTime for a well deserved nap...',\n  ],\n};\n\nconst postIntro = () => {\n  emit(GameEvent.WAKE_UP);\n  emit(GameEvent.SPAWN_FIRST_SPIRIT);\n  drawEngine.cameraLerpSpeed = 0.08;\n};\n\nexport class GameStory {\n  story: Story<typeof script>;\n\n  constructor() {\n    this.story = new Story(script);\n\n    on(StoryEngineEvent.STORY_STATE_EXIT, (label: Scene) => {\n      emit(GameEvent.CUTSCENE_END, script[label]);\n      if (label === Scene.intro) {\n        postIntro();\n        addTimeEvent(() => {\n          emit(StoryEngineEvent.STORY_STATE_ENTER, Scene.spirit);\n        }, 3000);\n      }\n      if(label === Scene.spirit) {\n        emit(GameEvent.ENABLE_SCRATCH);\n      }\n      if (label === Scene.end) {\n        emit(GameEvent.FADE_OUT);\n      }\n    });\n\n    on(StoryEngineEvent.STORY_STATE_ENTER, () => {\n      emit(GameEvent.CUTSCENE_START);\n    });\n\n    on(GameEvent.NOT_ENOUGH_MAGIC, () => {\n      if (script[Scene.barrier].isDone) {\n        emit(StoryEngineEvent.STORY_STATE_ENTER, Scene.noMagic);\n      } else {\n        emit(StoryEngineEvent.STORY_STATE_ENTER, Scene.barrier);\n      }\n    });\n\n    on(GameEvent.NEXT_STATUE_DIALOG, (magicLevel: number) => {\n      if (magicLevel < MAX_MAGIC) {\n        emit(StoryEngineEvent.STORY_STATE_ENTER, Scene.temple);\n      } else {\n        emit(StoryEngineEvent.STORY_STATE_ENTER, Scene.magicRestored);\n      }\n    });\n\n    on(GameEvent.SCARED, () => {\n      if (!script[Scene.villagers].isDone) {\n        emit(StoryEngineEvent.STORY_STATE_ENTER, Scene.villagers);\n      }\n    });\n\n    on(GameEvent.GAME_END, () => {\n      emit(StoryEngineEvent.STORY_STATE_ENTER, Scene.end);\n    });\n\n    addTimeEvent(() => this.story.enterState(Scene.intro), 1000);\n    // setTimeout(() => {\n    //   postIntro();\n    // }, 10);\n  }\n\n  update (timeElapsed: number) {\n    this.story.update(timeElapsed);\n  }\n}\n","class MusicPlayer {\n  audioContext: AudioContext | undefined;\n  startTime = 0;\n  isPlaying = false;\n  buffer: AudioBuffer | undefined;\n  musicProcessorNode: AudioWorkletNode | undefined;\n\n  async start() {\n    if (this.isPlaying) return;\n\n    this.audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\n    await this.audioContext.resume();\n    await this.audioContext.audioWorklet.addModule('music-worklet.js');\n\n    this.musicProcessorNode = new AudioWorkletNode(this.audioContext, 'mp');\n    \n    this.musicProcessorNode.connect(this.audioContext.destination);\n    this.isPlaying = true;\n  }\n\n  startMelody() {\n    this.musicProcessorNode?.port.postMessage(0);\n  }\n\n  pause() {\n    this.musicProcessorNode?.port.postMessage(1);\n  }\n\n  unpause() {\n    this.musicProcessorNode?.port.postMessage(2);\n  }\n\n  stop() {\n    if (this.isPlaying) {\n      this.musicProcessorNode?.disconnect();\n      this.isPlaying = false;\n    }\n  }\n}\n\nexport default new MusicPlayer();\n","import { State } from '@/core/state';\nimport { drawEngine } from '@/core/draw-engine';\nimport { Player } from '@/game/entities/player';\nimport { GameMap } from '@/game/game-map';\nimport { HUD } from '@/game/hud';\nimport { Actions } from '@/game/actions';\nimport { GameData } from '@/game/game-data';\nimport { GameStory } from '@/game/game-story';\nimport { addTimeEvent, updateTimeEvents } from '@/core/timer';\nimport { Obelisk } from '@/game/entities/obelisk';\nimport musicPlayer from '@/core/music-player';\nimport { on } from '@/core/event';\nimport { GameEvent } from '@/game/event-manifest';\nimport { gameStateMachine } from '@/game-state-machine';\nimport { menuState } from './menu.state';\nimport { MAX_LIVES } from '@/game/constants';\n\nexport class GameState implements State {\n  map!: GameMap;\n  cat!: Player;\n  hud!: HUD;\n  actions!: Actions;\n  gameData!: GameData;\n  story!: GameStory;\n  playMusic = true;\n\n  onLeave() {\n    musicPlayer.stop();\n    drawEngine.ctx4.clearRect(0, 0, c4.width, c4.height);\n  }\n\n  onEnter() {\n    if (this.playMusic) {\n      musicPlayer.start();\n    }\n    \n    on(GameEvent.ENABLE_SCRATCH, () => {\n      musicPlayer.startMelody();\n    });\n    on(GameEvent.PAUSE, () => {\n      musicPlayer.pause();\n    });\n    on(GameEvent.UNPAUSE, () => {\n      musicPlayer.unpause();\n    });\n\n    on(GameEvent.GAME_OVER, () => {\n      addTimeEvent(() => gameStateMachine.setState(menuState), 3000);\n    });\n\n    on(GameEvent.FADE_OUT, () => {\n      addTimeEvent(() => gameStateMachine.setState(menuState), 3000);\n    });\n\n    this.gameData = new GameData();\n    this.map = new GameMap(160, 160, this.gameData);\n    this.cat = new Player(60, 85, this.map, this.gameData);\n    // this.cat = new Player(94, 133, this.map, this.gameData);\n    this.actions = new Actions(this.map, this.cat);\n    this.hud = new HUD(this.map, this.cat, this.actions, this.gameData);\n    this.story = new GameStory();\n    \n    this.map.set(this.cat.col, this.cat.row, this.cat);\n    new Obelisk(this.map);\n    drawEngine.setCamera(this.cat.x, this.cat.y, 20, true);\n    drawEngine.cameraLerpSpeed = 0.01;\n  }\n\n  onUpdate(timeElapsed: number) {\n    const zoom = 5 + (MAX_LIVES - this.gameData.lives) / MAX_LIVES;\n    drawEngine.setCamera(this.cat.x, this.cat.y, zoom);\n    drawEngine.updateCamera();\n\n    if (this.gameData.lives > 0) {\n      if (!this.gameData.cutscene) {\n        this.actions.update();\n      }\n      this.map.update(timeElapsed, this.gameData.cutscene);\n      this.hud.update(timeElapsed);\n      this.gameData.update(timeElapsed);\n    }\n    this.story.update(timeElapsed);\n    updateTimeEvents(timeElapsed);\n\n    if (this.gameData.lives > 0 && !this.gameData.win) {\n      this.map.draw(this.cat.x, this.cat.y);\n      this.hud.draw();\n    } else {\n      if (this.gameData.lives > 0) {\n        this.hud.draw();\n      }\n      this.cat.update(timeElapsed);\n      this.cat.draw();\n    }\n    drawEngine.resetCamera();\n  }\n}\n","import { State } from '@/core/state';\nimport { drawEngine } from '@/core/draw-engine';\nimport { controls } from '@/core/controls';\nimport { gameStateMachine } from '@/game-state-machine';\nimport { GameState } from './game.state';\nimport { colors } from '@/core/util/color';\nimport { GameAssets } from '@/game/game-assets';\nimport { SeededRandom } from '@/core/util/rng';\n\nconst toggleFullscreen = () => {\n  if (!document.fullscreenElement) {\n    document.documentElement.requestFullscreen();\n  } else {\n    document.exitFullscreen();\n  }\n};\n\nconst rng = new SeededRandom(0);\n\nconst drawBackground = () => {\n  const bgColors = [\n    colors.blue4,\n    colors.blue3,\n    colors.blue2,\n    colors.blue1,\n    colors.blue0,\n  ];\n  const sectionHeight = Math.ceil(c2.height / bgColors.length);\n  const sections = 32;\n  const sectionW = c2.width / sections;\n  const offsetFreq = 4;\n  const offsetAmplitude = 16;\n  for (let index = 0; index < sections; index++) {\n    const yOffset = Math.round(\n      offsetAmplitude * Math.sin(1 - offsetFreq * 2 * Math.PI * index / sections)\n      / 10\n    ) * 10;\n    bgColors.forEach((color, row) => {\n      drawEngine.ctx1.fillStyle = color;\n      drawEngine.ctx1.fillRect(\n        sectionW * index,\n        yOffset + sectionHeight * row - 20,\n        Math.ceil(c2.width / sections),\n        sectionHeight\n      );\n    });\n  }\n\n  const iconSize = 32;\n  const iconInterval = 22;\n  const cols = c2.width / iconInterval;\n  const rows = (c2.height / 2) / iconInterval; // fill half the screen\n  const oak: HTMLImageElement = GameAssets.oak;\n  const spruce: HTMLImageElement = GameAssets.spruce;\n\n  if (!oak) {\n    return;\n  }\n\n  for (let col = 0; col <= cols + iconSize; col++) {\n    const mountainHeight = rows * (1.2 - Math.cos((col / cols) * 2 * Math.PI));\n    for(let row = mountainHeight; row > 0; row--) {\n      const offsetX = 5 * Math.sin(12 * Math.PI * (row / rows));\n      drawEngine.drawBackgroundImage(\n        0.2 + rng.next() > (row / (rows)) ? oak : spruce,\n        col * iconInterval + offsetX - iconSize/2,\n        c2.height - (row * iconInterval + rng.next() * 0.7) / 2,\n        false,\n        iconSize,\n        iconSize,\n      );\n    }\n  }\n\n  rng.rngSeed = 0;\n};\n\nclass MenuState implements State {\n  animationTimer = 0;\n  previousFPressed = false;\n\n  onUpdate(timeElapsed: number) {\n    this.animationTimer += timeElapsed;\n\n    drawBackground();\n    const xCenter = drawEngine.ctx2.canvas.width / 2;\n    drawEngine.drawText(\n      'Meow Mountain',\n      xCenter,\n      100,\n      colors.blue0,\n      1, // center\n      0, // top\n      15\n    );\n    drawEngine.drawText(\n      'Press Enter to start',\n      xCenter,\n      230,\n      colors.white,\n      1, // center\n      0, // top\n      4\n    );\n    drawEngine.drawText(\n      'Press F to toggle fullscreen',\n      xCenter,\n      280,\n      colors.blue4,\n      1, // center\n      0, // top\n      4\n    );\n    this.updateControls();\n  }\n\n  updateControls() {\n    if (controls.isConfirm && !controls.previousState.isConfirm) {\n      gameStateMachine.setState(new GameState());\n    }\n\n    const fPressed = Boolean(controls.keyMap.get('KeyF'));\n    if (fPressed && !this.previousFPressed) {\n      toggleFullscreen();\n    }\n    this.previousFPressed = fPressed;\n  }\n};\n\nexport const menuState = new MenuState();\n","import { createGameStateMachine, gameStateMachine } from './game-state-machine';\nimport { controls } from '@/core/controls';\nimport { drawEngine } from './core/draw-engine';\nimport { updateTimeEvents } from './core/timer';\nimport { menuState } from './game-states/menu.state';\nimport { emit } from './core/event';\nimport { GameEvent } from './game/event-manifest';\n\n// @ts-ignore -- is not undefined for sure\ndocument.querySelector('link[type=\"image/x-icon\"]').href = 'data:image/svg+xml,%3Csvg xmlns=\\'http://www.w3.org/2000/svg\\' viewBox=\\'0 0 100 100\\'%3E%3Ctext y=\\'.9em\\' font-size=\\'85\\'%3E💜%3C/text%3E%3C/svg%3E';\n\nlet previousTime = 0;\n// let fpsBacklog: number[] = [];\nlet paused = false;\n\nwindow.addEventListener('blur', () => {\n  emit(GameEvent.PAUSE);\n  paused = true;\n});\nwindow.addEventListener('focus', () => {\n  emit(GameEvent.UNPAUSE);\n  paused = false;\n});\n\nfunction update(currentTime: number) {\n  if (paused) return;\n\n  currentTime = performance.now();\n  let delta = currentTime - previousTime;\n  previousTime = currentTime;\n  if (delta > 1000) {\n    return;\n  }\n    \n  // fpsBacklog.push(1000 / delta);\n  // if (fpsBacklog.length === 15) {\n  //   fps.innerHTML = `${Math.round(fpsBacklog.reduce((a, b) => a + b) / 15)} FPS`;\n  //   fpsBacklog = [];\n  // }\n\n  drawEngine.clear();\n\n  const state = gameStateMachine.getState();\n  controls.queryController();\n  state.onUpdate(delta);\n  updateTimeEvents(delta);\n};\n\n\ncreateGameStateMachine(menuState);\nsetInterval(update, 16);\n","import { State } from './state';\n\nexport class StateMachine {\n  private currentState: State;\n\n  constructor(initialState: State, ...enterArgs: any) {\n    this.currentState = initialState;\n    this.currentState.onEnter?.(...enterArgs);\n  }\n\n  setState(newState: State, ...enterArgs: any) {\n    this.currentState.onLeave?.();\n    this.currentState = newState;\n    this.currentState.onEnter?.(...enterArgs);\n  }\n\n  getState() {\n    return this.currentState;\n  }\n}\n"],"names":["addTimeEvent","callback","time","repeat","delay","timeEvents","push","timeLeft","updateTimeEvents","delta","i","length","timeEvent","splice","updatePositionSmoothly","state","timeElapsed","axis","targetPos","d","step","Math","sign","speed","abs","moving","round","gameStateMachine","controls","constructor","this","isUp","isDown","isLeft","isRight","isConfirm","isAction1","isMoving","keyMap","Map","previousState","document","addEventListener","event","toggleKey","inputDirection","DOMPoint","queryController","gamepad","navigator","getGamepads","leftVal","get","rightVal","upVal","downVal","x","axes","y","isPressed","set","code","getCtx","canvas","getContext","createCanvasWithCtx","w","h","c","createElement","width","height","createCanvas","quantizeToPalette","r","g","b","a","emojiToPixelArt","emoji","fontSize","spriteSize","floor","padding","_","tmpCtx","font","textBaseline","clearRect","translate","fillText","data","getImageData","outImg","createImageData","outData","outCanvas","outCtx","putImageData","img","Image","src","toDataURL","generateImageData","icon","iconPalette","transparent","palette","colorsPerByte","bytesPerColor","bitMask","size","sqrt","setAttribute","ctx","imgData","map","z","charCodeAt","bit","paletteIndex","hex","replace","parseInt","substring","NewTileset","spriteSheet","animations","tileSize","animationName","frames","Object","entries","frameData","colors","cat","villager","statue","obelisk","oak","spruce","grass","house","ground","split","e","GameAssets","initialize","cornerImage","cornerColor","fillStyle","fillRect","createCornerImage","tinyFont","characterCanvases","MAGIC","getCharacterData","letter","paddedBinary","leftmostCol","charWidth","toString","String","padStart","rightmostCol","col","row","min","max","makeCircle","centerX","centerY","radiusX","radiusY","skew","normalizedY","halfWidth","offset","rect","DrawEngine","canvasWidth","canvasHeight","cameraX","cameraY","zoom","targetCameraX","targetCameraY","targetZoom","cameraLerpSpeed","ctx1","c1","ctx2","c2","ctx3","c3","ctx4","c4","resizeCanvas","window","ctxs","imageSmoothingEnabled","drawCircumference","color","strokeWidth","save","beginPath","clip","fill","restore","drawText","text","textAlign","space","context","spacing","characters","toUpperCase","totalWidth","charPositions","forEach","character","char","letterHeight","offsetX","offsetY","charX","cacheKey","V","W","G","scaledWidth","match","bitIndex","adjustedCol","createCharacterCanvas","getCharacterCanvas","drawImage","mirrored","imgWidth","imgWeight","scale","drawBackgroundImage","imgHeight","setCamera","immediate","setTransform","updateCamera","resetCamera","clear","worldToScreen","worldX","worldY","drawEngine","CELL_WIDTH","CELL_HEIGHT","MAX_REPAIR","paths","clearings","statues","heart","name","moon","ear","eye","foot","tail","GameObject","tileset","type","animation","animationTime","animationFrame","aD","animationLoop","ceil","random","setPos","update","draw","on","listener","detail","emit","dispatchEvent","CustomEvent","linePixels","x0","y0","x1","y1","pixels","e2","dx","sx","dy","sy","err","PentagramAnimation","animationDone","pentagramRotation","PI","radius","elapsed","trailLength","cycles","maxCycles","active","cx","cy","points","angle","cos","sin","pentagramVertices","allPixels","totalDuration","newOffset","effectiveTrailLength","idx","isActive","forEachSurroundingCell","centerCol","centerRow","includeCenter","deltaRow","deltaCol","audioCtx","playSound","f","AudioContext","m","createBuffer","getChannelData","s","createBufferSource","buffer","connect","destination","start","n","repair","pitch","exp","Player","gameData","super","sleeping","attacking","scared","inVillage","pentagramAttack","stepSoundTimer","playerLookingAt","cellVillage","grid","village","coords","innerText","cutscene","isSurrounded","newRow","content","newCol","autoSelectTarget","attackAllEnemiesAround","pow","attackEnemyInFront","cell","takeDamage","spiritCount","currentCell","getLookingAt","directions","facing","spiritTarget","statueTarget","spiritFacing","statueFacing","dir","contentType","phase","GameStaticObject","Tree","treeType","neighbors","top","bottom","left","right","setNeighbors","SeededRandom","rngSeed","next","range","House","Villager","lastDirection","moveTimer","moveInterval","isScared","seesCat","takeNextStep","isValidMove","checkCol","checkRow","Farm","Village","center","houseCount","population","houses","farms","villagers","generatePosition","rng","existing","distance","some","item","generateHouses","pos","generateFarms","farmCount","generateVillagers","Icon","toKey","reconstructPath","parents","goal","path","current","unshift","defaultColors","drawHpBar","hp","maxHp","colorHP","hpWidth","barX","barY","spirits","reduce","acc","index","level","Spirit","opacity","searchRadius","dead","recoil","attackTimer","attackDuration","attackTarget","attackOffsetX","attackOffsetY","species","playerCoords","lookAroundForPlayer","moveTowardsPlayer","updateAttack","progress","dirX","dirY","windProgress","attackProgress","restProgress","searchCol","searchRow","maxSteps","steps","queue","visited","Set","shift","neighbour","has","add","findShortestPath","nextStep","globalAlpha","filter","damage","exorcise","Statue","maxSpirits","spawnTimer","spawnInterval","spawnChance","spawnRadius","State","BROKEN","repairD","repairAnimationTimer","spiritsExorcised","lastClearTime","updateAnimation","ANIMATING","REPAIRED","getLevel","spawnSpirit","replaceSpirit","spirit","drawFaries","postDraw","drawAnimation","t","theta","offsetDist","animationProgress","maxWidth","maxHeight","clearCircleWithJitter","emptyCells","selectedPosition","spiritTypes","values","randomType","GameMap","colCount","rowCount","villages","Array","from","_a","_b","tree","clearPathWithJitter","clearing","farm","fillCenterWithGrass","statueProps","farmCol","farmRow","clearPlants","converage","heartsPeak","villagePath","to","pathWidth","jitterAmount","jitterX","jitterY","ox","oy","clearX","clearY","fieldsOnly","border","probability","adjustedRadius","clearProbability","isCutscene","renderWidth","renderHeight","minCol","maxCol","minRow","maxRow","postDrawDrawables","drawHighlight","seenRadius","seen","drawable","easeInOutSine","pixelColors","field","unseen","default","MiniMap","lastUpdate","updateInterval","player","mapSize","my","mx","arc","DialogBox","dialog","boxHeight","margin","boxWidth","HUD","actions","renderSuperstition","renderLives","renderMagic","villageName","villageNameTimer","miniMap","dialogBox","drawLives","drawMagic","drawGoals","drawSuperstition","drawActions","drawInfoBox","enabled","startX","symbol","fullHearts","lives","emptyHearts","halfHearts","partialHearts","boxW","fullMagic","magic","emptyMagic","maxMagic","noMagic","MAX_MAGIC","goals","label","boxY","NOTIFICATION_DURATION","boxH","superstition","drawInfo","Obelisk","attemptRepair","Actions","cellInFront","canTeleport","canRestore","canSleep","canAttack","doRestore","object","GameData","hasClearedIntro","win","scene","q","heal","Story","script","currentStateKey","currentDialogIndex","previousSpacePressed","currentState","fullText","visibleCharacters","textAnimationTimer","charactersPerSecond","textAnimationState","stateKey","enterState","showCurrentDialog","spacePressed","spaceJustPressed","targetCharacters","emitCurrentVisibleText","handleSpacePress","dialogs","exitCurrentState","visibleText","isDone","GameStory","story","magicLevel","musicPlayer","startTime","isPlaying","audioContext","webkitAudioContext","resume","audioWorklet","addModule","musicProcessorNode","AudioWorkletNode","startMelody","port","postMessage","pause","unpause","stop","disconnect","GameState","playMusic","onLeave","onEnter","setState","menuState","hud","onUpdate","animationTimer","previousFPressed","bgColors","sectionHeight","sectionW","yOffset","offsetFreq","cols","rows","iconSize","drawBackground","xCenter","updateControls","fPressed","fullscreenElement","exitFullscreen","documentElement","requestFullscreen","querySelector","href","previousTime","paused","initialState","enterArgs","newState","getState","createGameStateMachine","setInterval","currentTime","performance","now"],"mappings":"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"}